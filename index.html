<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2021-07-08 Thu 18:42 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Doom Emacs Configuration</title>
<meta name="author" content="tecosaur" />
<meta name="generator" content="org mode" />
<meta name="theme-color" content="#77aa99" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Doom Emacs Configuration" />
<meta property="og:description" content="The Methods, Management, and Menagerie of Madness" />
<meta property="og:image" content="https://tecosaur.com/resources/org/nib.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="200" />
<meta property="og:image:height" content="200" />
<meta property="og:image:alt" content="Green fountain pen nib" />
<meta property="og:article:author:first_name" content="tecosaur" />
<meta property="og:article:published_time" content="2021-07-08T00:00:00+0000" />
<meta property="og:article:modified_time" content="2021-07-08T18:42:06+0000" />
<link rel="icon" href="https://tecosaur.com/resources/org/nib.ico" type="image/ico" />

<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/etbookot-roman-webfont.woff2">
<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/etbookot-italic-webfont.woff2">
<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/Merriweather-TextRegular.woff2">
<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/Merriweather-TextItalic.woff2">
<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/Merriweather-TextBold.woff2">
<script>
// @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&dn=expat.txt Expat
function copyPreToClipbord(btn) {
    const pre = btn.parentElement.parentElement.getElementsByTagName("PRE")[0];
    const range = document.createRange();
    range.selectNodeContents(pre);
    range.setEnd(pre.childNodes[pre.childNodes.length-1], 0);
    window.getSelection().addRange(range);
    var successful = document.execCommand('copy');
    window.getSelection().removeRange(range);
}
window.addEventListener('DOMContentLoaded', () => {
    if (document.getElementById("text-table-of-contents")) {
        const sections = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        const activate = (entry) => {
            entry.classList.add('active');
            if (["LI", "UL"].includes(entry.parentElement.tagName)) {
                activate(entry.parentElement);
            }
        };
        const activateLast = () => {
            document.querySelectorAll('#text-table-of-contents li.active, #text-table-of-contents ul.active').forEach(a => {
                a.classList.remove('active')
            });
            let mostRecent = { section: sections[0], bottom: -Infinity };
            const windowHeight = window.innerHeight;
            sections.forEach((section) => {
                const bounds = section.getBoundingClientRect()
                if ( bounds.bottom > mostRecent.bottom && bounds.top < windowHeight ) {
                    mostRecent = { section, bottom: bounds.bottom };
                }
            })
            activate(document.querySelector(`#text-table-of-contents li a[href="#${mostRecent.section.getAttribute('id')}"]`).parentElement);
        }
        const observer = new IntersectionObserver(entries => {
            activateLast();
        });
        sections.forEach((section) => {
            observer.observe(section);
        });}
});
// @license-end
</script>
<style>
/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */
html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}b{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}button{-webkit-appearance:button}button::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring{outline:1px dotted ButtonText}details{display:block}summary{display:list-item}
/*! end normalise.css */
#page{--accent: #002642;--accent-dark: #00151c;--code-foreground: #2c3e50;--code-background: #efefef;--code-func: #6c3163;--code-const: #4e3163;--code-regex: #655370;--back-white: #fff;--back-light: #f0eeed;--back-medium: #c8c8c8;--text-light: #7b7b7b;--text-gray: #444;--text-medium: #222;--text-dark: #000;--switch-icon: "ðŸŒš";--switch-shadow-color: #373d4e;--switch-text: "dark mode?"}#theme-switch:checked~#page{--accent: #002642;--accent-dark: #daf1ff;--code-foreground: #a1a8ae;--code-background: #222;--code-func: #bd56ad;--code-const: #8755ab;--code-regex: #a184b3;--back-white: #000;--back-light: #181818;--back-medium: #444;--text-light: #7b7b7b;--text-gray: #c8c8c8;--text-medium: #ddd;--text-dark: #efefef;--switch-icon: "ðŸŒ";--switch-shadow-color: #fce477;--switch-text: "light mode?"}#theme-switch:checked~#page img.invertible,#theme-switch:checked~#page object.invertible[type="image/svg+xml"]{filter:invert(90%) hue-rotate(180deg) sepia(1%)}#theme-switch{display:none}#switch-label{position:fixed;bottom:4rem;left:3rem}#switch-label::before{content:var(--switch-icon);font-size:20px;transition:text-shadow .2s}#switch-label::after{content:var(--switch-text);color:var(--switch-shadow-color);font-size:12px;visibility:hidden;margin-left:.5em;z-index:1;position:fixed;bottom:calc(4rem - 25px);left:calc(3rem - 10px)}@media (max-width:1000px){#switch-label{left:auto;bottom:auto;right:1vw;top:1vh}#switch-label::after{position:fixed;top:calc(1vh + 3px);right:calc(1vw + 30px);left:auto;bottom:auto}}#switch-label:hover::before,#theme-switch:focus~#page #switch-label::before{text-shadow:0 0 15px var(--switch-shadow-color)}#switch-label:hover::after,#theme-switch:focus~#page #switch-label::after{visibility:visible}@font-face{font-family:"Merriweather";src:url(https://tecosaur.com/resources/org/Merriweather-TextRegular.woff2) format("woff2");font-weight:400;font-style:normal;font-display:fallback}@font-face{font-family:"Merriweather";src:url(https://tecosaur.com/resources/org/Merriweather-TextItalic.woff2) format("woff2");font-weight:400;font-style:italic;font-display:fallback}@font-face{font-family:"Merriweather";src:url(https://tecosaur.com/resources/org/Merriweather-TextBold.woff2) format("woff2");font-weight:700;font-style:normal;font-display:fallback}@font-face{font-family:"et-book";src:url(https://tecosaur.com/resources/org/etbookot-roman-webfont.woff2) format("woff2");font-weight:400;font-style:normal;font-display:fallback}@font-face{font-family:"et-book";src:url(https://tecosaur.com/resources/org/etbookot-italic-webfont.woff2) format("woff2");font-weight:400;font-style:italic;font-display:fallback}::selection{background:var(--back-medium)}.pace .pace-progress{background-color:var(--accent)!important}body,html{height:100%}body{display:flex;flex-direction:column;font-size:16px;font-family:"Merriweather",serif}#page{color:var(--text-dark);background-color:var(--back-light);transition-property:color,background-color;transition-duration:100ms}#content,.page-header,header{margin:32px;flex:1 0 auto}#content{margin-top:4rem;min-height:calc(100vh - 4rem - 48px)}.clearfix::after{clear:both}.clearfix::after,.clearfix::before{content:" ";display:table}.page-header{margin-top:80px;margin-left:0!important}.page-header h1{font-size:40px;margin-bottom:10px;margin-top:10px;text-transform:none}.page-header h1 .subtitle{font-size:24px;color:var(--text-light);margin:0}.page-meta,figure figcaption .figure-number,header .site-nav{font-family:"Open Sans",sans;font-weight:400;font-style:normal;font-size:12px;line-height:1.9;color:var(--text-light)}header .site-nav{font-weight:700;line-height:2;margin-top:22px}header .site-nav a{color:var(--text-light);text-decoration:none;margin-left:10px}header .site-nav a:hover{color:var(--text-gray)}header .site-nav a.active{border-bottom:solid;border-bottom-width:2px}header .site-nav a:first-child{margin-left:0}header>div{display:inherit}.site-title{font-size:16px}.site-title span{display:none!important}.site-title ul{display:block!important;list-style:none;padding:0;margin:0}.site-title ul img{border-radius:2px;max-width:32px}.site-header nav a{color:var(--text-light);font-family:"Open Sans",sans;font-size:12px;font-weight:700;text-transform:uppercase}.site-header nav a:hover{border:0;color:var(--accent)}@media (max-width:1000px){header *{display:inline}}@media (min-width:1000px){#content,.page-header,header{max-width:720px;margin-left:164px}header .site-title{float:left}header .site-nav{float:right;margin-top:0}}@media (min-width:2800px){#content,.page-header,header{margin-left:auto;margin-right:auto}}#content .page-intro{font-family:"Open Sans",sans;font-weight:400;font-size:15px;line-height:1.6;color:var(--text-gray);margin-bottom:40px}#content dd,#content li,#content p{line-height:1.9}#footer{margin-top:70px;height:10px;background:var(--accent-dark)}.archive-item{margin:50px 0}.archive-item .archive-title{font-size:25px;margin:5px 0}.archive-item .archive-title,.archive-item .archive-title:hover{background:0 0;text-shadow:none;text-decoration:none}#postamble,details.code[open] summary .lang{display:none}aside{background-color:var(--code-background);border-radius:5px;margin:20px 0;padding:5px 20px 10px}#footnotes li,#footnotes p,.org-ref-bib,.org-ref-bib-h1,aside,aside p,blockquote footer{font-family:"Open Sans",sans;font-weight:400;color:var(--text-gray)}aside,aside p{font-size:15px;line-height:1.6!important}aside pre{font-size:12px;border:0;padding-left:0}@media (min-width:1280px){aside{float:right;clear:right;background-color:var(--back-white);max-width:45%!important;margin-right:-52%}aside::before{content:''}}blockquote{border-left-style:solid;border-width:0 0 0 1px;border-left-color:var(--back-medium);margin:20px 0;padding:0 0 0 15px}blockquote p{display:inline;font-size:13px}blockquote footer{font-style:normal;font-size:12px;line-height:1.9;color:var(--text-light);text-transform:none}div.info{background:rgba(58,129,195,.15);border-left:4px solid rgba(58,129,195,.45);margin:1.8rem 0 1.25rem 15px;padding:.8em;line-height:1.4;text-align:center;position:relative;clear:both}div.error p,div.info p,div.success p,div.warning p{margin:0}div.error::before,div.info::before,div.success::before,div.warning::before{color:var(--back-white);align-items:flex-end;top:-1rem;font-weight:700;font-size:1.4rem;display:inline-flex;justify-content:center;position:absolute;left:-1.2rem;text-align:center}div.info::before{content:"i";background:rgba(58,129,195,.8);-webkit-clip-path:circle(50% at 50% 50%);clip-path:circle(50% at 50% 50%);width:30px;height:30px;line-height:1.3}div.success{background:rgba(45,149,116,.15);border-left:4px solid rgba(45,149,116,.45)}div.error::before,div.success::before,div.warning::before{width:35px}div.success::before{content:"âœ”";background:rgba(45,149,116,.8);-webkit-clip-path:polygon(50% 0,100% 50%,50% 100%,0 50%);clip-path:polygon(50% 0,100% 50%,50% 100%,0 50%);height:35px;line-height:1.5}div.error,div.success,div.warning{margin:1.8rem 0 1.25rem 15px;padding:.8em;line-height:1.4;text-align:center;position:relative;clear:both}div.warning{background:rgba(220,117,47,.15);border-left:4px solid rgba(220,117,47,.45)}div.error::before,div.warning::before{content:"!";line-height:1.1}div.warning::before{background:rgba(220,117,47,.8);-webkit-clip-path:polygon(50% 0,0 100%,100% 100%);clip-path:polygon(50% 0,0 100%,100% 100%);height:35px}div.error{background:rgba(186,47,89,.15);border-left:4px solid rgba(186,47,89,.45)}div.error::before{background:rgba(186,47,89,.8);-webkit-clip-path:polygon(25% 0,75% 0,100% 50%,75% 100%,25% 100%,0 50%);clip-path:polygon(25% 0,75% 0,100% 50%,75% 100%,25% 100%,0 50%);height:30px}#footnotes li,#footnotes p,.org-ref-bib,.org-ref-bib-h1{line-height:1.6}.org-ref-bib-h1{margin-top:70px;padding-top:30px;border-top-style:solid;border-width:1px 0 0;border-color:var(--back-light);font-size:20px}#footnotes li,#footnotes p,.org-ref-bib{font-size:15px}.org-ref-bib li>a:nth-child(2),.org-ref-bib li>a:nth-child(2):hover{background:0 0;text-shadow:none;text-decoration:none}.org-ref-bib .bib-link{font-family:"Open Sans",sans;font-weight:400;font-style:normal;font-size:12px;line-height:1.9;color:var(--text-light);background:0 0;text-shadow:none;text-decoration:none}pre.example,pre.src{border-left-style:solid;border-width:0 0 0 1px;border-left-color:var(--back-medium);margin:20px 0;padding:0 0 0 15px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:14px;line-height:1.9;overflow-x:visible;box-shadow:none;white-space:pre-wrap;position:relative}pre.example{border-left-style:dotted;border-width:0 0 0 2px}pre.src::before{display:inline-block;position:absolute;background-color:transparent;top:unset;bottom:-16px;left:20px;padding:0;border:0;font-size:80%;font-style:italic;color:var(--text-light)}pre.src:empty{display:none}code{color:var(--code-foreground);padding:0 5px}kbd{display:inline-block;padding:.25em .35em;font:80% SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:80%;color:var(--text-gray);vertical-align:middle;background-color:var(--back-light);border:1px solid #91959a88;border-radius:.35em;box-shadow:inset 0 -1px 0 #91959a88}li code{font-size:14px}code,dl li p,li p code,ol li p,ul li p{font-size:15px}details.code{position:relative}details.code summary{position:relative;left:-3px;padding-left:10px;padding-bottom:4px;margin-left:-10px;z-index:1;outline:0;font-family:"Open Sans",sans;font-weight:400;font-style:normal;font-size:12px;line-height:1.9;color:var(--text-light)}details.code summary .name{font-size:14px;color:var(--text-medium);margin-right:.7em}code,details.code summary .lang{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace}details.code summary .lang{font-style:italic}details.code summary::marker{color:var(--back-medium)}details.code[open] summary{margin-bottom:-32px}details.code[open] summary.named{margin-bottom:-26px}details.code:not([open]) summary{margin-bottom:-5px}p+details.code{margin-top:-20px}li p+details.code{margin-top:-5px}.example,.src{color:var(--code-foreground)}.example .org-keyword,.src .org-keyword{color:#3a81c3}.example .org-variable-name,.src .org-variable-name{color:#715ab1}.example .org-rainbow-delimiters-depth-1,.example .org-rainbow-delimiters-depth-2,.example .org-rainbow-delimiters-depth-3,.example .org-rainbow-delimiters-depth-4,.example .org-rainbow-delimiters-depth-5,.example .org-rainbow-delimiters-depth-6,.example .org-rainbow-delimiters-depth-7,.example .org-rainbow-delimiters-depth-8,.example .org-rainbow-delimiters-depth-9,.src .org-rainbow-delimiters-depth-1,.src .org-rainbow-delimiters-depth-2,.src .org-rainbow-delimiters-depth-3,.src .org-rainbow-delimiters-depth-4,.src .org-rainbow-delimiters-depth-5,.src .org-rainbow-delimiters-depth-6,.src .org-rainbow-delimiters-depth-7,.src .org-rainbow-delimiters-depth-8,.src .org-rainbow-delimiters-depth-9{color:#555}.example .org-string,.src .org-string{color:#2d9574}.example .org-comment,.example .org-comment-delimiter,.src .org-comment,.src .org-comment-delimiter{color:#555}.example .org-function-name,.src .org-function-name{color:var(--code-func)}.example .org-constant,.example .org-highlight-numbers-number,.src .org-constant,.src .org-highlight-numbers-number{color:var(--code-const)}.gutter{position:absolute;top:0;left:-2.5rem;width:2rem;padding-right:.3rem;padding-top:5px;height:calc(100% - 10px);z-index:1;transition:opacity 200ms;opacity:0;font-size:15px}.gutter:hover{opacity:1}.gutter *{display:block;width:100%;text-align:right;padding:0;margin:0;color:var(--text-light)}#content .page-intro p a:hover:visited,#content .page-intro p a:visited,#footnotes a:hover:visited,#footnotes a:visited,.gutter :hover{color:var(--text-gray)}.gutter :active{font-weight:700}.gutter a{text-decoration:none;font-size:110%}.gutter button{background:0 0;border:0}pre.src-asymptote::before{content:'Asymptote'}pre.src-authinfo::before{content:'Authinfo'}pre.src-awk::before{content:'Awk'}pre.src-C::before{content:'C'}pre.src-clojure::before{content:'Clojure'}pre.src-css::before{content:'CSS'}pre.src-D::before{content:'D'}pre.src-ditaa::before{content:'ditaa'}pre.src-dot::before{content:'Graphviz'}pre.src-calc::before{content:'Emacs Calc'}pre.src-emacs-lisp::before{content:'Emacs Lisp'}pre.src-fortran::before{content:'Fortran'}pre.src-gnuplot::before{content:'gnuplot'}pre.src-haskell::before{content:'Haskell'}pre.src-hledger::before{content:'hledger'}pre.src-java::before{content:'Java'}pre.src-js::before{content:'Javascript'}pre.src-latex::before{content:'LaTeX'}pre.src-ledger::before{content:'Ledger'}pre.src-lisp::before{content:'Lisp'}pre.src-lilypond::before{content:'Lilypond'}pre.src-lua::before{content:'Lua'}pre.src-matlab::before{content:'MATLAB'}pre.src-mscgen::before{content:'Mscgen'}pre.src-ocaml::before{content:'Objective Caml'}pre.src-octave::before{content:'Octave'}pre.src-org::before{content:'Org mode'}pre.src-oz::before{content:'OZ'}pre.src-plantuml::before{content:'Plantuml'}pre.src-processing::before{content:'Processing.js'}pre.src-python::before{content:'Python'}pre.src-R::before{content:'R'}pre.src-ruby::before{content:'Ruby'}pre.src-sass::before{content:'Sass'}pre.src-scheme::before{content:'Scheme'}pre.src-screen::before{content:'Gnu Screen'}pre.src-sed::before{content:'Sed'}pre.src-sh::before{content:'shell'}pre.src-sql::before{content:'SQL'}pre.src-sqlite::before{content:'SQLite'}pre.src-forth::before{content:'Forth'}pre.src-io::before{content:'IO'}pre.src-J::before{content:'J'}pre.src-makefile::before{content:'Makefile'}pre.src-maxima::before{content:'Maxima'}pre.src-perl::before{content:'Perl'}pre.src-picolisp::before{content:'Pico Lisp'}pre.src-scala::before{content:'Scala'}pre.src-shell::before{content:'Shell Script'}pre.src-systemd::before{content:'Systemd'}pre.src-ebnf2ps::before{content:'ebfn2ps'}pre.src-cpp::before{content:'C++'}pre.src-abc::before{content:'ABC'}pre.src-coq::before{content:'Coq'}pre.src-groovy::before{content:'Groovy'}pre.src-bash::before{content:'bash'}pre.src-csh::before{content:'csh'}pre.src-ash::before{content:'ash'}pre.src-dash::before{content:'dash'}pre.src-ksh::before{content:'ksh'}pre.src-mksh::before{content:'mksh'}pre.src-posh::before{content:'posh'}pre.src-ada::before{content:'Ada'}pre.src-asm::before{content:'Assembler'}pre.src-caml::before{content:'Caml'}pre.src-delphi::before{content:'Delphi'}pre.src-html::before{content:'HTML'}pre.src-idl::before{content:'IDL'}pre.src-mercury::before{content:'Mercury'}pre.src-metapost::before{content:'MetaPost'}pre.src-modula-2::before{content:'Modula-2'}pre.src-pascal::before{content:'Pascal'}pre.src-ps::before{content:'PostScript'}pre.src-prolog::before{content:'Prolog'}pre.src-simula::before{content:'Simula'}pre.src-tcl::before{content:'tcl'}pre.src-tex::before{content:'LaTeX'}pre.src-plain-tex::before{content:'TeX'}pre.src-verilog::before{content:'Verilog'}pre.src-vhdl::before{content:'VHDL'}pre.src-nxml::before,pre.src-xml::before{content:'XML'}pre.src-conf::before{content:'Configuration File'}.dropcap{float:left;font-size:55px;font-style:normal;line-height:.1;margin-right:.2em;margin-top:.5em;padding:0}figure,th.org-center,th.org-left,th.org-right{text-align:center}#footnotes,figure figcaption{margin-top:10px;font-family:"Open Sans",sans;font-weight:400;font-size:15px;line-height:1.6;color:var(--text-gray)}img.zoomTarget:hover{cursor:default!important}img,object[type="image/svg+xml"]{filter:invert(7%) sepia(4%);max-width:100%}.org-svg{width:90%}#footnotes{margin-top:70px;padding-top:30px;border-top-style:solid;border-width:1px 0 0;border-color:var(--back-light)}#footnotes h2.footnotes{margin-top:0;margin-bottom:30px;font-family:"Open Sans",sans;font-size:18px;letter-spacing:5px;display:none}#footnotes .footnum{color:var(--text-dark)}h1,h2,h3,h4,h5,h6{font-family:"et-book",serif;font-weight:400;margin-bottom:0;margin-top:60px;padding-left:30px;margin-left:-30px;position:relative}h1>a[aria-hidden=true],h2>a[aria-hidden=true],h3>a[aria-hidden=true],h4>a[aria-hidden=true],h5>a[aria-hidden=true],h6>a[aria-hidden=true]{color:var(--back-medium);position:relative;top:.06em;line-height:1;font-size:110%;padding-left:.2em;text-decoration:none;visibility:hidden}h1>a[aria-hidden=true]:hover,h2>a[aria-hidden=true]:hover,h3>a[aria-hidden=true]:hover,h4>a[aria-hidden=true]:hover,h5>a[aria-hidden=true]:hover,h6>a[aria-hidden=true]:hover{color:var(--text-light)}h1:hover>a[aria-hidden=true],h2:hover>a[aria-hidden=true],h3:hover>a[aria-hidden=true],h4:hover>a[aria-hidden=true],h5:hover>a[aria-hidden=true],h6:hover>a[aria-hidden=true]{visibility:visible}h1{font-size:40px}.outline-2 h2,h2{font-size:30px}h3{font-size:24px}h4,h5,h6{font-size:20px}h4,h6{font-style:italic}h5{font-variant:small-caps}h6{font-size:18px}.section-number-1,.section-number-2,.section-number-3,.section-number-4,.section-number-5,.section-number-6{font-family:"Open Sans",sans;font-weight:400;font-style:normal;font-size:inherit;color:var(--text-light);line-height:1}@media (min-width:1000px){.section-number-1,.section-number-2,.section-number-3,.section-number-4,.section-number-5,.section-number-6{position:absolute;transform:translateX(-100%) translateX(-10px)}}.outline-text-2:-moz-only-whitespace+.outline-3>h3,.outline-text-2:empty+.outline-3>h3{margin-top:20px}.outline-text-3:-moz-only-whitespace+.outline-4>h4,.outline-text-3:empty+.outline-4>h4,.outline-text-4:-moz-only-whitespace+.outline-5>h5,.outline-text-4:empty+.outline-5>h5{margin-top:15px}.outline-text-5:-moz-only-whitespace+.outline-6>h6,.outline-text-5:empty+.outline-6>h6{margin-top:10px}hr{border:0;border-top-style:solid;border-top-width:1px;color:var(--back-medium);margin-bottom:30px;margin-top:40px}a{color:inherit}dl a,figcaption a,li a,p a,table a{border-radius:1px}.page-tags a,dl a,figcaption a,li a,p a,table a{background-image:linear-gradient(var(--text-dark),var(--text-dark));background-size:1px 1px;background-repeat:repeat-x;background-position:0 95%;text-decoration:none}#content .page-intro p a::selection,#footnotes a::selection,.page-tags a::selection,dl a::selection,figcaption a::selection,li a::selection,p a::selection,table a::selection{background:var(--back-medium)}#content .page-intro p a *,#content .page-intro p a :after,#content .page-intro p a :before,#content .page-intro p a:after,#content .page-intro p a:before,#footnotes a *,#footnotes a :after,#footnotes a :before,#footnotes a:after,#footnotes a:before,.page-tags a *,.page-tags a :after,.page-tags a :before,.page-tags a:after,.page-tags a:before,dl a *,dl a :after,dl a :before,dl a:after,dl a:before,figcaption a *,figcaption a :after,figcaption a :before,figcaption a:after,figcaption a:before,li a *,li a :after,li a :before,li a:after,li a:before,p a *,p a :after,p a :before,p a:after,p a:before,table a *,table a :after,table a :before,table a:after,table a:before{text-shadow:none}.page-tags a:visited,dl a:visited,figcaption a:visited,li a:visited,p a:visited,table a:visited{color:var(--text-dark)}.page-tags a:hover,dl a:hover,figcaption a:hover,li a:hover,p a:hover,table a:hover{opacity:.9;filter:drop-shadow(1px 1px 1px var(--back-white));background-image:linear-gradient(var(--text-dark),var(--text-dark));background-repeat:repeat-x;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg id='squiggle-link' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:ev='http://www.w3.org/2001/xml-events' viewBox='0 0 20 4'%3E%3Cstyle type='text/css'%3E.squiggle{animation:shift .3s linear infinite;}@keyframes shift {from {transform:translateX(0);}to {transform:translateX(-20px);}}%3C/style%3E%3Cpath fill='none' stroke='%23000000' stroke-width='2' class='squiggle' d='M0,3.5 c 5,0,5,-3,10,-3 s 5,3,10,3 c 5,0,5,-3,10,-3 s 5,3,10,3'/%3E%3C/svg%3E")!important;background-position:0 100%;background-size:.8em auto;text-decoration:none}.page-tags a:hover::selection,.page-tags a[href^="#"]::selection,.page-tags a[href^="#"]:hover::selection,dl a:hover::selection,dl a[href^="#"]::selection,dl a[href^="#"]:hover::selection,figcaption a:hover::selection,figcaption a[href^="#"]::selection,figcaption a[href^="#"]:hover::selection,li a:hover::selection,li a[href^="#"]::selection,li a[href^="#"]:hover::selection,p a:hover::selection,p a[href^="#"]::selection,p a[href^="#"]:hover::selection,table a:hover::selection,table a[href^="#"]::selection,table a[href^="#"]:hover::selection{background:var(--back-white)}.page-tags a[href^="#"],dl a[href^="#"],figcaption a[href^="#"],li a[href^="#"],p a[href^="#"],table a[href^="#"]{background-image:linear-gradient(var(--text-gray),var(--text-gray));background-size:1px 1px;background-repeat:repeat-x;background-position:0 95%}.page-tags a[href^="#"]:hover,dl a[href^="#"]:hover,figcaption a[href^="#"]:hover,li a[href^="#"]:hover,p a[href^="#"]:hover,table a[href^="#"]:hover{opacity:.9;filter:drop-shadow(1px 1px 1px var(--back-white));background-image:linear-gradient(var(--text-medium),var(--text-medium));background-size:1px 1px;background-repeat:repeat-x;background-position:0 95%}#theme-switch:checked~#page #breadcrumbs a:hover,#theme-switch:checked~#page #crosslinks a:not(.highlight):hover,#theme-switch:checked~#page .page-tags a:hover,#theme-switch:checked~#page dl a:hover,#theme-switch:checked~#page figcaption a:hover,#theme-switch:checked~#page li a:hover,#theme-switch:checked~#page p a:hover,#theme-switch:checked~#page table a:hover{background-image:url("data:image/svg+xml;charset=utf8,%3Csvg id='squiggle-link' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:ev='http://www.w3.org/2001/xml-events' viewBox='0 0 20 4'%3E%3Cstyle type='text/css'%3E.squiggle{animation:shift .3s linear infinite;}@keyframes shift {from {transform:translateX(0);}to {transform:translateX(-20px);}}%3C/style%3E%3Cpath fill='none' stroke='%23ffffff' stroke-width='2' class='squiggle' d='M0,3.5 c 5,0,5,-3,10,-3 s 5,3,10,3 c 5,0,5,-3,10,-3 s 5,3,10,3'/%3E%3C/svg%3E")}:target::before{content:"ðŸ –";position:absolute;left:-7rem;top:calc(.5em - 2rem);line-height:1;color:#e65353aa;font-size:3rem;font-style:normal}@media (max-width:1000px){:target::before{content:"ðŸ ”";left:unset;right:0}}#content .page-intro p a,#content .page-intro p a:hover,#footnotes a,#footnotes a:hover{background-image:linear-gradient(var(--text-gray),var(--text-gray));background-size:1px 1px;background-repeat:repeat-x;background-position:0 95%;border-radius:1px;text-decoration:none}#content .page-intro p a:hover::selection,#footnotes a:hover::selection{background:var(--back-medium)}#content .page-intro p a:hover *,#content .page-intro p a:hover :after,#content .page-intro p a:hover :before,#content .page-intro p a:hover:after,#content .page-intro p a:hover:before,#footnotes a:hover *,#footnotes a:hover :after,#footnotes a:hover :before,#footnotes a:hover:after,#footnotes a:hover:before{text-shadow:none}.btn,.btn:hover{background-image:none}.btn{padding:7px 14px;border-style:solid;border-width:1px;border-color:var(--back-light);border-radius:1px;font-family:"Open Sans",sans;font-variant:all-small-caps;font-size:14px;font-style:normal;letter-spacing:2px;cursor:pointer}.btn:hover{background-color:var(--back-light)}.btn.disabled,div.link-preview small{color:var(--text-light)}.btn.disabled:hover{cursor:default}.btn.small{border-style:solid;border-width:1px;border-color:var(--back-light);border-radius:1px;font-family:"Open Sans",sans;font-variant:all-small-caps;font-size:12px;font-style:normal;letter-spacing:2px;background-image:none;padding:3px 9px}.btn.small:hover{background-color:var(--back-light);background-image:none}.btn.highlight,.btn.primary{text-shadow:none;text-decoration:none}.btn.highlight{color:var(--text-dark);background-color:#ff0}.btn.primary{color:var(--back-white);background-color:var(--accent)}.btn.primary:hover,.done.active:hover,.page-tags a.active:hover,.tag>span.active:hover,.todo.active:hover{background-color:var(--back-light);background-image:none;color:var(--text-dark)}.image-link,.image-link:hover{background:0 0;text-shadow:none;text-decoration:none}div.link-preview{border:1px solid var(--back-medium);border-radius:.5em;overflow:hidden;position:relative;max-height:5em;padding-left:.5em}div.link-preview a{color:initial;text-decoration:none}div.link-preview img{border-right:1px solid var(--back-medium);float:left;height:5em;margin-left:-.5em;margin-right:.5em}div.link-preview p{margin:0;font-size:10pt}div.link-preview p b{font-size:11pt}div.link-preview small{float:right;font-family:sans;margin:.45em .6em}dl,ol,ul{list-style:none;list-style-position:outside;padding:0}dl dt::before,dl li::before,ol dt::before,ol li::before,ul dt::before,ul li::before{display:inline-block;width:1em;font-family:"Open Sans",sans;font-weight:400;font-size:15px;line-height:1.6;color:var(--text-gray)}dl li,ol li,ul li{margin:5px 0;font-size:14px}dl dt::before,ul li::before{content:"â€¢";margin-left:-1em}ol{counter-reset:li}ol li::before{content:counter(li);margin-left:-1.5em;margin-right:.5em;text-align:right;direction:rtl}ol li{counter-increment:li}ol ol,ul ul{padding-left:20px}ol ol ol,ul ul ul{padding-left:30px}li p:first-child{display:inline-block;margin-bottom:0}dl dt{font-weight:400;margin-bottom:10px}dl dd{font-style:italic;margin-bottom:20px}li .checkbox{display:inline-block;width:.9em;height:.9em;border-radius:3px;margin:3px;top:4px;position:relative}li.on>.checkbox{background:#2d9574;box-shadow:0 0 2px #2d9574}li.trans>.checkbox{background:#dc752f;box-shadow:0 0 2px #dc752f}li.off>.checkbox{background:#ba2f59;box-shadow:0 0 2px #ba2f59;top:6px}li.on>.checkbox::after{content:'';height:.45em;width:.225em;-webkit-transform-origin:left top;transform-origin:left top;transform:scaleX(-1) rotate(135deg);border-right:2.8px solid #fff;border-top:2.8px solid #fff;opacity:.9;left:.1em;top:.45em;position:absolute}li.trans>.checkbox::after{content:'';font-weight:700;font-size:1.6em;position:absolute;top:.2em;left:.11em;width:.35em;height:.12em;background:#fff;opacity:.9;border-radius:.1em}li.off>.checkbox::after{content:'âœ–';color:#fff;opacity:.9;position:relative;top:-.5rem;left:.17em;font-size:.75em}#org-div-home-and-up{display:none!important}.outline-3 h3{font-style:normal}.outline-2 .section-number-2{font-size:30px}.outline-3 .section-number-3,.outline-3 h3{font-size:24px}.done,.timestamp,.timestamp-kwd,.todo{border-radius:1px;font-family:"Open Sans",sans;font-style:normal;background-color:var(--back-white)}.timestamp,.timestamp-kwd{font-weight:400;font-size:12px;line-height:1.9;color:var(--text-light)}.done,.todo{border-color:var(--back-light);font-variant:all-small-caps;font-size:max(.4em,10px);letter-spacing:2px;background-image:none;line-height:1;white-space:nowrap;vertical-align:middle;padding:.1em .5em;background-color:transparent;border:0;font-weight:700}.page-tags a:hover{background-color:var(--back-light)}.done:hover,.tag>span:hover,.todo:hover{background-color:var(--back-light);background-image:none}.done:not(.active),.page-tags a:not(.active),.tag>span:not(.active),.todo:not(.active){border-color:var(--back-white)}.done.active,.page-tags a.active,.tag>span.active,.todo.active{text-shadow:none;text-decoration:none;color:var(--back-white);background-color:var(--code-foreground)}.outline-2,.outline-3,.outline-4{contain:layout}.outline-2 .done,.outline-2 .todo,.outline-3 .done,.outline-3 .todo,.outline-4 .done,.outline-4 .todo{font-size:18px}.todo{color:#e33}.done,.priority{color:var(--text-light)}.tag>span{border-style:solid;border-width:1px;border-color:var(--back-light);font-family:"Open Sans",sans;font-variant:all-small-caps;font-size:max(.4em,10px);font-style:normal;letter-spacing:2px;background-image:none;line-height:1;white-space:nowrap;vertical-align:middle;padding:.1em .5em;background-color:var(--back-white);border-radius:100px}.priority{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace}.footref{text-shadow:none}.footpara{display:inline}.footdef{margin-bottom:1em}td.org-right{text-align:right}td.org-left{text-align:left}div.org-center,td.org-center{text-align:center}span.acr{font-variant-caps:all-small-caps;letter-spacing:.1em}.music-track{display:flex;justify-content:center;align-items:center;flex-wrap:wrap}.music-track img{height:6rem;margin-right:2rem}.music-track a{text-decoration:none}.music-track span{min-width:35%}div.table{position:relative}div.table .gutter{left:calc(20px - 2.5rem);padding-top:18px}div.table .tabular{max-width:100%;overflow-x:auto}table,table thead{font-family:"Open Sans",sans;font-size:15px}table{border-color:var(--text-light);border-left:transparent;border-right:transparent;border-style:solid;border-width:2px;border-collapse:collapse;margin:20px;padding:20px}table thead{font-weight:400;font-style:normal;line-height:1.9;color:var(--text-light)}table thead tr th{padding:4px 10px;background-color:#9991}table thead tr:last-of-type th{border-bottom:solid 1px var(--text-light)}table td,table th,table tr{border:0}table tbody tr td{border-top:0;padding:0 10px}table tr{line-height:1.9}table caption,table caption .table-number{font-family:"Open Sans",sans;font-weight:400}table caption{margin-bottom:10px;font-size:15px;line-height:1.6;color:var(--text-gray)}table caption .table-number{font-style:normal;font-size:12px;line-height:1.9;color:var(--text-light)}::-webkit-scrollbar{width:10px;height:8px}::-webkit-scrollbar-track{background:#9992}::-webkit-scrollbar-thumb{background:#ccc}::-webkit-scrollbar-thumb:hover{background:#888}@media (min-width:1280px){#table-of-contents{position:fixed;width:18rem;right:1rem;top:0;padding:1em;line-height:1.5;margin-top:4rem}#table-of-contents h2{margin-top:0}#table-of-contents #text-table-of-contents{position:relative}#table-of-contents #text-table-of-contents::after,#table-of-contents #text-table-of-contents::before{position:absolute;content:'';width:calc(100% - 10px);height:.7rem;left:0;z-index:1}#table-of-contents #text-table-of-contents::before{top:0;background:linear-gradient(180deg,var(--back-light) 0%,var(--back-light) 35%,transparent 100%)}#table-of-contents #text-table-of-contents::after{bottom:0;background:linear-gradient(0deg,var(--back-light) 0%,var(--back-light) 35%,transparent 100%)}#table-of-contents #text-table-of-contents>ul{list-style:none;padding:0;margin:0;max-height:calc(100vh - 5rem - 50px);overflow-y:auto;overflow-x:hidden;scrollbar-width:thin}#table-of-contents #text-table-of-contents>ul ul{padding-left:2em}#table-of-contents #text-table-of-contents>ul li.active>ul,#table-of-contents #text-table-of-contents>ul ul.active{display:inline-block}#table-of-contents #text-table-of-contents>ul li.active>a,#table-of-contents #text-table-of-contents>ul li.active>label a{color:var(--text-dark)}#table-of-contents #text-table-of-contents>ul li.active>input:not(:checked)~label::after{transform:rotate(90deg);top:5px;opacity:.35}#table-of-contents #text-table-of-contents>ul>li:last-child{margin-bottom:2rem}}@media (min-width:1440px){#table-of-contents{width:20rem;right:2rem}}@media (min-width:1640px){#table-of-contents{right:5rem}}@media (min-width:2000px){#table-of-contents{width:25rem}}#table-of-contents #text-table-of-contents ul{width:100%}#table-of-contents #text-table-of-contents li input[type=checkbox],#table-of-contents #text-table-of-contents>ul ul{display:none}#table-of-contents #text-table-of-contents li label{display:inline-block;width:100%;position:relative}#table-of-contents #text-table-of-contents li a{display:inline-block;color:var(--text-gray);text-decoration:none!important;text-shadow:none;background:0 0!important}#table-of-contents #text-table-of-contents li label::after{content:"\25b6";color:var(--text-gray);margin-left:.5em;font-size:10px;display:inline-block;position:absolute;top:3.4px;left:-20px;opacity:.8}#table-of-contents #text-table-of-contents li input:checked~ul{display:inline-block!important}#table-of-contents #text-table-of-contents li input:checked~label a{font-weight:700}#table-of-contents #text-table-of-contents li input:checked~label::after{transform:rotate(90deg);top:5px}#table-of-contents #text-table-of-contents li::before{content:""!important}.page-tags a{border-style:solid;border-width:1px;border-color:var(--back-light);border-radius:1px;font-family:"Open Sans",sans;font-variant:all-small-caps;font-size:max(.4em,10px);font-style:normal;letter-spacing:2px;background-image:none;white-space:nowrap;vertical-align:middle;padding:.1em .5em;background-color:var(--back-white);margin-right:5px;line-height:3em}@media print{h2{page-break-before:always}h1,h2,h3,h4,h5{page-break-after:avoid}#switch-label,#table-of-contents #text-table-of-contents li label::after{display:none}#content,#page-header{margin-top:0}#table-of-contents #text-table-of-contents>ul ul{display:inline-block}#table-of-contents #text-table-of-contents>ul a::after{content:leader(".") target-counter(attr(href),page)}img{filter:none}}@page{size:auto;margin-top:4mm;margin-bottom:4mm}</style>
<link rel='shortcut icon' type='image/png' href='https://www.gnu.org/software/emacs/favicon.png'>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
<script>
    MathJax = {
      chtml: {
        scale: 1
      },
      svg: {
        scale: 1,
        fontCache: "global"
      },
      tex: {
        tags: "ams",
        multlineWidth: "85%",
        tagSide: "right",
        tagIndent: ".8em"
      }
    };
    </script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
<input type='checkbox' id='theme-switch'><div id='page'><label id='switch-label' for='theme-switch'></label><div id="content">
<header class="page-header"><div class="page-meta"><!--<a href="https://github.com/tecosaur/emacs-config/commit/402879a" style="text-decoration: none"><code style="padding: 0; color: var(--text-light); font-size: inherit; opacity: 0.7">402879a</code></a>--> 2021-07-08 18:40 <span class='acr'>UTC</span>, <a href="https://github.com/tecosaur/emacs-config/commit/402879a" style="text-decoration: none"><code style="padding: 0; color: var(--text-light); font-size: inherit; opacity: 0.7">402879a</code></a>, tecosaur</div>

<h1 class="title">Doom Emacs Configuration</h1>
<p class="subtitle" role="doc-subtitle">The Methods, Management, and Menagerie of Madness</p>
</header><nav id="table-of-contents">
<h2><a href="#" style="color:inherit; text-decoration: none;">Table of Contents</a></h2>
<div id="text-table-of-contents">
<ul>
<li><input type='checkbox' id='toc--intro'/><label for='toc--intro'><a href="#intro">1. Intro</a></label>
<ul>
<li><input type='checkbox' id='toc--why-emacs'/><label for='toc--why-emacs'><a href="#why-emacs">1.1. Why Emacs?</a></label>
<ul>
<li><a href="#enveloping-editor">1.1.1. The enveloping editor</a></li>
<li><a href="#some-notably-unique">1.1.2. Some notably unique features</a></li>
<li><a href="#issues">1.1.3. Issues</a></li>
<li><a href="#teach-man-fish">1.1.4. Teach a man to fish&#x2026;</a></li>
</ul>
</li>
<li><a href="#editor-comparison">1.2. Editor comparison</a></li>
<li><input type='checkbox' id='toc--notes-unwary-adventurer'/><label for='toc--notes-unwary-adventurer'><a href="#notes-unwary-adventurer">1.3. Notes for the unwary adventurer</a></label>
<ul>
<li><a href="#extra-requirements">1.3.1. Extra Requirements</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--current-issues'/><label for='toc--current-issues'><a href="#current-issues">1.4. Current Issues</a></label>
<ul>
<li><a href="#magit-push-daemon">1.4.1. Magit push in daemon</a></li>
<li><a href="#unread-emails-doesnt">1.4.2. Unread emails doesn&rsquo;t work across Emacs instances</a></li>
</ul>
</li>
</ul>
</li>
<li><input type='checkbox' id='toc--rudimentary-configuration'/><label for='toc--rudimentary-configuration'><a href="#rudimentary-configuration">2. Rudimentary configuration</a></label>
<ul>
<li><a href="#personal-information">2.1. Personal Information</a></li>
<li><input type='checkbox' id='toc--better-defaults'/><label for='toc--better-defaults'><a href="#better-defaults">2.2. Better defaults</a></label>
<ul>
<li><a href="#simple-settings">2.2.1. Simple settings</a></li>
<li><a href="#frame-sizing">2.2.2. Frame sizing</a></li>
<li><a href="#auto-customisations">2.2.3. Auto-customisations</a></li>
<li><a href="#windows">2.2.4. Windows</a></li>
<li><a href="#buffer-defaults">2.2.5. Buffer defaults</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--doom-configuration'/><label for='toc--doom-configuration'><a href="#doom-configuration">2.3. Doom configuration</a></label>
<ul>
<li><input type='checkbox' id='toc--modules'/><label for='toc--modules'><a href="#modules">2.3.1. Modules</a></label>
<ul>
<li><a href="#structure">2.3.1.1. Structure</a></li>
<li><a href="#interface">2.3.1.2. Interface</a></li>
<li><a href="#language-support">2.3.1.3. Language support</a></li>
<li><a href="#everything-emacs">2.3.1.4. Everything in Emacs</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--visual-settings'/><label for='toc--visual-settings'><a href="#visual-settings">2.3.2. Visual Settings</a></label>
<ul>
<li><a href="#font-face">2.3.2.1. Font Face</a></li>
<li><a href="#theme-modeline">2.3.2.2. Theme and modeline</a></li>
<li><a href="#miscellaneous">2.3.2.3. Miscellaneous</a></li>
</ul>
</li>
<li><a href="#some-helper-macros">2.3.3. Some helper macros</a></li>
<li><a href="#allow-babel-execution">2.3.4. Allow babel execution in <span class='acr'>CLI</span> actions</a></li>
<li><a href="#asyncronous-config-tangling">2.3.5. Asyncronous config tangling</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--other-things'/><label for='toc--other-things'><a href="#other-things">2.4. Other things</a></label>
<ul>
<li><input type='checkbox' id='toc--editor-interaction'/><label for='toc--editor-interaction'><a href="#editor-interaction">2.4.1. Editor interaction</a></label>
<ul>
<li><a href="#mouse-buttons">2.4.1.1. Mouse buttons</a></li>
</ul>
</li>
<li><a href="#window-title">2.4.2. Window title</a></li>
<li><a href="#splash-screen">2.4.3. Splash screen</a></li>
<li><a href="#systemd-daemon">2.4.4. Systemd daemon</a></li>
<li><a href="#emacs-client-wrapper">2.4.5. Emacs client wrapper</a></li>
</ul>
</li>
</ul>
</li>
<li><input type='checkbox' id='toc--package-loading'/><label for='toc--package-loading'><a href="#package-loading">3. Package loading</a></label>
<ul>
<li><input type='checkbox' id='toc--loading-instructions'/><label for='toc--loading-instructions'><a href="#loading-instructions">3.1. Loading instructions</a></label>
<ul>
<li><a href="#packages-melpa-elpa">3.1.1. Packages in <span class='acr'>MELPA</span>/<span class='acr'>ELPA</span>/emacsmirror</a></li>
<li><a href="#packages-from-git">3.1.2. Packages from git repositories</a></li>
<li><a href="#disabling-built-packages">3.1.3. Disabling built-in packages</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--general-packages'/><label for='toc--general-packages'><a href="#general-packages">3.2. General packages</a></label>
<ul>
<li><a href="#window-management">3.2.1. Window management</a></li>
<li><a href="#fun">3.2.2. Fun</a></li>
<li><input type='checkbox' id='toc--features'/><label for='toc--features'><a href="#features">3.2.3. Features</a></label>
<ul>
<li><a href="#calctex">3.2.3.1. CalcTeX</a></li>
<li><a href="#emacs-everywhere">3.2.3.2. Emacs everywhere</a></li>
<li><a href="#ess">3.2.3.3. <span class='acr'>ESS</span></a></li>
<li><a href="#magit-delta">3.2.3.4. Magit Delta</a></li>
<li><a href="#info-colours">3.2.3.5. Info colours</a></li>
<li><a href="#large-files">3.2.3.6. Large files</a></li>
<li><a href="#definitions">3.2.3.7. Definitions</a></li>
<li><a href="#calibre-ebook-reading">3.2.3.8. Calibre and ebook reading</a></li>
<li><a href="#screenshots">3.2.3.9. Screenshots</a></li>
<li><a href="#prettier-page-break">3.2.3.10. Prettier page break lines</a></li>
</ul>
</li>
</ul>
</li>
<li><input type='checkbox' id='toc--language-packages'/><label for='toc--language-packages'><a href="#language-packages">3.3. Language packages</a></label>
<ul>
<li><a href="#latex">3.3.1. LaTeX</a></li>
<li><input type='checkbox' id='toc--org-mode'/><label for='toc--org-mode'><a href="#org-mode">3.3.2. Org Mode</a></label>
<ul>
<li><a href="#improve-agenda-capture">3.3.2.1. Improve agenda/capture</a></li>
<li><a href="#visuals">3.3.2.2. Visuals</a></li>
<li><a href="#extra-functionality">3.3.2.3. Extra functionality</a></li>
</ul>
</li>
<li><a href="#systemd">3.3.3. Systemd</a></li>
<li><a href="#stan">3.3.4. Stan</a></li>
<li><a href="#graphviz">3.3.5. Graphviz</a></li>
<li><a href="#authinfo">3.3.6. Authinfo</a></li>
<li><a href="#beancount-accounting">3.3.7. Beancount (accounting)</a></li>
</ul>
</li>
</ul>
</li>
<li><input type='checkbox' id='toc--package-configuration'/><label for='toc--package-configuration'><a href="#package-configuration">4. Package configuration</a></label>
<ul>
<li><a href="#abbrev-mode">4.1. Abbrev mode</a></li>
<li><a href="#all-icons">4.2. All the icons</a></li>
<li><a href="#avy">4.3. Avy</a></li>
<li><input type='checkbox' id='toc--calc'/><label for='toc--calc'><a href="#calc">4.4. Calc</a></label>
<ul>
<li><a href="#defaults">4.4.1. Defaults</a></li>
<li><a href="#calc-calctex">4.4.2. CalcTeX</a></li>
<li><a href="#embedded-calc">4.4.3. Embedded calc</a></li>
</ul>
</li>
<li><a href="#centaur-tabs">4.5. Centaur Tabs</a></li>
<li><input type='checkbox' id='toc--company'/><label for='toc--company'><a href="#company">4.6. Company</a></label>
<ul>
<li><a href="#plain-text">4.6.1. Plain Text</a></li>
<li><a href="#company-ess">4.6.2. <span class='acr'>ESS</span></a></li>
</ul>
</li>
<li><a href="#doom-modeline">4.7. Doom modeline</a></li>
<li><a href="#elcord">4.8. Elcord</a></li>
<li><a href="#package-configuration-emacs">4.9. Emacs Everywhere</a></li>
<li><a href="#emojify">4.10. Emojify</a></li>
<li><a href="#eros-eval">4.11. Eros-eval</a></li>
<li><a href="#evil">4.12. <span class='acr'>EVIL</span></a></li>
<li><a href="#package-configuration-info">4.13. Info colours</a></li>
<li><input type='checkbox' id='toc--ispell'/><label for='toc--ispell'><a href="#ispell">4.14. Ispell</a></label>
<ul>
<li><input type='checkbox' id='toc--downloading-dictionaries'/><label for='toc--downloading-dictionaries'><a href="#downloading-dictionaries">4.14.1. Downloading dictionaries</a></label>
<ul>
<li><a href="#hunspell">4.14.1.1. Hunspell</a></li>
<li><a href="#aspell">4.14.1.2. Aspell</a></li>
</ul>
</li>
<li><a href="#configuration">4.14.2. Configuration</a></li>
</ul>
</li>
<li><a href="#ivy">4.15. Ivy</a></li>
<li><a href="#magit">4.16. Magit</a></li>
<li><a href="#mixed-pitch">4.17. Mixed pitch</a></li>
<li><a href="#org-chef">4.18. Org Chef</a></li>
<li><a href="#projectile">4.19. Projectile</a></li>
<li><a href="#smart-parentheses">4.20. Smart Parentheses</a></li>
<li><a href="#spray">4.21. Spray</a></li>
<li><a href="#theme-magic">4.22. Theme magic</a></li>
<li><input type='checkbox' id='toc--tramp'/><label for='toc--tramp'><a href="#tramp">4.23. Tramp</a></label>
<ul>
<li><input type='checkbox' id='toc--troubleshooting'/><label for='toc--troubleshooting'><a href="#troubleshooting">4.23.1. Troubleshooting</a></label>
<ul>
<li><a href="#zsh">4.23.1.1. Zsh</a></li>
</ul>
</li>
<li><a href="#guix">4.23.2. Guix</a></li>
</ul>
</li>
<li><a href="#treemacs">4.24. Treemacs</a></li>
<li><a href="#which-key">4.25. Which-key</a></li>
<li><a href="#writeroom">4.26. Writeroom</a></li>
<li><a href="#xkcd">4.27. xkcd</a></li>
<li><a href="#yasnippet">4.28. YASnippet</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--applications'/><label for='toc--applications'><a href="#applications">5. Applications</a></label>
<ul>
<li><a href="#ebooks">5.1. Ebooks</a></li>
<li><input type='checkbox' id='toc--irc'/><label for='toc--irc'><a href="#irc">5.2. <span class='acr'>IRC</span></a></label>
<ul>
<li><a href="#org-style-emphasis">5.2.1. Org-style emphasis</a></li>
<li><a href="#emojis">5.2.2. Emojis</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--newsfeed'/><label for='toc--newsfeed'><a href="#newsfeed">5.3. Newsfeed</a></label>
<ul>
<li><a href="#keybindings">5.3.1. Keybindings</a></li>
<li><a href="#usability-enhancements">5.3.2. Usability enhancements</a></li>
<li><a href="#visual-enhancements">5.3.3. Visual enhancements</a></li>
<li><a href="#functionality-enhancements">5.3.4. Functionality enhancements</a></li>
</ul>
</li>
<li><a href="#dictionary">5.4. Dictionary</a></li>
<li><input type='checkbox' id='toc--mail'/><label for='toc--mail'><a href="#mail">5.5. Mail</a></label>
<ul>
<li><input type='checkbox' id='toc--fetching'/><label for='toc--fetching'><a href="#fetching">5.5.1. Fetching</a></label>
<ul>
<li><a href="#rebuild-mail-index">5.5.1.1. Rebuild mail index while using mu4e</a></li>
<li><a href="#config-transcoding-service">5.5.1.2. Config transcoding &amp; service management</a></li>
<li><a href="#fetching-systemd">5.5.1.3. Systemd</a></li>
</ul>
</li>
<li><a href="#indexing-searching">5.5.2. Indexing/Searching</a></li>
<li><input type='checkbox' id='toc--sending'/><label for='toc--sending'><a href="#sending">5.5.3. Sending</a></label>
<ul>
<li><a href="#system-hackery">5.5.3.1. System hackery</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--mu4e'/><label for='toc--mu4e'><a href="#mu4e">5.5.4. Mu4e</a></label>
<ul>
<li><a href="#viewing-mail">5.5.4.1. Viewing Mail</a></li>
<li><a href="#sending-mail">5.5.4.2. Sending Mail</a></li>
</ul>
</li>
<li><a href="#org-msg">5.5.5. Org Msg</a></li>
</ul>
</li>
</ul>
</li>
<li><input type='checkbox' id='toc--language-configuration'/><label for='toc--language-configuration'><a href="#language-configuration">6. Language configuration</a></label>
<ul>
<li><input type='checkbox' id='toc--general'/><label for='toc--general'><a href="#general">6.1. General</a></label>
<ul>
<li><a href="#file-templates">6.1.1. File Templates</a></li>
</ul>
</li>
<li><a href="#plaintext">6.2. Plaintext</a></li>
<li><input type='checkbox' id='toc--org'/><label for='toc--org'><a href="#org">6.3. Org</a></label>
<ul>
<li><input type='checkbox' id='toc--system-config'/><label for='toc--system-config'><a href="#system-config">6.3.1. System config</a></label>
<ul>
<li><a href="#mime-types">6.3.1.1. Mime types</a></li>
<li><a href="#git-diffs">6.3.1.2. Git diffs</a></li>
<li><a href="#development">6.3.1.3. Development</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--behaviour'/><label for='toc--behaviour'><a href="#behaviour">6.3.2. Behaviour</a></label>
<ul>
<li><a href="#tweaking-defaults">6.3.2.1. Tweaking defaults</a></li>
<li><input type='checkbox' id='toc--behaviour-extra-functionality'/><label for='toc--behaviour-extra-functionality'><a href="#behaviour-extra-functionality">6.3.2.2. Extra functionality</a></label>
<ul>
<li><a href="#org-buffer-creation">6.3.2.2.1. Org buffer creation</a></li>
<li><a href="#utility-zero-width">6.3.2.2.2. The utility of zero-width spaces</a></li>
<li><a href="#list-bullet-sequence">6.3.2.2.3. List bullet sequence</a></li>
<li><a href="#citation">6.3.2.2.4. Citation</a></li>
<li><a href="#cdlatex">6.3.2.2.5. cdlatex</a></li>
<li><a href="#spellcheck">6.3.2.2.6. Spellcheck</a></li>
<li><a href="#lsp-support-src">6.3.2.2.7. <span class='acr'>LSP</span> support in <code>src</code> blocks</a></li>
<li><a href="#view-exported-file">6.3.2.2.8. View exported file</a></li>
</ul>
</li>
<li><a href="#super-agenda">6.3.2.3. Super agenda</a></li>
<li><a href="#capture">6.3.2.4. Capture</a></li>
<li><input type='checkbox' id='toc--roam'/><label for='toc--roam'><a href="#roam">6.3.2.5. Roam</a></label>
<ul>
<li><a href="#basic-settings">6.3.2.5.1. Basic settings</a></li>
<li><a href="#registering-roam-protocol">6.3.2.5.2. Registering roam protocol</a></li>
<li><a href="#graph-behaviour">6.3.2.5.3. Graph Behaviour</a></li>
<li><a href="#modeline-file-name">6.3.2.5.4. Modeline file name</a></li>
</ul>
</li>
<li><a href="#nicer-generated-heading">6.3.2.6. Nicer generated heading <span class='acr'>ID</span><small>s</small></a></li>
<li><a href="#nicer-org-return">6.3.2.7. Nicer <code>org-return</code></a></li>
<li><a href="#snippet-helpers">6.3.2.8. Snippet Helpers</a></li>
<li><a href="#translate-capital-keywords">6.3.2.9. Translate capital keywords (old) to lower case (new)</a></li>
<li><input type='checkbox' id='toc--extra-links'/><label for='toc--extra-links'><a href="#extra-links">6.3.2.10. Extra links</a></label>
<ul>
<li><a href="#extra-links-xkcd">6.3.2.10.1. xkcd</a></li>
<li><a href="#music">6.3.2.10.2. Music</a></li>
<li><a href="#youtube">6.3.2.10.3. YouTube</a></li>
</ul>
</li>
<li><a href="#fix-problematic-hooks">6.3.2.11. Fix problematic hooks</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--org-visuals'/><label for='toc--org-visuals'><a href="#org-visuals">6.3.3. Visuals</a></label>
<ul>
<li><a href="#font-display">6.3.3.1. Font Display</a></li>
<li><a href="#fontifying-inline-src">6.3.3.2. Fontifying inline src blocks</a></li>
<li><a href="#symbols">6.3.3.3. Symbols</a></li>
<li><input type='checkbox' id='toc--latex-fragments'/><label for='toc--latex-fragments'><a href="#latex-fragments">6.3.3.4. LaTeX Fragments</a></label>
<ul>
<li><a href="#prettier-highlighting">6.3.3.4.1. Prettier highlighting</a></li>
<li><a href="#more-eager-rendering">6.3.3.4.2. More eager rendering</a></li>
<li><a href="#prettier-rendering">6.3.3.4.3. Prettier rendering</a></li>
<li><a href="#rendering-speed-tests">6.3.3.4.4. Rendering speed tests</a></li>
</ul>
</li>
<li><a href="#stolen-from-scimax">6.3.3.5. Stolen from scimax (semi-working right now)</a></li>
<li><a href="#org-plot">6.3.3.6. Org Plot</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--exporting'/><label for='toc--exporting'><a href="#exporting">6.3.4. Exporting</a></label>
<ul>
<li><a href="#general-settings">6.3.4.1. General settings</a></li>
<li><a href="#acronym-formatting">6.3.4.2. Acronym formatting</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--html-export'/><label for='toc--html-export'><a href="#html-export">6.3.5. <span class='acr'>HTML</span> Export</a></label>
<ul>
<li><a href="#extra-header-content">6.3.5.1. Extra header content</a></li>
<li><a href="#custom-css-js">6.3.5.2. Custom <span class='acr'>CSS</span>/<span class='acr'>JS</span></a></li>
<li><a href="#collapsable-src-example">6.3.5.3. Collapsable src and example blocks</a></li>
<li><a href="#include-extra-font">6.3.5.4. Include extra font-locking in htmlize</a></li>
<li><a href="#handle-table-overflow">6.3.5.5. Handle table overflow</a></li>
<li><a href="#toc-as-collapsable">6.3.5.6. <span class='acr'>TOC</span> as a collapsable tree</a></li>
<li><a href="#make-verbatim-different">6.3.5.7. Make verbatim different to code</a></li>
<li><a href="#change-checkbox-type">6.3.5.8. Change checkbox type</a></li>
<li><a href="#extra-special-strings">6.3.5.9. Extra special strings</a></li>
<li><a href="#header-anchors">6.3.5.10. Header anchors</a></li>
<li><a href="#link-previews">6.3.5.11. Link previews</a></li>
<li><input type='checkbox' id='toc--latex-rendering'/><label for='toc--latex-rendering'><a href="#latex-rendering">6.3.5.12. LaTeX Rendering</a></label>
<ul>
<li><a href="#pre-rendered">6.3.5.12.1. Pre-rendered</a></li>
<li><a href="#mathjax">6.3.5.12.2. MathJax</a></li>
</ul>
</li>
</ul>
</li>
<li><input type='checkbox' id='toc--latex-export'/><label for='toc--latex-export'><a href="#latex-export">6.3.6. LaTeX Export</a></label>
<ul>
<li><a href="#compiling">6.3.6.1. Compiling</a></li>
<li><a href="#nicer-checkboxes">6.3.6.2. Nicer checkboxes</a></li>
<li><a href="#class-templates">6.3.6.3. Class templates</a></li>
<li><input type='checkbox' id='toc--cleverer-preamble'/><label for='toc--cleverer-preamble'><a href="#cleverer-preamble">6.3.6.4. A cleverer preamble</a></label>
<ul>
<li><a href="#use-case">6.3.6.4.1. Use case</a></li>
<li><a href="#conditional-content">6.3.6.4.2. Conditional Content</a></li>
<li><a href="#content-feature-preamble">6.3.6.4.3. Content-feature-preamble association</a></li>
<li><a href="#feature-determination">6.3.6.4.4. Feature determination</a></li>
<li><a href="#preamble-generation">6.3.6.4.5. Preamble generation</a></li>
<li><a href="#reduce-default-packages">6.3.6.4.6. Reduce default packages</a></li>
</ul>
</li>
<li><a href="#font-collections">6.3.6.5. Font collections</a></li>
<li><a href="#cover-page">6.3.6.6. Cover page</a></li>
<li><a href="#condensed-lists">6.3.6.7. Condensed lists</a></li>
<li><a href="#pretty-code-blocks">6.3.6.8. Pretty code blocks</a></li>
<li><a href="#julia-code-blocks">6.3.6.9. Julia code blocks</a></li>
<li><a href="#latex-export-emojis">6.3.6.10. Emojis</a></li>
<li><a href="#remove-non-ascii">6.3.6.11. Remove non-ascii chars</a></li>
<li><a href="#latex-export-extra">6.3.6.12. Extra special strings</a></li>
<li><a href="#support-images-from">6.3.6.13. Support images from <span class='acr'>URL</span><small>s</small></a></li>
<li><a href="#chameleon-aka-match">6.3.6.14. Chameleon &#x2014; aka. match theme</a></li>
<li><a href="#latex-export-make">6.3.6.15. Make verbatim different to code</a></li>
<li><a href="#no-auctex-please">6.3.6.16. No AucTeX please</a></li>
<li><a href="#check-required-packages">6.3.6.17. Check for required packages</a></li>
</ul>
</li>
<li><a href="#beamer-export">6.3.7. Beamer Export</a></li>
<li><a href="#reveal-export">6.3.8. Reveal export</a></li>
<li><a href="#ascii-export">6.3.9. <span class='acr'>ASCII</span> export</a></li>
<li><a href="#markdown-export">6.3.10. Markdown Export</a></li>
<li><a href="#babel">6.3.11. Babel</a></li>
<li><a href="#org-ess">6.3.12. <span class='acr'>ESS</span></a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--language-configuration-latex'/><label for='toc--language-configuration-latex'><a href="#language-configuration-latex">6.4. LaTeX</a></label>
<ul>
<li><a href="#be-implemented-ideas">6.4.1. To-be-implemented ideas</a></li>
<li><a href="#compilation">6.4.2. Compilation</a></li>
<li><input type='checkbox' id='toc--latex-snippet-helpers'/><label for='toc--latex-snippet-helpers'><a href="#latex-snippet-helpers">6.4.3. Snippet helpers</a></label>
<ul>
<li><a href="#template">6.4.3.1. Template</a></li>
<li><a href="#deliminators">6.4.3.2. Deliminators</a></li>
</ul>
</li>
<li><a href="#editor-visuals">6.4.4. Editor visuals</a></li>
<li><a href="#latex-cdlatex">6.4.5. CDLaTeX</a></li>
<li><a href="#synctex">6.4.6. SyncTeX</a></li>
<li><a href="#fixes">6.4.7. Fixes</a></li>
</ul>
</li>
<li><a href="#python">6.5. Python</a></li>
<li><a href="#pdf">6.6. <span class='acr'>PDF</span></a></li>
<li><input type='checkbox' id='toc--r'/><label for='toc--r'><a href="#r">6.7. R</a></label>
<ul>
<li><a href="#r-editor-visuals">6.7.1. Editor Visuals</a></li>
</ul>
</li>
<li><a href="#julia">6.8. Julia</a></li>
<li><a href="#language-configuration-graphviz">6.9. Graphviz</a></li>
<li><a href="#markdown">6.10. Markdown</a></li>
<li><a href="#beancount">6.11. Beancount</a></li>
<li><input type='checkbox' id='toc--snippets'/><label for='toc--snippets'><a href="#snippets">6.12. Snippets</a></label>
<ul>
<li><a href="#latex-mode">6.12.1. Latex mode</a></li>
<li><a href="#markdown-mode">6.12.2. Markdown mode</a></li>
<li><a href="#snippets-org-mode">6.12.3. Org mode</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<a href="https://github.com/tecosaur/emacs-config/"
   style="font-family: 'Open Sans'; background-image: none; color: inherit;
   text-decoration: none; position: relative; top: clamp(-26px, calc(1280px - 100vw), 0px); opacity: 0.7;">
  <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg"
       class="invertible" alt="GitHub Octicon"
       style="height: 1em; position: relative; top: 0.1em;">
  View on GitHub</a>

<blockquote>
<p>
Let us change our traditional attitude to the construction of programs:
Instead of imagining that our main task is to instruct a computer what to do,
let us concentrate rather on explaining to human beings what we want a
computer to do. &#x2014; Donald Knuth
</p>
</blockquote>

<div id="outline-container-intro" class="outline-2">
<h2 id="intro"><span class="section-number-2">1</span> Intro<a aria-hidden="true" href="#intro">#</a> </h2>
<div class="outline-text-2" id="text-1">
<p>
Customising an editor can be very rewarding &#x2026; until you have to leave it.
For years I have been looking for ways to avoid this pain.
Then I discovered <a href="https://github.com/cknadler/vim-anywhere">vim-anywhere</a>, and found that it had an Emacs companion,
<a href="https://github.com/zachcurry/emacs-anywhere">emacs-anywhere</a>. To me, this looked most attractive.
</p>

<p>
Separately, online I have seen the following statement enough times I think it&rsquo;s a catchphrase
</p>
<blockquote>
<p>
Redditor 1: I just discovered this thing, isn&rsquo;t it cool. <br>
Redditor 2: Oh, there&rsquo;s an Emacs mode for that.
</p>
</blockquote>

<p>
This was enough for me to install Emacs, but I soon learned there are <a href="https://github.com/remacs/remacs#why-emacs">far more
compelling reasons</a> to keep using it.
</p>

<p>
I tried out the <kbd>spacemacs</kbd> distribution a bit, but it wasn&rsquo;t quite to my liking.
Then I heard about <kbd>doom emacs</kbd> and thought I may as well give that a try.
<span class='acr'>TLDR</span>; it&rsquo;s great.
</p>

<p>
Now I&rsquo;ve discovered the wonders of literate programming, and am becoming more
settled by the day. This is both my config, and a cautionary tale (just replace
&ldquo;Linux&rdquo; with &ldquo;Emacs&rdquo; in the comic below).
</p>

<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/cautionary.png' title="This really is a true story, and she doesn't know I put it in my comic because her wifi hasn't worked for weeks." alt='Cautionary'>
</p>
</div>

<div id="outline-container-why-emacs" class="outline-3">
<h3 id="why-emacs"><span class="section-number-3">1.1</span> Why Emacs?<a aria-hidden="true" href="#why-emacs">#</a> </h3>
<div class="outline-text-3" id="text-1-1">
<p>
Emacs is <a href="https://www.eigenbahn.com/2020/01/12/emacs-is-no-editor">not a text editor</a>, this is a common misnomer. It is far more apt to
describe Emacs as <i>a Lisp machine providing a generic user-centric text
manipulation environment</i>. That&rsquo;s quite a mouthful.
In simpler terms one can think of Emacs as a platform for text-related
applications. It&rsquo;s a vague and generic definition because Emacs itself is
generic.
</p>

<p>
Good with text. How far does that go? A lot further than one initially thinks:
</p>
<ul class="org-ul">
<li><a href="https://orgmode.org/">Task planning</a></li>
<li><a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Dired.html">File management</a></li>
<li><a href="https://github.com/akermu/emacs-libvterm">Terminal emulation</a></li>
<li><a href="https://www.djcbsoftware.nl/code/mu/mu4e.html">Email client</a></li>
<li><a href="https://www.gnu.org/software/tramp/">Remote server tool</a></li>
<li><a href="https://magit.vc/">Git frontend</a></li>
<li>Web <a href="https://github.com/pashky/restclient.el">client</a>/<a href="https://github.com/skeeto/emacs-web-server">server</a></li>
<li>and more&#x2026;</li>
</ul>

<p>
Ideally, one may use Emacs as <i>the</i> interface to perform <kbd>input â†’ transform â†’
output</kbd> cycles, i.e. form a bridge between the human mind and information
manipulation.
</p>
</div>

<div id="outline-container-enveloping-editor" class="outline-4">
<h4 id="enveloping-editor"><span class="section-number-4">1.1.1</span> The enveloping editor<a aria-hidden="true" href="#enveloping-editor">#</a> </h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
Emacs allows one to do more in one place than any other application. Why is this
good?
</p>
<ul class="org-ul">
<li>Enables one to complete tasks with a consistent, standard set of keybindings,
<span class='acr'>GUI</span> and editing methods &#x2014; learn once, use everywhere</li>
<li>Reduced context-switching</li>
<li>Compressing the stages of a project &#x2014; a more centralised workflow can progress
with greater ease</li>
<li>Integration between tasks previously relegated to different applications, but
with a common subject &#x2014; e.g. linking to an email in a to-do list</li>
</ul>

<p>
Emacs can be thought of as a platform within which various elements of your
workflow may settle, with the potential for rich integrations between them &#x2014; a
<i>life</i> <span class='acr'>IDE</span> if you will.
</p>

<p>
Today, many aspects of daily computer usage are split between different
applications which act like islands, but this often doesn&rsquo;t mirror how we
<i>actually use</i> our computers. Emacs, if one goes down the rabbit hole, can give
users the power to bridge this gap.
</p>


<figure id="org949f784">
<object type="image/svg+xml" data="misc/emacs-platform.svg" class="invertible" alt="Graph of possible Emacs task integrations" style="max-width:min(24em,100%)">
Sorry, your browser does not support SVG.</object>

<figcaption><span class="figure-number">Figure 1: </span>Some sample workflow integrations that can be used within Emacs</figcaption>
</figure>
</div>
</div>

<div id="outline-container-some-notably-unique" class="outline-4">
<h4 id="some-notably-unique"><span class="section-number-4">1.1.2</span> Some notably unique features<a aria-hidden="true" href="#some-notably-unique">#</a> </h4>
<div class="outline-text-4" id="text-1-1-2">
<ul class="org-ul">
<li>Recursive editing</li>
<li>Completely introspectable, with pervasive docstrings</li>
<li>Mutable environment, which can be incrementally modified</li>
<li>Functionality without applications</li>
<li>Client-server separation allows for a daemon, giving near-instant perceived
startup time.</li>
</ul>
</div>
</div>

<div id="outline-container-issues" class="outline-4">
<h4 id="issues"><span class="section-number-4">1.1.3</span> Issues<a aria-hidden="true" href="#issues">#</a> </h4>
<div class="outline-text-4" id="text-1-1-3">
<ul class="org-ul">
<li>Emacs has irritating quirks</li>
<li>Some aspects are showing their age (naming conventions, <span class='acr'>API</span><small>s</small>)</li>
<li>Emacs is (<a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Threads.html">mostly</a>) single-threaded, meaning that when something holds that
thread up the whole application freezes</li>
<li>A few other nuisances</li>
</ul>
</div>
</div>

<div id="outline-container-teach-man-fish" class="outline-4">
<h4 id="teach-man-fish"><span class="section-number-4">1.1.4</span> Teach a man to fish&#x2026;<a aria-hidden="true" href="#teach-man-fish">#</a> </h4>
<div class="outline-text-4" id="text-1-1-4">
<blockquote>
<p>
Give a man a fish, and you feed him for a day. Teach a man to fish, and you feed
him for a lifetime. &#x2014; Anne Isabella
</p>
</blockquote>

<p>
Most popular editors have a simple and pretty <a href="https://code.visualstudio.com/docs/getstarted/settings">settings interface</a>, filled with
check-boxes, selects, and the occasional text-box. This makes it easy for the
user to pick between common desirable behaviours. To me this is now like <i>giving
a man a fish</i>.
</p>

<p>
What if you want one of those &rsquo;check-box&rsquo; settings to be only on in certain
conditions? Some editors have workspace settings, but that requires you to
manually set the value for <i>every single instance</i>. Urgh, <a href="https://github.com/microsoft/vscode/issues/93153">what</a> <a href="https://github.com/microsoft/vscode/issues/93628">a</a> <a href="https://github.com/microsoft/vscode/issues/5595">pain</a>.
</p>

<p>
What if you could set the value of that &rsquo;check-box&rsquo; setting to be the result of
an arbitrary expression evaluated for each file? This is where an editor like
Emacs comes in.
Configuration for Emacs isn&rsquo;t a list of settings in <span class='acr'>JSON</span> etc. it&rsquo;s <b>an executable
program which modifies the behaviour of the editor to suit your liking</b>.
This is &rsquo;teaching a man to fish&rsquo;.
</p>

<p>
Emacs is built in the same language you configure it in (Emacs <a href="https://en.wikipedia.org/wiki/Lisp_(programming_language)">Lisp</a>, or <a href="https://www.gnu.org/software/emacs/manual/html_node/eintr/">elisp</a>).
It comes with a broad array of useful functions for text-editing, and Doom adds
a few handy little convenience functions.
</p>

<p>
Want to add a keybinding to delete the previous line? It&rsquo;s as easy as
</p>
<details id='keybinding-delete-previous' class='code' open><summary class='named'><span class="name">Keybinding to delete the previous line</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#keybinding-delete-previous'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">map!</span> <span class="org-string">"C-d"</span>
      (<span class="org-keyword">cmd!</span> (previous-line)
            (kill-line)
            (forward-line)))
</pre>
</div>
    </details>

<p>
How about another example, say you want to be presented with a list of currently
open <i>buffers</i> (think files, almost) when you split the window. It&rsquo;s as simple as
</p>
<details id='prompt-buffer-after' class='code' open><summary class='named'><span class="name">Prompt for buffer after split</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#prompt-buffer-after'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> prompt-for-buffer (<span class="org-type">&amp;rest</span> _)
  <span class="org-builtin">:after</span> 'window-split (switch-to-buffer))
</pre>
</div>
    </details>

<p>
Want to test it out? You don&rsquo;t need to save and restart, you can just <i>evaluate
the expression</i> within your current Emacs instance and try it immediately! This
editor is, after all, a Lisp interpreter.
</p>

<p>
Want to tweak the behaviour? Just re-evaluate your new version &#x2014; it&rsquo;s a
super-tight iteration loop.
</p>
</div>
</div>
</div>

<div id="outline-container-editor-comparison" class="outline-3">
<h3 id="editor-comparison"><span class="section-number-3">1.2</span> Editor comparison<a aria-hidden="true" href="#editor-comparison">#</a> </h3>
<div class="outline-text-3" id="text-1-2">
<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/real_programmers.png' title="Real programmers set the universal constants at the start such that the universe evolves to contain the disk with the data they want." alt='Real Programmers'>
</p>

<p>
Over the years I have tried out (spent at least a year using as my primary
editor) the following applications
</p>
<ul class="org-ul">
<li>Python <span class='acr'>IDLE</span></li>
<li>Komodo Edit</li>
<li>Brackets</li>
<li>VSCode</li>
<li>and now, Emacs</li>
</ul>

<p>
I have attempted to quantify aspects of my impressions of them below.
</p>

<div id='editor-comparison,table--1' class='table'>
    <div class='gutter'><a href='#editor-comparison,table--1'>#</a></div>
    <div class='tabular'>
    <table>


<colgroup>
<col  class="org-left">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Editor</th>
<th scope="col" class="org-right">Extensibility</th>
<th scope="col" class="org-right">Ecosystem</th>
<th scope="col" class="org-right">Ease of Use</th>
<th scope="col" class="org-right">Comfort</th>
<th scope="col" class="org-right">Completion</th>
<th scope="col" class="org-right">Performance</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><span class='acr'>IDLE</span></td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">VSCode</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">3.5</td>
<td class="org-right">4</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">Brackets</td>
<td class="org-right">2.5</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">2.5</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">Emacs</td>
<td class="org-right">4</td>
<td class="org-right">4</td>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">3.5</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">Komodo Edit</td>
<td class="org-right">2</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
    </div>    </div>


<figure id="org16f15d2">
<object type="image/svg+xml" data="misc/editor-comparison.svg" class="invertible" alt="Radar chart comparing my thoughts on a few editors.">
Sorry, your browser does not support SVG.</object>

</figure>
</div>
</div>

<div id="outline-container-notes-unwary-adventurer" class="outline-3">
<h3 id="notes-unwary-adventurer"><span class="section-number-3">1.3</span> Notes for the unwary adventurer<a aria-hidden="true" href="#notes-unwary-adventurer">#</a> </h3>
<div class="outline-text-3" id="text-1-3">
<p>
If you like the look of this, that&rsquo;s marvellous, and I&rsquo;m really happy that I&rsquo;ve
made something which you may find interesting, however:
</p>
<div class="warning" id="org51e8b56">
<p>
This config is <i>insidious</i>. Copying the whole thing blindly can easily lead to
undesired effects. I recommend copying chunks instead.
</p>

</div>

<p>
If you are so bold as to wish to steal bits of my config (or if I upgrade and
wonder why things aren&rsquo;t working), here&rsquo;s a list of sections which rely on
external setup (i.e. outside of this config).
</p>

<dl class="org-dl">
<dt>dictionary</dt><dd>I&rsquo;ve downloaded a custom <a href="http://app.aspell.com/create"><span class='acr'>SCOWL</span></a> dictionary, which I use in <a href="#ispell">ispell</a>.
If this causes issues, just delete the <code class="src src-elisp">(<span class="org-keyword">setq</span> ispell-dictionary ...)</code>
bit.</dd>
</dl>

<p>
Oh, did I mention that I started this config when I didn&rsquo;t know any <kbd>elisp</kbd>, and
this whole thing is a hack job? If you can suggest any improvements, please do
so, no matter how much criticism you include I&rsquo;ll appreciate it :)
</p>

<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/code_quality.png' title="I honestly didn't think you could even USE emoji in variable names. Or that there were so many different crying ones." alt='Code Quality'>
</p>
</div>

<div id="outline-container-extra-requirements" class="outline-4">
<h4 id="extra-requirements"><span class="section-number-4">1.3.1</span> Extra Requirements<a aria-hidden="true" href="#extra-requirements">#</a> </h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
The lovely <code>doom doctor</code> is good at diagnosing most missing things, but here are a
few extras.
</p>
<ul class="org-ul">
<li>A <a href="https://www.tug.org/texlive/">LaTeX Compiler</a> is required for the mathematics rendering performed in <a href="#org">Org</a>,
and by <a href="#calctex">CalcTeX</a>.</li>
<li>I use the <a href="https://overpassfont.org/">Overpass</a> font as a go-to sans serif.
It&rsquo;s used as my <code>doom-variable-pitch-font</code> and in the graph generated
by <a href="#roam">Roam</a>.
I have chosen it because it possesses a few characteristics I consider
desirable, namely:
<ul class="org-ul">
<li>A clean, and legible style. Highway-style fonts tend to be designed to be
clear at a glance, and work well with a thicker weight, and this is inspired
by <i>Highway Gothic</i>.</li>
<li>It&rsquo;s slightly quirky. Look at the diagonal cut on stems for example.
Helvetica is a masterful design, but I like a bit more pizzazz now and then.</li>
</ul></li>
<li>A few <span class='acr'>LSP</span> servers. Take a look at <a href="init.el">init.el</a> to see which modules have the <code>+lsp</code> flag.</li>
<li><p>
The <a href="https://github.com/dandavison/delta/">Delta</a> binary. It&rsquo;s packaged for some distributions but I installed it with
</p>
<details id=',code--1' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">cargo install git-delta
</pre>
</div>
    </details></li>
<li><p>
The <kbd>theme-magic</kbd> package requires the <code>wal</code> (<kbd>pywal</kbd>) executable. If this is
packaged for you, great! If not, it&rsquo;s just a quick <code>pip install</code> away.
</p>
<details id=',code--2' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-type">sudo</span> python3 -m pip install pywal
</pre>
</div>
    </details></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-current-issues" class="outline-3">
<h3 id="current-issues"><span class="section-number-3">1.4</span> Current Issues<a aria-hidden="true" href="#current-issues">#</a> </h3>
<div class="outline-text-3" id="text-1-4">
</div>
<div id="outline-container-magit-push-daemon" class="outline-4">
<h4 id="magit-push-daemon"><span class="section-number-4">1.4.1</span> Magit push in daemon<a aria-hidden="true" href="#magit-push-daemon">#</a> </h4>
<div class="outline-text-4" id="text-1-4-1">
<p>
Quite often trying to push to a remote in the Emacs daemon produces as error like this:
</p>
<details id='magit-push-daemon,code--1' class='code' open><summary><span class="lang">fundamental</span></summary>
    <div class='gutter'>
    <a href='#magit-push-daemon,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-fundamental">128 git &#8230; push -v origin refs/heads/master\:refs/heads/master
Pushing to git@github.com:tecosaur/emacs-config.git

fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-unread-emails-doesnt" class="outline-4">
<h4 id="unread-emails-doesnt"><span class="section-number-4">1.4.2</span> Unread emails doesn&rsquo;t work across Emacs instances<a aria-hidden="true" href="#unread-emails-doesnt">#</a> </h4>
<div class="outline-text-4" id="text-1-4-2">
<p>
It would be nice if it did, so that I could have the Emacs-daemon hold the
active mu4e session, but still get that information. In this case I&rsquo;d want to
change the action to open the Emacs daemon, but it should be possible.
</p>

<p>
This would probably involve hooking into the daemon&rsquo;s modeline update function
to write to a temporary file, and having a file watcher started in other Emacs
instances, in a similar manner to <a href="#rebuild-mail-index">Rebuild mail index while using mu4e</a>.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-rudimentary-configuration" class="outline-2">
<h2 id="rudimentary-configuration"><span class="section-number-2">2</span> Rudimentary configuration<a aria-hidden="true" href="#rudimentary-configuration">#</a> </h2>
<div class="outline-text-2" id="text-2">
<p>
Make this file run (slightly) faster with lexical binding (see <a href="https://nullprogram.com/blog/2016/12/22/">this blog post</a>
for more info).
</p>
<details id='rudimentary-configuration,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#rudimentary-configuration,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">config.el -*- lexical-binding: t; -*-</span>
</pre>
</div>
    </details>
</div>

<div id="outline-container-personal-information" class="outline-3">
<h3 id="personal-information"><span class="section-number-3">2.1</span> Personal Information<a aria-hidden="true" href="#personal-information">#</a> </h3>
<div class="outline-text-3" id="text-2-1">
<p>
It&rsquo;s useful to have some basic personal information
</p>
<details id='personal-information,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#personal-information,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> user-full-name <span class="org-string">"TEC"</span>
      user-mail-address <span class="org-string">"tec@tecosaur.com"</span>)
</pre>
</div>
    </details>
<p>
Apparently this is used by <code>GPG</code>, and all sorts of other things.
</p>

<p>
Speaking of <code>GPG</code>, I want to use <kbd>~/.authsource.gpg</kbd> instead of the default in
<kbd>~/.emacs.d</kbd>. Why? Because my home directory is already cluttered, so this won&rsquo;t
make a difference, and I don&rsquo;t want to accidentaly purge this file (I have done
. I also want to cache as much as possible, as
my home machine is pretty safe, and my laptop is shutdown a lot.
</p>
<details id='personal-information,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#personal-information,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> auth-sources '(<span class="org-string">"~/.authinfo.gpg"</span>)
      auth-source-cache-expiry nil) <span class="org-comment-delimiter">; </span><span class="org-comment">default is 7200 (2h)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-better-defaults" class="outline-3">
<h3 id="better-defaults"><span class="section-number-3">2.2</span> Better defaults<a aria-hidden="true" href="#better-defaults">#</a> </h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-simple-settings" class="outline-4">
<h4 id="simple-settings"><span class="section-number-4">2.2.1</span> Simple settings<a aria-hidden="true" href="#simple-settings">#</a> </h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
Browsing the web and seeing <a href="https://github.com/angrybacon/dotemacs/blob/master/dotemacs.org#use-better-defaults">angrybacon/dotemacs</a> and comparing with the values
shown by <kbd>SPC h v</kbd> and selecting what I thought looks good, I&rsquo;ve ended up adding
the following:
</p>

<details id='simple-settings,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#simple-settings,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span>
 delete-by-moving-to-trash t                      <span class="org-comment-delimiter">; </span><span class="org-comment">Delete files to trash</span>
 window-combination-resize t                      <span class="org-comment-delimiter">; </span><span class="org-comment">take new window space from all other windows (not just current)</span>
 x-stretch-cursor t)                              <span class="org-comment-delimiter">; </span><span class="org-comment">Stretch cursor to the glyph width</span>

(<span class="org-keyword">setq</span> undo-limit <span class="org-highlight-numbers-number">80000000</span>                         <span class="org-comment-delimiter">; </span><span class="org-comment">Raise undo-limit to 80Mb</span>
      evil-want-fine-undo t                       <span class="org-comment-delimiter">; </span><span class="org-comment">By default while in insert all changes are one big blob. Be more granular</span>
      auto-save-default t                         <span class="org-comment-delimiter">; </span><span class="org-comment">Nobody likes to loose work, I certainly don't</span>
      truncate-string-ellipsis <span class="org-string">"&#8230;"</span>                <span class="org-comment-delimiter">; </span><span class="org-comment">Unicode ellispis are nicer than "...", and also save /precious/ space</span>
      password-cache-expiry nil                   <span class="org-comment-delimiter">; </span><span class="org-comment">I can trust my computers ... can't I?</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">scroll-preserve-screen-position 'always     ; Don't have `</span><span class="org-comment"><span class="org-constant">point</span></span><span class="org-comment">' jump around</span>
      scroll-margin <span class="org-highlight-numbers-number">2</span>)                            <span class="org-comment-delimiter">; </span><span class="org-comment">It's nice to maintain a little margin</span>

(display-time-mode <span class="org-highlight-numbers-number">1</span>)                             <span class="org-comment-delimiter">; </span><span class="org-comment">Enable time in the mode-line</span>

(<span class="org-keyword">unless</span> (string-match-p <span class="org-string">"^Power N/A"</span> (battery))   <span class="org-comment-delimiter">; </span><span class="org-comment">On laptops...</span>
  (display-battery-mode <span class="org-highlight-numbers-number">1</span>))                       <span class="org-comment-delimiter">; </span><span class="org-comment">it's nice to know how much power you have</span>

(global-subword-mode <span class="org-highlight-numbers-number">1</span>)                           <span class="org-comment-delimiter">; </span><span class="org-comment">Iterate through CamelCase words</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-frame-sizing" class="outline-4">
<h4 id="frame-sizing"><span class="section-number-4">2.2.2</span> Frame sizing<a aria-hidden="true" href="#frame-sizing">#</a> </h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
It&rsquo;s nice to control the size of new frames, when launching Emacs that can be
done with . After the font size adjustment
during initialisation this works out to be <code>102x31</code>.
</p>

<p>
Thanks to hotkeys, it&rsquo;s easy for me to expand a frame to half/full-screen, so it
makes sense to be conservative with the sizing of new frames.
</p>

<p>
Then, for creating new frames within the same Emacs instance, we&rsquo;ll just set the
default to be something roughly 80% of that size.
</p>

<details id='frame-sizing,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#frame-sizing,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'default-frame-alist '(height . <span class="org-highlight-numbers-number">24</span>))
(add-to-list 'default-frame-alist '(width . <span class="org-highlight-numbers-number">80</span>))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-auto-customisations" class="outline-4">
<h4 id="auto-customisations"><span class="section-number-4">2.2.3</span> Auto-customisations<a aria-hidden="true" href="#auto-customisations">#</a> </h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
By default changes made via a customisation interface are added to <kbd>init.el</kbd>.
I prefer the idea of using a separate file for this. We just need to change a
setting, and load it if it exists.
</p>
<details id='auto-customisations,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#auto-customisations,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> custom-file (expand-file-name <span class="org-string">".custom.el"</span> doom-private-dir))
(<span class="org-keyword">when</span> (file-exists-p custom-file)
  (load custom-file))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-windows" class="outline-4">
<h4 id="windows"><span class="section-number-4">2.2.4</span> Windows<a aria-hidden="true" href="#windows">#</a> </h4>
<div class="outline-text-4" id="text-2-2-4">
<p>
I find it rather handy to be asked which buffer I want to see after splitting
the window. Let&rsquo;s make that happen.
</p>

<p>
First, we&rsquo;ll enter the new window
</p>
<details id='windows,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#windows,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> evil-vsplit-window-right t
      evil-split-window-below t)
</pre>
</div>
    </details>

<p>
Then, we&rsquo;ll pull up <code>ivy</code>
</p>
<details id='windows,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#windows,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> prompt-for-buffer (<span class="org-type">&amp;rest</span> _)
  <span class="org-builtin">:after</span> '(evil-window-split evil-window-vsplit)
  (+ivy/switch-buffer))
</pre>
</div>
    </details>

<p>
Oh, and previews are nice
</p>
<details id='windows,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#windows,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> +ivy-buffer-preview t)
</pre>
</div>
    </details>

<p>
Window rotation is nice, and can be found under <kbd>SPC w r</kbd> and <kbd>SPC w R</kbd>.
<i>Layout</i> rotation is also nice though. Let&rsquo;s stash this under <kbd>SPC w SPC</kbd>, inspired
by Tmux&rsquo;s use of <kbd>C-b SPC</kbd> to rotate windows.
</p>

<p>
We could also do with adding the missing arrow-key variants of the window
navigation/swapping commands.
</p>
<details id='windows,code--4' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#windows,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> evil-window-map
      <span class="org-string">"SPC"</span> #'rotate-layout
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Navigation</span>
      <span class="org-string">"&lt;left&gt;"</span>     #'evil-window-left
      <span class="org-string">"&lt;down&gt;"</span>     #'evil-window-down
      <span class="org-string">"&lt;up&gt;"</span>       #'evil-window-up
      <span class="org-string">"&lt;right&gt;"</span>    #'evil-window-right
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Swapping windows</span>
      <span class="org-string">"C-&lt;left&gt;"</span>       #'+evil/window-move-left
      <span class="org-string">"C-&lt;down&gt;"</span>       #'+evil/window-move-down
      <span class="org-string">"C-&lt;up&gt;"</span>         #'+evil/window-move-up
      <span class="org-string">"C-&lt;right&gt;"</span>      #'+evil/window-move-right)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-buffer-defaults" class="outline-4">
<h4 id="buffer-defaults"><span class="section-number-4">2.2.5</span> Buffer defaults<a aria-hidden="true" href="#buffer-defaults">#</a> </h4>
<div class="outline-text-4" id="text-2-2-5">
<p>
I&rsquo;d much rather have my new buffers in <code>org-mode</code> than <code>fundamental-mode</code>, hence
</p>
<details id='buffer-defaults,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#buffer-defaults,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(setq-default major-mode 'org-mode)</span>
</pre>
</div>
    </details>
<p>
For some reason this + the mixed pitch hook causes issues with hydra and so I&rsquo;ll
just need to resort to <kbd>SPC b o</kbd> for now.
</p>
</div>
</div>
</div>
<div id="outline-container-doom-configuration" class="outline-3">
<h3 id="doom-configuration"><span class="section-number-3">2.3</span> Doom configuration<a aria-hidden="true" href="#doom-configuration">#</a> </h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-modules" class="outline-4">
<h4 id="modules"><span class="section-number-4">2.3.1</span> Modules<a aria-hidden="true" href="#modules">#</a> </h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
Doom has this lovely <i>modular configuration base</i> that takes a lot of work out of
configuring Emacs. Each module (when enabled) can provide a list of packages to
install (on <code>doom sync</code>) and configuration to be applied. The modules can also
have flags applied to tweak their behaviour.
</p>

<details id='initel' class='code'><summary class='named'><span class="name">init.el</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#initel'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">init.el -*- lexical-binding: t; -*-</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">This file controls what Doom modules are enabled and what order they load in.</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Press 'K' on a module to view its documentation, and 'gd' to browse its directory.</span>

(<span class="org-keyword">doom!</span> <span class="org-builtin">:completion</span>
       &lt;&lt;doom-completion&gt;&gt;

       <span class="org-builtin">:ui</span>
       &lt;&lt;doom-ui&gt;&gt;

       <span class="org-builtin">:editor</span>
       &lt;&lt;doom-editor&gt;&gt;

       <span class="org-builtin">:emacs</span>
       &lt;&lt;doom-emacs&gt;&gt;

       <span class="org-builtin">:term</span>
       &lt;&lt;doom-term&gt;&gt;

       <span class="org-builtin">:checkers</span>
       &lt;&lt;doom-checkers&gt;&gt;

       <span class="org-builtin">:tools</span>
       &lt;&lt;doom-tools&gt;&gt;

       <span class="org-builtin">:os</span>
       &lt;&lt;doom-os&gt;&gt;

       <span class="org-builtin">:lang</span>
       &lt;&lt;doom-lang&gt;&gt;

       <span class="org-builtin">:email</span>
       &lt;&lt;doom-email&gt;&gt;

       <span class="org-builtin">:app</span>
       &lt;&lt;doom-app&gt;&gt;

       <span class="org-builtin">:config</span>
       &lt;&lt;doom-config&gt;&gt;
       )
</pre>
</div>
    </details>
</div>

<div id="outline-container-structure" class="outline-5">
<h5 id="structure"><span class="section-number-5">2.3.1.1</span> Structure<a aria-hidden="true" href="#structure">#</a> </h5>
<div class="outline-text-5" id="text-2-3-1-1">
<p>
As you may have noticed by this point, this is a <a href="https://en.wikipedia.org/wiki/Literate_programming">literate</a> configuration. Doom
has good support for this which we access though the <code>literate</code> module.
</p>

<p>
While we&rsquo;re in the <code class="src src-elisp"><span class="org-builtin">:config</span></code> section, we&rsquo;ll use Dooms nicer defaults,
along with the bindings and smartparens behaviour (the flags aren&rsquo;t documented,
but they exist).
</p>
<details id='doom-config' class='code' open><summary class='named'><span class="name">doom-config</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-config'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">literate
(default +bindings +smartparens)
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-interface" class="outline-5">
<h5 id="interface"><span class="section-number-5">2.3.1.2</span> Interface<a aria-hidden="true" href="#interface">#</a> </h5>
<div class="outline-text-5" id="text-2-3-1-2">
<p>
There&rsquo;s a lot that can be done to enhance Emacs&rsquo; capabilities.
I reckon enabling half the modules Doom provides should do it.
</p>

<details id='doom-completion' class='code' open><summary class='named'><span class="name">doom-completion</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-completion'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(company                     <span class="org-comment-delimiter">; </span><span class="org-comment">the ultimate code completion backend</span>
 +childframe)                <span class="org-comment-delimiter">; </span><span class="org-comment">... when your children are better than you</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">helm                       ; the *other* search engine for love and life</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">ido                        ; the other *other* search engine...</span>
(ivy                         <span class="org-comment-delimiter">; </span><span class="org-comment">a search engine for love and life</span>
 +icons                      <span class="org-comment-delimiter">; </span><span class="org-comment">... icons are nice</span>
 +prescient)                 <span class="org-comment-delimiter">; </span><span class="org-comment">... I know what I want(ed)</span>
</pre>
</div>
    </details>

<details id='doom-ui' class='code' open><summary class='named'><span class="name">doom-ui</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-ui'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;</span><span class="org-comment">deft                       ; notational velocity for Emacs</span>
doom                         <span class="org-comment-delimiter">; </span><span class="org-comment">what makes DOOM look the way it does</span>
doom-dashboard               <span class="org-comment-delimiter">; </span><span class="org-comment">a nifty splash screen for Emacs</span>
doom-quit                    <span class="org-comment-delimiter">; </span><span class="org-comment">DOOM quit-message prompts when you quit Emacs</span>
(emoji +unicode)             <span class="org-comment-delimiter">; </span><span class="org-comment">&#128578;</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">fill-column                ; a `</span><span class="org-comment"><span class="org-constant">fill-column</span></span><span class="org-comment">' indicator</span>
hl-todo                      <span class="org-comment-delimiter">; </span><span class="org-comment">highlight </span><span class="org-comment"><span class="org-bold"><span class="org-warning">TODO</span></span></span><span class="org-comment">/</span><span class="org-comment"><span class="org-bold"><span class="org-error">FIXME</span></span></span><span class="org-comment">/</span><span class="org-comment"><span class="org-bold"><span class="org-success">NOTE</span></span></span><span class="org-comment">/</span><span class="org-comment"><span class="org-bold"><span class="org-doc">DEPRECATED</span></span></span><span class="org-comment">/</span><span class="org-comment"><span class="org-bold"><span class="org-constant">HACK</span></span></span><span class="org-comment">/</span><span class="org-comment"><span class="org-bold"><span class="org-keyword">REVIEW</span></span></span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">hydra                      ; quick documentation for related commands</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">indent-guides              ; highlighted indent columns, notoriously slow</span>
(ligatures +extra)           <span class="org-comment-delimiter">; </span><span class="org-comment">ligatures and symbols to make your code pretty again</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">minimap                    ; show a map of the code on the side</span>
modeline                     <span class="org-comment-delimiter">; </span><span class="org-comment">snazzy, Atom-inspired modeline, plus API</span>
nav-flash                    <span class="org-comment-delimiter">; </span><span class="org-comment">blink the current line after jumping</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">neotree                    ; a project drawer, like NERDTree for vim</span>
ophints                      <span class="org-comment-delimiter">; </span><span class="org-comment">highlight the region an operation acts on</span>
(popup                       <span class="org-comment-delimiter">; </span><span class="org-comment">tame sudden yet inevitable temporary windows</span>
 +all                        <span class="org-comment-delimiter">; </span><span class="org-comment">catch all popups that start with an asterix</span>
 +defaults)                  <span class="org-comment-delimiter">; </span><span class="org-comment">default popup rules</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">(tabs                      ; an tab bar for Emacs</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">+centaur-tabs)           ; ... with prettier tabs</span>
treemacs                     <span class="org-comment-delimiter">; </span><span class="org-comment">a project drawer, like neotree but cooler</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">unicode                    ; extended unicode support for various languages</span>
vc-gutter                    <span class="org-comment-delimiter">; </span><span class="org-comment">vcs diff in the fringe</span>
vi-tilde-fringe              <span class="org-comment-delimiter">; </span><span class="org-comment">fringe tildes to mark beyond EOB</span>
(window-select +numbers)     <span class="org-comment-delimiter">; </span><span class="org-comment">visually switch windows</span>
workspaces                   <span class="org-comment-delimiter">; </span><span class="org-comment">tab emulation, persistence &amp; separate workspaces</span>
zen                          <span class="org-comment-delimiter">; </span><span class="org-comment">distraction-free coding or writing</span>
</pre>
</div>
    </details>

<details id='doom-editor' class='code' open><summary class='named'><span class="name">doom-editor</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-editor'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(evil +everywhere)           <span class="org-comment-delimiter">; </span><span class="org-comment">come to the dark side, we have cookies</span>
file-templates               <span class="org-comment-delimiter">; </span><span class="org-comment">auto-snippets for empty files</span>
fold                         <span class="org-comment-delimiter">; </span><span class="org-comment">(nigh) universal code folding</span>
(format)                     <span class="org-comment-delimiter">; </span><span class="org-comment">automated prettiness</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">god                        ; run Emacs commands without modifier keys</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">lispy                      ; vim for lisp, for people who don't like vim</span>
multiple-cursors             <span class="org-comment-delimiter">; </span><span class="org-comment">editing in many places at once</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">objed                      ; text object editing for the innocent</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">parinfer                   ; turn lisp into python, sort of</span>
rotate-text                  <span class="org-comment-delimiter">; </span><span class="org-comment">cycle region at point between text candidates</span>
snippets                     <span class="org-comment-delimiter">; </span><span class="org-comment">my elves. They type so I don't have to</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">word-wrap                  ; soft wrapping with language-aware indent</span>
</pre>
</div>
    </details>

<details id='doom-emacs' class='code' open><summary class='named'><span class="name">doom-emacs</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-emacs'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(dired +icons)               <span class="org-comment-delimiter">; </span><span class="org-comment">making dired pretty [functional]</span>
electric                     <span class="org-comment-delimiter">; </span><span class="org-comment">smarter, keyword-based electric-indent</span>
(ibuffer +icons)             <span class="org-comment-delimiter">; </span><span class="org-comment">interactive buffer management</span>
(undo +tree)                 <span class="org-comment-delimiter">; </span><span class="org-comment">persistent, smarter undo for your inevitable mistakes</span>
vc                           <span class="org-comment-delimiter">; </span><span class="org-comment">version-control and Emacs, sitting in a tree</span>
</pre>
</div>
    </details>

<details id='doom-term' class='code' open><summary class='named'><span class="name">doom-term</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-term'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;</span><span class="org-comment">eshell                     ; the elisp shell that works everywhere</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">shell                      ; simple shell REPL for Emacs</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">term                       ; basic terminal emulator for Emacs</span>
vterm                        <span class="org-comment-delimiter">; </span><span class="org-comment">the best terminal emulation in Emacs</span>
</pre>
</div>
    </details>

<details id='doom-checkers' class='code' open><summary class='named'><span class="name">doom-checkers</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-checkers'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">syntax                       <span class="org-comment-delimiter">; </span><span class="org-comment">tasing you for every semicolon you forget</span>
(<span class="org-builtin">:if</span> (executable-find <span class="org-string">"aspell"</span>) spell) <span class="org-comment-delimiter">; </span><span class="org-comment">tasing you for misspelling mispelling</span>
grammar                      <span class="org-comment-delimiter">; </span><span class="org-comment">tasing grammar mistake every you make</span>
</pre>
</div>
    </details>

<details id='doom-tools' class='code' open><summary class='named'><span class="name">doom-tools</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-tools'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">ansible                      <span class="org-comment-delimiter">; </span><span class="org-comment">a crucible for infrastructure as code</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">debugger                   ; </span><span class="org-comment"><span class="org-bold"><span class="org-error">FIXME</span></span></span><span class="org-comment"> stepping through code, to help you add bugs</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">direnv                     ; be direct about your environment</span>
docker                       <span class="org-comment-delimiter">; </span><span class="org-comment">port everything to containers</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">editorconfig               ; let someone else argue about tabs vs spaces</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">ein                        ; tame Jupyter notebooks with emacs</span>
(eval +overlay)              <span class="org-comment-delimiter">; </span><span class="org-comment">run code, run (also, repls)</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">gist                       ; interacting with github gists</span>
(lookup                      <span class="org-comment-delimiter">; </span><span class="org-comment">helps you navigate your code and documentation</span>
 +dictionary                 <span class="org-comment-delimiter">; </span><span class="org-comment">dictionary/thesaurus is nice</span>
 +docsets)                   <span class="org-comment-delimiter">; </span><span class="org-comment">...or in Dash docsets locally</span>
lsp                          <span class="org-comment-delimiter">; </span><span class="org-comment">Language Server Protocol</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">macos                      ; MacOS-specific commands</span>
(magit                       <span class="org-comment-delimiter">; </span><span class="org-comment">a git porcelain for Emacs</span>
 +forge)                     <span class="org-comment-delimiter">; </span><span class="org-comment">interface with git forges</span>
make                         <span class="org-comment-delimiter">; </span><span class="org-comment">run make tasks from Emacs</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">pass                       ; password manager for nerds</span>
pdf                          <span class="org-comment-delimiter">; </span><span class="org-comment">pdf enhancements</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">prodigy                    ; </span><span class="org-comment"><span class="org-bold"><span class="org-error">FIXME</span></span></span><span class="org-comment"> managing external services &amp; code builders</span>
rgb                          <span class="org-comment-delimiter">; </span><span class="org-comment">creating color strings</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">taskrunner                 ; taskrunner for all your projects</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">terraform                  ; infrastructure as code</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">tmux                       ; an API for interacting with tmux</span>
upload                       <span class="org-comment-delimiter">; </span><span class="org-comment">map local to remote projects via ssh/ftp</span>
</pre>
</div>
    </details>

<details id='doom-os' class='code' open><summary class='named'><span class="name">doom-os</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-os'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">tty                          <span class="org-comment-delimiter">; </span><span class="org-comment">improve the terminal Emacs experience</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-language-support" class="outline-5">
<h5 id="language-support"><span class="section-number-5">2.3.1.3</span> Language support<a aria-hidden="true" href="#language-support">#</a> </h5>
<div class="outline-text-5" id="text-2-3-1-3">
<p>
We can be rather liberal with enabling support for languages as the associated
packages/configuration are (usually) only loaded when first opening an
associated file.
</p>

<details id='doom-lang' class='code' open><summary class='named'><span class="name">doom-lang</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-lang'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;</span><span class="org-comment">agda                       ; types of types of types of types...</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">cc                         ; C/C++/Obj-C madness</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">clojure                    ; java with a lisp</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">common-lisp                ; if you've seen one lisp, you've seen them all</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">coq                        ; proofs-as-programs</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">crystal                    ; ruby at the speed of c</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">csharp                     ; unity, .NET, and mono shenanigans</span>
data                         <span class="org-comment-delimiter">; </span><span class="org-comment">config/data formats</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">(dart +flutter)            ; paint ui and not much else</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">elixir                     ; erlang done right</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">elm                        ; care for a cup of TEA?</span>
emacs-lisp                   <span class="org-comment-delimiter">; </span><span class="org-comment">drown in parentheses</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">erlang                     ; an elegant language for a more civilized age</span>
ess                          <span class="org-comment-delimiter">; </span><span class="org-comment">emacs speaks statistics</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">faust                      ; dsp, but you get to keep your soul</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">fsharp                     ; ML stands for Microsoft's Language</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">fstar                      ; (dependent) types and (monadic) effects and Z3</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">(go +lsp)                  ; the hipster dialect</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(haskell +lsp)            ; a language that's lazier than I am</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">hy                         ; readability of scheme w/ speed of python</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">idris                      ;</span>
json                         <span class="org-comment-delimiter">; </span><span class="org-comment">At least it ain't XML</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">(java +meghanada)          ; the poster child for carpal tunnel syndrome</span>
(javascript +lsp)            <span class="org-comment-delimiter">; </span><span class="org-comment">all(hope(abandon(ye(who(enter(here))))))</span>
(julia +lsp)                 <span class="org-comment-delimiter">; </span><span class="org-comment">a better, faster MATLAB</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">kotlin                     ; a better, slicker Java(Script)</span>
(latex                       <span class="org-comment-delimiter">; </span><span class="org-comment">writing papers in Emacs has never been so fun</span>
 +latexmk                    <span class="org-comment-delimiter">; </span><span class="org-comment">what else would you use?</span>
 +cdlatex                    <span class="org-comment-delimiter">; </span><span class="org-comment">quick maths symbols</span>
 +fold)                      <span class="org-comment-delimiter">; </span><span class="org-comment">fold the clutter away nicities</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">lean                       ; proof that mathematicians need help</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">factor                     ; for when scripts are stacked against you</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">ledger                     ; an accounting system in Emacs</span>
lua                          <span class="org-comment-delimiter">; </span><span class="org-comment">one-based indices? one-based indices</span>
markdown                     <span class="org-comment-delimiter">; </span><span class="org-comment">writing docs for people to ignore</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">nim                        ; python + lisp at the speed of c</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">nix                        ; I hereby declare "nix geht mehr!"</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">ocaml                      ; an objective camel</span>
(org                         <span class="org-comment-delimiter">; </span><span class="org-comment">organize your plain life in plain text</span>
 +pretty                     <span class="org-comment-delimiter">; </span><span class="org-comment">yessss my pretties! (nice unicode symbols)</span>
 +dragndrop                  <span class="org-comment-delimiter">; </span><span class="org-comment">drag &amp; drop files/images into org buffers</span>
 <span class="org-comment-delimiter">;;</span><span class="org-comment">+hugo                     ; use Emacs for hugo blogging</span>
 +noter                      <span class="org-comment-delimiter">; </span><span class="org-comment">enhanced PDF notetaking</span>
 +jupyter                    <span class="org-comment-delimiter">; </span><span class="org-comment">ipython/jupyter support for babel</span>
 +pandoc                     <span class="org-comment-delimiter">; </span><span class="org-comment">export-with-pandoc support</span>
 +gnuplot                    <span class="org-comment-delimiter">; </span><span class="org-comment">who doesn't like pretty pictures</span>
 <span class="org-comment-delimiter">;;</span><span class="org-comment">+pomodoro                 ; be fruitful with the tomato technique</span>
 +present                    <span class="org-comment-delimiter">; </span><span class="org-comment">using org-mode for presentations</span>
 +roam)                      <span class="org-comment-delimiter">; </span><span class="org-comment">wander around notes</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">perl                       ; write code no one else can comprehend</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">php                        ; perl's insecure younger brother</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">plantuml                   ; diagrams for confusing people more</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">purescript                 ; javascript, but functional</span>
(python +lsp +pyright)       <span class="org-comment-delimiter">; </span><span class="org-comment">beautiful is better than ugly</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">qt                         ; the 'cutest' gui framework ever</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">racket                     ; a DSL for DSLs</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">rest                       ; Emacs as a REST client</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">rst                        ; ReST in peace</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">(ruby +rails)              ; 1.step {|i| p "Ruby is #{i.even? ? 'love' : 'life'}"}</span>
(rust +lsp)                  <span class="org-comment-delimiter">; </span><span class="org-comment">Fe2O3.unwrap().unwrap().unwrap().unwrap()</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">scala                      ; java, but good</span>
scheme                       <span class="org-comment-delimiter">; </span><span class="org-comment">a fully conniving family of lisps</span>
sh                           <span class="org-comment-delimiter">; </span><span class="org-comment">she sells {ba,z,fi}sh shells on the C xor</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">sml                        ; no, the /other/ ML</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">solidity                   ; do you need a blockchain? No.</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">swift                      ; who asked for emoji variables?</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">terra                      ; Earth and Moon in alignment for performance.</span>
web                          <span class="org-comment-delimiter">; </span><span class="org-comment">the tubes</span>
yaml                         <span class="org-comment-delimiter">; </span><span class="org-comment">JSON, but readable</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-everything-emacs" class="outline-5">
<h5 id="everything-emacs"><span class="section-number-5">2.3.1.4</span> Everything in Emacs<a aria-hidden="true" href="#everything-emacs">#</a> </h5>
<div class="outline-text-5" id="text-2-3-1-4">
<p>
It&rsquo;s just too convenient being able to have everything in Emacs.
I couldn&rsquo;t resist the Email and Feed modules.
</p>

<details id='doom-email' class='code' open><summary class='named'><span class="name">doom-email</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-email'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-builtin">:if</span> (executable-find <span class="org-string">"mu"</span>) (mu4e +org +gmail))
<span class="org-comment-delimiter">;;</span><span class="org-comment">notmuch</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">(wanderlust +gmail)</span>
</pre>
</div>
    </details>

<details id='doom-app' class='code' open><summary class='named'><span class="name">doom-app</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-app'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;</span><span class="org-comment">calendar                   ; A dated approach to timetabling</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">emms                       ; Multimedia in Emacs is music to my ears</span>
everywhere                   <span class="org-comment-delimiter">; </span><span class="org-comment">*leave* Emacs!? You must be joking.</span>
irc                          <span class="org-comment-delimiter">; </span><span class="org-comment">how neckbeards socialize</span>
(rss +org)                   <span class="org-comment-delimiter">; </span><span class="org-comment">emacs as an RSS reader</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">twitter                    ; twitter client https://twitter.com/vnought</span>
</pre>
</div>
    </details>
</div>
</div>
</div>

<div id="outline-container-visual-settings" class="outline-4">
<h4 id="visual-settings"><span class="section-number-4">2.3.2</span> Visual Settings<a aria-hidden="true" href="#visual-settings">#</a> </h4>
<div class="outline-text-4" id="text-2-3-2">
</div>
<div id="outline-container-font-face" class="outline-5">
<h5 id="font-face"><span class="section-number-5">2.3.2.1</span> Font Face<a aria-hidden="true" href="#font-face">#</a> </h5>
<div class="outline-text-5" id="text-2-3-2-1">
<p>
&rsquo;Fira Code&rsquo; is nice, and &rsquo;Overpass&rsquo; makes for a nice sans companion. We just need to
fiddle with the font sizes a tad so that they visually match. Just for fun I&rsquo;m
trying out JetBrains Mono though. So far I have mixed feelings on it, some
aspects are nice, but on others I prefer Fira.
</p>
<details id='font-face,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-face,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> doom-font (font-spec <span class="org-builtin">:family</span> <span class="org-string">"JetBrains Mono"</span> <span class="org-builtin">:size</span> <span class="org-highlight-numbers-number">24</span>)
      doom-big-font (font-spec <span class="org-builtin">:family</span> <span class="org-string">"JetBrains Mono"</span> <span class="org-builtin">:size</span> <span class="org-highlight-numbers-number">36</span>)
      doom-variable-pitch-font (font-spec <span class="org-builtin">:family</span> <span class="org-string">"Overpass"</span> <span class="org-builtin">:size</span> <span class="org-highlight-numbers-number">24</span>)
      doom-unicode-font (font-spec <span class="org-builtin">:family</span> <span class="org-string">"JuliaMono"</span>)
      doom-serif-font (font-spec <span class="org-builtin">:family</span> <span class="org-string">"IBM Plex Mono"</span> <span class="org-builtin">:weight</span> 'light))
</pre>
</div>
    </details>


<figure id="orgdb89acc">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/font-face.png" alt="Screenshot of the fonts within Emacs." class="invertible">

</figure>

<p>
In addition to these fonts, Merriweather is used with <kbd>nov.el</kbd>, and Alegreya as a
serifed proportional font used by <kbd>mixed-pitch-mode</kbd> for <kbd>writeroom-mode</kbd> with Org
files.
</p>

<p>
Because we care about how things look let&rsquo;s add a check to make sure we&rsquo;re told
if the system doesn&rsquo;t have any of those fonts.
</p>

<details id='detect-missing-fonts' class='code' open><summary class='named'><span class="name">detect-missing-fonts</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#detect-missing-fonts'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">required-fonts</span> '(<span class="org-string">"JetBrainsMono.*"</span> <span class="org-string">"Overpass"</span> <span class="org-string">"JuliaMono"</span> <span class="org-string">"IBM Plex Mono"</span> <span class="org-string">"Merriweather"</span> <span class="org-string">"Alegreya"</span>))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">available-fonts</span>
  (delete-dups (<span class="org-keyword">or</span> (font-family-list)
                   (split-string (shell-command-to-string <span class="org-string">"fc-list : family"</span>)
                                 <span class="org-string">"[,\n]"</span>))))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">missing-fonts</span>
  (delq nil (mapcar
             (<span class="org-keyword">lambda</span> (font)
               (<span class="org-keyword">unless</span> (delq nil (mapcar (<span class="org-keyword">lambda</span> (f)
                                           (string-match-p (format <span class="org-string">"^%s$"</span> font) f))
                                         available-fonts))
                 font))
             required-fonts)))

(<span class="org-keyword">if</span> missing-fonts
    (pp-to-string
     `(<span class="org-keyword">unless</span> noninteractive
        (<span class="org-keyword">add-hook!</span> 'doom-init-ui-hook
          (run-at-time nil nil
                       (<span class="org-keyword">lambda</span> ()
                         (message <span class="org-string">"%s missing the following fonts: %s"</span>
                                  (propertize <span class="org-string">"Warning!"</span> 'face '(bold warning))
                                  (mapconcat (<span class="org-keyword">lambda</span> (font)
                                               (propertize font 'face 'font-lock-variable-name-face))
                                             ',missing-fonts
                                             <span class="org-string">", "</span>))
                         (sleep-for <span class="org-highlight-numbers-number">0.5</span>))))))
  <span class="org-string">";; No missing fonts detected"</span>)
</pre>
</div>
    </details>

<details id='font-face,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-face,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">&lt;&lt;detect-missing-fonts()&gt;&gt;
</pre>
</div>
    </details>

<p>
This way whenever fonts are missing, after Doom&rsquo;s <span class='acr'>UI</span> has initialised, a warning
listing the missing fonts should appear for at least half a second.
</p>
</div>
</div>


<div id="outline-container-theme-modeline" class="outline-5">
<h5 id="theme-modeline"><span class="section-number-5">2.3.2.2</span> Theme and modeline<a aria-hidden="true" href="#theme-modeline">#</a> </h5>
<div class="outline-text-5" id="text-2-3-2-2">
<p>
<code>doom-one</code> is nice and all, but I find the <code>vibrant</code> variant nicer. Oh, and with the
nice selection doom provides there&rsquo;s no reason for me to want the defaults.
</p>
<details id='theme-modeline,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#theme-modeline,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> doom-theme 'doom-vibrant)
(remove-hook 'window-setup-hook #'doom-init-theme-h)
(add-hook 'after-init-hook #'doom-init-theme-h 'append)
(<span class="org-keyword">delq!</span> t custom-theme-load-path)
</pre>
</div>
    </details>
<p>
However, by default <code>red</code> text is used in the <code>modeline</code>, so let&rsquo;s make that orange
so I don&rsquo;t feel like something&rsquo;s gone <i>wrong</i> when editing files.
</p>
<details id='theme-modeline,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#theme-modeline,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">custom-set-faces!</span>
  '(doom-modeline-buffer-modified <span class="org-builtin">:foreground</span> <span class="org-string">"orange"</span>))
</pre>
</div>
    </details>
<p>
While we&rsquo;re modifying the modeline, <kbd>LF UTF-8</kbd> is the default file encoding, and
thus not worth noting in the modeline. So, let&rsquo;s conditionally hide it.
</p>
<details id='theme-modeline,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#theme-modeline,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">doom-modeline-conditional-buffer-encoding</span> ()
  <span class="org-doc">"We expect the encoding to be LF UTF-8, so only show the modeline when this is not the case"</span>
  (<span class="org-keyword">setq-local</span> doom-modeline-buffer-encoding
              (<span class="org-keyword">unless</span> (<span class="org-keyword">and</span> (memq (plist-get (coding-system-plist buffer-file-coding-system) <span class="org-builtin">:category</span>)
                                 '(coding-category-undecided coding-category-utf-8))
                           (not (memq (coding-system-eol-type buffer-file-coding-system) '(<span class="org-highlight-numbers-number">1</span> <span class="org-highlight-numbers-number">2</span>))))
                t)))

(add-hook 'after-change-major-mode-hook #'doom-modeline-conditional-buffer-encoding)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-miscellaneous" class="outline-5">
<h5 id="miscellaneous"><span class="section-number-5">2.3.2.3</span> Miscellaneous<a aria-hidden="true" href="#miscellaneous">#</a> </h5>
<div class="outline-text-5" id="text-2-3-2-3">
<p>
Relative line numbers are fantastic for knowing how far away line numbers are,
then <kbd>ESC 12 &lt;UP&gt;</kbd> gets you exactly where you think.
</p>
<details id='miscellaneous,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#miscellaneous,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> display-line-numbers-type 'relative)
</pre>
</div>
    </details>

<p>
I&rsquo;d like some slightly nicer default buffer names
</p>
<details id='miscellaneous,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#miscellaneous,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> doom-fallback-buffer-name <span class="org-string">"&#9658; Doom"</span>
      +doom-dashboard-name <span class="org-string">"&#9658; Doom"</span>)
</pre>
</div>
    </details>
</div>
</div>
</div>

<div id="outline-container-some-helper-macros" class="outline-4">
<h4 id="some-helper-macros"><span class="section-number-4">2.3.3</span> Some helper macros<a aria-hidden="true" href="#some-helper-macros">#</a> </h4>
<div class="outline-text-4" id="text-2-3-3">
<p>
There are a few handy macros added by doom, namely
</p>
<ul class="org-ul">
<li><code>load!</code> for loading external <code>.el</code> files relative to this one</li>
<li><code>use-package!</code> for configuring packages</li>
<li><code>add-load-path!</code> for adding directories to the <code>load-path</code> where <code>Emacs</code> looks when
you load packages with <code>require</code> or <code>use-package</code></li>
<li><code>map!</code> for binding new keys</li>
</ul>
</div>
</div>

<div id="outline-container-allow-babel-execution" class="outline-4">
<h4 id="allow-babel-execution"><span class="section-number-4">2.3.4</span> Allow babel execution in <span class='acr'><span class='acr'>CLI</span></span> actions<a aria-hidden="true" href="#allow-babel-execution">#</a> </h4>
<div class="outline-text-4" id="text-2-3-4">
<p>
In this config I sometimes generate code to include in my config.
This works nicely, but for it to work with <kbd>doom sync</kbd> et. al. I need to make sure
that Org doesn&rsquo;t try to confirm that I want to allow evaluation (I do!).
</p>

<p>
Thankfully Doom supports <kbd>$DOOMDIR/cli.el</kbd> file which is sourced every time a <span class='acr'>CLI</span>
command is run, so we can just enable evaluation by setting
<code>org-confirm-babel-evaluate</code> to <code>nil</code> there.
While we&rsquo;re at it, we should silence <code>org-babel-execute-src-block</code> to
avoid polluting the output.
</p>

<details id='allow-babel-execution,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#allow-babel-execution,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">cli.el -*- lexical-binding: t; -*-</span>
(<span class="org-keyword">setq</span> org-confirm-babel-evaluate nil)

(<span class="org-keyword">defun</span> <span class="org-function-name">doom-shut-up-a</span> (orig-fn <span class="org-type">&amp;rest</span> args)
  (<span class="org-keyword">quiet!</span> (apply orig-fn args)))

(advice-add 'org-babel-execute-src-block <span class="org-builtin">:around</span> #'doom-shut-up-a)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-asyncronous-config-tangling" class="outline-4">
<h4 id="asyncronous-config-tangling"><span class="section-number-4">2.3.5</span> Asyncronous config tangling<a aria-hidden="true" href="#asyncronous-config-tangling">#</a> </h4>
<div class="outline-text-4" id="text-2-3-5">
<p>
Doom adds an <kbd>org-mode</kbd> hook <code>+literate-enable-recompile-h</code>. This is a nice idea,
but it&rsquo;s too blocking for my taste. Since I trust my tangling to be fairly
straightforward, I&rsquo;ll just redefine it to a simpler, async, function.
</p>
<details id='asyncronous-config-tangling,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#asyncronous-config-tangling,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> +literate-tangle-async-h ()
  <span class="org-doc">"A very simplified version of `</span><span class="org-doc"><span class="org-constant">+literate-tangle-h</span></span><span class="org-doc">', but async."</span>
  <span class="org-builtin">:override</span> #'+literate-tangle-h
  (<span class="org-keyword">let</span> ((default-directory doom-private-dir))
    (async-shell-command
     (format <span class="org-string">"emacs --batch --eval \"(progn \</span>
<span class="org-string">(require 'org) (setq org-confirm-babel-evaluate nil) \</span>
<span class="org-string">(org-babel-tangle-file \\\"%s\\\"))\""</span>
             +literate-config-file))))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-other-things" class="outline-3">
<h3 id="other-things"><span class="section-number-3">2.4</span> Other things<a aria-hidden="true" href="#other-things">#</a> </h3>
<div class="outline-text-3" id="text-2-4">
</div>
<div id="outline-container-editor-interaction" class="outline-4">
<h4 id="editor-interaction"><span class="section-number-4">2.4.1</span> Editor interaction<a aria-hidden="true" href="#editor-interaction">#</a> </h4>
<div class="outline-text-4" id="text-2-4-1">
</div>
<div id="outline-container-mouse-buttons" class="outline-5">
<h5 id="mouse-buttons"><span class="section-number-5">2.4.1.1</span> Mouse buttons<a aria-hidden="true" href="#mouse-buttons">#</a> </h5>
<div class="outline-text-5" id="text-2-4-1-1">
<details id='mouse-buttons,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#mouse-buttons,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">map!</span> <span class="org-builtin">:n</span> [mouse-8] #'better-jumper-jump-backward
      <span class="org-builtin">:n</span> [mouse-9] #'better-jumper-jump-forward)
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-window-title" class="outline-4">
<h4 id="window-title"><span class="section-number-4">2.4.2</span> Window title<a aria-hidden="true" href="#window-title">#</a> </h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
I&rsquo;d like to have just the buffer name, then if applicable the project folder
</p>
<details id='window-title,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#window-title,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> frame-title-format
      '(<span class="org-string">""</span>
        (<span class="org-builtin">:eval</span>
         (<span class="org-keyword">if</span> (s-contains-p org-roam-directory (<span class="org-keyword">or</span> buffer-file-name <span class="org-string">""</span>))
             (replace-regexp-in-string
              <span class="org-string">".*/[0-9]*-?"</span> <span class="org-string">"&#9776; "</span>
              (subst-char-in-string ?_ ?  buffer-file-name))
           <span class="org-string">"%b"</span>))
        (<span class="org-builtin">:eval</span>
         (<span class="org-keyword">let</span> ((project-name (projectile-project-name)))
           (<span class="org-keyword">unless</span> (string= <span class="org-string">"-"</span> project-name)
             (format (<span class="org-keyword">if</span> (buffer-modified-p)  <span class="org-string">" &#9673; %s"</span> <span class="org-string">" &#8198;&#9679;&#8198; %s"</span>) project-name))))))
</pre>
</div>
    </details>

<p>
For example when I open my config file it the window will be titled <kbd>config.org â—
doom</kbd> then as soon as I make a change it will become <kbd>config.org â—‰ doom</kbd>.
</p>
</div>
</div>
<div id="outline-container-splash-screen" class="outline-4">
<h4 id="splash-screen"><span class="section-number-4">2.4.3</span> Splash screen<a aria-hidden="true" href="#splash-screen">#</a> </h4>
<div class="outline-text-4" id="text-2-4-3">
<p>
Emacs can render an image as the splash screen, and <a href="https://github.com/MarioRicalde">@MarioRicalde</a> came up with a
cracker! He&rsquo;s also provided me with a nice Emacs-style <i>E</i>. I was using the
blackhole image, but as I&rsquo;ve stripped down the splash screen I&rsquo;ve switched to
just using the <i>E</i>.
</p>


<figure id="orgbe9b640">
<object type="image/svg+xml" data="misc/splash-images/emacs-e.svg" class="org-svg" style="width:20%" alt="Fancy Emacs &quot;E&quot;">
Sorry, your browser does not support SVG.</object>

</figure>

<p>
Now we just make it theme-appropriate, and resize with the frame.
</p>

<details id='splash-screen,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#splash-screen,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">fancy-splash-image-template</span>
  (expand-file-name <span class="org-string">"misc/splash-images/emacs-e-template.svg"</span> doom-private-dir)
  <span class="org-doc">"Default template svg used for the splash image, with substitutions from "</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">fancy-splash-sizes</span>
  `((<span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">300</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">50</span> <span class="org-builtin">:padding</span> (<span class="org-highlight-numbers-number">0</span> . <span class="org-highlight-numbers-number">2</span>))
    (<span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">250</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">42</span> <span class="org-builtin">:padding</span> (<span class="org-highlight-numbers-number">2</span> . <span class="org-highlight-numbers-number">4</span>))
    (<span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">200</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">35</span> <span class="org-builtin">:padding</span> (<span class="org-highlight-numbers-number">3</span> . <span class="org-highlight-numbers-number">3</span>))
    (<span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">150</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">28</span> <span class="org-builtin">:padding</span> (<span class="org-highlight-numbers-number">3</span> . <span class="org-highlight-numbers-number">3</span>))
    (<span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">100</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">20</span> <span class="org-builtin">:padding</span> (<span class="org-highlight-numbers-number">2</span> . <span class="org-highlight-numbers-number">2</span>))
    (<span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">75</span>  <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">15</span> <span class="org-builtin">:padding</span> (<span class="org-highlight-numbers-number">2</span> . <span class="org-highlight-numbers-number">1</span>))
    (<span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">50</span>  <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">10</span> <span class="org-builtin">:padding</span> (<span class="org-highlight-numbers-number">1</span> . <span class="org-highlight-numbers-number">0</span>))
    (<span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1</span>   <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">0</span>  <span class="org-builtin">:padding</span> (<span class="org-highlight-numbers-number">0</span> . <span class="org-highlight-numbers-number">0</span>)))
  <span class="org-doc">"list of plists with the following properties</span>
<span class="org-doc">  :height the height of the image</span>
<span class="org-doc">  :min-height minimum `</span><span class="org-doc"><span class="org-constant">frame-height</span></span><span class="org-doc">' for image</span>
<span class="org-doc">  :padding `</span><span class="org-doc"><span class="org-constant">+doom-dashboard-banner-padding</span></span><span class="org-doc">' (top . bottom) to apply</span>
<span class="org-doc">  :template non-default template file</span>
<span class="org-doc">  :file file to use instead of template"</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">fancy-splash-template-colours</span>
  '((<span class="org-string">"$colour1"</span> . keywords) (<span class="org-string">"$colour2"</span> . type) (<span class="org-string">"$colour3"</span> . base5) (<span class="org-string">"$colour4"</span> . base8))
  <span class="org-doc">"list of colour-replacement alists of the form (\"$placeholder\" . 'theme-colour) which applied the template"</span>)

(<span class="org-keyword">unless</span> (file-exists-p (expand-file-name <span class="org-string">"theme-splashes"</span> doom-cache-dir))
  (make-directory (expand-file-name <span class="org-string">"theme-splashes"</span> doom-cache-dir) t))

(<span class="org-keyword">defun</span> <span class="org-function-name">fancy-splash-filename</span> (theme-name height)
  (expand-file-name (concat (file-name-as-directory <span class="org-string">"theme-splashes"</span>)
                            theme-name
                            <span class="org-string">"-"</span> (number-to-string height) <span class="org-string">".svg"</span>)
                    doom-cache-dir))

(<span class="org-keyword">defun</span> <span class="org-function-name">fancy-splash-clear-cache</span> ()
  <span class="org-doc">"Delete all cached fancy splash images"</span>
  (<span class="org-keyword">interactive</span>)
  (delete-directory (expand-file-name <span class="org-string">"theme-splashes"</span> doom-cache-dir) t)
  (message <span class="org-string">"Cache cleared!"</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">fancy-splash-generate-image</span> (template height)
  <span class="org-doc">"Read TEMPLATE and create an image if HEIGHT with colour substitutions as</span>
<span class="org-doc">   described by `</span><span class="org-doc"><span class="org-constant">fancy-splash-template-colours</span></span><span class="org-doc">' for the current theme"</span>
  (<span class="org-keyword">with-temp-buffer</span>
    (insert-file-contents template)
    (re-search-forward <span class="org-string">"$height"</span> nil t)
    (replace-match (number-to-string height) nil nil)
    (<span class="org-keyword">dolist</span> (substitution fancy-splash-template-colours)
      (goto-char (point-min))
      (<span class="org-keyword">while</span> (re-search-forward (car substitution) nil t)
        (replace-match (doom-color (cdr substitution)) nil nil)))
    (write-region nil nil
                  (fancy-splash-filename (symbol-name doom-theme) height) nil nil)))

(<span class="org-keyword">defun</span> <span class="org-function-name">fancy-splash-generate-images</span> ()
  <span class="org-doc">"Perform `</span><span class="org-doc"><span class="org-constant">fancy-splash-generate-image</span></span><span class="org-doc">' in bulk"</span>
  (<span class="org-keyword">dolist</span> (size fancy-splash-sizes)
    (<span class="org-keyword">unless</span> (plist-get size <span class="org-builtin">:file</span>)
      (fancy-splash-generate-image (<span class="org-keyword">or</span> (plist-get size <span class="org-builtin">:template</span>)
                                       fancy-splash-image-template)
                                   (plist-get size <span class="org-builtin">:height</span>)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">ensure-theme-splash-images-exist</span> (<span class="org-type">&amp;optional</span> height)
  (<span class="org-keyword">unless</span> (file-exists-p (fancy-splash-filename
                          (symbol-name doom-theme)
                          (<span class="org-keyword">or</span> height
                              (plist-get (car fancy-splash-sizes) <span class="org-builtin">:height</span>))))
    (fancy-splash-generate-images)))

(<span class="org-keyword">defun</span> <span class="org-function-name">get-appropriate-splash</span> ()
  (<span class="org-keyword">let</span> ((height (frame-height)))
    (cl-some (<span class="org-keyword">lambda</span> (size) (<span class="org-keyword">when</span> (&gt;= height (plist-get size <span class="org-builtin">:min-height</span>)) size))
             fancy-splash-sizes)))

(<span class="org-keyword">setq</span> fancy-splash-last-size nil)
(<span class="org-keyword">setq</span> fancy-splash-last-theme nil)
(<span class="org-keyword">defun</span> <span class="org-function-name">set-appropriate-splash</span> (<span class="org-type">&amp;rest</span> _)
  (<span class="org-keyword">let</span> ((appropriate-image (get-appropriate-splash)))
    (<span class="org-keyword">unless</span> (<span class="org-keyword">and</span> (equal appropriate-image fancy-splash-last-size)
                 (equal doom-theme fancy-splash-last-theme)))
    (<span class="org-keyword">unless</span> (plist-get appropriate-image <span class="org-builtin">:file</span>)
      (ensure-theme-splash-images-exist (plist-get appropriate-image <span class="org-builtin">:height</span>)))
    (<span class="org-keyword">setq</span> fancy-splash-image
          (<span class="org-keyword">or</span> (plist-get appropriate-image <span class="org-builtin">:file</span>)
              (fancy-splash-filename (symbol-name doom-theme) (plist-get appropriate-image <span class="org-builtin">:height</span>))))
    (<span class="org-keyword">setq</span> +doom-dashboard-banner-padding (plist-get appropriate-image <span class="org-builtin">:padding</span>))
    (<span class="org-keyword">setq</span> fancy-splash-last-size appropriate-image)
    (<span class="org-keyword">setq</span> fancy-splash-last-theme doom-theme)
    (+doom-dashboard-reload)))

(add-hook 'window-size-change-functions #'set-appropriate-splash)
(add-hook 'doom-load-theme-hook #'set-appropriate-splash)
</pre>
</div>
    </details>

<p>
Now the only thing missing is a an extra interesting line, whether that be some
corporate <span class='acr'>BS</span>, an developer excuse, or a fun (useless) fact.
</p>

<p>
The following is rather long, but it essentially
</p>
<ul class="org-ul">
<li>fetches a phrase from an <span class='acr'>API</span></li>
<li>inserts it into the dashboard (asynchronously)</li>
<li>moves <code>point</code> to the phrase</li>
<li>re-uses the last phrase for requests within a few seconds of it being fetched</li>
</ul>

<details id='splash-screen,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#splash-screen,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">phrase-api-url</span>
  (nth (random <span class="org-highlight-numbers-number">3</span>)
       '((<span class="org-string">"https://corporatebs-generator.sameerkumar.website/"</span> <span class="org-builtin">:phrase</span>)
         (<span class="org-string">"https://useless-facts.sameerkumar.website/api"</span> <span class="org-builtin">:data</span>)
         (<span class="org-string">"https://dev-excuses-api.herokuapp.com/"</span> <span class="org-builtin">:text</span>))))

(<span class="org-keyword">defmacro</span> <span class="org-function-name">phrase-generate-callback</span> (token <span class="org-type">&amp;optional</span> format-fn ignore-read-only callback buffer-name)
  `(<span class="org-keyword">lambda</span> (status)
     (<span class="org-keyword">unless</span> (plist-get status <span class="org-builtin">:error</span>)
       (goto-char url-http-end-of-headers)
       (<span class="org-keyword">let</span> ((phrase (plist-get (json-parse-buffer <span class="org-builtin">:object-type</span> 'plist) (cadr phrase-api-url)))
             (inhibit-read-only ,(<span class="org-keyword">when</span> (eval ignore-read-only) t)))
         (<span class="org-keyword">setq</span> phrase-last (cons phrase (float-time)))
         (<span class="org-keyword">with-current-buffer</span> ,(<span class="org-keyword">or</span> (eval buffer-name) (buffer-name (current-buffer)))
           (<span class="org-keyword">save-excursion</span>
             (goto-char (point-min))
             (<span class="org-keyword">when</span> (search-forward ,token nil t)
               (<span class="org-keyword">with-silent-modifications</span>
                 (replace-match <span class="org-string">""</span>)
                 (insert ,(<span class="org-keyword">if</span> format-fn format-fn 'phrase)))))
           ,callback)))))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">phrase-last</span> nil)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">phrase-timeout</span> <span class="org-highlight-numbers-number">5</span>)

(<span class="org-keyword">defmacro</span> <span class="org-function-name">phrase-insert-async</span> (<span class="org-type">&amp;optional</span> format-fn token ignore-read-only callback buffer-name)
  `(<span class="org-keyword">let</span> ((inhibit-message t))
     (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> phrase-last
              (&gt; phrase-timeout (- (float-time) (cdr phrase-last))))
         (<span class="org-keyword">let</span> ((phrase (car phrase-last)))
           ,(<span class="org-keyword">if</span> format-fn format-fn 'phrase))
       (url-retrieve (car phrase-api-url)
                     (<span class="org-keyword">phrase-generate-callback</span> ,(<span class="org-keyword">or</span> token <span class="org-string">"\ufeff"</span>) ,format-fn ,ignore-read-only ,callback ,buffer-name))
       <span class="org-comment-delimiter">;; </span><span class="org-comment">For reference, \ufeff = Zero-width no-break space / BOM</span>
       ,(<span class="org-keyword">or</span> token <span class="org-string">"\ufeff"</span>))))

(<span class="org-keyword">defun</span> <span class="org-function-name">doom-dashboard-phrase</span> ()
  (<span class="org-keyword">phrase-insert-async</span>
   (<span class="org-keyword">progn</span>
     (<span class="org-keyword">setq-local</span> phrase-position (point))
     (mapconcat
      (<span class="org-keyword">lambda</span> (line)
        (+doom-dashboard--center
         +doom-dashboard--width
         (<span class="org-keyword">with-temp-buffer</span>
           (insert-text-button
            line
            'action
            (<span class="org-keyword">lambda</span> (_)
              (<span class="org-keyword">setq</span> phrase-last nil)
              (+doom-dashboard-reload t))
            'face 'doom-dashboard-menu-title
            'mouse-face 'doom-dashboard-menu-title
            'help-echo <span class="org-string">"Random phrase"</span>
            'follow-link t)
           (buffer-string))))
      (split-string
       (<span class="org-keyword">with-temp-buffer</span>
         (insert phrase)
         (<span class="org-keyword">setq</span> fill-column (min <span class="org-highlight-numbers-number">70</span> (/ (* <span class="org-highlight-numbers-number">2</span> (window-width)) <span class="org-highlight-numbers-number">3</span>)))
         (fill-region (point-min) (point-max))
         (buffer-string))
       <span class="org-string">"\n"</span>)
      <span class="org-string">"\n"</span>))
   nil t
   (<span class="org-keyword">progn</span>
     (goto-char phrase-position)
     (forward-whitespace <span class="org-highlight-numbers-number">1</span>))
   +doom-dashboard-name))

(<span class="org-keyword">defadvice!</span> doom-dashboard-widget-loaded-with-phrase ()
  <span class="org-builtin">:override</span> #'doom-dashboard-widget-loaded
  (<span class="org-keyword">setq</span> line-spacing <span class="org-highlight-numbers-number">0.2</span>)
  (insert
   <span class="org-string">"\n\n"</span>
   (propertize
    (+doom-dashboard--center
     +doom-dashboard--width
     (doom-display-benchmark-h 'return))
    'face 'doom-dashboard-loaded)
   <span class="org-string">"\n"</span>
   (doom-dashboard-phrase)
   <span class="org-string">"\n"</span>))
</pre>
</div>
    </details>

<p>
Lastly, the doom dashboard &ldquo;useful commands&rdquo; are no longer useful to me.
So, we&rsquo;ll disable them and then for a particularly <i>clean</i> look disable
the modeline and <code>hl-line-mode</code>, then also hide the cursor.
</p>

<details id='splash-screen,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#splash-screen,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(remove-hook '+doom-dashboard-functions #'doom-dashboard-widget-shortmenu)
(<span class="org-keyword">add-hook!</span> '+doom-dashboard-mode-hook (hide-mode-line-mode <span class="org-highlight-numbers-number">1</span>) (hl-line-mode <span class="org-highlight-numbers-number">-1</span>))
(<span class="org-keyword">setq-hook!</span> '+doom-dashboard-mode-hook evil-normal-state-cursor (list nil))
</pre>
</div>
    </details>

<p>
At the end, we have a minimal but rather nice splash screen.
</p>


<figure id="org242f632">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/splash-screen.png" alt="The splash screen, just loaded." class="invertible">

</figure>

<p>
I haven&rsquo;t forgotten about the <span class='acr'>ASCII</span> banner though! Once again we&rsquo;re going for
something simple.
</p>

<details id='splash-screen,code--4' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#splash-screen,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">doom-dashboard-draw-ascii-emacs-banner-fn</span> ()
  (<span class="org-keyword">let*</span> ((banner
          '(<span class="org-string">",---.,-.-.,---.,---.,---."</span>
            <span class="org-string">"|---'| | |,---||    `---."</span>
            <span class="org-string">"`</span><span class="org-string"><span class="org-constant">---</span></span><span class="org-string">'` ' '`---^`</span><span class="org-string"><span class="org-constant">---</span></span><span class="org-string">'`</span><span class="org-string"><span class="org-constant">---</span></span><span class="org-string">'"</span>))
         (longest-line (apply #'max (mapcar #'length banner))))
    (put-text-property
     (point)
     (<span class="org-keyword">dolist</span> (line banner (point))
       (insert (+doom-dashboard--center
                +doom-dashboard--width
                (concat
                 line (make-string (max <span class="org-highlight-numbers-number">0</span> (- longest-line (length line)))
                                   <span class="org-highlight-numbers-number">32</span>)))
               <span class="org-string">"\n"</span>))
     'face 'doom-dashboard-banner)))

(<span class="org-keyword">unless</span> (display-graphic-p) <span class="org-comment-delimiter">; </span><span class="org-comment">for some reason this messes up the graphical splash screen atm</span>
  (<span class="org-keyword">setq</span> +doom-dashboard-ascii-banner-fn #'doom-dashboard-draw-ascii-emacs-banner-fn))
</pre>
</div>
    </details>
</div>
</div>


<div id="outline-container-systemd-daemon" class="outline-4">
<h4 id="systemd-daemon"><span class="section-number-4">2.4.4</span> Systemd daemon<a aria-hidden="true" href="#systemd-daemon">#</a> </h4>
<div class="outline-text-4" id="text-2-4-4">
<p>
For running a systemd service for a Emacs server I have the following
</p>
<details id='emacsclient-service' class='code' open><summary class='named'><span class="name">emacsclient service</span><span class="lang">systemd</span></summary>
    <div class='gutter'>
    <a href='#emacsclient-service'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-systemd"><span class="org-type">[Unit]</span>
<span class="org-keyword">Description</span>=Emacs server daemon
<span class="org-keyword">Documentation</span>=info:emacs man:emacs(<span class="org-highlight-numbers-number">1</span>) https://gnu.org/software/emacs/

<span class="org-type">[Service]</span>
<span class="org-keyword">Type</span>=<span class="org-builtin">forking</span>
<span class="org-keyword">ExecStart</span>=sh -c <span class="org-string">'emacs --daemon &amp;&amp; emacsclient -c --eval "(delete-frame)"'</span>
<span class="org-keyword">ExecStop</span>=/usr/bin/emacsclient --no-wait --eval <span class="org-string">"(progn (setq kill-emacs-hook nil) (kill emacs))"</span>
<span class="org-keyword">Restart</span>=<span class="org-builtin">on-failure</span>

<span class="org-type">[Install]</span>
<span class="org-keyword">WantedBy</span>=default.target
</pre>
</div>
    </details>

<p>
which is then enabled by
</p>
<details id='systemd-daemon,code--1' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#systemd-daemon,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">systemctl --user enable emacs.service
</pre>
</div>
    </details>

<p>
For some reason if a frame isn&rsquo;t opened early in the initialisation process, the
daemon doesn&rsquo;t seem to like opening frames later &#x2014; hence the <code>&amp;&amp; emacsclient</code>
part of the <kbd>ExecStart</kbd> value.
</p>

<p>
It can now be nice to use this as a &rsquo;default app&rsquo; for opening files. If we add
an appropriate desktop entry, and enable it in the desktop environment.
</p>

<details id='systemd-daemon,code--2' class='code' open><summary><span class="lang">Configuration File</span></summary>
    <div class='gutter'>
    <a href='#systemd-daemon,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-conf">[<span class="org-type">Desktop Entry</span>]
<span class="org-variable-name">Name</span>=Emacs client
<span class="org-variable-name">GenericName</span>=Text Editor
<span class="org-variable-name">Comment</span>=A flexible platform for end-user applications
<span class="org-variable-name">MimeType</span>=text/english;text/plain;text/x-makefile;text/x-c++hdr;text/x-c++src;text/x-chdr;text/x-csrc;text/x-java;text/x-moc;text/x-pascal;text/x-tcl;text/x-tex;application/x-shellscript;text/x-c;text/x-c++;
<span class="org-variable-name">Exec</span>=emacsclient -create-frame --alternate-editor=<span class="org-string">""</span> --no-wait %F
<span class="org-variable-name">Icon</span>=emacs
<span class="org-variable-name">Type</span>=Application
<span class="org-variable-name">Terminal</span>=false
<span class="org-variable-name">Categories</span>=TextEditor;Utility;
<span class="org-variable-name">StartupWMClass</span>=Emacs
<span class="org-variable-name">Keywords</span>=Text;Editor;
<span class="org-variable-name">X-KDE-StartupNotify</span>=false
</pre>
</div>
    </details>

<p>
When the daemon is running, I almost always want to do a few particular things
with it, so I may as well eat the load time at startup. We also want to keep
<kbd>mu4e</kbd> running.
</p>

<p>
It would be good to start the <span class='acr'>IRC</span> client (<kbd>circe</kbd>) too, but that seems to have
issues when started in a non-graphical session.
</p>

<p>
Lastly, while I&rsquo;m not sure quite why it happens, but after a bit it seems that
new Emacsclient frames start on the <kbd>*scratch*</kbd> buffer instead of the dashboard.
I prefer the dashboard, so let&rsquo;s ensure that&rsquo;s always switched to in new frames.
</p>

<details id='daemon-initialisation' class='code' open><summary class='named'><span class="name">daemon initialisation</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#daemon-initialisation'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">greedily-do-daemon-setup</span> ()
  (<span class="org-keyword">require</span> '<span class="org-constant">org</span>)
  (<span class="org-keyword">when</span> (<span class="org-keyword">require</span> '<span class="org-constant">mu4e</span> nil t)
    (<span class="org-keyword">setq</span> mu4e-confirm-quit t)
    (<span class="org-keyword">setq</span> +mu4e-lock-greedy t)
    (<span class="org-keyword">setq</span> +mu4e-lock-relaxed t)
    (+mu4e-lock-add-watcher)
    (<span class="org-keyword">when</span> (+mu4e-lock-available t)
      (mu4e~start)))
  (<span class="org-keyword">when</span> (<span class="org-keyword">require</span> '<span class="org-constant">elfeed</span> nil t)
    (run-at-time nil (* <span class="org-highlight-numbers-number">8</span> <span class="org-highlight-numbers-number">60</span> <span class="org-highlight-numbers-number">60</span>) #'elfeed-update)))

(<span class="org-keyword">when</span> (daemonp)
  (add-hook 'emacs-startup-hook #'greedily-do-daemon-setup)
  (<span class="org-keyword">add-hook!</span> 'server-after-make-frame-hook (switch-to-buffer +doom-dashboard-name)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-emacs-client-wrapper" class="outline-4">
<h4 id="emacs-client-wrapper"><span class="section-number-4">2.4.5</span> Emacs client wrapper<a aria-hidden="true" href="#emacs-client-wrapper">#</a> </h4>
<div class="outline-text-4" id="text-2-4-5">
<p>
I frequently want to make use of Emacs while in a terminal emulator. To make
this easier, I can construct a few handy aliases.
</p>

<p>
However, a little convenience script in <kbd>~/.local/bin</kbd> can have the same effect,
be available beyond the specific shell I plop the alias in, then also allow me
to add a few bells and whistles &#x2014; namely:
</p>
<ul class="org-ul">
<li>Accepting stdin by putting it in a temporary file and immediately opening it.</li>
<li>Guessing that the <kbd>tty</kbd> is a good idea when <code>$DISPLAY</code> is unset (relevant with <span class='acr'>SSH</span>
sessions, among other things).</li>
<li>With a whiff of 24-bit color support, sets <code>TERM</code> variable to a <kbd>terminfo</kbd> that
(probably) announces 24-bit color support.</li>
<li>Changes <span class='acr'>GUI</span> <kbd>emacsclient</kbd> instances to be non-blocking by default (<code>--no-wait</code>),
and instead take a flag to suppress this behaviour (<code>-w</code>).</li>
</ul>

<p>
I would use <kbd>sh</kbd>, but using arrays for argument manipulation is just too
convenient, so I&rsquo;ll raise the requirement to <kbd>bash</kbd>. Since arrays are the only
&rsquo;extra&rsquo; compared to <kbd>sh</kbd>, other shells like <kbd>ksh</kbd> etc. should work too.
</p>

<details id='e' class='code' open><summary class='named'><span class="name">e</span><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#e'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/</span><span class="org-keyword">env</span><span class="org-comment"> bash</span>
<span class="org-variable-name">force_tty</span>=false
<span class="org-variable-name">force_wait</span>=false
<span class="org-variable-name">stdin_mode</span>=<span class="org-string">""</span>

<span class="org-variable-name">args</span>=<span class="org-rainbow-delimiters-depth-1">()</span>

<span class="org-keyword">while</span> :; <span class="org-keyword">do</span>
    <span class="org-keyword">case</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">1</span></span><span class="org-string">"</span><span class="org-keyword"> in</span>
        -t | -nw | --tty)
            <span class="org-variable-name">force_tty</span>=true
            <span class="org-builtin">shift</span> ;;
        -w | --wait)
            <span class="org-variable-name">force_wait</span>=true
            <span class="org-builtin">shift</span> ;;
        -m | --mode)
            <span class="org-variable-name">stdin_mode</span>=<span class="org-string">" (</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">2</span></span><span class="org-string">-mode)"</span>
            <span class="org-builtin">shift</span> <span class="org-highlight-numbers-number">2</span> ;;
        -h | --help)
            <span class="org-type">echo</span> -e <span class="org-string">"\033[1mUsage: e [-t] [-m MODE] [OPTIONS] FILE [-]\033[0m</span>

<span class="org-string">Emacs client convenience wrapper.</span>

<span class="org-string">\033[1mOptions:\033[0m</span>
<span class="org-string">\033[0;34m-h, --help\033[0m            Show this message</span>
<span class="org-string">\033[0;34m-t, -nw, --tty\033[0m        Force terminal mode</span>
<span class="org-string">\033[0;34m-w, --wait\033[0m            Don't supply \033[0;34m--no-wait\033[0m to graphical emacsclient</span>
<span class="org-string">\033[0;34m-\033[0m                     Take \033[0;33mstdin\033[0m (when last argument)</span>
<span class="org-string">\033[0;34m-m MODE, --mode MODE\033[0m  Mode to open \033[0;33mstdin\033[0m with</span>

<span class="org-string">Run \033[0;32memacsclient --help\033[0m to see help for the emacsclient."</span>
            <span class="org-keyword">exit</span> <span class="org-highlight-numbers-number">0</span> ;;
        --*=*)
            <span class="org-builtin">set</span> -- <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">@</span></span><span class="org-string">"</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{1%%=*}</span></span><span class="org-string">"</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{1#*=}</span></span><span class="org-string">"</span>
            <span class="org-builtin">shift</span> ;;
        *)
            <span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">[</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">#</span></span><span class="org-string">"</span> = <span class="org-highlight-numbers-number">0</span> <span class="org-rainbow-delimiters-depth-1">]</span>; <span class="org-keyword">then</span>
                <span class="org-keyword">break</span>; <span class="org-keyword">fi</span>
            <span class="org-variable-name">args</span>+=<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">1</span></span><span class="org-string">"</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-builtin">shift</span> ;;
    <span class="org-keyword">esac</span>
<span class="org-keyword">done</span>

<span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">[</span> <span class="org-negation-char">!</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{#args[*]}</span></span><span class="org-string">"</span> = <span class="org-highlight-numbers-number">0</span> <span class="org-rainbow-delimiters-depth-1">]</span> &amp;&amp; <span class="org-rainbow-delimiters-depth-1">[</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{args[-1]}</span></span><span class="org-string">"</span> = <span class="org-string">"-"</span> <span class="org-rainbow-delimiters-depth-1">]</span>; <span class="org-keyword">then</span>
    <span class="org-builtin">unset</span> <span class="org-string">'args[-1]'</span>
    <span class="org-variable-name">TMP</span>=<span class="org-string">"</span><span class="org-string"><span class="org-sh-quoted-exec">$(</span></span><span class="org-sh-quoted-exec">mktemp</span><span class="org-string"><span class="org-sh-quoted-exec"> /tmp/emacsstdin-</span></span><span class="org-string"><span class="org-sh-quoted-exec"><span class="org-bold"><span class="org-constant">XXX</span></span></span></span><span class="org-string"><span class="org-sh-quoted-exec">)</span></span><span class="org-string">"</span>
    <span class="org-type">cat</span> &gt; <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">TMP</span></span><span class="org-string">"</span>
    <span class="org-variable-name">args</span>+=<span class="org-rainbow-delimiters-depth-1">(</span>--eval <span class="org-string">"(let ((b (generate-new-buffer \"*stdin*\"))) (switch-to-buffer b) (insert-file-contents \"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">TMP</span></span><span class="org-string">\") (delete-file \"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">TMP</span></span><span class="org-string">\")</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{stdin_mode}</span></span><span class="org-string">)"</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-keyword">fi</span>

<span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">[</span> -z <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">DISPLAY</span></span><span class="org-string">"</span> <span class="org-rainbow-delimiters-depth-1">]</span> || $<span class="org-variable-name">force_tty</span>; <span class="org-keyword">then</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">detect terminals with sneaky 24-bit support</span>
    <span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">{</span> <span class="org-rainbow-delimiters-depth-2">[</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">COLORTERM</span></span><span class="org-string">"</span> = truecolor <span class="org-rainbow-delimiters-depth-2">]</span> || <span class="org-rainbow-delimiters-depth-2">[</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">COLORTERM</span></span><span class="org-string">"</span> = 24bit <span class="org-rainbow-delimiters-depth-2">]</span>; <span class="org-rainbow-delimiters-depth-1">}</span> <span class="org-sh-escaped-newline">\</span>
        &amp;&amp; <span class="org-rainbow-delimiters-depth-1">[</span> <span class="org-string">"</span><span class="org-string"><span class="org-sh-quoted-exec">$(</span></span><span class="org-sh-quoted-exec">tput</span><span class="org-string"><span class="org-sh-quoted-exec"> colors 2&gt;/dev/null)</span></span><span class="org-string">"</span> -lt <span class="org-highlight-numbers-number">257</span> <span class="org-rainbow-delimiters-depth-1">]</span>; <span class="org-keyword">then</span>
        <span class="org-keyword">if </span><span class="org-type">echo</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">TERM</span></span><span class="org-string">"</span> | <span class="org-type">grep</span> -q <span class="org-string">"^\w\+-[0-9]"</span>; <span class="org-keyword">then</span>
            <span class="org-variable-name">termstub</span>=<span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{TERM%%-*}</span></span><span class="org-string">"</span>; <span class="org-keyword">else</span>
            <span class="org-variable-name">termstub</span>=<span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{TERM#*-}</span></span><span class="org-string">"</span>; <span class="org-keyword">fi</span>
        <span class="org-keyword">if</span> infocmp <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">termstub</span></span><span class="org-string">-direct"</span> &gt;/dev/null <span class="org-highlight-numbers-number">2</span>&gt;&amp;<span class="org-highlight-numbers-number">1</span>; <span class="org-keyword">then</span>
            <span class="org-variable-name">TERM</span>=<span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">termstub</span></span><span class="org-string">-direct"</span>; <span class="org-keyword">else</span>
            <span class="org-variable-name">TERM</span>=<span class="org-string">"xterm-direct"</span>; <span class="org-keyword">fi</span> <span class="org-comment-delimiter"># </span><span class="org-comment">should be fairly safe</span>
    <span class="org-keyword">fi</span>
    emacsclient --tty -create-frame --alternate-editor=<span class="org-string">""</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{args[@]}</span></span><span class="org-string">"</span>
<span class="org-keyword">else</span>
    <span class="org-keyword">if</span> <span class="org-negation-char">!</span> $<span class="org-variable-name">force_wait</span>; <span class="org-keyword">then</span>
        <span class="org-variable-name">args</span>+=<span class="org-rainbow-delimiters-depth-1">(</span>--no-wait<span class="org-rainbow-delimiters-depth-1">)</span>; <span class="org-keyword">fi</span>
    emacsclient -create-frame --alternate-editor=<span class="org-string">""</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{args[@]}</span></span><span class="org-string">"</span>
<span class="org-keyword">fi</span>
</pre>
</div>
    </details>

<p>
Now, to set an alias to use <kbd>e</kbd> with magit, and then for maximum laziness we can
set aliases for the terminal-forced variants.
</p>
<details id='emacs-client-wrapper,code--1' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#emacs-client-wrapper,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">alias</span> <span class="org-variable-name">m</span>=<span class="org-string">'e --eval "(progn (magit-status) (delete-other-windows))"'</span>
<span class="org-builtin">alias</span> <span class="org-variable-name">mt</span>=<span class="org-string">"m -t"</span>
<span class="org-builtin">alias</span> <span class="org-variable-name">et</span>=<span class="org-string">"e -t"</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
</div>

<div id="outline-container-package-loading" class="outline-2">
<h2 id="package-loading"><span class="section-number-2">3</span> Package loading<a aria-hidden="true" href="#package-loading">#</a> </h2>
<div class="outline-text-2" id="text-3">
<p>
This file shouldn&rsquo;t be byte compiled.
</p>
<details id='package-loading,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#package-loading,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">-*- no-byte-compile: t; -*-</span>
</pre>
</div>
    </details>
</div>
<div id="outline-container-loading-instructions" class="outline-3">
<h3 id="loading-instructions"><span class="section-number-3">3.1</span> Loading instructions<a aria-hidden="true" href="#loading-instructions">#</a> </h3>
<div class="outline-text-3" id="text-3-1">
<p>
This is where you install packages, by declaring them with the <code>package!</code>
macro, then running <code>doom refresh</code> on the command line. You&rsquo;ll need to
restart Emacs for your changes to take effect! Or at least, run <kbd>M-x doom/reload</kbd>.
</p>

<p>
<b>Warning</b>: Don&rsquo;t disable core packages listed in <kbd>~/.emacs.d/core/packages.el</kbd>.
Doom requires these, and disabling them may have terrible side effects.
</p>
</div>

<div id="outline-container-packages-melpa-elpa" class="outline-4">
<h4 id="packages-melpa-elpa"><span class="section-number-4">3.1.1</span> Packages in <span class='acr'><span class='acr'>MELPA</span></span>/<span class='acr'><span class='acr'>ELPA</span></span>/emacsmirror<a aria-hidden="true" href="#packages-melpa-elpa">#</a> </h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
To install <code>some-package</code> from <span class='acr'>MELPA</span>, <span class='acr'>ELPA</span> or emacsmirror:
</p>
<details id='packages-melpa-elpa,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#packages-melpa-elpa,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> some-package)
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-packages-from-git" class="outline-4">
<h4 id="packages-from-git"><span class="section-number-4">3.1.2</span> Packages from git repositories<a aria-hidden="true" href="#packages-from-git">#</a> </h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
To install a package directly from a particular repo, you&rsquo;ll need to specify
a <code>:recipe</code>. You&rsquo;ll find documentation on what <code>:recipe</code> accepts <a href="https://github.com/raxod502/straight.el#the-recipe-format">here</a>:
</p>
<details id='packages-from-git,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#packages-from-git,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> another-package
  <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"username/repo"</span>))
</pre>
</div>
    </details>

<p>
If the package you are trying to install does not contain a <code>PACKAGENAME.el</code>
file, or is located in a subdirectory of the repo, you&rsquo;ll need to specify
<code>:files</code> in the <code>:recipe</code>:
</p>
<details id='packages-from-git,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#packages-from-git,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> this-package
  <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"username/repo"</span>
           <span class="org-builtin">:files</span> (<span class="org-string">"some-file.el"</span> <span class="org-string">"src/lisp/*.el"</span>)))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-disabling-built-packages" class="outline-4">
<h4 id="disabling-built-packages"><span class="section-number-4">3.1.3</span> Disabling built-in packages<a aria-hidden="true" href="#disabling-built-packages">#</a> </h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
If you&rsquo;d like to disable a package included with Doom, for whatever reason,
you can do so here with the <code>:disable</code> property:
</p>
<details id='disabling-built-packages,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#disabling-built-packages,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> builtin-package <span class="org-builtin">:disable</span> t)
</pre>
</div>
    </details>
<p>
You can override the recipe of a built in package without having to specify
all the properties for <code>:recipe</code>. These will inherit the rest of its recipe
from Doom or <span class='acr'>MELPA</span>/<span class='acr'>ELPA</span>/Emacsmirror:
</p>
<details id='disabling-built-packages,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#disabling-built-packages,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> builtin-package <span class="org-builtin">:recipe</span> (<span class="org-builtin">:nonrecursive</span> t))
(<span class="org-keyword">package!</span> builtin-package-2 <span class="org-builtin">:recipe</span> (<span class="org-builtin">:repo</span> <span class="org-string">"myfork/package"</span>))
</pre>
</div>
    </details>

<p>
Specify a <code>:branch</code> to install a package from a particular branch or tag.
This is required for some packages whose default branch isn&rsquo;t &rsquo;master&rsquo; (which
our package manager can&rsquo;t deal with; see <a href="https://github.com/raxod502/straight.el/issues/279">raxod502/straight.el#279</a>)
</p>
<details id='disabling-built-packages,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#disabling-built-packages,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> builtin-package <span class="org-builtin">:recipe</span> (<span class="org-builtin">:branch</span> <span class="org-string">"develop"</span>))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-general-packages" class="outline-3">
<h3 id="general-packages"><span class="section-number-3">3.2</span> General packages<a aria-hidden="true" href="#general-packages">#</a> </h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-window-management" class="outline-4">
<h4 id="window-management"><span class="section-number-4">3.2.1</span> Window management<a aria-hidden="true" href="#window-management">#</a> </h4>
<div class="outline-text-4" id="text-3-2-1">
<details id='window-management,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#window-management,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> rotate <span class="org-builtin">:pin</span> <span class="org-string">"4e9ac3ff800880bd9b705794ef0f7c99d72900a6"</span>)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-fun" class="outline-4">
<h4 id="fun"><span class="section-number-4">3.2.2</span> Fun<a aria-hidden="true" href="#fun">#</a> </h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
Sometimes one just wants a little fun.
<span class='acr'>XKCD</span> comics are fun.
</p>
<details id='fun,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> xkcd <span class="org-builtin">:pin</span> <span class="org-string">"66e928706fd660cfdab204c98a347b49c4267bdf"</span>)
</pre>
</div>
    </details>

<p>
Every so often, you want everyone else to <i>know</i> that you&rsquo;re typing, or just to
amuse oneself. Introducing: typewriter sounds!
</p>
<details id='fun,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> selectric-mode <span class="org-builtin">:pin</span> <span class="org-string">"1840de71f7414b7cd6ce425747c8e26a413233aa"</span>)
</pre>
</div>
    </details>

<p>
Hey, let&rsquo;s get the weather in here while we&rsquo;re at it.
Unfortunately this seems slightly unmaintained (<a href="https://github.com/bcbcarl/emacs-wttrin/pulls">few open bugfix <span class='acr'>PR</span><small>s</small></a>) so let&rsquo;s
roll our <a href="lisp/wttrin/wttrin.el">own version</a>.
</p>
<details id='fun,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> wttrin <span class="org-builtin">:recipe</span> (<span class="org-builtin">:local-repo</span> <span class="org-string">"lisp/wttrin"</span>))
</pre>
</div>
    </details>

<p>
Why not flash words on the screen. Why not &#x2014; hey, it could be fun.
</p>
<details id='fun,code--4' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> spray <span class="org-builtin">:pin</span> <span class="org-string">"74d9dcfa2e8b38f96a43de9ab0eb13364300cb46"</span>)
</pre>
</div>
    </details>

<p>
With all our fancy Emacs themes, my terminal is missing out!
</p>
<details id='fun,code--5' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> theme-magic <span class="org-builtin">:pin</span> <span class="org-string">"844c4311bd26ebafd4b6a1d72ddcc65d87f074e3"</span>)
</pre>
</div>
    </details>

<p>
What&rsquo;s even the point of using Emacs unless you&rsquo;re constantly telling everyone
about it?
</p>
<details id='fun,code--6' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> elcord <span class="org-builtin">:pin</span> <span class="org-string">"6608e0392b46324fc09a5b5f4457c15ac1394f80"</span>)
</pre>
</div>
    </details>

<p>
For some reason, I find myself demoing Emacs every now and then. Showing what
keyboard stuff I&rsquo;m doing on-screen seems helpful. While <a href="https://gitlab.com/screenkey/screenkey">screenkey</a> does exist,
having something that doesn&rsquo;t cover up screen content is nice.
</p>


<figure id="orgf3e6db5">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/keycast.png" alt="Screenshot of Keycast-mode in action" class="invertible">

</figure>

<details id='fun,code--7' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--7'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> keycast <span class="org-builtin">:pin</span> <span class="org-string">"a3a0798349adf3e33277091fa8dee63173b68edf"</span>)
</pre>
</div>
    </details>
<p>
let&rsquo;s just make sure this is lazy-loaded appropriately.
</p>
<details id='fun,code--8' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--8'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> keycast
  <span class="org-builtin">:commands</span> keycast-mode
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">define-minor-mode</span> <span class="org-function-name">keycast-mode</span>
    <span class="org-doc">"Show current command and its key binding in the mode line."</span>
    <span class="org-builtin">:global</span> t
    (<span class="org-keyword">if</span> keycast-mode
        (<span class="org-keyword">progn</span>
          (add-hook 'pre-command-hook 'keycast--update t)
          (add-to-list 'global-mode-string '(<span class="org-string">""</span> mode-line-keycast <span class="org-string">" "</span>)))
      (remove-hook 'pre-command-hook 'keycast--update)
      (<span class="org-keyword">setq</span> global-mode-string (remove '(<span class="org-string">""</span> mode-line-keycast <span class="org-string">" "</span>) global-mode-string))))
  (<span class="org-keyword">custom-set-faces!</span>
    '(keycast-command <span class="org-builtin">:inherit</span> doom-modeline-debug
                      <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">0.9</span>)
    '(keycast-key <span class="org-builtin">:inherit</span> custom-modified
                  <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.1</span>
                  <span class="org-builtin">:weight</span> bold)))
</pre>
</div>
    </details>

<p>
In a similar manner, <a href="https://gitlab.com/ambrevar/emacs-gif-screencast">gif-screencast</a> may come in handy.
</p>
<details id='fun,code--9' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--9'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> gif-screencast <span class="org-builtin">:pin</span> <span class="org-string">"fa81e915c256271fa10b807a2935d5eaa4700dff"</span>)
</pre>
</div>
    </details>

<p>
We can lazy load this using the start/stop commands.
</p>

<p>
I initially installed <code>scrot</code> for this, since it was the default capture program.
However it raised <code>glib error: Saving to file ... failed</code> each time it was run.
Google didn&rsquo;t reveal any easy fixed, so I switched to <a href="https://github.com/naelstrof/maim">maim</a>. We now need to pass
it the window <span class='acr'>ID</span>. This doesn&rsquo;t change throughout the lifetime of an emacs
instance, so as long as a single window is used <code>xdotool getactivewindow</code> will
give a satisfactory result.
</p>

<p>
It seems that when new colours appear, that tends to make <code>gifsicle</code> introduce
artefacts. To avoid this we pre-populate the colour map using the current doom
theme.
</p>
<details id='fun,code--10' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--10'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> gif-screencast
  <span class="org-builtin">:commands</span> gif-screencast-mode
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> gif-screencast-mode-map
        <span class="org-builtin">:g</span> <span class="org-string">"&lt;f8&gt;"</span> #'gif-screencast-toggle-pause
        <span class="org-builtin">:g</span> <span class="org-string">"&lt;f9&gt;"</span> #'gif-screencast-stop)
  (<span class="org-keyword">setq</span> gif-screencast-program <span class="org-string">"maim"</span>
        gif-screencast-args `(<span class="org-string">"--quality"</span> <span class="org-string">"3"</span> <span class="org-string">"-i"</span> ,(string-trim-right
                                                     (shell-command-to-string
                                                      <span class="org-string">"xdotool getactivewindow"</span>)))
        gif-screencast-optimize-args '(<span class="org-string">"--batch"</span> <span class="org-string">"--optimize=3"</span> <span class="org-string">"--usecolormap=/tmp/doom-color-theme"</span>))
  (<span class="org-keyword">defun</span> <span class="org-function-name">gif-screencast-write-colormap</span> ()
    (f-write-text
     (replace-regexp-in-string
      <span class="org-string">"\n+"</span> <span class="org-string">"\n"</span>
      (mapconcat (<span class="org-keyword">lambda</span> (c) (<span class="org-keyword">if</span> (listp (cdr c))
                                 (cadr c))) doom-themes--colors <span class="org-string">"\n"</span>))
     'utf-8
     <span class="org-string">"/tmp/doom-color-theme"</span> ))
  (gif-screencast-write-colormap)
  (add-hook 'doom-load-theme-hook #'gif-screencast-write-colormap))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-features" class="outline-4">
<h4 id="features"><span class="section-number-4">3.2.3</span> Features<a aria-hidden="true" href="#features">#</a> </h4>
<div class="outline-text-4" id="text-3-2-3">
</div>
<div id="outline-container-calctex" class="outline-5">
<h5 id="calctex"><span class="section-number-5">3.2.3.1</span> CalcTeX<a aria-hidden="true" href="#calctex">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-1">
<p>
This is a nice extension to <code>calc</code>
</p>

<details id='calctex,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#calctex,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> calctex <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"johnbcoughlin/calctex"</span>
                           <span class="org-builtin">:files</span> (<span class="org-string">"*.el"</span> <span class="org-string">"calctex/*.el"</span> <span class="org-string">"calctex-contrib/*.el"</span> <span class="org-string">"org-calctex/*.el"</span> <span class="org-string">"vendor"</span>))
  <span class="org-builtin">:pin</span> <span class="org-string">"784cf911bc96aac0f47d529e8cee96ebd7cc31c9"</span>)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-emacs-everywhere" class="outline-5">
<h5 id="emacs-everywhere"><span class="section-number-5">3.2.3.2</span> Emacs everywhere<a aria-hidden="true" href="#emacs-everywhere">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-2">
<details id='emacs-everywhere,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#emacs-everywhere,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> emacs-everywhere <span class="org-builtin">:recipe</span> (<span class="org-builtin">:local-repo</span> <span class="org-string">"lisp/emacs-everywhere"</span>) <span class="org-builtin">:pin</span> nil)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-ess" class="outline-5">
<h5 id="ess"><span class="section-number-5">3.2.3.3</span> <span class='acr'><span class='acr'>ESS</span></span><a aria-hidden="true" href="#ess">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-3">
<p>
View data frames better with
</p>
<details id='ess,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ess,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> ess-view <span class="org-builtin">:pin</span> <span class="org-string">"925cafd876e2cc37bc756bb7fcf3f34534b457e2"</span>)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-magit-delta" class="outline-5">
<h5 id="magit-delta"><span class="section-number-5">3.2.3.4</span> Magit Delta<a aria-hidden="true" href="#magit-delta">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-4">
<p>
<a href="https://github.com/dandavison/delta/">Delta</a> is a git diff syntax highlighter written in rust. The author also wrote a
package to hook this into the magit diff view. This requires the <code>delta</code> binary.
</p>
<details id='magit-delta,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#magit-delta,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(package! magit-delta :recipe (:host github :repo "dandavison/magit-delta") :pin "1164a6c3e501e944f1a6a2e91f15374a193bb8d3")</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-info-colours" class="outline-5">
<h5 id="info-colours"><span class="section-number-5">3.2.3.5</span> Info colours<a aria-hidden="true" href="#info-colours">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-5">
<p>
This makes manual pages nicer to look at :)
Variable pitch fontification + colouring
</p>


<figure id="orga4eb0f1">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/info-colours.png" alt="Example info-colours page." class="invertible" style="width:80%">

</figure>

<details id='info-colours,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#info-colours,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> info-colors <span class="org-builtin">:pin</span> <span class="org-string">"47ee73cc19b1049eef32c9f3e264ea7ef2aaf8a5"</span>)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-large-files" class="outline-5">
<h5 id="large-files"><span class="section-number-5">3.2.3.6</span> Large files<a aria-hidden="true" href="#large-files">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-6">
<p>
The <i>very large files</i> mode loads large files in chunks, allowing one to open
ridiculously large files.
</p>
<details id='large-files,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#large-files,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> vlf <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"m00natic/vlfi"</span> <span class="org-builtin">:files</span> (<span class="org-string">"*.el"</span>))
  <span class="org-builtin">:pin</span> <span class="org-string">"cc02f2533782d6b9b628cec7e2dcf25b2d05a27c"</span> <span class="org-builtin">:disable</span> t)
</pre>
</div>
    </details>
<p>
To make <span class='acr'>VLF</span> available without delaying startup, we&rsquo;ll just load it in quiet moments.
</p>
<details id='large-files,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#large-files,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> vlf-setup
  <span class="org-builtin">:defer-incrementally</span> vlf-tune vlf-base vlf-write vlf-search vlf-occur vlf-follow vlf-ediff vlf)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-definitions" class="outline-5">
<h5 id="definitions"><span class="section-number-5">3.2.3.7</span> Definitions<a aria-hidden="true" href="#definitions">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-7">
<p>
Doom already loads <kbd>define-word</kbd>, and provides it&rsquo;s own definition service using
<a href="https://github.com/gromnitsky/wordnut">wordnut</a>. However, using an offline dictionary possess a few compelling
advantages, namely:
</p>
<ul class="org-ul">
<li>speed</li>
<li>integration of multiple dictionaries</li>
</ul>
<p>
<a href="http://goldendict.org/">GoldenDict</a> seems like the best option currently avalible, but lacks a <span class='acr'>CLI</span>.
Hence, we&rsquo;ll fall back to <a href="https://dushistov.github.io/sdcv/">sdcv</a> (a <span class='acr'>CLI</span> version of StarDict) for now.
To interface with this, we&rsquo;ll use a my <kbd>lexic</kbd> package.
</p>


<figure id="org25c5df5">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/lexic.png" alt="Screenshot of the lexic-mode view of &quot;literate&quot;" class="invertible">

</figure>

<details id='definitions,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#definitions,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> lexic <span class="org-builtin">:recipe</span> (<span class="org-builtin">:local-repo</span> <span class="org-string">"lisp/lexic"</span>))
</pre>
</div>
    </details>

<p>
Given that a request for a <span class='acr'>CLI</span> is the most upvoted issue on GitHub for
GoldenDict, it&rsquo;s likely we&rsquo;ll be able to switch from <code>sdcv</code> to that in the future.
</p>

<p>
Since GoldenDict supports StarDict files, I expect this will be a relatively
painless switch.
</p>
</div>
</div>
<div id="outline-container-calibre-ebook-reading" class="outline-5">
<h5 id="calibre-ebook-reading"><span class="section-number-5">3.2.3.8</span> Calibre and ebook reading<a aria-hidden="true" href="#calibre-ebook-reading">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-8">
<p>
For managing my ebooks, I&rsquo;ll hook into the well-established ebook library
manager <a href="https://calibre-ebook.com/">calibre</a>. A number of Emacs clients for this exist, but this seems like a
good option.
</p>
<details id='calibre-ebook-reading,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#calibre-ebook-reading,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> calibredb <span class="org-builtin">:pin</span> <span class="org-string">"a3b04c0c37b1e8ceff2472e21a3579e64e944528"</span>)
</pre>
</div>
    </details>

<p>
Then for reading them, the only currently viable options seems to be <a href="https://depp.brause.cc/nov.el/">nov.el</a>.
</p>
<details id='calibre-ebook-reading,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#calibre-ebook-reading,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> nov <span class="org-builtin">:pin</span> <span class="org-string">"b3c7cc28e95fe25ce7b443e5f49e2e45360944a3"</span>)
</pre>
</div>
    </details>

<p>
Together these should give me a rather good experience reading ebooks.
</p>
</div>
</div>

<div id="outline-container-screenshots" class="outline-5">
<h5 id="screenshots"><span class="section-number-5">3.2.3.9</span> Screenshots<a aria-hidden="true" href="#screenshots">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-9">
<p>
This makes it a breeze to take lovely screenshots.
</p>
<details id='screenshots,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#screenshots,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> screenshot <span class="org-builtin">:recipe</span> (<span class="org-builtin">:local-repo</span> <span class="org-string">"lisp/screenshot"</span>))
</pre>
</div>
    </details>


<figure id="org04091a5">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/screenshot.png" alt="Example screenshot.el screenshot" class="invertible">

</figure>

<p>
Some light configuring is all we need, so we can make use of the <a href="https://github.com/Calinou/0x0">0x0</a> wrapper
file uploading script (which I&rsquo;ve renamed to <code>upload</code>).
</p>
<details id='screenshots,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#screenshots,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> screenshot
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:config</span> (<span class="org-keyword">setq</span> screenshot-upload-fn <span class="org-string">"upload %s 2&gt;/dev/null"</span>))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-prettier-page-break" class="outline-5">
<h5 id="prettier-page-break"><span class="section-number-5">3.2.3.10</span> Prettier page break lines<a aria-hidden="true" href="#prettier-page-break">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-10">
<p>
In some files, <kbd>^L</kbd> appears as a page break character. This isn&rsquo;t that visually
appealing, and Steve Purcell has been nice enough to make a package to display
these as horizontal rules.
</p>
<details id='prettier-page-break,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#prettier-page-break,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> page-break-lines <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"purcell/page-break-lines"</span>))
</pre>
</div>
    </details>

<details id='prettier-page-break,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#prettier-page-break,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> page-break-lines
  <span class="org-builtin">:commands</span> page-break-lines-mode
  <span class="org-builtin">:init</span>
  (autoload 'turn-on-page-break-lines-mode <span class="org-string">"page-break-lines"</span>)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> page-break-lines-max-width fill-column)
  (<span class="org-keyword">map!</span> <span class="org-builtin">:prefix</span> <span class="org-string">"g"</span>
        <span class="org-builtin">:desc</span> <span class="org-string">"Prev page break"</span> <span class="org-builtin">:nv</span> <span class="org-string">"["</span> #'backward-page
        <span class="org-builtin">:desc</span> <span class="org-string">"Next page break"</span> <span class="org-builtin">:nv</span> <span class="org-string">"]"</span> #'forward-page))
</pre>
</div>
    </details>
</div>
</div>
</div>
</div>
<div id="outline-container-language-packages" class="outline-3">
<h3 id="language-packages"><span class="section-number-3">3.3</span> Language packages<a aria-hidden="true" href="#language-packages">#</a> </h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-latex" class="outline-4">
<h4 id="latex"><span class="section-number-4">3.3.1</span> LaTeX<a aria-hidden="true" href="#latex">#</a> </h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
For mathematical convenience, <span class='acr'>WIP</span>
</p>
<details id='latex,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#latex,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> aas <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"ymarco/auto-activating-snippets"</span>)
  <span class="org-builtin">:pin</span> <span class="org-string">"3076cefea0f6ae9d7757f13c27b5602e007b58ec"</span>)
(<span class="org-keyword">package!</span> laas <span class="org-builtin">:recipe</span> (<span class="org-builtin">:local-repo</span> <span class="org-string">"lisp/LaTeX-auto-activating-snippets"</span>))
</pre>
</div>
    </details>
<p>
And some basic config
</p>
<details id='latex,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#latex,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> aas
  <span class="org-builtin">:commands</span> aas-mode)

(<span class="org-keyword">use-package!</span> laas
  <span class="org-builtin">:hook</span> (LaTeX-mode . laas-mode)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">laas-tex-fold-maybe</span> ()
    (<span class="org-keyword">unless</span> (equal <span class="org-string">"/"</span> aas-transient-snippet-key)
      (+latex-fold-last-macro-a)))
  (add-hook 'aas-post-snippet-expand-hook #'laas-tex-fold-maybe))
</pre>
</div>
    </details>

<p>
I think the latest AucTeX may be a bit dodgy, so
</p>
<details id='latex,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#latex,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> auctex <span class="org-builtin">:pin</span> <span class="org-string">"6440ec5964dcbe58155e28f00f84ec0118d8fb7b"</span>)
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-org-mode" class="outline-4">
<h4 id="org-mode"><span class="section-number-4">3.3.2</span> Org Mode<a aria-hidden="true" href="#org-mode">#</a> </h4>
<div class="outline-text-4" id="text-3-3-2">
<p>
There are actually three possible package statements I may want to use for Org.
</p>

<p>
If I&rsquo;m on a machine where I can push changes, I want to be able to develop Org.
I can check this by checking the content of the <span class='acr'>SSH</span> key <kbd>~/.ssh/id_ed25519.pub</kbd>.
</p>
<ol class="org-ol">
<li>If this key exists and there isn&rsquo;t a repo at
<kbd>$straight-base-dir/straight/repos/org-mode</kbd> with the right remote, we should
install it as such.</li>
<li>If the key exists and repo are both set up, the package should just be ignored.</li>
<li>If the key does not exist, the Org&rsquo;s <code>HEAD</code> should just be used</li>
</ol>

<p>
To account for this situation properly, we need a short script to determine the
correct package statement needed.
</p>

<details id='org-pkg-statement' class='code' open><summary class='named'><span class="name">org-pkg-statement</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-pkg-statement'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(load (expand-file-name <span class="org-string">"core/core.el"</span> user-emacs-directory) nil t) <span class="org-comment-delimiter">; </span><span class="org-comment">for `</span><span class="org-comment"><span class="org-constant">doom-local-dir</span></span><span class="org-comment">'</span>
(<span class="org-keyword">let</span> ((dev-key (<span class="org-keyword">and</span> (file-exists-p <span class="org-string">"~/.ssh/id_ed25519.pub"</span>)
                    (= <span class="org-highlight-numbers-number">0</span> (shell-command <span class="org-string">"cat ~/.ssh/id_ed25519.pub | grep -q AAAAC3NzaC1lZDI1NTE5AAAAIOZZqcJOLdN+QFHKyW8ST2zz750+8TdvO9IT5geXpQVt"</span>))))
      (dev-pkg (<span class="org-keyword">let</span> ((default-directory (expand-file-name <span class="org-string">"straight/repos/org-mode"</span> doom-local-dir)))
                 (<span class="org-keyword">and</span> (file-exists-p default-directory)
                      (string= <span class="org-string">"git@code.orgmode.org:bzg/org-mode.git\n"</span> (shell-command-to-string <span class="org-string">"git remote get-url origin"</span>)))))
      (recipe-common '(<span class="org-builtin">:files</span> (<span class="org-string">"*.el"</span> <span class="org-string">"lisp/*.el"</span>)
                       <span class="org-builtin">:pre-build</span>
                       (<span class="org-keyword">with-temp-file</span> (doom-path (straight--repos-dir <span class="org-string">"org-mode"</span>) <span class="org-string">"org-version.el"</span>)
                         (insert <span class="org-string">"(fset 'org-release (lambda () \"9.5\"))\n"</span>
                                 (format <span class="org-string">"(fset 'org-git-version (lambda () \"%s\"))\n"</span>
                                         (substring (shell-command-to-string <span class="org-string">"git rev-parse --short HEAD"</span>) <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-numbers-number">-1</span>))
                                 <span class="org-string">"(provide 'org-version)\n"</span>))
                       <span class="org-builtin">:includes</span> org)))
  (prin1-to-string
   `(<span class="org-keyword">package!</span> org-mode
      <span class="org-builtin">:recipe</span> (,@(<span class="org-keyword">cond</span> ((<span class="org-keyword">and</span> dev-key dev-pkg)
                        (list <span class="org-builtin">:host</span> nil <span class="org-builtin">:repo</span> nil <span class="org-builtin">:local-repo</span> (expand-file-name <span class="org-string">"straight/repos/org-mode"</span> doom-local-dir)))
                       (dev-key
                        (list <span class="org-builtin">:host</span> nil <span class="org-builtin">:repo</span> <span class="org-string">"git@code.orgmode.org:bzg/org-mode.git"</span>))
                       (t
                        (list <span class="org-builtin">:host</span> 'github <span class="org-builtin">:repo</span> <span class="org-string">"emacs-straight/org-mode"</span>)))
               ,@recipe-common)
      <span class="org-builtin">:pin</span> nil)))
</pre>
</div>
    </details>

<details id='org-mode,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">&lt;&lt;org-pkg-statement()&gt;&gt;
(<span class="org-keyword">unpin!</span> org-mode) <span class="org-comment-delimiter">; </span><span class="org-comment">there be bugs</span>
(<span class="org-keyword">package!</span> org-contrib
  <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> nil <span class="org-builtin">:repo</span> <span class="org-string">"https://git.sr.ht/~bzg/org-contrib"</span>
           <span class="org-builtin">:files</span> (<span class="org-string">"lisp/*.el"</span>))
  <span class="org-builtin">:pin</span> <span class="org-string">"b18928c973d1de7d05df73f454c7952317919a1c"</span>)
</pre>
</div>
    </details>
</div>

<div id="outline-container-improve-agenda-capture" class="outline-5">
<h5 id="improve-agenda-capture"><span class="section-number-5">3.3.2.1</span> Improve agenda/capture<a aria-hidden="true" href="#improve-agenda-capture">#</a> </h5>
<div class="outline-text-5" id="text-3-3-2-1">
<p>
The agenda is nice, but a souped up version is nicer.
</p>
<details id='improve-agenda-capture,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#improve-agenda-capture,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-super-agenda <span class="org-builtin">:pin</span> <span class="org-string">"f5e80e4d0da6b2eeda9ba21e021838fa6a495376"</span>)
</pre>
</div>
    </details>

<p>
Similarly <code>doct</code> (Declarative Org Capture Templates) seems to be a nicer way to
set up org-capture.
</p>
<details id='improve-agenda-capture,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#improve-agenda-capture,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> doct
  <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"progfolio/doct"</span>)
  <span class="org-builtin">:pin</span> <span class="org-string">"67fc46c8a68989b932bce879fbaa62c6a2456a1f"</span>)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-visuals" class="outline-5">
<h5 id="visuals"><span class="section-number-5">3.3.2.2</span> Visuals<a aria-hidden="true" href="#visuals">#</a> </h5>
<div class="outline-text-5" id="text-3-3-2-2">
<p>
Org tables aren&rsquo;t the prettiest thing to look at. This package is supposed to
redraw them in the buffer with box-drawing characters. Sounds like an
improvement to me! We&rsquo;ll make use of this with <kbd>writeroom-mode</kbd>.
</p>
<details id='visuals,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-pretty-table
  <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"Fuco1/org-pretty-table"</span>) <span class="org-builtin">:pin</span> <span class="org-string">"87772a9469d91770f87bfa788580fca69b9e697a"</span>)
</pre>
</div>
    </details>
<details id='visuals,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-pretty-table
  <span class="org-builtin">:commands</span> (org-pretty-table-mode global-org-pretty-table-mode))
</pre>
</div>
    </details>

<p>
For automatically toggling LaTeX fragment previews as the cursor moves in and
out of them there&rsquo;s this nice package
</p>
<details id='visuals,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-fragtog <span class="org-builtin">:pin</span> <span class="org-string">"0151cabc7aa9f244f82e682b87713b344d780c23"</span>)
</pre>
</div>
    </details>

<p>
Then for showing org formatting markers (<kbd>*/=~</kbd>)  when inside such a region, we
have <kbd>org-appear</kbd>.
</p>
<details id='visuals,code--4' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-appear <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"awth13/org-appear"</span>)
  <span class="org-builtin">:pin</span> <span class="org-string">"6ee49875f8bdefafbde849f5628d673e9740cf8c"</span>)
</pre>
</div>
    </details>

<p>
<code>org-superstar-mode</code> is great. While we&rsquo;re at it we may as well make tags prettier as well ðŸ™‚
</p>
<details id='visuals,code--5' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-pretty-tags <span class="org-builtin">:pin</span> <span class="org-string">"5c7521651b35ae9a7d3add4a66ae8cc176ae1c76"</span>)
</pre>
</div>
    </details>

<p>
Speaking of headlines, a nice package for viewing and managing the headline
structure has come to my attention.
</p>
<details id='visuals,code--6' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-ol-tree <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"Townk/org-ol-tree"</span>)
  <span class="org-builtin">:pin</span> <span class="org-string">"207c748aa5fea8626be619e8c55bdb1c16118c25"</span>)
</pre>
</div>
    </details>
<details id='visuals,code--7' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--7'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-ol-tree
  <span class="org-builtin">:commands</span> org-ol-tree)
(<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> org-mode-map
      <span class="org-builtin">:after</span> org
      <span class="org-builtin">:localleader</span>
      <span class="org-builtin">:desc</span> <span class="org-string">"Outline"</span> <span class="org-string">"O"</span> #'org-ol-tree)
</pre>
</div>
    </details>

<p>
There&rsquo;s this nice package that can provide nice syntax highlighting with LaTeX
exports.
</p>
<details id='visuals,code--8' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--8'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> engrave-faces <span class="org-builtin">:recipe</span> (<span class="org-builtin">:local-repo</span> <span class="org-string">"lisp/engrave-faces"</span>))
</pre>
</div>
    </details>
<details id='visuals,code--9' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--9'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> engrave-faces-latex
  <span class="org-builtin">:after</span> ox-latex)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-extra-functionality" class="outline-5">
<h5 id="extra-functionality"><span class="section-number-5">3.3.2.3</span> Extra functionality<a aria-hidden="true" href="#extra-functionality">#</a> </h5>
<div class="outline-text-5" id="text-3-3-2-3">
<p>
Because of the <i><a href="https://github.com/commonmark/commonmark-spec/wiki/markdown-flavors">lovely variety in markdown implementations</a></i> there isn&rsquo;t actually
such a thing a standard table spec &#x2026; or standard anything really. Because
<code>org-md</code> is a goody-two-shoes, it just uses <span class='acr'>HTML</span> for all these non-standardised
elements (a lot of them). So <code>ox-gfm</code> is handy for exporting markdown with all the
features that GitHub has.
</p>
<details id='extra-functionality,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> ox-gfm <span class="org-builtin">:pin</span> <span class="org-string">"99f93011b069e02b37c9660b8fcb45dab086a07f"</span>)
</pre>
</div>
    </details>
<details id='extra-functionality,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> ox-gfm
  <span class="org-builtin">:after</span> org)
</pre>
</div>
    </details>

<p>
Now and then citations need to happen
</p>
<details id='extra-functionality,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-ref <span class="org-builtin">:pin</span> <span class="org-string">"3ca9beb744621f007d932deb8a4197467012c23a"</span>)
</pre>
</div>
    </details>

<p>
<kbd>ob-julia</kbd> is currently a bit borked, but there&rsquo;s an effort to improve this.
</p>
<details id='extra-functionality,code--4' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> ob-julia <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"nico202/ob-julia"</span> <span class="org-builtin">:files</span> (<span class="org-string">"*.el"</span> <span class="org-string">"julia"</span>)))
</pre>
</div>
    </details>

<p>
There&rsquo;s a really cool package in development to <i>transclude</i> Org document content.
</p>
<details id='extra-functionality,code--5' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-transclusion <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"nobiot/org-transclusion"</span>)
  <span class="org-builtin">:pin</span> <span class="org-string">"daa18df6de26b74badab0372e8a64fbde6a7be71"</span>)
</pre>
</div>
    </details>
<details id='extra-functionality,code--6' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-transclusion
  <span class="org-builtin">:commands</span> org-transclusion-mode
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">map!</span> <span class="org-builtin">:after</span> org <span class="org-builtin">:map</span> org-mode-map
        <span class="org-string">"&lt;f12&gt;"</span> #'org-transclusion-mode))
</pre>
</div>
    </details>

<p>
Came across this and &#x2026; it&rsquo;s cool
</p>
<details id='extra-functionality,code--7' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--7'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-graph-view <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"alphapapa/org-graph-view"</span>) <span class="org-builtin">:pin</span> <span class="org-string">"13314338d70d2c19511efccc491bed3ca0758170"</span>)
</pre>
</div>
    </details>

<p>
I <b>need</b> this in my life. It take a <span class='acr'>URL</span> to a recipe from a common site, and
inserts an org-ified version at point. Isn&rsquo;t that just great.
</p>
<details id='extra-functionality,code--8' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--8'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-chef <span class="org-builtin">:pin</span> <span class="org-string">"5b461ed7d458cdcbff0af5013fbdbe88cbfb13a4"</span>)
</pre>
</div>
    </details>

<p>
Sometimes I&rsquo;m given non-org files, that&rsquo;s very sad. Luckily Pandoc offers a way
to make that right again, and this package makes that even easier to do.
</p>
<details id='extra-functionality,code--9' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--9'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-pandoc-import <span class="org-builtin">:recipe</span>
  (<span class="org-builtin">:local-repo</span> <span class="org-string">"lisp/org-pandoc-import"</span> <span class="org-builtin">:files</span> (<span class="org-string">"*.el"</span> <span class="org-string">"filters"</span> <span class="org-string">"preprocessors"</span>)))
</pre>
</div>
    </details>
<details id='extra-functionality,code--10' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--10'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-pandoc-import
  <span class="org-builtin">:after</span> org)
</pre>
</div>
    </details>

<p>
Org-roam is nice by itself, but there are so <i>extra</i> nice packages which integrate
with it.
</p>
<details id='extra-functionality,code--11' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--11'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-roam-server <span class="org-builtin">:pin</span> <span class="org-string">"2122a61e9e9be205355c7e2c1e4b65986d6985a5"</span>)
</pre>
</div>
    </details>
<details id='extra-functionality,code--12' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--12'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> org-roam-server
  <span class="org-builtin">:after</span> (org-roam server)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> org-roam-server-host <span class="org-string">"127.0.0.1"</span>
        org-roam-server-port <span class="org-highlight-numbers-number">8078</span>
        org-roam-server-export-inline-images t
        org-roam-server-authenticate nil
        org-roam-server-network-label-truncate t
        org-roam-server-network-label-truncate-length <span class="org-highlight-numbers-number">60</span>
        org-roam-server-network-label-wrap-length <span class="org-highlight-numbers-number">20</span>)
  (<span class="org-keyword">defun</span> <span class="org-function-name">org-roam-server-open</span> ()
    <span class="org-doc">"Ensure the server is active, then open the roam graph."</span>
    (<span class="org-keyword">interactive</span>)
    (org-roam-server-mode <span class="org-highlight-numbers-number">1</span>)
    (browse-url-xdg-open (format <span class="org-string">"http://localhost:%d"</span> org-roam-server-port))))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-systemd" class="outline-4">
<h4 id="systemd"><span class="section-number-4">3.3.3</span> Systemd<a aria-hidden="true" href="#systemd">#</a> </h4>
<div class="outline-text-4" id="text-3-3-3">
<p>
For editing systemd unit files
</p>
<details id='systemd,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#systemd,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> systemd <span class="org-builtin">:pin</span> <span class="org-string">"b6ae63a236605b1c5e1069f7d3afe06ae32a7bae"</span>)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-stan" class="outline-4">
<h4 id="stan"><span class="section-number-4">3.3.4</span> Stan<a aria-hidden="true" href="#stan">#</a> </h4>
<div class="outline-text-4" id="text-3-3-4">
<p>
Stan is probabilistic programming language written in <kbd>C++</kbd>. From my brief
exposure I think of it as a nicer <kbd>JAGS</kbd>. Though <kbd>Turing.jl</kbd> looks nicer yet&#x2026;
</p>

<p>
Anyway, the <a href="https://github.com/stan-dev/stan-mode">stan-dev/stan-mode</a> repository contains a number of packages for
working with Stan code. Let&rsquo;s grab them all.
</p>

<details id='stan,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#stan,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> stan-mode <span class="org-builtin">:pin</span> <span class="org-string">"9bb858b9f1314dcf1a5df23e39f9af522098276b"</span>)
(<span class="org-keyword">package!</span> company-stan <span class="org-builtin">:pin</span> <span class="org-string">"9bb858b9f1314dcf1a5df23e39f9af522098276b"</span>)
(<span class="org-keyword">package!</span> eldoc-stan <span class="org-builtin">:pin</span> <span class="org-string">"9bb858b9f1314dcf1a5df23e39f9af522098276b"</span>)
(<span class="org-keyword">package!</span> flycheck-stan <span class="org-builtin">:pin</span> <span class="org-string">"9bb858b9f1314dcf1a5df23e39f9af522098276b"</span>)
(<span class="org-keyword">package!</span> stan-snippets <span class="org-builtin">:pin</span> <span class="org-string">"9bb858b9f1314dcf1a5df23e39f9af522098276b"</span>)
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-graphviz" class="outline-4">
<h4 id="graphviz"><span class="section-number-4">3.3.5</span> Graphviz<a aria-hidden="true" href="#graphviz">#</a> </h4>
<div class="outline-text-4" id="text-3-3-5">
<p>
Graphviz is a nice method of visualising simple graphs, based on plaintext
<kbd>.dot</kbd> / <kbd>.gv</kbd> files.
</p>
<details id='graphviz,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#graphviz,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> graphviz-dot-mode <span class="org-builtin">:pin</span> <span class="org-string">"3642a0a5f41a80c8ecef7c6143d514200b80e194"</span>)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-authinfo" class="outline-4">
<h4 id="authinfo"><span class="section-number-4">3.3.6</span> Authinfo<a aria-hidden="true" href="#authinfo">#</a> </h4>
<div class="outline-text-4" id="text-3-3-6">
<p>
My patch giving my patch giving <kbd>authinfo-mode</kbd> syntax highlighting is only
available in Emacs28+. For older versions, I&rsquo;ve got a package I can use.
</p>
<details id='authinfo,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#authinfo,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> authinfo-color-mode
  <span class="org-builtin">:recipe</span> (<span class="org-builtin">:local-repo</span> <span class="org-string">"lisp/authinfo-color-mode"</span>))
</pre>
</div>
    </details>
<p>
Now we just need to load it appropriately.
</p>
<details id='authinfo,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#authinfo,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> authinfo-color-mode
  <span class="org-builtin">:mode</span> (<span class="org-string">"authinfo.gpg\\'"</span> . authinfo-color-mode)
  <span class="org-builtin">:init</span> (advice-add 'authinfo-mode <span class="org-builtin">:override</span> #'authinfo-color-mode))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-beancount-accounting" class="outline-4">
<h4 id="beancount-accounting"><span class="section-number-4">3.3.7</span> Beancount (accounting)<a aria-hidden="true" href="#beancount-accounting">#</a> </h4>
<div class="outline-text-4" id="text-3-3-7">
<details id='beancount-accounting,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#beancount-accounting,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> beancount <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"beancount/beancount-mode"</span>)
  <span class="org-builtin">:pin</span> <span class="org-string">"3c04745fa539c25dc007683ad257239067c24cfe"</span>)
</pre>
</div>
    </details>
</div>
</div>
</div>
</div>
<div id="outline-container-package-configuration" class="outline-2">
<h2 id="package-configuration"><span class="section-number-2">4</span> Package configuration<a aria-hidden="true" href="#package-configuration">#</a> </h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-abbrev-mode" class="outline-3">
<h3 id="abbrev-mode"><span class="section-number-3">4.1</span> Abbrev mode<a aria-hidden="true" href="#abbrev-mode">#</a> </h3>
<div class="outline-text-3" id="text-4-1">
<p>
Thanks to <a href="https://emacs.stackexchange.com/questions/45462/use-a-single-abbrev-table-for-multiple-modes/45476#45476">use a single abbrev-table for multiple modes? - Emacs Stack Exchange</a> I
have the following.
</p>
<details id='abbrev-mode,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#abbrev-mode,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> abbrev
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq-default</span> abbrev-mode t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">a hook funtion that sets the abbrev-table to org-mode-abbrev-table</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">whenever the major mode is a text mode</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">tec/set-text-mode-abbrev-table</span> ()
    (<span class="org-keyword">if</span> (derived-mode-p 'text-mode)
        (<span class="org-keyword">setq</span> local-abbrev-table org-mode-abbrev-table)))
  <span class="org-builtin">:commands</span> abbrev-mode
  <span class="org-builtin">:hook</span>
  (abbrev-mode . tec/set-text-mode-abbrev-table)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> abbrev-file-name (expand-file-name <span class="org-string">"abbrev.el"</span> doom-private-dir))
  (<span class="org-keyword">setq</span> save-abbrevs 'silently))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-all-icons" class="outline-3">
<h3 id="all-icons"><span class="section-number-3">4.2</span> All the icons<a aria-hidden="true" href="#all-icons">#</a> </h3>
<div class="outline-text-3" id="text-4-2">
<p>
<kbd>all-the-icons</kbd> does a generally great job giving file names icons. One minor
niggle I have is that when <i>I</i> open a <kbd>.m</kbd> file, it&rsquo;s much more likely to be Matlab
than Objective-C. As such, it&rsquo;ll be switching the icon associated with <kbd>.m</kbd>.
</p>
<details id='all-icons,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#all-icons,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> all-the-icons
  (setcdr (assoc <span class="org-string">"m"</span> all-the-icons-extension-icon-alist)
          (cdr (assoc <span class="org-string">"matlab"</span> all-the-icons-extension-icon-alist))))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-avy" class="outline-3">
<h3 id="avy"><span class="section-number-3">4.3</span> Avy<a aria-hidden="true" href="#avy">#</a> </h3>
<div class="outline-text-3" id="text-4-3">
<p>
What a wonderful way to jump to buffer positions, and it uses the <span class='acr'>QWERTY</span>
home-row for jumping. Very convenient &#x2026; except I&rsquo;m using Colemak.
</p>

<details id='avy,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#avy,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> avy
  <span class="org-comment-delimiter">;; </span><span class="org-comment">home row priorities: 8 6 4 5 - - 1 2 3 7</span>
  (<span class="org-keyword">setq</span> avy-keys '(?n ?e ?i ?s ?t ?r ?i ?a)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-calc" class="outline-3">
<h3 id="calc"><span class="section-number-3">4.4</span> Calc<a aria-hidden="true" href="#calc">#</a> </h3>
<div class="outline-text-3" id="text-4-4">
</div>
<div id="outline-container-defaults" class="outline-4">
<h4 id="defaults"><span class="section-number-4">4.4.1</span> Defaults<a aria-hidden="true" href="#defaults">#</a> </h4>
<div class="outline-text-4" id="text-4-4-1">
<p>
Any sane person prefers radians and exact values.
</p>

<details id='defaults,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#defaults,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> calc-angle-mode 'rad  <span class="org-comment-delimiter">; </span><span class="org-comment">radians are rad</span>
      calc-symbolic-mode t) <span class="org-comment-delimiter">; </span><span class="org-comment">keeps expressions like \sqrt{2} irrational for as long as possible</span>
</pre>
</div>
    </details>


<figure id="org47e93e0">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/calc-with-calctex.png" alt="Demonstration of calc, prettified by calctex." class="invertible">

</figure>
</div>
</div>

<div id="outline-container-calc-calctex" class="outline-4">
<h4 id="calc-calctex"><span class="section-number-4">4.4.2</span> CalcTeX<a aria-hidden="true" href="#calc-calctex">#</a> </h4>
<div class="outline-text-4" id="text-4-4-2">
<p>
We&rsquo;d like to use CalcTeX too, so let&rsquo;s set that up, and fix some glaring
inadequacies &#x2014; why on earth would you commit a hard-coded path to an executable
that <i>only works on your local machine</i>, consequently breaking the package for
everyone else!?
</p>

<details id='calctex,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#calctex,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> calctex
  <span class="org-builtin">:commands</span> calctex-mode
  <span class="org-builtin">:init</span>
  (add-hook 'calc-mode-hook #'calctex-mode)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> calctex-additional-latex-packages <span class="org-string">"</span>
<span class="org-string">\\usepackage[usenames]{xcolor}</span>
<span class="org-string">\\usepackage{soul}</span>
<span class="org-string">\\usepackage{adjustbox}</span>
<span class="org-string">\\usepackage{amsmath}</span>
<span class="org-string">\\usepackage{amssymb}</span>
<span class="org-string">\\usepackage{siunitx}</span>
<span class="org-string">\\usepackage{cancel}</span>
<span class="org-string">\\usepackage{mathtools}</span>
<span class="org-string">\\usepackage{mathalpha}</span>
<span class="org-string">\\usepackage{xparse}</span>
<span class="org-string">\\usepackage{arevmath}"</span>
        calctex-additional-latex-macros
        (concat calctex-additional-latex-macros
                <span class="org-string">"\n\\let\\evalto\\Rightarrow"</span>))
  (<span class="org-keyword">defadvice!</span> no-messaging-a (orig-fn <span class="org-type">&amp;rest</span> args)
    <span class="org-builtin">:around</span> #'calctex-default-dispatching-render-process
    (<span class="org-keyword">let</span> ((inhibit-message t) message-log-max)
      (apply orig-fn args)))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Fix hardcoded dvichop path (whyyyyyyy)</span>
  (<span class="org-keyword">let</span> ((vendor-folder (concat (file-truename doom-local-dir)
                               <span class="org-string">"straight/"</span>
                               (format <span class="org-string">"build-%s"</span> emacs-version)
                               <span class="org-string">"/calctex/vendor/"</span>)))
    (<span class="org-keyword">setq</span> calctex-dvichop-sty (concat vendor-folder <span class="org-string">"texd/dvichop"</span>)
          calctex-dvichop-bin (concat vendor-folder <span class="org-string">"texd/dvichop"</span>)))
  (<span class="org-keyword">unless</span> (file-exists-p calctex-dvichop-bin)
    (message <span class="org-string">"CalcTeX: Building dvichop binary"</span>)
    (<span class="org-keyword">let</span> ((default-directory (file-name-directory calctex-dvichop-bin)))
      (call-process <span class="org-string">"make"</span> nil nil nil))))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-embedded-calc" class="outline-4">
<h4 id="embedded-calc"><span class="section-number-4">4.4.3</span> Embedded calc<a aria-hidden="true" href="#embedded-calc">#</a> </h4>
<div class="outline-text-4" id="text-4-4-3">
<p>
Embedded calc is a lovely feature which let&rsquo;s us use calc to operate on LaTeX
maths expressions. The standard keybinding is a bit janky however (<kbd>C-x * e</kbd>), so
we&rsquo;ll add a localleader-based alternative.
</p>

<details id='embedded-calc,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#embedded-calc,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> calc-mode-map
      <span class="org-builtin">:after</span> calc
      <span class="org-builtin">:localleader</span>
      <span class="org-builtin">:desc</span> <span class="org-string">"Embedded calc (toggle)"</span> <span class="org-string">"e"</span> #'calc-embedded)
(<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> org-mode-map
      <span class="org-builtin">:after</span> org
      <span class="org-builtin">:localleader</span>
      <span class="org-builtin">:desc</span> <span class="org-string">"Embedded calc (toggle)"</span> <span class="org-string">"E"</span> #'calc-embedded)
(<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> latex-mode-map
      <span class="org-builtin">:after</span> latex
      <span class="org-builtin">:localleader</span>
      <span class="org-builtin">:desc</span> <span class="org-string">"Embedded calc (toggle)"</span> <span class="org-string">"e"</span> #'calc-embedded)
</pre>
</div>
    </details>

<p>
Unfortunately this operates without the (rather informative) calculator and
trail buffers, but we can advice it that we would rather like those in a side
panel.
</p>

<details id='embedded-calc,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#embedded-calc,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">calc-embedded-trail-window</span> nil)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">calc-embedded-calculator-window</span> nil)

(<span class="org-keyword">defadvice!</span> calc-embedded-with-side-pannel (<span class="org-type">&amp;rest</span> _)
  <span class="org-builtin">:after</span> #'calc-do-embedded
  (<span class="org-keyword">when</span> calc-embedded-trail-window
    (<span class="org-keyword">ignore-errors</span>
      (delete-window calc-embedded-trail-window))
    (<span class="org-keyword">setq</span> calc-embedded-trail-window nil))
  (<span class="org-keyword">when</span> calc-embedded-calculator-window
    (<span class="org-keyword">ignore-errors</span>
      (delete-window calc-embedded-calculator-window))
    (<span class="org-keyword">setq</span> calc-embedded-calculator-window nil))
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> calc-embedded-info
             (&gt; (* (window-width) (window-height)) <span class="org-highlight-numbers-number">1200</span>))
    (<span class="org-keyword">let</span> ((main-window (selected-window))
          (vertical-p (&gt; (window-width) <span class="org-highlight-numbers-number">80</span>)))
      (select-window
       (<span class="org-keyword">setq</span> calc-embedded-trail-window
             (<span class="org-keyword">if</span> vertical-p
                 (split-window-horizontally (- (max <span class="org-highlight-numbers-number">30</span> (/ (window-width) <span class="org-highlight-numbers-number">3</span>))))
               (split-window-vertically (- (max <span class="org-highlight-numbers-number">8</span> (/ (window-height) <span class="org-highlight-numbers-number">4</span>)))))))
      (switch-to-buffer <span class="org-string">"*Calc Trail*"</span>)
      (select-window
       (<span class="org-keyword">setq</span> calc-embedded-calculator-window
             (<span class="org-keyword">if</span> vertical-p
                 (split-window-vertically <span class="org-highlight-numbers-number">-6</span>)
               (split-window-horizontally (- (/ (window-width) <span class="org-highlight-numbers-number">2</span>))))))
      (switch-to-buffer <span class="org-string">"*Calculator*"</span>)
      (select-window main-window))))
</pre>
</div>
    </details>
</div>
</div>
</div>

<div id="outline-container-centaur-tabs" class="outline-3">
<h3 id="centaur-tabs"><span class="section-number-3">4.5</span> Centaur Tabs<a aria-hidden="true" href="#centaur-tabs">#</a> </h3>
<div class="outline-text-3" id="text-4-5">
<p>
We want to make the tabs a nice, comfy size (<code>36</code>), with icons. The modifier
marker is nice, but the particular default Unicode one causes a lag spike, so
let&rsquo;s just switch to an <code>o</code>, which still looks decent but doesn&rsquo;t cause any
issues.
A &rsquo;active-bar&rsquo; is nice, so let&rsquo;s have one of those. If we have it <code>under</code> needs us to
turn on <code>x-underline-at-decent</code> though. For some reason this didn&rsquo;t seem to work
inside the <code class="src src-elisp">(<span class="org-keyword">after!</span> ... )</code> block Â¯\_(ãƒ„)_/Â¯.
Then let&rsquo;s change the font to a sans serif, but the default one doesn&rsquo;t fit too
well somehow, so let&rsquo;s switch to &rsquo;P22 Underground Book&rsquo;; it looks much nicer.
</p>
<details id='centaur-tabs,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#centaur-tabs,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> centaur-tabs
  (centaur-tabs-mode <span class="org-highlight-numbers-number">-1</span>)
  (<span class="org-keyword">setq</span> centaur-tabs-height <span class="org-highlight-numbers-number">36</span>
        centaur-tabs-set-icons t
        centaur-tabs-modified-marker <span class="org-string">"o"</span>
        centaur-tabs-close-button <span class="org-string">"&#215;"</span>
        centaur-tabs-set-bar 'above
        centaur-tabs-gray-out-icons 'buffer)
  (centaur-tabs-change-fonts <span class="org-string">"P22 Underground Book"</span> <span class="org-highlight-numbers-number">160</span>))
<span class="org-comment-delimiter">;; </span><span class="org-comment">(setq x-underline-at-descent-line t)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-company" class="outline-3">
<h3 id="company"><span class="section-number-3">4.6</span> Company<a aria-hidden="true" href="#company">#</a> </h3>
<div class="outline-text-3" id="text-4-6">
<p>
It&rsquo;s nice to have completions almost all the time, in my opinion. Key strokes
are just waiting to be saved!
</p>
<details id='company,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#company,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> company
  (<span class="org-keyword">setq</span> company-idle-delay <span class="org-highlight-numbers-number">0.5</span>
        company-minimum-prefix-length <span class="org-highlight-numbers-number">2</span>)
  (<span class="org-keyword">setq</span> company-show-numbers t)
  (add-hook 'evil-normal-state-entry-hook #'company-abort)) <span class="org-comment-delimiter">;; </span><span class="org-comment">make aborting less annoying.</span>
</pre>
</div>
    </details>
<p>
Now, the improvements from <code>precedent</code> are mostly from remembering history, so
let&rsquo;s improve that memory.
</p>
<details id='company,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#company,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> history-length <span class="org-highlight-numbers-number">1000</span>)
(<span class="org-keyword">setq-default</span> prescient-history-length <span class="org-highlight-numbers-number">1000</span>)
</pre>
</div>
    </details>
</div>
<div id="outline-container-plain-text" class="outline-4">
<h4 id="plain-text"><span class="section-number-4">4.6.1</span> Plain Text<a aria-hidden="true" href="#plain-text">#</a> </h4>
<div class="outline-text-4" id="text-4-6-1">
<p>
<code>Ispell</code> is nice, let&rsquo;s have it in <code>text</code>, <code>markdown</code>, and <code>GFM</code>.
</p>
<details id='plain-text,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#plain-text,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(set-company-backend!
  '(text-mode
    markdown-mode
    gfm-mode)
  '(<span class="org-builtin">:seperate</span>
    company-ispell
    company-files
    company-yasnippet))
</pre>
</div>
    </details>
<p>
We then configure the dictionary we&rsquo;re using in <a href="#ispell">Ispell</a>.
</p>
</div>
</div>
<div id="outline-container-company-ess" class="outline-4">
<h4 id="company-ess"><span class="section-number-4">4.6.2</span> <span class='acr'><span class='acr'>ESS</span></span><a aria-hidden="true" href="#company-ess">#</a> </h4>
<div class="outline-text-4" id="text-4-6-2">
<p>
<code>company-dabbrev-code</code> is nice. Let&rsquo;s have it.
</p>
<details id='ess,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ess,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(set-company-backend! 'ess-r-mode '(company-R-args company-R-objects company-dabbrev-code <span class="org-builtin">:separate</span>))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-doom-modeline" class="outline-3">
<h3 id="doom-modeline"><span class="section-number-3">4.7</span> Doom modeline<a aria-hidden="true" href="#doom-modeline">#</a> </h3>
<div class="outline-text-3" id="text-4-7">
<p>
Very nice and pretty, however I think the <span class='acr'>PDF</span> modeline could do with tweaking.
I raised <a href="https://github.com/seagle0128/doom-modeline/pull/425">an issue</a> on this, however the response was basically &ldquo;put your
preferences in your personal config, the current default is sensible&rdquo; &#x2014; so
here we are.
</p>

<p>
First up I&rsquo;m going to want a segment for just the buffer file name, and a <span class='acr'>PDF</span>
icon. Then we&rsquo;ll redefine two functions used to generate the modeline.
</p>

<details id='doom-modeline,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-modeline,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> doom-modeline
  (doom-modeline-def-segment buffer-name
    <span class="org-string">"Display the current buffer's name, without any other information."</span>
    (concat
     (doom-modeline-spc)
     (doom-modeline--buffer-name)))

  (doom-modeline-def-segment pdf-icon
    <span class="org-string">"PDF icon from all-the-icons."</span>
    (concat
     (doom-modeline-spc)
     (doom-modeline-icon 'octicon <span class="org-string">"file-pdf"</span> nil nil
                         <span class="org-builtin">:face</span> (<span class="org-keyword">if</span> (doom-modeline--active)
                                   'all-the-icons-red
                                 'mode-line-inactive)
                         <span class="org-builtin">:v-adjust</span> <span class="org-highlight-numbers-number">0.02</span>)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">doom-modeline-update-pdf-pages</span> ()
    <span class="org-doc">"Update PDF pages."</span>
    (<span class="org-keyword">setq</span> doom-modeline--pdf-pages
          (<span class="org-keyword">let</span> ((current-page-str (number-to-string (eval `(pdf-view-current-page))))
                (total-page-str (number-to-string (pdf-cache-number-of-pages))))
            (concat
             (propertize
              (concat (make-string (- (length total-page-str) (length current-page-str)) ? )
                      <span class="org-string">" P"</span> current-page-str)
              'face 'mode-line)
             (propertize (concat <span class="org-string">"/"</span> total-page-str) 'face 'doom-modeline-buffer-minor-mode)))))

  (doom-modeline-def-segment pdf-pages
    <span class="org-string">"Display PDF pages."</span>
    (<span class="org-keyword">if</span> (doom-modeline--active) doom-modeline--pdf-pages
      (propertize doom-modeline--pdf-pages 'face 'mode-line-inactive)))

  (doom-modeline-def-modeline 'pdf
    '(bar window-number pdf-pages pdf-icon buffer-name)
    '(misc-info matches major-mode process vcs)))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-elcord" class="outline-3">
<h3 id="elcord"><span class="section-number-3">4.8</span> Elcord<a aria-hidden="true" href="#elcord">#</a> </h3>
<div class="outline-text-3" id="text-4-8">
<details id='elcord,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#elcord,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> elcord-use-major-mode-as-main-icon t)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-package-configuration-emacs" class="outline-3">
<h3 id="package-configuration-emacs"><span class="section-number-3">4.9</span> Emacs Everywhere<a aria-hidden="true" href="#package-configuration-emacs">#</a> </h3>
<div class="outline-text-3" id="text-4-9">
<details id='emacs-everywhere,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#emacs-everywhere,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> emacs-everywhere
  <span class="org-builtin">:if</span> (daemonp)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">spell-fu</span>)
  (<span class="org-keyword">setq</span> emacs-everywhere-major-mode-function #'org-mode
        emacs-everywhere-frame-name-format <span class="org-string">"Edit &#8759; %s &#8212; %s"</span>)
  (<span class="org-keyword">defadvice!</span> emacs-everywhere-raise-frame ()
    <span class="org-builtin">:after</span> #'emacs-everywhere-set-frame-name
    (<span class="org-keyword">setq</span> emacs-everywhere-frame-name (format emacs-everywhere-frame-name-format
                                (emacs-everywhere-app-class emacs-everywhere-current-app)
                                (truncate-string-to-width
                                 (emacs-everywhere-app-title emacs-everywhere-current-app)
                                 <span class="org-highlight-numbers-number">45</span> nil nil <span class="org-string">"&#8230;"</span>)))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">need to wait till frame refresh happen before really set</span>
    (run-with-timer <span class="org-highlight-numbers-number">0.1</span> nil #'emacs-everywhere-raise-frame-1))
  (<span class="org-keyword">defun</span> <span class="org-function-name">emacs-everywhere-raise-frame-1</span> ()
    (call-process <span class="org-string">"wmctrl"</span> nil nil nil <span class="org-string">"-a"</span> emacs-everywhere-frame-name)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-emojify" class="outline-3">
<h3 id="emojify"><span class="section-number-3">4.10</span> Emojify<a aria-hidden="true" href="#emojify">#</a> </h3>
<div class="outline-text-3" id="text-4-10">
<p>
For starters, twitter&rsquo;s emojis look nicer than emoji-one.
Other than that, this is pretty great <span class='acr'>OOTB</span> ðŸ˜€.
</p>

<details id='emojify,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#emojify,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> emojify-emoji-set <span class="org-string">"twemoji-v2"</span>)
</pre>
</div>
    </details>

<p>
One minor annoyance is the use of emojis over the default character
when the default is actually preferred. This occurs with overlay symbols I use
in Org mode, such as checkbox state, and a few other miscellaneous cases.
</p>

<p>
We can accommodate our preferences by deleting those entries from the emoji hash
table
</p>

<details id='emojify,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#emojify,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">emojify-disabled-emojis</span>
  '(<span class="org-comment-delimiter">;; </span><span class="org-comment">Org</span>
    <span class="org-string">"&#9724;"</span> <span class="org-string">"&#9745;"</span> <span class="org-string">"&#9784;"</span> <span class="org-string">"&#9881;"</span> <span class="org-string">"&#9193;"</span> <span class="org-string">"&#9194;"</span> <span class="org-string">"&#11014;"</span> <span class="org-string">"&#11015;"</span> <span class="org-string">"&#10067;"</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Terminal powerline</span>
    <span class="org-string">"&#10004;"</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Box drawing</span>
    <span class="org-string">"&#9654;"</span> <span class="org-string">"&#9664;"</span>)
  <span class="org-doc">"Characters that should never be affected by `</span><span class="org-doc"><span class="org-constant">emojify-mode</span></span><span class="org-doc">'."</span>)

(<span class="org-keyword">defadvice!</span> emojify-delete-from-data ()
  <span class="org-doc">"Ensure `</span><span class="org-doc"><span class="org-constant">emojify-disabled-emojis</span></span><span class="org-doc">' don't appear in `</span><span class="org-doc"><span class="org-constant">emojify-emojis</span></span><span class="org-doc">'."</span>
  <span class="org-builtin">:after</span> #'emojify-set-emoji-data
  (<span class="org-keyword">dolist</span> (emoji emojify-disabled-emojis)
    (remhash emoji emojify-emojis)))
</pre>
</div>
    </details>

<p>
#+end_src
</p>

<p>
This new minor mode of ours will be nice for messages, so let&rsquo;s hook it in for
Email and <span class='acr'>IRC</span>.
</p>
<details id='emojify,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#emojify,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">add-hook!</span> '(mu4e-compose-mode org-msg-edit-mode circe-channel-mode) (emoticon-to-emoji <span class="org-highlight-numbers-number">1</span>))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-eros-eval" class="outline-3">
<h3 id="eros-eval"><span class="section-number-3">4.11</span> Eros-eval<a aria-hidden="true" href="#eros-eval">#</a> </h3>
<div class="outline-text-3" id="text-4-11">
<p>
This makes the result of evals with <kbd>gr</kbd> and <kbd>gR</kbd> just slightly prettier. Every bit
counts right?
</p>
<details id='eros-eval,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#eros-eval,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> eros-eval-result-prefix <span class="org-string">"&#10233; "</span>)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-evil" class="outline-3">
<h3 id="evil"><span class="section-number-3">4.12</span> <span class='acr'><span class='acr'>EVIL</span></span><a aria-hidden="true" href="#evil">#</a> </h3>
<div class="outline-text-3" id="text-4-12">
<p>
When I want to make a substitution, I want it to be global more often than not
&#x2014; so let&rsquo;s make that the default.
</p>

<p>
Now, <span class='acr'>EVIL</span> cares a fair bit about keeping compatibility with Vim&rsquo;s default
behaviour. I don&rsquo;t. There are some particular settings that I&rsquo;d rather be
something else, so let&rsquo;s change them.
</p>

<details id='evil,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#evil,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> evil
  (<span class="org-keyword">setq</span> evil-ex-substitute-global t     <span class="org-comment-delimiter">; </span><span class="org-comment">I like my s/../.. to by global by default</span>
        evil-move-cursor-back nil       <span class="org-comment-delimiter">; </span><span class="org-comment">Don't move the block cursor when toggling insert mode</span>
        evil-kill-on-visual-paste nil)) <span class="org-comment-delimiter">; </span><span class="org-comment">Don't put overwritten text in the kill ring</span>
</pre>
</div>
    </details>

<p>
I don&rsquo;t use <code>evil-escape-mode</code>, so I may as well turn it off, I&rsquo;ve heard it
contributes a typing delay. I&rsquo;m not sure it&rsquo;s much, but it is an extra
<code>pre-command-hook</code> that I don&rsquo;t benefit from, so&#x2026;
It seems that there&rsquo;s a dedicated package for this, so instead of just disabling
the mode on startup, let&rsquo;s prevent installation of the package.
</p>
<details id='evil,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#evil,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> evil-escape <span class="org-builtin">:disable</span> t)
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-package-configuration-info" class="outline-3">
<h3 id="package-configuration-info"><span class="section-number-3">4.13</span> Info colours<a aria-hidden="true" href="#package-configuration-info">#</a> </h3>
<div class="outline-text-3" id="text-4-13">
<details id='info-colours,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#info-colours,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> info-colors
  <span class="org-builtin">:commands</span> (info-colors-fontify-node))

(add-hook 'Info-selection-hook 'info-colors-fontify-node)
</pre>
</div>
    </details>


<figure id="org84a3254">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/info-coloured.png" alt="Example colourised info page" class="invertible">

</figure>
</div>
</div>
<div id="outline-container-ispell" class="outline-3">
<h3 id="ispell"><span class="section-number-3">4.14</span> Ispell<a aria-hidden="true" href="#ispell">#</a> </h3>
<div class="outline-text-3" id="text-4-14">
</div>
<div id="outline-container-downloading-dictionaries" class="outline-4">
<h4 id="downloading-dictionaries"><span class="section-number-4">4.14.1</span> Downloading dictionaries<a aria-hidden="true" href="#downloading-dictionaries">#</a> </h4>
<div class="outline-text-4" id="text-4-14-1">
<p>
Let&rsquo;s get a nice big dictionary from <a href="http://app.aspell.net/create"><span class='acr'>SCOWL</span> Custom List/Dictionary Creator</a> with
the following configuration
</p>
<dl class="org-dl">
<dt>size</dt><dd>80 (huge)</dd>
<dt>spellings</dt><dd>British(-ise) and Australian</dd>
<dt>spelling variants level</dt><dd>0</dd>
<dt>diacritics</dt><dd>keep</dd>
<dt>extra lists</dt><dd>hacker, roman numerals</dd>
</dl>
</div>

<div id="outline-container-hunspell" class="outline-5">
<h5 id="hunspell"><span class="section-number-5">4.14.1.1</span> Hunspell<a aria-hidden="true" href="#hunspell">#</a> </h5>
<div class="outline-text-5" id="text-4-14-1-1">
<details id='hunspell,code--1' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#hunspell,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-type">cd</span> /tmp
<span class="org-type">curl</span> -o <span class="org-string">"hunspell-en-custom.zip"</span> <span class="org-string">'http://app.aspell.net/create?max_size=80&amp;spelling=GBs&amp;spelling=AU&amp;max_variant=0&amp;diacritic=keep&amp;special=hacker&amp;special=roman-numerals&amp;encoding=utf-8&amp;format=inline&amp;download=hunspell'</span>
unzip <span class="org-string">"hunspell-en-custom.zip"</span>

<span class="org-type">sudo</span> <span class="org-type">chown</span> root:root en-custom.*
<span class="org-type">sudo</span> <span class="org-type">mv</span> en-custom.<span class="org-rainbow-delimiters-depth-1">{</span>aff,dic<span class="org-rainbow-delimiters-depth-1">}</span> /usr/share/myspell/
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-aspell" class="outline-5">
<h5 id="aspell"><span class="section-number-5">4.14.1.2</span> Aspell<a aria-hidden="true" href="#aspell">#</a> </h5>
<div class="outline-text-5" id="text-4-14-1-2">
<details id='aspell,code--1' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#aspell,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-type">cd</span> /tmp
<span class="org-type">curl</span> -o <span class="org-string">"aspell6-en-custom.tar.bz2"</span> <span class="org-string">'http://app.aspell.net/create?max_size=80&amp;spelling=GBs&amp;spelling=AU&amp;max_variant=0&amp;diacritic=keep&amp;special=hacker&amp;special=roman-numerals&amp;encoding=utf-8&amp;format=inline&amp;download=aspell'</span>
tar -xjf <span class="org-string">"aspell6-en-custom.tar.bz2"</span>

<span class="org-type">cd</span> aspell6-en-custom
./configure &amp;&amp; <span class="org-type">make</span> &amp;&amp; <span class="org-type">sudo</span> <span class="org-type">make</span> install
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-configuration" class="outline-4">
<h4 id="configuration"><span class="section-number-4">4.14.2</span> Configuration<a aria-hidden="true" href="#configuration">#</a> </h4>
<div class="outline-text-4" id="text-4-14-2">
<details id='configuration,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#configuration,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> ispell-dictionary <span class="org-string">"en-custom"</span>)
</pre>
</div>
    </details>
<p>
Oh, and by the way, if <code>company-ispell-dictionary</code> is <code>nil</code>, then
<code>ispell-complete-word-dict</code> is used instead, which once again when <code>nil</code> is
<code>ispell-alternate-dictionary</code>, which at the moment maps to a plaintext version of
the above.
</p>

<p>
It seems reasonable to want to keep an eye on my personal dict, let&rsquo;s have it
nearby (also means that if I change the &rsquo;main&rsquo; dictionary I keep my addition).
</p>
<details id='configuration,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#configuration,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> ispell-personal-dictionary (expand-file-name <span class="org-string">".ispell_personal"</span> doom-private-dir))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-ivy" class="outline-3">
<h3 id="ivy"><span class="section-number-3">4.15</span> Ivy<a aria-hidden="true" href="#ivy">#</a> </h3>
<div class="outline-text-3" id="text-4-15">
<p>
While in an ivy mini-buffer <kbd>C-o</kbd> shows a list of all possible actions one may take.
By default this is <code class="src src-elisp">#'ivy-read-action-by-key</code> however a better
interface to this is using Hydra.
</p>
<details id='ivy,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ivy,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> ivy-read-action-function #'ivy-hydra-read-action)
</pre>
</div>
    </details>

<p>
I currently have ~40k functions. This seems like sufficient motivation to
increase the maximum number of items ivy will sort to 40k + a bit, this way
<kbd>SPC h f</kbd> et al. will continue to function as expected.
</p>
<details id='ivy,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ivy,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> ivy-sort-max-size <span class="org-highlight-numbers-number">50000</span>)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-magit" class="outline-3">
<h3 id="magit"><span class="section-number-3">4.16</span> Magit<a aria-hidden="true" href="#magit">#</a> </h3>
<div class="outline-text-3" id="text-4-16">
<p>
Magit is pretty nice by default. The diffs don&rsquo;t get any
syntax-highlighting-love though which is a bit sad. Thankfully
<a href="https://github.com/dandavison/magit-delta">dandavison/magit-delta</a> exists, which we can put to use.
</p>
<details id='magit,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#magit,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(after! magit</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">(magit-delta-mode +1))</span>
</pre>
</div>
    </details>
<p>
Unfortunately this seems to mess things up, which is something I&rsquo;ll want to look
into later.
</p>
</div>
</div>
<div id="outline-container-mixed-pitch" class="outline-3">
<h3 id="mixed-pitch"><span class="section-number-3">4.17</span> Mixed pitch<a aria-hidden="true" href="#mixed-pitch">#</a> </h3>
<div class="outline-text-3" id="text-4-17">
<p>
We&rsquo;d like to use mixed pitch in certain modes. If we simply add a hook, when
directly opening a file with (a new) Emacs <kbd>mixed-pitch-mode</kbd> runs before <span class='acr'>UI</span>
initialisation, which is problematic. To resolve this, we create a hook that
runs after <span class='acr'>UI</span> initialisation and both
</p>
<ul class="org-ul">
<li>conditionally enables <kbd>mixed-pitch-mode</kbd></li>
<li>sets up the mixed pitch hooks</li>
</ul>

<details id='mixed-pitch,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#mixed-pitch,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">mixed-pitch-modes</span> '(org-mode LaTeX-mode markdown-mode gfm-mode Info-mode)
  <span class="org-doc">"Modes that `</span><span class="org-doc"><span class="org-constant">mixed-pitch-mode</span></span><span class="org-doc">' should be enabled in, but only after UI initialisation."</span>)
(<span class="org-keyword">defun</span> <span class="org-function-name">init-mixed-pitch-h</span> ()
  <span class="org-doc">"Hook `</span><span class="org-doc"><span class="org-constant">mixed-pitch-mode</span></span><span class="org-doc">' into each mode in `</span><span class="org-doc"><span class="org-constant">mixed-pitch-modes</span></span><span class="org-doc">'.</span>
<span class="org-doc">Also immediately enables `</span><span class="org-doc"><span class="org-constant">mixed-pitch-modes</span></span><span class="org-doc">' if currently in one of the modes."</span>
  (<span class="org-keyword">when</span> (memq major-mode mixed-pitch-modes)
    (mixed-pitch-mode <span class="org-highlight-numbers-number">1</span>))
  (<span class="org-keyword">dolist</span> (hook mixed-pitch-modes)
    (add-hook (intern (concat (symbol-name hook) <span class="org-string">"-hook"</span>)) #'mixed-pitch-mode)))
(add-hook 'doom-init-ui-hook #'init-mixed-pitch-h)
</pre>
</div>
    </details>

<p>
As mixed pitch uses the variable <kbd>mixed-pitch-face</kbd>, we can create a new function
to apply mixed pitch with a serif face instead of the default. This was created
for writeroom mode.
</p>

<details id='mixed-pitch,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#mixed-pitch,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload #'mixed-pitch-serif-mode <span class="org-string">"mixed-pitch"</span>
  <span class="org-doc">"Change the default face of the current buffer to a serifed variable pitch, while keeping some faces fixed pitch."</span> t)

(<span class="org-keyword">after!</span> mixed-pitch
  (<span class="org-keyword">defface</span> <span class="org-variable-name">variable-pitch-serif</span>
    '((t (<span class="org-builtin">:family</span> <span class="org-string">"serif"</span>)))
    <span class="org-doc">"A variable-pitch face with serifs."</span>
    <span class="org-builtin">:group</span> 'basic-faces)
  (<span class="org-keyword">setq</span> mixed-pitch-set-height t)
  (<span class="org-keyword">setq</span> variable-pitch-serif-font (font-spec <span class="org-builtin">:family</span> <span class="org-string">"Alegreya"</span> <span class="org-builtin">:size</span> <span class="org-highlight-numbers-number">27</span>))
  (set-face-attribute 'variable-pitch-serif nil <span class="org-builtin">:font</span> variable-pitch-serif-font)
  (<span class="org-keyword">defun</span> <span class="org-function-name">mixed-pitch-serif-mode</span> (<span class="org-type">&amp;optional</span> arg)
    <span class="org-doc">"Change the default face of the current buffer to a serifed variable pitch, while keeping some faces fixed pitch."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let</span> ((mixed-pitch-face 'variable-pitch-serif))
      (mixed-pitch-mode (<span class="org-keyword">or</span> arg 'toggle)))))
</pre>
</div>
    </details>

<p>
Now, as Harfbuzz is currently used in Emacs, we&rsquo;ll be missing out on the
following Alegreya ligatures:
</p>
<div class="org-center">
<p>
ff <i>ff</i> ffi <i>ffi</i> ffj <i>ffj</i> ffl <i>ffl</i>
fft <i>fft</i> fi <i>fi</i> fj <i>fj</i> ft <i>ft</i>
Th <i>Th</i>
</p>
</div>

<p>
Thankfully, it isn&rsquo;t to hard to add these to the <code>composition-function-table</code>.
</p>
<details id='mixed-pitch,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#mixed-pitch,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(set-char-table-range composition-function-table ?f '([<span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">ff?[fijlt]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> <span class="org-highlight-numbers-number">0</span> font-shape-gstring]))
(set-char-table-range composition-function-table ?T '([<span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">Th</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> <span class="org-highlight-numbers-number">0</span> font-shape-gstring]))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-org-chef" class="outline-3">
<h3 id="org-chef"><span class="section-number-3">4.18</span> Org Chef<a aria-hidden="true" href="#org-chef">#</a> </h3>
<div class="outline-text-3" id="text-4-18">
<p>
Loading after org seems a bit premature. Let&rsquo;s just load it when we try to use
it, either by command or in a capture template.
</p>
<details id='org-chef,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-chef,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-chef
  <span class="org-builtin">:commands</span> (org-chef-insert-recipe org-chef-get-recipe-from-url))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-projectile" class="outline-3">
<h3 id="projectile"><span class="section-number-3">4.19</span> Projectile<a aria-hidden="true" href="#projectile">#</a> </h3>
<div class="outline-text-3" id="text-4-19">
<p>
Looking at documentation via <kbd>SPC h f</kbd> and <kbd>SPC h v</kbd> and looking at the source can
add package src directories to projectile. This isn&rsquo;t desirable in my opinion.
</p>
<details id='projectile,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#projectile,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> projectile-ignored-projects '(<span class="org-string">"~/"</span> <span class="org-string">"/tmp"</span> <span class="org-string">"~/.emacs.d/.local/straight/repos/"</span>))
(<span class="org-keyword">defun</span> <span class="org-function-name">projectile-ignored-project-function</span> (filepath)
  <span class="org-doc">"Return t if FILEPATH is within any of `</span><span class="org-doc"><span class="org-constant">projectile-ignored-projects</span></span><span class="org-doc">'"</span>
  (<span class="org-keyword">or</span> (mapcar (<span class="org-keyword">lambda</span> (p) (s-starts-with-p p filepath)) projectile-ignored-projects)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-smart-parentheses" class="outline-3">
<h3 id="smart-parentheses"><span class="section-number-3">4.20</span> Smart Parentheses<a aria-hidden="true" href="#smart-parentheses">#</a> </h3>
<div class="outline-text-3" id="text-4-20">
<details id='smart-parentheses,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#smart-parentheses,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(sp-local-pair
 '(org-mode)
 <span class="org-string">"&lt;&lt;"</span> <span class="org-string">"&gt;&gt;"</span>
 <span class="org-builtin">:actions</span> '(insert))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-spray" class="outline-3">
<h3 id="spray"><span class="section-number-3">4.21</span> Spray<a aria-hidden="true" href="#spray">#</a> </h3>
<div class="outline-text-3" id="text-4-21">
<p>
It would be nice if Spray&rsquo;s default speed suited me better, and the keybindings
worked in evil mode. Let&rsquo;s do that and make the display slightly nicer while
we&rsquo;re at it.
</p>

<details id='spray,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#spray,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> spray
  <span class="org-builtin">:commands</span> spray-mode
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> spray-wpm <span class="org-highlight-numbers-number">600</span>
        spray-height <span class="org-highlight-numbers-number">800</span>)
  (<span class="org-keyword">defun</span> <span class="org-function-name">spray-mode-hide-cursor</span> ()
    <span class="org-doc">"Hide or unhide the cursor as is appropriate."</span>
    (<span class="org-keyword">if</span> spray-mode
        (<span class="org-keyword">setq-local</span> spray--last-evil-cursor-state evil-normal-state-cursor
                    evil-normal-state-cursor '(nil))
      (<span class="org-keyword">setq-local</span> evil-normal-state-cursor spray--last-evil-cursor-state)))
  (add-hook 'spray-mode-hook #'spray-mode-hide-cursor)
  (<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> spray-mode-map
        <span class="org-string">"&lt;return&gt;"</span> #'spray-start/stop
        <span class="org-string">"f"</span> #'spray-faster
        <span class="org-string">"s"</span> #'spray-slower
        <span class="org-string">"t"</span> #'spray-time
        <span class="org-string">"&lt;right&gt;"</span> #'spray-forward-word
        <span class="org-string">"h"</span> #'spray-forward-word
        <span class="org-string">"&lt;left&gt;"</span> #'spray-backward-word
        <span class="org-string">"l"</span> #'spray-backward-word
        <span class="org-string">"q"</span> #'spray-quit))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-theme-magic" class="outline-3">
<h3 id="theme-magic"><span class="section-number-3">4.22</span> Theme magic<a aria-hidden="true" href="#theme-magic">#</a> </h3>
<div class="outline-text-3" id="text-4-22">
<p>
Let&rsquo;s automatically update terminals on theme change (as long as <code>pywal</code> is available).
</p>

<p>
Unfortunately, as the theme is set on startup this causes the hook to be run
immediately. It would be nicer to <i>not</i> have this add to our precious startup
time (around 0.4s last time I checked).
We can achieve this by deferring it with a short idle timer that should add the
hook <i>just after</i> initialisation.
</p>

<details id='theme-magic,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#theme-magic,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(run-with-idle-timer <span class="org-highlight-numbers-number">0.1</span> nil (<span class="org-keyword">lambda</span> () (add-hook 'doom-load-theme-hook 'theme-magic-from-emacs)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-tramp" class="outline-3">
<h3 id="tramp"><span class="section-number-3">4.23</span> Tramp<a aria-hidden="true" href="#tramp">#</a> </h3>
<div class="outline-text-3" id="text-4-23">
<p>
Let&rsquo;s try to make tramp handle prompts better
</p>
<details id='tramp,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#tramp,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> tramp
  (setenv <span class="org-string">"SHELL"</span> <span class="org-string">"/bin/bash"</span>)
  (<span class="org-keyword">setq</span> tramp-shell-prompt-pattern <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">^</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string"></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">]#$%&gt;\n]*#?[]#$%&gt;&#57520;] *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">&#27;\\[[0-9;]*[a-zA-Z] *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">*"</span>)) <span class="org-comment-delimiter">;; </span><span class="org-comment">default + &#57520;</span>
</pre>
</div>
    </details>
</div>
<div id="outline-container-troubleshooting" class="outline-4">
<h4 id="troubleshooting"><span class="section-number-4">4.23.1</span> Troubleshooting<a aria-hidden="true" href="#troubleshooting">#</a> </h4>
<div class="outline-text-4" id="text-4-23-1">
<p>
In case the remote shell is misbehaving, here are some things to try
</p>
</div>
<div id="outline-container-zsh" class="outline-5">
<h5 id="zsh"><span class="section-number-5">4.23.1.1</span> Zsh<a aria-hidden="true" href="#zsh">#</a> </h5>
<div class="outline-text-5" id="text-4-23-1-1">
<p>
There are some escape code you don&rsquo;t want, let&rsquo;s make it behave more considerately.
</p>
<details id='zsh,code--1' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#zsh,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">[</span><span class="org-rainbow-delimiters-depth-2">[</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">TERM</span></span><span class="org-string">"</span> == <span class="org-string">"dumb"</span> <span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">]</span>; <span class="org-keyword">then</span>
    <span class="org-builtin">unset</span> zle_bracketed_paste
    <span class="org-builtin">unset</span> zle
    <span class="org-variable-name">PS1</span>=<span class="org-string">'$ '</span>
    <span class="org-keyword">return</span>
<span class="org-keyword">fi</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-guix" class="outline-4">
<h4 id="guix"><span class="section-number-4">4.23.2</span> Guix<a aria-hidden="true" href="#guix">#</a> </h4>
<div class="outline-text-4" id="text-4-23-2">
<p>
<a href="https://guix.gnu.org/">Guix</a> puts some binaries that <span class='acr'>TRAMP</span> looks for in unexpected locations.
That&rsquo;s no problem though, we just need to help <span class='acr'>TRAMP</span> find them.
</p>
<details id='guix,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#guix,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> tramp
  (<span class="org-keyword">appendq!</span> tramp-remote-path
            '(<span class="org-string">"~/.guix-profile/bin"</span> <span class="org-string">"~/.guix-profile/sbin"</span>
              <span class="org-string">"/run/current-system/profile/bin"</span>
              <span class="org-string">"/run/current-system/profile/sbin"</span>)))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-treemacs" class="outline-3">
<h3 id="treemacs"><span class="section-number-3">4.24</span> Treemacs<a aria-hidden="true" href="#treemacs">#</a> </h3>
<div class="outline-text-3" id="text-4-24">
<p>
Quite often there are superfluous files I&rsquo;m not that interested in. There&rsquo;s no
good reason for them to take up space. Let&rsquo;s add a mechanism to ignore them.
</p>
<details id='treemacs,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#treemacs,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> treemacs
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">treemacs-file-ignore-extensions</span> '()
    <span class="org-doc">"File extension which `</span><span class="org-doc"><span class="org-constant">treemacs-ignore-filter</span></span><span class="org-doc">' will ensure are ignored"</span>)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">treemacs-file-ignore-globs</span> '()
    <span class="org-doc">"Globs which will are transformed to `</span><span class="org-doc"><span class="org-constant">treemacs-file-ignore-regexps</span></span><span class="org-doc">' which `</span><span class="org-doc"><span class="org-constant">treemacs-ignore-filter</span></span><span class="org-doc">' will ensure are ignored"</span>)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">treemacs-file-ignore-regexps</span> '()
    <span class="org-doc">"RegExps to be tested to ignore files, generated from `</span><span class="org-doc"><span class="org-constant">treeemacs-file-ignore-globs</span></span><span class="org-doc">'"</span>)
  (<span class="org-keyword">defun</span> <span class="org-function-name">treemacs-file-ignore-generate-regexps</span> ()
    <span class="org-doc">"Generate `</span><span class="org-doc"><span class="org-constant">treemacs-file-ignore-regexps</span></span><span class="org-doc">' from `</span><span class="org-doc"><span class="org-constant">treemacs-file-ignore-globs</span></span><span class="org-doc">'"</span>
    (<span class="org-keyword">setq</span> treemacs-file-ignore-regexps (mapcar 'dired-glob-regexp treemacs-file-ignore-globs)))
  (<span class="org-keyword">if</span> (equal treemacs-file-ignore-globs '()) nil (treemacs-file-ignore-generate-regexps))
  (<span class="org-keyword">defun</span> <span class="org-function-name">treemacs-ignore-filter</span> (file full-path)
    <span class="org-doc">"Ignore files specified by `</span><span class="org-doc"><span class="org-constant">treemacs-file-ignore-extensions</span></span><span class="org-doc">', and `</span><span class="org-doc"><span class="org-constant">treemacs-file-ignore-regexps</span></span><span class="org-doc">'"</span>
    (<span class="org-keyword">or</span> (member (file-name-extension file) treemacs-file-ignore-extensions)
        (<span class="org-keyword">let</span> ((ignore-file nil))
          (<span class="org-keyword">dolist</span> (regexp treemacs-file-ignore-regexps ignore-file)
            (<span class="org-keyword">setq</span> ignore-file (<span class="org-keyword">or</span> ignore-file (<span class="org-keyword">if</span> (string-match-p regexp full-path) t nil)))))))
  (add-to-list 'treemacs-ignored-file-predicates #'treemacs-ignore-filter))
</pre>
</div>
    </details>

<p>
Now, we just identify the files in question.
</p>
<details id='treemacs,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#treemacs,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> treemacs-file-ignore-extensions
      '(<span class="org-comment-delimiter">;; </span><span class="org-comment">LaTeX</span>
        <span class="org-string">"aux"</span>
        <span class="org-string">"ptc"</span>
        <span class="org-string">"fdb_latexmk"</span>
        <span class="org-string">"fls"</span>
        <span class="org-string">"synctex.gz"</span>
        <span class="org-string">"toc"</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">LaTeX - glossary</span>
        <span class="org-string">"glg"</span>
        <span class="org-string">"glo"</span>
        <span class="org-string">"gls"</span>
        <span class="org-string">"glsdefs"</span>
        <span class="org-string">"ist"</span>
        <span class="org-string">"acn"</span>
        <span class="org-string">"acr"</span>
        <span class="org-string">"alg"</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">LaTeX - pgfplots</span>
        <span class="org-string">"mw"</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">LaTeX - pdfx</span>
        <span class="org-string">"pdfa.xmpi"</span>
        ))
(<span class="org-keyword">setq</span> treemacs-file-ignore-globs
      '(<span class="org-comment-delimiter">;; </span><span class="org-comment">LaTeX</span>
        <span class="org-string">"*/_minted-*"</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">AucTeX</span>
        <span class="org-string">"*/.auctex-auto"</span>
        <span class="org-string">"*/_region_.log"</span>
        <span class="org-string">"*/_region_.tex"</span>))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-which-key" class="outline-3">
<h3 id="which-key"><span class="section-number-3">4.25</span> Which-key<a aria-hidden="true" href="#which-key">#</a> </h3>
<div class="outline-text-3" id="text-4-25">
<p>
Let&rsquo;s make this popup a bit faster
</p>
<details id='which-key,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#which-key,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> which-key-idle-delay <span class="org-highlight-numbers-number">0.5</span>) <span class="org-comment-delimiter">;; </span><span class="org-comment">I need the help, I really do</span>
</pre>
</div>
    </details>
<p>
I also think that having <kbd>evil-</kbd> appear in so many popups is a bit too verbose,
let&rsquo;s change that, and do a few other similar tweaks while we&rsquo;re at it.
</p>
<details id='which-key,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#which-key,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> which-key-allow-multiple-replacements t)
(<span class="org-keyword">after!</span> which-key
  (<span class="org-keyword">pushnew!</span>
   which-key-replacement-alist
   '((<span class="org-string">""</span> . <span class="org-string">"\\`+?evil[-:]?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">a-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>) . (nil . <span class="org-string">"&#9666;\\1"</span>))
   '((<span class="org-string">"\\`g s"</span> . <span class="org-string">"\\`evilem--?motion-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>) . (nil . <span class="org-string">"&#9667;\\1"</span>))
   ))
</pre>
</div>
    </details>


<figure id="orgbcf368e">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/whichkey-evil.png" alt="Whichkey triggered on an evil motion" class="invertible">

</figure>
</div>
</div>
<div id="outline-container-writeroom" class="outline-3">
<h3 id="writeroom"><span class="section-number-3">4.26</span> Writeroom<a aria-hidden="true" href="#writeroom">#</a> </h3>
<div class="outline-text-3" id="text-4-26">
<p>
For starters, I think Doom is a bit over-zealous when zooming in
</p>
<details id='writeroom,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#writeroom,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> +zen-text-scale <span class="org-highlight-numbers-number">0.8</span>)
</pre>
</div>
    </details>

<p>
Then, when using Org it would be nice to make a number of other aesthetic
tweaks. Namely:
</p>
<ul class="org-ul">
<li>Use a serifed variable-pitch font</li>
<li>Hiding headline leading stars</li>
<li>Using fleurons as headline bullets</li>
<li>Hiding line numbers</li>
<li>Removing outline indentation</li>
<li>Centring the text</li>
<li>Turning on <code>org-pretty-table-mode</code></li>
</ul>

<details id='writeroom,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#writeroom,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">+zen-serif-p</span> t
  <span class="org-doc">"Whether to use a serifed font with `</span><span class="org-doc"><span class="org-constant">mixed-pitch-mode</span></span><span class="org-doc">'."</span>)
(<span class="org-keyword">after!</span> writeroom-mode
  (<span class="org-keyword">defvar-local</span> <span class="org-variable-name">+zen--original-org-indent-mode-p</span> nil)
  (<span class="org-keyword">defvar-local</span> <span class="org-variable-name">+zen--original-mixed-pitch-mode-p</span> nil)
  (<span class="org-keyword">defvar-local</span> <span class="org-variable-name">+zen--original-org-pretty-table-mode-p</span> nil)
  (<span class="org-keyword">defun</span> <span class="org-function-name">+zen-enable-mixed-pitch-mode-h</span> ()
    <span class="org-doc">"Enable `</span><span class="org-doc"><span class="org-constant">mixed-pitch-mode</span></span><span class="org-doc">' when in `</span><span class="org-doc"><span class="org-constant">+zen-mixed-pitch-modes</span></span><span class="org-doc">'."</span>
    (<span class="org-keyword">when</span> (apply #'derived-mode-p +zen-mixed-pitch-modes)
      (<span class="org-keyword">if</span> writeroom-mode
          (<span class="org-keyword">progn</span>
            (<span class="org-keyword">setq</span> +zen--original-mixed-pitch-mode-p mixed-pitch-mode)
            (funcall (<span class="org-keyword">if</span> +zen-serif-p #'mixed-pitch-serif-mode #'mixed-pitch-mode) <span class="org-highlight-numbers-number">1</span>))
        (funcall #'mixed-pitch-mode (<span class="org-keyword">if</span> +zen--original-mixed-pitch-mode-p <span class="org-highlight-numbers-number">1</span> <span class="org-highlight-numbers-number">-1</span>)))))
  (<span class="org-keyword">pushnew!</span> writeroom--local-variables
            'display-line-numbers
            'visual-fill-column-width
            'org-adapt-indentation
            'org-superstar-headline-bullets-list
            'org-superstar-remove-leading-stars)
  (add-hook 'writeroom-mode-enable-hook
            (<span class="org-keyword">defun</span> <span class="org-function-name">+zen-prose-org-h</span> ()
              <span class="org-doc">"Reformat the current Org buffer appearance for prose."</span>
              (<span class="org-keyword">when</span> (eq major-mode 'org-mode)
                (<span class="org-keyword">setq</span> display-line-numbers nil
                      visual-fill-column-width <span class="org-highlight-numbers-number">60</span>
                      org-adapt-indentation nil)
                (<span class="org-keyword">when</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">org-superstar</span>)
                  (<span class="org-keyword">setq-local</span> org-superstar-headline-bullets-list '(<span class="org-string">"&#128600;"</span> <span class="org-string">"&#128601;"</span> <span class="org-string">"&#128602;"</span> <span class="org-string">"&#128603;"</span>)
                              <span class="org-comment-delimiter">;; </span><span class="org-comment">org-superstar-headline-bullets-list '("&#128592;" "&#128593;" "&#128594;" "&#128595;" "&#128596;" "&#128597;" "&#128598;" "&#128599;")</span>
                              org-superstar-remove-leading-stars t)
                  (org-superstar-restart))
                (<span class="org-keyword">setq</span>
                 +zen--original-org-indent-mode-p org-indent-mode
                 +zen--original-org-pretty-table-mode-p (<span class="org-keyword">bound-and-true-p</span> org-pretty-table-mode))
                (org-indent-mode <span class="org-highlight-numbers-number">-1</span>)
                (org-pretty-table-mode <span class="org-highlight-numbers-number">1</span>))))
  (add-hook 'writeroom-mode-disable-hook
            (<span class="org-keyword">defun</span> <span class="org-function-name">+zen-nonprose-org-h</span> ()
              <span class="org-doc">"Reverse the effect of `</span><span class="org-doc"><span class="org-constant">+zen-prose-org</span></span><span class="org-doc">'."</span>
              (<span class="org-keyword">when</span> (eq major-mode 'org-mode)
                (<span class="org-keyword">when</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">org-superstar</span>)
                  (org-superstar-restart))
                (<span class="org-keyword">when</span> +zen--original-org-indent-mode-p (org-indent-mode <span class="org-highlight-numbers-number">1</span>))
                <span class="org-comment-delimiter">;; </span><span class="org-comment">(unless +zen--original-org-pretty-table-mode-p (org-pretty-table-mode -1))</span>
                ))))
</pre>
</div>
    </details>


<figure id="orga76ef52">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/writeroom-and-org.png" alt="Writeroom applied to an Org file" class="invertible">

</figure>
</div>
</div>
<div id="outline-container-xkcd" class="outline-3">
<h3 id="xkcd"><span class="section-number-3">4.27</span> xkcd<a aria-hidden="true" href="#xkcd">#</a> </h3>
<div class="outline-text-3" id="text-4-27">
<p>
We want to set this up so it loads nicely in <a href="#extra-links">Extra links</a>.
</p>
<details id='xkcd,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#xkcd,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> xkcd
  <span class="org-builtin">:commands</span> (xkcd-get-json
             xkcd-download xkcd-get
             <span class="org-comment-delimiter">;; </span><span class="org-comment">now for funcs from my extension of this pkg</span>
             +xkcd-find-and-copy +xkcd-find-and-view
             +xkcd-fetch-info +xkcd-select)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> xkcd-cache-dir (expand-file-name <span class="org-string">"xkcd/"</span> doom-cache-dir)
        xkcd-cache-latest (concat xkcd-cache-dir <span class="org-string">"latest"</span>))
  (<span class="org-keyword">unless</span> (file-exists-p xkcd-cache-dir)
    (make-directory xkcd-cache-dir))
  (<span class="org-keyword">after!</span> evil-snipe
    (add-to-list 'evil-snipe-disabled-modes 'xkcd-mode))
  <span class="org-builtin">:general</span> (<span class="org-builtin">:states</span> 'normal
            <span class="org-builtin">:keymaps</span> 'xkcd-mode-map
            <span class="org-string">"&lt;right&gt;"</span> #'xkcd-next
            <span class="org-string">"n"</span>       #'xkcd-next <span class="org-comment-delimiter">; </span><span class="org-comment">evil-ish</span>
            <span class="org-string">"&lt;left&gt;"</span>  #'xkcd-prev
            <span class="org-string">"N"</span>       #'xkcd-prev <span class="org-comment-delimiter">; </span><span class="org-comment">evil-ish</span>
            <span class="org-string">"r"</span>       #'xkcd-rand
            <span class="org-string">"a"</span>       #'xkcd-rand <span class="org-comment-delimiter">; </span><span class="org-comment">because image-rotate can interfere</span>
            <span class="org-string">"t"</span>       #'xkcd-alt-text
            <span class="org-string">"q"</span>       #'xkcd-kill-buffer
            <span class="org-string">"o"</span>       #'xkcd-open-browser
            <span class="org-string">"e"</span>       #'xkcd-open-explanation-browser
            <span class="org-comment-delimiter">;; </span><span class="org-comment">extras</span>
            <span class="org-string">"s"</span>       #'+xkcd-find-and-view
            <span class="org-string">"/"</span>       #'+xkcd-find-and-view
            <span class="org-string">"y"</span>       #'+xkcd-copy))
</pre>
</div>
    </details>

<p>
Let&rsquo;s also extend the functionality a whole bunch.
</p>
<details id='xkcd,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#xkcd,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> xkcd
  (<span class="org-keyword">require</span> '<span class="org-constant">emacsql-sqlite</span>)

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-select</span> ()
    <span class="org-doc">"Prompt the user for an xkcd using `</span><span class="org-doc"><span class="org-constant">ivy-read</span></span><span class="org-doc">' and `</span><span class="org-doc"><span class="org-constant">+xkcd-select-format</span></span><span class="org-doc">'. Return the xkcd number or nil"</span>
    (<span class="org-keyword">let*</span> (prompt-lines
           (-dummy (maphash (<span class="org-keyword">lambda</span> (key xkcd-info)
                              (<span class="org-keyword">push</span> (+xkcd-select-format xkcd-info) prompt-lines))
                            +xkcd-stored-info))
           (num (ivy-read (format <span class="org-string">"xkcd (%s): "</span> xkcd-latest) prompt-lines)))
      (<span class="org-keyword">if</span> (equal <span class="org-string">""</span> num) xkcd-latest
        (string-to-number (replace-regexp-in-string <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">.*"</span> <span class="org-string">"\\1"</span> num)))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-select-format</span> (xkcd-info)
    <span class="org-doc">"Creates each ivy-read line from an xkcd info plist. Must start with the xkcd number"</span>
    (format <span class="org-string">"%-4s  %-30s %s"</span>
            (propertize (number-to-string (plist-get xkcd-info <span class="org-builtin">:num</span>))
                        'face 'counsel-key-binding)
            (plist-get xkcd-info <span class="org-builtin">:title</span>)
            (propertize (plist-get xkcd-info <span class="org-builtin">:alt</span>)
                        'face '(variable-pitch font-lock-comment-face))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-fetch-info</span> (<span class="org-type">&amp;optional</span> num)
    <span class="org-doc">"Fetch the parsed json info for comic NUM. Fetches latest when omitted or 0"</span>
    (<span class="org-keyword">require</span> '<span class="org-constant">xkcd</span>)
    (<span class="org-keyword">when</span> (<span class="org-keyword">or</span> (not num) (= num <span class="org-highlight-numbers-number">0</span>))
      (+xkcd-check-latest)
      (<span class="org-keyword">setq</span> num xkcd-latest))
    (<span class="org-keyword">let</span> ((res (<span class="org-keyword">or</span> (gethash num +xkcd-stored-info)
                   (puthash num (+xkcd-db-read num) +xkcd-stored-info))))
      (<span class="org-keyword">unless</span> res
        (+xkcd-db-write
         (<span class="org-keyword">let*</span> ((url (format <span class="org-string">"https://xkcd.com/%d/info.0.json"</span> num))
                (json-assoc
                 (<span class="org-keyword">if</span> (gethash num +xkcd-stored-info)
                     (gethash num +xkcd-stored-info)
                   (json-read-from-string (xkcd-get-json url num)))))
           json-assoc))
        (<span class="org-keyword">setq</span> res (+xkcd-db-read num)))
      res))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">since we've done this, we may as well go one little step further</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-find-and-copy</span> ()
    <span class="org-doc">"Prompt for an xkcd using `</span><span class="org-doc"><span class="org-constant">+xkcd-select</span></span><span class="org-doc">' and copy url to clipboard"</span>
    (<span class="org-keyword">interactive</span>)
    (+xkcd-copy (+xkcd-select)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-copy</span> (<span class="org-type">&amp;optional</span> num)
    <span class="org-doc">"Copy a url to xkcd NUM to the clipboard"</span>
    (<span class="org-keyword">interactive</span> <span class="org-string">"i"</span>)
    (<span class="org-keyword">let</span> ((num (<span class="org-keyword">or</span> num xkcd-cur)))
      (gui-select-text (format <span class="org-string">"https://xkcd.com/%d"</span> num))
      (message <span class="org-string">"xkcd.com/%d copied to clipboard"</span> num)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-find-and-view</span> ()
    <span class="org-doc">"Prompt for an xkcd using `</span><span class="org-doc"><span class="org-constant">+xkcd-select</span></span><span class="org-doc">' and view it"</span>
    (<span class="org-keyword">interactive</span>)
    (xkcd-get (+xkcd-select))
    (switch-to-buffer <span class="org-string">"*xkcd*"</span>))

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">+xkcd-latest-max-age</span> (* <span class="org-highlight-numbers-number">60</span> <span class="org-highlight-numbers-number">60</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">1 hour</span>
    <span class="org-doc">"Time after which xkcd-latest should be refreshed, in seconds"</span>)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">initialise `</span><span class="org-comment"><span class="org-constant">xkcd-latest</span></span><span class="org-comment">' and `</span><span class="org-comment"><span class="org-constant">+xkcd-stored-info</span></span><span class="org-comment">' with latest xkcd</span>
  (<span class="org-keyword">add-transient-hook!</span> '+xkcd-select
    (<span class="org-keyword">require</span> '<span class="org-constant">xkcd</span>)
    (+xkcd-fetch-info xkcd-latest)
    (<span class="org-keyword">setq</span> +xkcd-stored-info (+xkcd-db-read-all)))

  (<span class="org-keyword">add-transient-hook!</span> '+xkcd-fetch-info
    (xkcd-update-latest))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-check-latest</span> ()
    <span class="org-doc">"Use value in `</span><span class="org-doc"><span class="org-constant">xkcd-cache-latest</span></span><span class="org-doc">' as long as it isn't older thabn `</span><span class="org-doc"><span class="org-constant">+xkcd-latest-max-age</span></span><span class="org-doc">'"</span>
    (<span class="org-keyword">unless</span> (<span class="org-keyword">and</span> (file-exists-p xkcd-cache-latest)
                 (&lt; (- (time-to-seconds (current-time))
                       (time-to-seconds (file-attribute-modification-time (file-attributes xkcd-cache-latest))))
                    +xkcd-latest-max-age))
      (<span class="org-keyword">let*</span> ((out (xkcd-get-json <span class="org-string">"http://xkcd.com/info.0.json"</span> <span class="org-highlight-numbers-number">0</span>))
             (json-assoc (json-read-from-string out))
             (latest (cdr (assoc 'num json-assoc))))
        (<span class="org-keyword">when</span> (/= xkcd-latest latest)
          (+xkcd-db-write json-assoc)
          (<span class="org-keyword">with-current-buffer</span> (find-file xkcd-cache-latest)
            (<span class="org-keyword">setq</span> xkcd-latest latest)
            (erase-buffer)
            (insert (number-to-string latest))
            (save-buffer)
            (kill-buffer (current-buffer)))))
      (shell-command (format <span class="org-string">"touch %s"</span> xkcd-cache-latest))))

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">+xkcd-stored-info</span> (make-hash-table <span class="org-builtin">:test</span> 'eql)
    <span class="org-doc">"Basic info on downloaded xkcds, in the form of a hashtable"</span>)

  (<span class="org-keyword">defadvice!</span> xkcd-get-json--and-cache (url <span class="org-type">&amp;optional</span> num)
    <span class="org-doc">"Fetch the Json coming from URL.</span>
<span class="org-doc">If the file NUM.json exists, use it instead.</span>
<span class="org-doc">If NUM is 0, always download from URL.</span>
<span class="org-doc">The return value is a string."</span>
    <span class="org-builtin">:override</span> #'xkcd-get-json
    (<span class="org-keyword">let*</span> ((file (format <span class="org-string">"%s%d.json"</span> xkcd-cache-dir num))
           (cached (<span class="org-keyword">and</span> (file-exists-p file) (not (eq num <span class="org-highlight-numbers-number">0</span>))))
           (out (<span class="org-keyword">with-current-buffer</span> (<span class="org-keyword">if</span> cached
                                         (find-file file)
                                       (url-retrieve-synchronously url))
                  (goto-char (point-min))
                  (<span class="org-keyword">unless</span> cached (re-search-forward <span class="org-string">"^$"</span>))
                  (<span class="org-keyword">prog1</span>
                      (buffer-substring-no-properties (point) (point-max))
                    (kill-buffer (current-buffer))))))
      (<span class="org-keyword">unless</span> (<span class="org-keyword">or</span> cached (eq num <span class="org-highlight-numbers-number">0</span>))
        (xkcd-cache-json num out))
      out))

  (<span class="org-keyword">defadvice!</span> +xkcd-get (num)
    <span class="org-doc">"Get the xkcd number NUM."</span>
    <span class="org-builtin">:override</span> 'xkcd-get
    (<span class="org-keyword">interactive</span> <span class="org-string">"nEnter comic number: "</span>)
    (xkcd-update-latest)
    (get-buffer-create <span class="org-string">"*xkcd*"</span>)
    (switch-to-buffer <span class="org-string">"*xkcd*"</span>)
    (xkcd-mode)
    (<span class="org-keyword">let</span> (buffer-read-only)
      (erase-buffer)
      (<span class="org-keyword">setq</span> xkcd-cur num)
      (<span class="org-keyword">let*</span> ((xkcd-data (+xkcd-fetch-info num))
             (num (plist-get xkcd-data <span class="org-builtin">:num</span>))
             (img (plist-get xkcd-data <span class="org-builtin">:img</span>))
             (safe-title (plist-get xkcd-data <span class="org-builtin">:safe-title</span>))
             (alt (plist-get xkcd-data <span class="org-builtin">:alt</span>))
             title file)
        (message <span class="org-string">"Getting comic..."</span>)
        (<span class="org-keyword">setq</span> file (xkcd-download img num))
        (<span class="org-keyword">setq</span> title (format <span class="org-string">"%d: %s"</span> num safe-title))
        (insert (propertize title
                            'face 'outline-1))
        (center-line)
        (insert <span class="org-string">"\n"</span>)
        (xkcd-insert-image file num)
        (<span class="org-keyword">if</span> (eq xkcd-cur <span class="org-highlight-numbers-number">0</span>)
            (<span class="org-keyword">setq</span> xkcd-cur num))
        (<span class="org-keyword">setq</span> xkcd-alt alt)
        (message <span class="org-string">"%s"</span> title))))

  (<span class="org-keyword">defconst</span> <span class="org-variable-name">+xkcd-db--sqlite-available-p</span>
    (<span class="org-keyword">with-demoted-errors</span> <span class="org-string">"+org-xkcd initialization: %S"</span>
      (emacsql-sqlite-ensure-binary)
      t))

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">+xkcd-db--connection</span> (make-hash-table <span class="org-builtin">:test</span> #'equal)
    <span class="org-doc">"Database connection to +org-xkcd database."</span>)

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db--get</span> ()
    <span class="org-doc">"Return the sqlite db file."</span>
    (expand-file-name <span class="org-string">"xkcd.db"</span> xkcd-cache-dir))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db--get-connection</span> ()
    <span class="org-doc">"Return the database connection, if any."</span>
    (gethash (file-truename xkcd-cache-dir)
             +xkcd-db--connection))

  (<span class="org-keyword">defconst</span> <span class="org-variable-name">+xkcd-db--table-schema</span>
    '((xkcds
       [(num integer <span class="org-builtin">:unique</span> <span class="org-builtin">:primary-key</span>)
        (year        <span class="org-builtin">:not-null</span>)
        (month       <span class="org-builtin">:not-null</span>)
        (link        <span class="org-builtin">:not-null</span>)
        (news        <span class="org-builtin">:not-null</span>)
        (safe_title  <span class="org-builtin">:not-null</span>)
        (title       <span class="org-builtin">:not-null</span>)
        (transcript  <span class="org-builtin">:not-null</span>)
        (alt         <span class="org-builtin">:not-null</span>)
        (img         <span class="org-builtin">:not-null</span>)])))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db--init</span> (db)
    <span class="org-doc">"Initialize database DB with the correct schema and user version."</span>
    (<span class="org-keyword">emacsql-with-transaction</span> db
      (<span class="org-keyword">pcase-dolist</span> (`(,table . ,schema) +xkcd-db--table-schema)
        (emacsql db [<span class="org-builtin">:create-table</span> $i1 $S2] table schema))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db</span> ()
    <span class="org-doc">"Entrypoint to the +org-xkcd sqlite database.</span>
<span class="org-doc">Initializes and stores the database, and the database connection.</span>
<span class="org-doc">Performs a database upgrade when required."</span>
    (<span class="org-keyword">unless</span> (<span class="org-keyword">and</span> (+xkcd-db--get-connection)
                 (emacsql-live-p (+xkcd-db--get-connection)))
      (<span class="org-keyword">let*</span> ((db-file (+xkcd-db--get))
             (init-db (not (file-exists-p db-file))))
        (make-directory (file-name-directory db-file) t)
        (<span class="org-keyword">let</span> ((conn (emacsql-sqlite db-file)))
          (set-process-query-on-exit-flag (emacsql-process conn) nil)
          (puthash (file-truename xkcd-cache-dir)
                   conn
                   +xkcd-db--connection)
          (<span class="org-keyword">when</span> init-db
            (+xkcd-db--init conn)))))
    (+xkcd-db--get-connection))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db-query</span> (sql <span class="org-type">&amp;rest</span> args)
    <span class="org-doc">"Run SQL query on +org-xkcd database with ARGS.</span>
<span class="org-doc">SQL can be either the emacsql vector representation, or a string."</span>
    (<span class="org-keyword">if</span>  (stringp sql)
        (emacsql (+xkcd-db) (apply #'format sql args))
      (apply #'emacsql (+xkcd-db) sql args)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db-read</span> (num)
    (<span class="org-keyword">when-let</span> ((res
                (car (+xkcd-db-query [<span class="org-builtin">:select</span> * <span class="org-builtin">:from</span> xkcds
                                      <span class="org-builtin">:where</span> (= num $s1)]
                                     num
                                     <span class="org-builtin">:limit</span> <span class="org-highlight-numbers-number">1</span>))))
      (+xkcd-db-list-to-plist res)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db-read-all</span> ()
    (<span class="org-keyword">let</span> ((xkcd-table (make-hash-table <span class="org-builtin">:test</span> 'eql <span class="org-builtin">:size</span> <span class="org-highlight-numbers-number">4000</span>)))
      (mapcar (<span class="org-keyword">lambda</span> (xkcd-info-list)
                (puthash (car xkcd-info-list) (+xkcd-db-list-to-plist xkcd-info-list) xkcd-table))
              (+xkcd-db-query [<span class="org-builtin">:select</span> * <span class="org-builtin">:from</span> xkcds]))
      xkcd-table))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db-list-to-plist</span> (xkcd-datalist)
    `(<span class="org-builtin">:num</span> ,(nth <span class="org-highlight-numbers-number">0</span> xkcd-datalist)
      <span class="org-builtin">:year</span> ,(nth <span class="org-highlight-numbers-number">1</span> xkcd-datalist)
      <span class="org-builtin">:month</span> ,(nth <span class="org-highlight-numbers-number">2</span> xkcd-datalist)
      <span class="org-builtin">:link</span> ,(nth <span class="org-highlight-numbers-number">3</span> xkcd-datalist)
      <span class="org-builtin">:news</span> ,(nth <span class="org-highlight-numbers-number">4</span> xkcd-datalist)
      <span class="org-builtin">:safe-title</span> ,(nth <span class="org-highlight-numbers-number">5</span> xkcd-datalist)
      <span class="org-builtin">:title</span> ,(nth <span class="org-highlight-numbers-number">6</span> xkcd-datalist)
      <span class="org-builtin">:transcript</span> ,(nth <span class="org-highlight-numbers-number">7</span> xkcd-datalist)
      <span class="org-builtin">:alt</span> ,(nth <span class="org-highlight-numbers-number">8</span> xkcd-datalist)
      <span class="org-builtin">:img</span> ,(nth <span class="org-highlight-numbers-number">9</span> xkcd-datalist)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db-write</span> (data)
    (+xkcd-db-query [<span class="org-builtin">:insert-into</span> xkcds
                     <span class="org-builtin">:values</span> $v1]
                    (list (vector
                           (cdr (assoc 'num        data))
                           (cdr (assoc 'year       data))
                           (cdr (assoc 'month      data))
                           (cdr (assoc 'link       data))
                           (cdr (assoc 'news       data))
                           (cdr (assoc 'safe_title data))
                           (cdr (assoc 'title      data))
                           (cdr (assoc 'transcript data))
                           (cdr (assoc 'alt        data))
                           (cdr (assoc 'img        data))
                           )))))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-yasnippet" class="outline-3">
<h3 id="yasnippet"><span class="section-number-3">4.28</span> YASnippet<a aria-hidden="true" href="#yasnippet">#</a> </h3>
<div class="outline-text-3" id="text-4-28">
<p>
Nested snippets are good, enable that.
</p>
<details id='yasnippet,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#yasnippet,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> yas-triggers-in-field t)
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-applications" class="outline-2">
<h2 id="applications"><span class="section-number-2">5</span> Applications<a aria-hidden="true" href="#applications">#</a> </h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-ebooks" class="outline-3">
<h3 id="ebooks"><span class="section-number-3">5.1</span> Ebooks<a aria-hidden="true" href="#ebooks">#</a> </h3>
<div class="outline-text-3" id="text-5-1">
<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/kindle.png' title="I'm happy with my Kindle 2 so far, but if they cut off the free Wikipedia browsing, I plan to show up drunk on Jeff Bezos's lawn and refuse to leave." alt='Kindle'>
<kbd>calibredb</kbd> lets us use calibre through Emacs, because who wouldn&rsquo;t want to use
something through Emacs?
</p>
<details id='ebooks,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ebooks,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> calibredb
  <span class="org-builtin">:commands</span> calibredb
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> calibredb-root-dir <span class="org-string">"~/Desktop/TEC/Other/Ebooks"</span>
        calibredb-db-dir (expand-file-name <span class="org-string">"metadata.db"</span> calibredb-root-dir))
  (<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> calibredb-show-mode-map
        <span class="org-builtin">:ne</span> <span class="org-string">"?"</span> #'calibredb-entry-dispatch
        <span class="org-builtin">:ne</span> <span class="org-string">"o"</span> #'calibredb-find-file
        <span class="org-builtin">:ne</span> <span class="org-string">"O"</span> #'calibredb-find-file-other-frame
        <span class="org-builtin">:ne</span> <span class="org-string">"V"</span> #'calibredb-open-file-with-default-tool
        <span class="org-builtin">:ne</span> <span class="org-string">"s"</span> #'calibredb-set-metadata-dispatch
        <span class="org-builtin">:ne</span> <span class="org-string">"e"</span> #'calibredb-export-dispatch
        <span class="org-builtin">:ne</span> <span class="org-string">"q"</span> #'calibredb-entry-quit
        <span class="org-builtin">:ne</span> <span class="org-string">"."</span> #'calibredb-open-dired
        <span class="org-builtin">:ne</span> [tab] #'calibredb-toggle-view-at-point
        <span class="org-builtin">:ne</span> <span class="org-string">"M-t"</span> #'calibredb-set-metadata--tags
        <span class="org-builtin">:ne</span> <span class="org-string">"M-a"</span> #'calibredb-set-metadata--author_sort
        <span class="org-builtin">:ne</span> <span class="org-string">"M-A"</span> #'calibredb-set-metadata--authors
        <span class="org-builtin">:ne</span> <span class="org-string">"M-T"</span> #'calibredb-set-metadata--title
        <span class="org-builtin">:ne</span> <span class="org-string">"M-c"</span> #'calibredb-set-metadata--comments)
  (<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> calibredb-search-mode-map
        <span class="org-builtin">:ne</span> [mouse-3] #'calibredb-search-mouse
        <span class="org-builtin">:ne</span> <span class="org-string">"RET"</span> #'calibredb-find-file
        <span class="org-builtin">:ne</span> <span class="org-string">"?"</span> #'calibredb-dispatch
        <span class="org-builtin">:ne</span> <span class="org-string">"a"</span> #'calibredb-add
        <span class="org-builtin">:ne</span> <span class="org-string">"A"</span> #'calibredb-add-dir
        <span class="org-builtin">:ne</span> <span class="org-string">"c"</span> #'calibredb-clone
        <span class="org-builtin">:ne</span> <span class="org-string">"d"</span> #'calibredb-remove
        <span class="org-builtin">:ne</span> <span class="org-string">"D"</span> #'calibredb-remove-marked-items
        <span class="org-builtin">:ne</span> <span class="org-string">"j"</span> #'calibredb-next-entry
        <span class="org-builtin">:ne</span> <span class="org-string">"k"</span> #'calibredb-previous-entry
        <span class="org-builtin">:ne</span> <span class="org-string">"l"</span> #'calibredb-virtual-library-list
        <span class="org-builtin">:ne</span> <span class="org-string">"L"</span> #'calibredb-library-list
        <span class="org-builtin">:ne</span> <span class="org-string">"n"</span> #'calibredb-virtual-library-next
        <span class="org-builtin">:ne</span> <span class="org-string">"N"</span> #'calibredb-library-next
        <span class="org-builtin">:ne</span> <span class="org-string">"p"</span> #'calibredb-virtual-library-previous
        <span class="org-builtin">:ne</span> <span class="org-string">"P"</span> #'calibredb-library-previous
        <span class="org-builtin">:ne</span> <span class="org-string">"s"</span> #'calibredb-set-metadata-dispatch
        <span class="org-builtin">:ne</span> <span class="org-string">"S"</span> #'calibredb-switch-library
        <span class="org-builtin">:ne</span> <span class="org-string">"o"</span> #'calibredb-find-file
        <span class="org-builtin">:ne</span> <span class="org-string">"O"</span> #'calibredb-find-file-other-frame
        <span class="org-builtin">:ne</span> <span class="org-string">"v"</span> #'calibredb-view
        <span class="org-builtin">:ne</span> <span class="org-string">"V"</span> #'calibredb-open-file-with-default-tool
        <span class="org-builtin">:ne</span> <span class="org-string">"."</span> #'calibredb-open-dired
        <span class="org-builtin">:ne</span> <span class="org-string">"b"</span> #'calibredb-catalog-bib-dispatch
        <span class="org-builtin">:ne</span> <span class="org-string">"e"</span> #'calibredb-export-dispatch
        <span class="org-builtin">:ne</span> <span class="org-string">"r"</span> #'calibredb-search-refresh-and-clear-filter
        <span class="org-builtin">:ne</span> <span class="org-string">"R"</span> #'calibredb-search-clear-filter
        <span class="org-builtin">:ne</span> <span class="org-string">"q"</span> #'calibredb-search-quit
        <span class="org-builtin">:ne</span> <span class="org-string">"m"</span> #'calibredb-mark-and-forward
        <span class="org-builtin">:ne</span> <span class="org-string">"f"</span> #'calibredb-toggle-favorite-at-point
        <span class="org-builtin">:ne</span> <span class="org-string">"x"</span> #'calibredb-toggle-archive-at-point
        <span class="org-builtin">:ne</span> <span class="org-string">"h"</span> #'calibredb-toggle-highlight-at-point
        <span class="org-builtin">:ne</span> <span class="org-string">"u"</span> #'calibredb-unmark-and-forward
        <span class="org-builtin">:ne</span> <span class="org-string">"i"</span> #'calibredb-edit-annotation
        <span class="org-builtin">:ne</span> <span class="org-string">"DEL"</span> #'calibredb-unmark-and-backward
        <span class="org-builtin">:ne</span> [backtab] #'calibredb-toggle-view
        <span class="org-builtin">:ne</span> [tab] #'calibredb-toggle-view-at-point
        <span class="org-builtin">:ne</span> <span class="org-string">"M-n"</span> #'calibredb-show-next-entry
        <span class="org-builtin">:ne</span> <span class="org-string">"M-p"</span> #'calibredb-show-previous-entry
        <span class="org-builtin">:ne</span> <span class="org-string">"/"</span> #'calibredb-search-live-filter
        <span class="org-builtin">:ne</span> <span class="org-string">"M-t"</span> #'calibredb-set-metadata--tags
        <span class="org-builtin">:ne</span> <span class="org-string">"M-a"</span> #'calibredb-set-metadata--author_sort
        <span class="org-builtin">:ne</span> <span class="org-string">"M-A"</span> #'calibredb-set-metadata--authors
        <span class="org-builtin">:ne</span> <span class="org-string">"M-T"</span> #'calibredb-set-metadata--title
        <span class="org-builtin">:ne</span> <span class="org-string">"M-c"</span> #'calibredb-set-metadata--comments))
</pre>
</div>
    </details>

<p>
Then, to actually read the ebooks we use <kbd>nov</kbd>.
</p>


<figure id="orga39bb73">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/nov.png" alt="Excerpt of the GNU Emacs manual viewed through nov.el" class="invertible">

</figure>

<details id='ebooks,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ebooks,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> nov
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.epub\\'"</span> . nov-mode)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> nov-mode-map
        <span class="org-builtin">:n</span> <span class="org-string">"RET"</span> #'nov-scroll-up)

  (<span class="org-keyword">defun</span> <span class="org-function-name">doom-modeline-segment--nov-info</span> ()
    (concat
     <span class="org-string">" "</span>
     (propertize
      (cdr (assoc 'creator nov-metadata))
      'face 'doom-modeline-project-parent-dir)
     <span class="org-string">" "</span>
     (cdr (assoc 'title nov-metadata))
     <span class="org-string">" "</span>
     (propertize
      (format <span class="org-string">"%d/%d"</span>
              (1+ nov-documents-index)
              (length nov-documents))
      'face 'doom-modeline-info)))

  (advice-add 'nov-render-title <span class="org-builtin">:override</span> #'ignore)

  (<span class="org-keyword">defun</span> <span class="org-function-name">+nov-mode-setup</span> ()
    (face-remap-add-relative 'variable-pitch
                             <span class="org-builtin">:family</span> <span class="org-string">"Merriweather"</span>
                             <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.4</span>
                             <span class="org-builtin">:width</span> 'semi-expanded)
    (face-remap-add-relative 'default <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.3</span>)
    (<span class="org-keyword">setq-local</span> line-spacing <span class="org-highlight-numbers-number">0.2</span>
                next-screen-context-lines <span class="org-highlight-numbers-number">4</span>
                shr-use-colors nil)
    (<span class="org-keyword">require</span> '<span class="org-constant">visual-fill-column</span> nil t)
    (<span class="org-keyword">setq-local</span> visual-fill-column-center-text t
                visual-fill-column-width <span class="org-highlight-numbers-number">80</span>
                nov-text-width <span class="org-highlight-numbers-number">80</span>)
    (visual-fill-column-mode <span class="org-highlight-numbers-number">1</span>)
    (hl-line-mode <span class="org-highlight-numbers-number">-1</span>)

    (add-to-list '+lookup-definition-functions #'+lookup/dictionary-definition)

    (<span class="org-keyword">setq-local</span> mode-line-format
                `((<span class="org-builtin">:eval</span>
                   (doom-modeline-segment--workspace-name))
                  (<span class="org-builtin">:eval</span>
                   (doom-modeline-segment--window-number))
                  (<span class="org-builtin">:eval</span>
                   (doom-modeline-segment--nov-info))
                  ,(propertize
                    <span class="org-string">" %P "</span>
                    'face 'doom-modeline-buffer-minor-mode)
                  ,(propertize
                    <span class="org-string">" "</span>
                    'face (<span class="org-keyword">if</span> (doom-modeline--active) 'mode-line 'mode-line-inactive)
                    'display `((space
                                <span class="org-builtin">:align-to</span>
                                (- (+ right right-fringe right-margin)
                                   ,(* (<span class="org-keyword">let</span> ((width (doom-modeline--font-width)))
                                         (<span class="org-keyword">or</span> (<span class="org-keyword">and</span> (= width <span class="org-highlight-numbers-number">1</span>) <span class="org-highlight-numbers-number">1</span>)
                                             (/ width (frame-char-width) <span class="org-highlight-numbers-number">1.0</span>)))
                                       (string-width
                                        (format-mode-line (cons <span class="org-string">""</span> '(<span class="org-builtin">:eval</span> (doom-modeline-segment--major-mode))))))))))
                  (<span class="org-builtin">:eval</span> (doom-modeline-segment--major-mode)))))

  (add-hook 'nov-mode-hook #'+nov-mode-setup))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-irc" class="outline-3">
<h3 id="irc"><span class="section-number-3">5.2</span> <span class='acr'><span class='acr'>IRC</span></span><a aria-hidden="true" href="#irc">#</a> </h3>
<div class="outline-text-3" id="text-5-2">
<p>
<kbd>circe</kbd> is a client for <span class='acr'>IRC</span> in Emacs (hey, isn&rsquo;t that a nice project
name+acronym), and a greek enchantress who turned humans into animals.
</p>

<p>
Let&rsquo;s use the former to chat to <del>recluses</del> discerning individuals online.
</p>

<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/team_chat.png' title="2078: He announces that he's finally making the jump from screen+irssi to tmux+weechat." alt='Team Chat'>
</p>

<p>
Before we start seeing and sending messages, we need to authenticate with our
<span class='acr'>IRC</span> servers. The circe manual provided a snippet for putting some of the auth
details in <kbd>.authinfo.gpg</kbd> &#x2014; but I think we should go further than that: have
the entire server info in our authinfo.
</p>

<p>
First, a reasonable format by which we can specify:
</p>
<ul class="org-ul">
<li>server</li>
<li>port</li>
<li><span class='acr'>SASL</span> username</li>
<li><span class='acr'>SASL</span> password</li>
<li>channels to join</li>
</ul>

<p>
We can have these stored like so
</p>
<details id='irc,code--1' class='code' open><summary><span class="lang">authinfo</span></summary>
    <div class='gutter'>
    <a href='#irc,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-authinfo"><span class="org-variable-name">machine</span> <span class="org-builtin">chat.freenode.net</span> <span class="org-comment-delimiter">login</span> <span class="org-keyword">USERNAME</span> <span class="org-comment-delimiter">password</span> <span class="org-doc">PASSWORD</span> <span class="org-comment-delimiter">port</span> <span class="org-type">PORT</span> <span class="org-constant">for</span> irc <span class="org-constant">channels</span> emacs,org-mode
</pre>
</div>
    </details>

<p>
The <code>for irc</code> bit is used so we can uniquely identify all <span class='acr'>IRC</span> auth info. By
omitting the <kbd>#</kbd> in channel names we can have a list of channels comma-separated
(no space!) which the secrets <span class='acr'>API</span> will return as a single string.
</p>

<details id='irc-authinfo-reader' class='code' open><summary class='named'><span class="name">irc-authinfo-reader</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#irc-authinfo-reader'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">auth-server-pass</span> (server)
  (<span class="org-keyword">if-let</span> ((secret (plist-get (car (auth-source-search <span class="org-builtin">:host</span> server)) <span class="org-builtin">:secret</span>)))
      (<span class="org-keyword">if</span> (functionp secret)
          (funcall secret) secret)
    (<span class="org-warning">error</span> <span class="org-string">"Could not fetch password for host %s"</span> server)))

(<span class="org-keyword">defun</span> <span class="org-function-name">register-irc-auths</span> ()
  (<span class="org-keyword">require</span> '<span class="org-constant">circe</span>)
  (<span class="org-keyword">require</span> '<span class="org-constant">dash</span>)
  (<span class="org-keyword">let</span> ((accounts (-filter (<span class="org-keyword">lambda</span> (a) (string= <span class="org-string">"irc"</span> (plist-get a <span class="org-builtin">:for</span>)))
                           (auth-source-search <span class="org-builtin">:require</span> '(<span class="org-builtin">:for</span>) <span class="org-builtin">:max</span> <span class="org-highlight-numbers-number">10</span>))))
    (<span class="org-keyword">appendq!</span> circe-network-options
              (mapcar (<span class="org-keyword">lambda</span> (entry)
                        (<span class="org-keyword">let*</span> ((host (plist-get entry <span class="org-builtin">:host</span>))
                               (label (<span class="org-keyword">or</span> (plist-get entry <span class="org-builtin">:label</span>) host))
                               (_ports (mapcar #'string-to-number
                                               (s-split <span class="org-string">","</span> (plist-get entry <span class="org-builtin">:port</span>))))
                               (port (<span class="org-keyword">if</span> (= <span class="org-highlight-numbers-number">1</span> (length _ports)) (car _ports) _ports))
                               (user (plist-get entry <span class="org-builtin">:user</span>))
                               (nick (<span class="org-keyword">or</span> (plist-get entry <span class="org-builtin">:nick</span>) user))
                               (channels (mapcar (<span class="org-keyword">lambda</span> (c) (concat <span class="org-string">"#"</span> c))
                                                 (s-split <span class="org-string">","</span> (plist-get entry <span class="org-builtin">:channels</span>)))))
                          `(,label
                            <span class="org-builtin">:host</span> ,host <span class="org-builtin">:port</span> ,port <span class="org-builtin">:nick</span> ,nick
                            <span class="org-builtin">:sasl-username</span> ,user <span class="org-builtin">:sasl-password</span> auth-server-pass
                            <span class="org-builtin">:channels</span> ,channels)))
                      accounts))))
</pre>
</div>
    </details>

<p>
We&rsquo;ll just call <code class="src src-elisp">(register-irc-auths)</code> on a hook when we start Circe
up.
</p>

<p>
Now we&rsquo;re ready to go, let&rsquo;s actually wire-up Circe, with one or two
configuration tweaks.
</p>
<details id='irc,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#irc,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> circe
  (<span class="org-keyword">setq-default</span> circe-use-tls t)
  (<span class="org-keyword">setq</span> circe-notifications-alert-icon <span class="org-string">"/usr/share/icons/breeze/actions/24/network-connect.svg"</span>
        lui-logging-directory <span class="org-string">"~/.emacs.d/.local/etc/irc"</span>
        lui-logging-file-format <span class="org-string">"{buffer}/%Y/%m-%d.txt"</span>
        circe-format-self-say <span class="org-string">"{nick:+13s} &#9475; {body}"</span>)

  (<span class="org-keyword">custom-set-faces!</span>
    '(circe-my-message-face <span class="org-builtin">:weight</span> unspecified))

  (enable-lui-logging-globally)
  (enable-circe-display-images)

  &lt;&lt;org-emph-to-irc&gt;&gt;

  &lt;&lt;circe-emojis&gt;&gt;
  &lt;&lt;circe-emoji-alists&gt;&gt;

  (<span class="org-keyword">defun</span> <span class="org-function-name">named-circe-prompt</span> ()
    (lui-set-prompt
     (concat (propertize (format <span class="org-string">"%13s &gt; "</span> (circe-nick))
                         'face 'circe-prompt-face)
             <span class="org-string">""</span>)))
  (add-hook 'circe-chat-mode-hook #'named-circe-prompt)

  (<span class="org-keyword">appendq!</span> all-the-icons-mode-icon-alist
            '((circe-channel-mode all-the-icons-material <span class="org-string">"message"</span> <span class="org-builtin">:face</span> all-the-icons-lblue)
              (circe-server-mode all-the-icons-material <span class="org-string">"chat_bubble_outline"</span> <span class="org-builtin">:face</span> all-the-icons-purple))))

&lt;&lt;irc-authinfo-reader&gt;&gt;

(<span class="org-keyword">add-transient-hook!</span> #'=irc (register-irc-auths))
</pre>
</div>
    </details>
</div>

<div id="outline-container-org-style-emphasis" class="outline-4">
<h4 id="org-style-emphasis"><span class="section-number-4">5.2.1</span> Org-style emphasis<a aria-hidden="true" href="#org-style-emphasis">#</a> </h4>
<div class="outline-text-4" id="text-5-2-1">
<p>
Let&rsquo;s do our <b>bold</b>, <i>italic</i>, and <span class="underline">underline</span> in org-syntax, using <span class='acr'>IRC</span> control characters.
</p>
<details id='org-emph-irc' class='code' open><summary class='named'><span class="name">org-emph-to-irc</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-emph-irc'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">lui-org-to-irc</span> ()
  <span class="org-doc">"Examine a buffer with simple org-mode formatting, and converts the empasis:</span>
<span class="org-doc">*bold*, /italic/, and _underline_ to IRC semi-standard escape codes.</span>
<span class="org-doc">=code= is converted to inverse (highlighted) text."</span>
  (goto-char (point-min))
  (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"\\_&lt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?1:</span></span><span class="org-string">[*/_=]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?2:</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">[:space:]]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">.*?[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">[:space:]]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\1\\_&gt;"</span> nil t)
    (replace-match
     (concat (<span class="org-keyword">pcase</span> (match-string <span class="org-highlight-numbers-number">1</span>)
               (<span class="org-string">"*"</span> <span class="org-string">"&#2;"</span>)
               (<span class="org-string">"/"</span> <span class="org-string">"&#29;"</span>)
               (<span class="org-string">"_"</span> <span class="org-string">"&#31;"</span>)
               (<span class="org-string">"="</span> <span class="org-string">"&#22;"</span>))
             (match-string <span class="org-highlight-numbers-number">2</span>)
             <span class="org-string">"&#15;"</span>) <span class="org-warning">nil nil)))</span>

(add-hook 'lui-pre-input-hook #'lui-org-to-irc)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-emojis" class="outline-4">
<h4 id="emojis"><span class="section-number-4">5.2.2</span> Emojis<a aria-hidden="true" href="#emojis">#</a> </h4>
<div class="outline-text-4" id="text-5-2-2">
<p>
Let&rsquo;s setup Circe to use some emojis
</p>
<details id='circe-emojis' class='code' open><summary class='named'><span class="name">circe-emojis</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#circe-emojis'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">lui-ascii-to-emoji</span> ()
  (goto-char (point-min))
  (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?::?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">[:space:]:]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?"</span> nil t)
    (replace-match
     (concat
      (match-string <span class="org-highlight-numbers-number">1</span>)
      (<span class="org-keyword">or</span> (cdr (assoc (match-string <span class="org-highlight-numbers-number">2</span>) lui-emojis-alist))
          (concat <span class="org-string">":"</span> (match-string <span class="org-highlight-numbers-number">2</span>) <span class="org-string">":"</span>))
      (match-string <span class="org-highlight-numbers-number">3</span>))
     nil nil)))

(<span class="org-keyword">defun</span> <span class="org-function-name">lui-emoticon-to-emoji</span> ()
  (<span class="org-keyword">dolist</span> (emoticon lui-emoticons-alist)
    (goto-char (point-min))
    (<span class="org-keyword">while</span> (re-search-forward (concat <span class="org-string">" "</span> (car emoticon) <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?"</span>) nil t)
      (replace-match (concat <span class="org-string">" "</span>
                             (cdr (assoc (cdr emoticon) lui-emojis-alist))
                             (match-string <span class="org-highlight-numbers-number">1</span>))))))

(<span class="org-keyword">define-minor-mode</span> <span class="org-function-name">lui-emojify</span>
  <span class="org-doc">"Replace :emojis: and ;) emoticons with unicode emoji chars."</span>
  <span class="org-builtin">:global</span> t
  <span class="org-builtin">:init-value</span> t
  (<span class="org-keyword">if</span> lui-emojify
      (<span class="org-keyword">add-hook!</span> lui-pre-input #'lui-ascii-to-emoji #'lui-emoticon-to-emoji)
    (<span class="org-keyword">remove-hook!</span> lui-pre-input #'lui-ascii-to-emoji #'lui-emoticon-to-emoji)))
</pre>
</div>
    </details>

<p>
Now, some actual emojis to use.
</p>
<details id='circe-emoji-alists' class='code' open><summary class='named'><span class="name">circe-emoji-alists</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#circe-emoji-alists'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">lui-emojis-alist</span>
  '((<span class="org-string">"grinning"</span>                      . <span class="org-string">"&#128512;"</span>)
    (<span class="org-string">"smiley"</span>                        . <span class="org-string">"&#128515;"</span>)
    (<span class="org-string">"smile"</span>                         . <span class="org-string">"&#128516;"</span>)
    (<span class="org-string">"grin"</span>                          . <span class="org-string">"&#128513;"</span>)
    (<span class="org-string">"laughing"</span>                      . <span class="org-string">"&#128518;"</span>)
    (<span class="org-string">"sweat_smile"</span>                   . <span class="org-string">"&#128517;"</span>)
    (<span class="org-string">"joy"</span>                           . <span class="org-string">"&#128514;"</span>)
    (<span class="org-string">"rofl"</span>                          . <span class="org-string">"&#129315;"</span>)
    (<span class="org-string">"relaxed"</span>                       . <span class="org-string">"&#9786;&#65039;"</span>)
    (<span class="org-string">"blush"</span>                         . <span class="org-string">"&#128522;"</span>)
    (<span class="org-string">"innocent"</span>                      . <span class="org-string">"&#128519;"</span>)
    (<span class="org-string">"slight_smile"</span>                  . <span class="org-string">"&#128578;"</span>)
    (<span class="org-string">"upside_down"</span>                   . <span class="org-string">"&#128579;"</span>)
    (<span class="org-string">"wink"</span>                          . <span class="org-string">"&#128521;"</span>)
    (<span class="org-string">"relieved"</span>                      . <span class="org-string">"&#128524;"</span>)
    (<span class="org-string">"heart_eyes"</span>                    . <span class="org-string">"&#128525;"</span>)
    (<span class="org-string">"yum"</span>                           . <span class="org-string">"&#128523;"</span>)
    (<span class="org-string">"stuck_out_tongue"</span>              . <span class="org-string">"&#128539;"</span>)
    (<span class="org-string">"stuck_out_tongue_closed_eyes"</span>  . <span class="org-string">"&#128541;"</span>)
    (<span class="org-string">"stuck_out_tongue_wink"</span>         . <span class="org-string">"&#128540;"</span>)
    (<span class="org-string">"zanzy"</span>                         . <span class="org-string">"&#129322;"</span>)
    (<span class="org-string">"raised_eyebrow"</span>                . <span class="org-string">"&#129320;"</span>)
    (<span class="org-string">"monocle"</span>                       . <span class="org-string">"&#129488;"</span>)
    (<span class="org-string">"nerd"</span>                          . <span class="org-string">"&#129299;"</span>)
    (<span class="org-string">"cool"</span>                          . <span class="org-string">"&#128526;"</span>)
    (<span class="org-string">"star_struck"</span>                   . <span class="org-string">"&#129321;"</span>)
    (<span class="org-string">"party"</span>                         . <span class="org-string">"&#129395;"</span>)
    (<span class="org-string">"smirk"</span>                         . <span class="org-string">"&#128527;"</span>)
    (<span class="org-string">"unamused"</span>                      . <span class="org-string">"&#128530;"</span>)
    (<span class="org-string">"disapointed"</span>                   . <span class="org-string">"&#128542;"</span>)
    (<span class="org-string">"pensive"</span>                       . <span class="org-string">"&#128532;"</span>)
    (<span class="org-string">"worried"</span>                       . <span class="org-string">"&#128543;"</span>)
    (<span class="org-string">"confused"</span>                      . <span class="org-string">"&#128533;"</span>)
    (<span class="org-string">"slight_frown"</span>                  . <span class="org-string">"&#128577;"</span>)
    (<span class="org-string">"frown"</span>                         . <span class="org-string">"&#9785;&#65039;"</span>)
    (<span class="org-string">"persevere"</span>                     . <span class="org-string">"&#128547;"</span>)
    (<span class="org-string">"confounded"</span>                    . <span class="org-string">"&#128534;"</span>)
    (<span class="org-string">"tired"</span>                         . <span class="org-string">"&#128555;"</span>)
    (<span class="org-string">"weary"</span>                         . <span class="org-string">"&#128553;"</span>)
    (<span class="org-string">"pleading"</span>                      . <span class="org-string">"&#129402;"</span>)
    (<span class="org-string">"tear"</span>                          . <span class="org-string">"&#128546;"</span>)
    (<span class="org-string">"cry"</span>                           . <span class="org-string">"&#128546;"</span>)
    (<span class="org-string">"sob"</span>                           . <span class="org-string">"&#128557;"</span>)
    (<span class="org-string">"triumph"</span>                       . <span class="org-string">"&#128548;"</span>)
    (<span class="org-string">"angry"</span>                         . <span class="org-string">"&#128544;"</span>)
    (<span class="org-string">"rage"</span>                          . <span class="org-string">"&#128545;"</span>)
    (<span class="org-string">"exploding_head"</span>                . <span class="org-string">"&#129327;"</span>)
    (<span class="org-string">"flushed"</span>                       . <span class="org-string">"&#128563;"</span>)
    (<span class="org-string">"hot"</span>                           . <span class="org-string">"&#129397;"</span>)
    (<span class="org-string">"cold"</span>                          . <span class="org-string">"&#129398;"</span>)
    (<span class="org-string">"scream"</span>                        . <span class="org-string">"&#128561;"</span>)
    (<span class="org-string">"fearful"</span>                       . <span class="org-string">"&#128552;"</span>)
    (<span class="org-string">"disapointed"</span>                   . <span class="org-string">"&#128560;"</span>)
    (<span class="org-string">"relieved"</span>                      . <span class="org-string">"&#128549;"</span>)
    (<span class="org-string">"sweat"</span>                         . <span class="org-string">"&#128531;"</span>)
    (<span class="org-string">"thinking"</span>                      . <span class="org-string">"&#129300;"</span>)
    (<span class="org-string">"shush"</span>                         . <span class="org-string">"&#129323;"</span>)
    (<span class="org-string">"liar"</span>                          . <span class="org-string">"&#129317;"</span>)
    (<span class="org-string">"blank_face"</span>                    . <span class="org-string">"&#128566;"</span>)
    (<span class="org-string">"neutral"</span>                       . <span class="org-string">"&#128528;"</span>)
    (<span class="org-string">"expressionless"</span>                . <span class="org-string">"&#128529;"</span>)
    (<span class="org-string">"grimace"</span>                       . <span class="org-string">"&#128556;"</span>)
    (<span class="org-string">"rolling_eyes"</span>                  . <span class="org-string">"&#128580;"</span>)
    (<span class="org-string">"hushed"</span>                        . <span class="org-string">"&#128559;"</span>)
    (<span class="org-string">"frowning"</span>                      . <span class="org-string">"&#128550;"</span>)
    (<span class="org-string">"anguished"</span>                     . <span class="org-string">"&#128551;"</span>)
    (<span class="org-string">"wow"</span>                           . <span class="org-string">"&#128558;"</span>)
    (<span class="org-string">"astonished"</span>                    . <span class="org-string">"&#128562;"</span>)
    (<span class="org-string">"sleeping"</span>                      . <span class="org-string">"&#128564;"</span>)
    (<span class="org-string">"drooling"</span>                      . <span class="org-string">"&#129316;"</span>)
    (<span class="org-string">"sleepy"</span>                        . <span class="org-string">"&#128554;"</span>)
    (<span class="org-string">"dizzy"</span>                         . <span class="org-string">"&#128565;"</span>)
    (<span class="org-string">"zipper_mouth"</span>                  . <span class="org-string">"&#129296;"</span>)
    (<span class="org-string">"woozy"</span>                         . <span class="org-string">"&#129396;"</span>)
    (<span class="org-string">"sick"</span>                          . <span class="org-string">"&#129314;"</span>)
    (<span class="org-string">"vomiting"</span>                      . <span class="org-string">"&#129326;"</span>)
    (<span class="org-string">"sneeze"</span>                        . <span class="org-string">"&#129319;"</span>)
    (<span class="org-string">"mask"</span>                          . <span class="org-string">"&#128567;"</span>)
    (<span class="org-string">"bandaged_head"</span>                 . <span class="org-string">"&#129301;"</span>)
    (<span class="org-string">"money_face"</span>                    . <span class="org-string">"&#129297;"</span>)
    (<span class="org-string">"cowboy"</span>                        . <span class="org-string">"&#129312;"</span>)
    (<span class="org-string">"imp"</span>                           . <span class="org-string">"&#128520;"</span>)
    (<span class="org-string">"ghost"</span>                         . <span class="org-string">"&#128123;"</span>)
    (<span class="org-string">"alien"</span>                         . <span class="org-string">"&#128125;"</span>)
    (<span class="org-string">"robot"</span>                         . <span class="org-string">"&#129302;"</span>)
    (<span class="org-string">"clap"</span>                          . <span class="org-string">"&#128079;"</span>)
    (<span class="org-string">"thumpup"</span>                       . <span class="org-string">"&#128077;"</span>)
    (<span class="org-string">"+1"</span>                            . <span class="org-string">"&#128077;"</span>)
    (<span class="org-string">"thumbdown"</span>                     . <span class="org-string">"&#128078;"</span>)
    (<span class="org-string">"-1"</span>                            . <span class="org-string">"&#128078;"</span>)
    (<span class="org-string">"ok"</span>                            . <span class="org-string">"&#128076;"</span>)
    (<span class="org-string">"pinch"</span>                         . <span class="org-string">"&#129295;"</span>)
    (<span class="org-string">"left"</span>                          . <span class="org-string">"&#128072;"</span>)
    (<span class="org-string">"right"</span>                         . <span class="org-string">"&#128073;"</span>)
    (<span class="org-string">"down"</span>                          . <span class="org-string">"&#128071;"</span>)
    (<span class="org-string">"wave"</span>                          . <span class="org-string">"&#128075;"</span>)
    (<span class="org-string">"pray"</span>                          . <span class="org-string">"&#128591;"</span>)
    (<span class="org-string">"eyes"</span>                          . <span class="org-string">"&#128064;"</span>)
    (<span class="org-string">"brain"</span>                         . <span class="org-string">"&#129504;"</span>)
    (<span class="org-string">"facepalm"</span>                      . <span class="org-string">"&#129318;"</span>)
    (<span class="org-string">"tada"</span>                          . <span class="org-string">"&#127881;"</span>)
    (<span class="org-string">"fire"</span>                          . <span class="org-string">"&#128293;"</span>)
    (<span class="org-string">"flying_money"</span>                  . <span class="org-string">"&#128184;"</span>)
    (<span class="org-string">"lighbulb"</span>                      . <span class="org-string">"&#128161;"</span>)
    (<span class="org-string">"heart"</span>                         . <span class="org-string">"&#10084;&#65039;"</span>)
    (<span class="org-string">"sparkling_heart"</span>               . <span class="org-string">"&#128150;"</span>)
    (<span class="org-string">"heartbreak"</span>                    . <span class="org-string">"&#128148;"</span>)
    (<span class="org-string">"100"</span>                           . <span class="org-string">"&#128175;"</span>)))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">lui-emoticons-alist</span>
  '((<span class="org-string">":)"</span>   . <span class="org-string">"slight_smile"</span>)
    (<span class="org-string">";)"</span>   . <span class="org-string">"wink"</span>)
    (<span class="org-string">":D"</span>   . <span class="org-string">"smile"</span>)
    (<span class="org-string">"=D"</span>   . <span class="org-string">"grin"</span>)
    (<span class="org-string">"xD"</span>   . <span class="org-string">"laughing"</span>)
    (<span class="org-string">";("</span>   . <span class="org-string">"joy"</span>)
    (<span class="org-string">":P"</span>   . <span class="org-string">"stuck_out_tongue"</span>)
    (<span class="org-string">";D"</span>   . <span class="org-string">"stuck_out_tongue_wink"</span>)
    (<span class="org-string">"xP"</span>   . <span class="org-string">"stuck_out_tongue_closed_eyes"</span>)
    (<span class="org-string">":("</span>   . <span class="org-string">"slight_frown"</span>)
    (<span class="org-string">";("</span>   . <span class="org-string">"cry"</span>)
    (<span class="org-string">";'("</span>  . <span class="org-string">"sob"</span>)
    (<span class="org-string">"&gt;:("</span>  . <span class="org-string">"angry"</span>)
    (<span class="org-string">"&gt;&gt;:("</span> . <span class="org-string">"rage"</span>)
    (<span class="org-string">":o"</span>   . <span class="org-string">"wow"</span>)
    (<span class="org-string">":O"</span>   . <span class="org-string">"astonished"</span>)
    (<span class="org-string">":/"</span>   . <span class="org-string">"confused"</span>)
    (<span class="org-string">":-/"</span>  . <span class="org-string">"thinking"</span>)
    (<span class="org-string">":|"</span>   . <span class="org-string">"neutral"</span>)
    (<span class="org-string">":-|"</span>  . <span class="org-string">"expressionless"</span>)))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-newsfeed" class="outline-3">
<h3 id="newsfeed"><span class="section-number-3">5.3</span> Newsfeed<a aria-hidden="true" href="#newsfeed">#</a> </h3>
<div class="outline-text-3" id="text-5-3">
<p>
<span class='acr'>RSS</span> feeds are still a thing. Why not make use of them with <kbd>elfeed</kbd>.
I really like what <a href="https://github.com/fuxialexander/doom-emacs-private-xfu/tree/master/modules/app/rss">fuxialexander</a> has going on, but I don&rsquo;t think I need a custom
module. Let&rsquo;s just try to patch on the main things I like the look of.
</p>


<figure id="org92499d7">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/elfeed.png" alt="Example elfeed entry" class="invertible">

</figure>
</div>

<div id="outline-container-keybindings" class="outline-4">
<h4 id="keybindings"><span class="section-number-4">5.3.1</span> Keybindings<a aria-hidden="true" href="#keybindings">#</a> </h4>
<div class="outline-text-4" id="text-5-3-1">
<details id='keybindings,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#keybindings,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> elfeed-search-mode-map
      <span class="org-builtin">:after</span> elfeed-search
      [remap kill-this-buffer] <span class="org-string">"q"</span>
      [remap kill-buffer] <span class="org-string">"q"</span>
      <span class="org-builtin">:n</span> doom-leader-key nil
      <span class="org-builtin">:n</span> <span class="org-string">"q"</span> #'+rss/quit
      <span class="org-builtin">:n</span> <span class="org-string">"e"</span> #'elfeed-update
      <span class="org-builtin">:n</span> <span class="org-string">"r"</span> #'elfeed-search-untag-all-unread
      <span class="org-builtin">:n</span> <span class="org-string">"u"</span> #'elfeed-search-tag-all-unread
      <span class="org-builtin">:n</span> <span class="org-string">"s"</span> #'elfeed-search-live-filter
      <span class="org-builtin">:n</span> <span class="org-string">"RET"</span> #'elfeed-search-show-entry
      <span class="org-builtin">:n</span> <span class="org-string">"p"</span> #'elfeed-show-pdf
      <span class="org-builtin">:n</span> <span class="org-string">"+"</span> #'elfeed-search-tag-all
      <span class="org-builtin">:n</span> <span class="org-string">"-"</span> #'elfeed-search-untag-all
      <span class="org-builtin">:n</span> <span class="org-string">"S"</span> #'elfeed-search-set-filter
      <span class="org-builtin">:n</span> <span class="org-string">"b"</span> #'elfeed-search-browse-url
      <span class="org-builtin">:n</span> <span class="org-string">"y"</span> #'elfeed-search-yank)
(<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> elfeed-show-mode-map
      <span class="org-builtin">:after</span> elfeed-show
      [remap kill-this-buffer] <span class="org-string">"q"</span>
      [remap kill-buffer] <span class="org-string">"q"</span>
      <span class="org-builtin">:n</span> doom-leader-key nil
      <span class="org-builtin">:nm</span> <span class="org-string">"q"</span> #'+rss/delete-pane
      <span class="org-builtin">:nm</span> <span class="org-string">"o"</span> #'ace-link-elfeed
      <span class="org-builtin">:nm</span> <span class="org-string">"RET"</span> #'org-ref-elfeed-add
      <span class="org-builtin">:nm</span> <span class="org-string">"n"</span> #'elfeed-show-next
      <span class="org-builtin">:nm</span> <span class="org-string">"N"</span> #'elfeed-show-prev
      <span class="org-builtin">:nm</span> <span class="org-string">"p"</span> #'elfeed-show-pdf
      <span class="org-builtin">:nm</span> <span class="org-string">"+"</span> #'elfeed-show-tag
      <span class="org-builtin">:nm</span> <span class="org-string">"-"</span> #'elfeed-show-untag
      <span class="org-builtin">:nm</span> <span class="org-string">"s"</span> #'elfeed-show-new-live-search
      <span class="org-builtin">:nm</span> <span class="org-string">"y"</span> #'elfeed-show-yank)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-usability-enhancements" class="outline-4">
<h4 id="usability-enhancements"><span class="section-number-4">5.3.2</span> Usability enhancements<a aria-hidden="true" href="#usability-enhancements">#</a> </h4>
<div class="outline-text-4" id="text-5-3-2">
<details id='usability-enhancements,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#usability-enhancements,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> elfeed-search
  (set-evil-initial-state! 'elfeed-search-mode 'normal))
(<span class="org-keyword">after!</span> elfeed-show-mode
  (set-evil-initial-state! 'elfeed-show-mode   'normal))

(<span class="org-keyword">after!</span> evil-snipe
  (<span class="org-keyword">push</span> 'elfeed-show-mode   evil-snipe-disabled-modes)
  (<span class="org-keyword">push</span> 'elfeed-search-mode evil-snipe-disabled-modes))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-visual-enhancements" class="outline-4">
<h4 id="visual-enhancements"><span class="section-number-4">5.3.3</span> Visual enhancements<a aria-hidden="true" href="#visual-enhancements">#</a> </h4>
<div class="outline-text-4" id="text-5-3-3">
<details id='visual-enhancements,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visual-enhancements,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> elfeed

  (elfeed-org)
  (<span class="org-keyword">use-package!</span> elfeed-link)

  (<span class="org-keyword">setq</span> elfeed-search-filter <span class="org-string">"@1-week-ago +unread"</span>
        elfeed-search-print-entry-function '+rss/elfeed-search-print-entry
        elfeed-search-title-min-width <span class="org-highlight-numbers-number">80</span>
        elfeed-show-entry-switch #'pop-to-buffer
        elfeed-show-entry-delete #'+rss/delete-pane
        elfeed-show-refresh-function #'+rss/elfeed-show-refresh--better-style
        shr-max-image-proportion <span class="org-highlight-numbers-number">0.6</span>)

  (<span class="org-keyword">add-hook!</span> 'elfeed-show-mode-hook (hide-mode-line-mode <span class="org-highlight-numbers-number">1</span>))
  (<span class="org-keyword">add-hook!</span> 'elfeed-search-update-hook #'hide-mode-line-mode)

  (<span class="org-keyword">defface</span> <span class="org-variable-name">elfeed-show-title-face</span> '((t (<span class="org-builtin">:weight</span> ultrabold <span class="org-builtin">:slant</span> italic <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.5</span>)))
    <span class="org-doc">"title face in elfeed show buffer"</span>
    <span class="org-builtin">:group</span> 'elfeed)
  (<span class="org-keyword">defface</span> <span class="org-variable-name">elfeed-show-author-face</span> `((t (<span class="org-builtin">:weight</span> light)))
    <span class="org-doc">"title face in elfeed show buffer"</span>
    <span class="org-builtin">:group</span> 'elfeed)
  (set-face-attribute 'elfeed-search-title-face nil
                      <span class="org-builtin">:foreground</span> 'nil
                      <span class="org-builtin">:weight</span> 'light)

  (<span class="org-keyword">defadvice!</span> +rss-elfeed-wrap-h-nicer ()
    <span class="org-doc">"Enhances an elfeed entry's readability by wrapping it to a width of</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">fill-column</span></span><span class="org-doc">' and centering it with `</span><span class="org-doc"><span class="org-constant">visual-fill-column-mode</span></span><span class="org-doc">'."</span>
    <span class="org-builtin">:override</span> #'+rss-elfeed-wrap-h
    (<span class="org-keyword">setq-local</span> truncate-lines nil
                shr-width <span class="org-highlight-numbers-number">120</span>
                visual-fill-column-center-text t
                default-text-properties '(line-height <span class="org-highlight-numbers-number">1.1</span>))
    (<span class="org-keyword">let</span> ((inhibit-read-only t)
          (inhibit-modification-hooks t))
      (visual-fill-column-mode)
      <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq-local shr-current-font '(:family "Merriweather" :height 1.2))</span>
      (set-buffer-modified-p nil)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+rss/elfeed-search-print-entry</span> (entry)
    <span class="org-doc">"Print ENTRY to the buffer."</span>
    (<span class="org-keyword">let*</span> ((elfeed-goodies/tag-column-width <span class="org-highlight-numbers-number">40</span>)
           (elfeed-goodies/feed-source-column-width <span class="org-highlight-numbers-number">30</span>)
           (title (<span class="org-keyword">or</span> (elfeed-meta entry <span class="org-builtin">:title</span>) (elfeed-entry-title entry) <span class="org-string">""</span>))
           (title-faces (elfeed-search--faces (elfeed-entry-tags entry)))
           (feed (elfeed-entry-feed entry))
           (feed-title
            (<span class="org-keyword">when</span> feed
              (<span class="org-keyword">or</span> (elfeed-meta feed <span class="org-builtin">:title</span>) (elfeed-feed-title feed))))
           (tags (mapcar #'symbol-name (elfeed-entry-tags entry)))
           (tags-str (concat (mapconcat 'identity tags <span class="org-string">","</span>)))
           (title-width (- (window-width) elfeed-goodies/feed-source-column-width
                           elfeed-goodies/tag-column-width <span class="org-highlight-numbers-number">4</span>))

           (tag-column (elfeed-format-column
                        tags-str (elfeed-clamp (length tags-str)
                                               elfeed-goodies/tag-column-width
                                               elfeed-goodies/tag-column-width)
                        <span class="org-builtin">:left</span>))
           (feed-column (elfeed-format-column
                         feed-title (elfeed-clamp elfeed-goodies/feed-source-column-width
                                                  elfeed-goodies/feed-source-column-width
                                                  elfeed-goodies/feed-source-column-width)
                         <span class="org-builtin">:left</span>)))

      (insert (propertize feed-column 'face 'elfeed-search-feed-face) <span class="org-string">" "</span>)
      (insert (propertize tag-column 'face 'elfeed-search-tag-face) <span class="org-string">" "</span>)
      (insert (propertize title 'face title-faces 'kbd-help title))
      (<span class="org-keyword">setq-local</span> line-spacing <span class="org-highlight-numbers-number">0.2</span>)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+rss/elfeed-show-refresh--better-style</span> ()
    <span class="org-doc">"Update the buffer to match the selected entry, using a mail-style."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let*</span> ((inhibit-read-only t)
           (title (elfeed-entry-title elfeed-show-entry))
           (date (seconds-to-time (elfeed-entry-date elfeed-show-entry)))
           (author (elfeed-meta elfeed-show-entry <span class="org-builtin">:author</span>))
           (link (elfeed-entry-link elfeed-show-entry))
           (tags (elfeed-entry-tags elfeed-show-entry))
           (tagsstr (mapconcat #'symbol-name tags <span class="org-string">", "</span>))
           (nicedate (format-time-string <span class="org-string">"%a, %e %b %Y %T %Z"</span> date))
           (content (elfeed-deref (elfeed-entry-content elfeed-show-entry)))
           (type (elfeed-entry-content-type elfeed-show-entry))
           (feed (elfeed-entry-feed elfeed-show-entry))
           (feed-title (elfeed-feed-title feed))
           (base (<span class="org-keyword">and</span> feed (elfeed-compute-base (elfeed-feed-url feed)))))
      (erase-buffer)
      (insert <span class="org-string">"\n"</span>)
      (insert (format <span class="org-string">"%s\n\n"</span> (propertize title 'face 'elfeed-show-title-face)))
      (insert (format <span class="org-string">"%s\t"</span> (propertize feed-title 'face 'elfeed-search-feed-face)))
      (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> author elfeed-show-entry-author)
        (insert (format <span class="org-string">"%s\n"</span> (propertize author 'face 'elfeed-show-author-face))))
      (insert (format <span class="org-string">"%s\n\n"</span> (propertize nicedate 'face 'elfeed-log-date-face)))
      (<span class="org-keyword">when</span> tags
        (insert (format <span class="org-string">"%s\n"</span>
                        (propertize tagsstr 'face 'elfeed-search-tag-face))))
      <span class="org-comment-delimiter">;; </span><span class="org-comment">(insert (propertize "Link: " 'face 'message-header-name))</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">(elfeed-insert-link link link)</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">(insert "\n")</span>
      (<span class="org-keyword">cl-loop</span> for enclosure in (elfeed-entry-enclosures elfeed-show-entry)
               do (insert (propertize <span class="org-string">"Enclosure: "</span> 'face 'message-header-name))
               do (elfeed-insert-link (car enclosure))
               do (insert <span class="org-string">"\n"</span>))
      (insert <span class="org-string">"\n"</span>)
      (<span class="org-keyword">if</span> content
          (<span class="org-keyword">if</span> (eq type 'html)
              (elfeed-insert-html content base)
            (insert content))
        (insert (propertize <span class="org-string">"(empty)\n"</span> 'face 'italic)))
      (goto-char (point-min))))

  )
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-functionality-enhancements" class="outline-4">
<h4 id="functionality-enhancements"><span class="section-number-4">5.3.4</span> Functionality enhancements<a aria-hidden="true" href="#functionality-enhancements">#</a> </h4>
<div class="outline-text-4" id="text-5-3-4">
<details id='functionality-enhancements,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#functionality-enhancements,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> elfeed-show
  (<span class="org-keyword">require</span> '<span class="org-constant">url</span>)

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">elfeed-pdf-dir</span>
    (expand-file-name <span class="org-string">"pdfs/"</span>
                      (file-name-directory (directory-file-name elfeed-enclosure-default-dir))))

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">elfeed-link-pdfs</span>
    '((<span class="org-string">"https://www.jstatsoft.org/index.php/jss/article/view/v0</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">/]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> . <span class="org-string">"https://www.jstatsoft.org/index.php/jss/article/view/v0\\1/v\\1.pdf"</span>)
      (<span class="org-string">"http://arxiv.org/abs/</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">/]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> . <span class="org-string">"https://arxiv.org/pdf/\\1.pdf"</span>))
    <span class="org-doc">"List of alists of the form (REGEX-FOR-LINK . FORM-FOR-PDF)"</span>)

  (<span class="org-keyword">defun</span> <span class="org-function-name">elfeed-show-pdf</span> (entry)
    (<span class="org-keyword">interactive</span>
     (list (<span class="org-keyword">or</span> elfeed-show-entry (elfeed-search-selected <span class="org-builtin">:ignore-region</span>))))
    (<span class="org-keyword">let</span> ((link (elfeed-entry-link entry))
          (feed-name (plist-get (elfeed-feed-meta (elfeed-entry-feed entry)) <span class="org-builtin">:title</span>))
          (title (elfeed-entry-title entry))
          (file-view-function
           (<span class="org-keyword">lambda</span> (f)
             (<span class="org-keyword">when</span> elfeed-show-entry
               (elfeed-kill-buffer))
             (pop-to-buffer (find-file-noselect f))))
          pdf)

      (<span class="org-keyword">let</span> ((file (expand-file-name
                   (concat (subst-char-in-string ?/ ?, title) <span class="org-string">".pdf"</span>)
                   (expand-file-name (subst-char-in-string ?/ ?, feed-name)
                                     elfeed-pdf-dir))))
        (<span class="org-keyword">if</span> (file-exists-p file)
            (funcall file-view-function file)
          (<span class="org-keyword">dolist</span> (link-pdf elfeed-link-pdfs)
            (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (string-match-p (car link-pdf) link)
                       (not pdf))
              (<span class="org-keyword">setq</span> pdf (replace-regexp-in-string (car link-pdf) (cdr link-pdf) link))))
          (<span class="org-keyword">if</span> (not pdf)
              (message <span class="org-string">"No associated PDF for entry"</span>)
            (message <span class="org-string">"Fetching %s"</span> pdf)
            (<span class="org-keyword">unless</span> (file-exists-p (file-name-directory file))
              (make-directory (file-name-directory file) t))
            (url-copy-file pdf file)
            (funcall file-view-function file))))))

  )
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-dictionary" class="outline-3">
<h3 id="dictionary"><span class="section-number-3">5.4</span> Dictionary<a aria-hidden="true" href="#dictionary">#</a> </h3>
<div class="outline-text-3" id="text-5-4">
<p>
We start off by loading <kbd>lexic</kbd>, then we&rsquo;ll integrate it into pre-existing
definition functionality (like <code>+lookup/dictionary-definition</code>).
</p>
<details id='dictionary,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#dictionary,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> lexic
  <span class="org-builtin">:commands</span> lexic-search lexic-list-dictionary
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> lexic-mode-map
        <span class="org-builtin">:n</span> <span class="org-string">"q"</span> #'lexic-return-from-lexic
        <span class="org-builtin">:nv</span> <span class="org-string">"RET"</span> #'lexic-search-word-at-point
        <span class="org-builtin">:n</span> <span class="org-string">"a"</span> #'outline-show-all
        <span class="org-builtin">:n</span> <span class="org-string">"h"</span> (<span class="org-keyword">cmd!</span> (outline-hide-sublevels <span class="org-highlight-numbers-number">3</span>))
        <span class="org-builtin">:n</span> <span class="org-string">"o"</span> #'lexic-toggle-entry
        <span class="org-builtin">:n</span> <span class="org-string">"n"</span> #'lexic-next-entry
        <span class="org-builtin">:n</span> <span class="org-string">"N"</span> (<span class="org-keyword">cmd!</span> (lexic-next-entry t))
        <span class="org-builtin">:n</span> <span class="org-string">"p"</span> #'lexic-previous-entry
        <span class="org-builtin">:n</span> <span class="org-string">"P"</span> (<span class="org-keyword">cmd!</span> (lexic-previous-entry t))
        <span class="org-builtin">:n</span> <span class="org-string">"E"</span> (<span class="org-keyword">cmd!</span> (lexic-return-from-lexic) <span class="org-comment-delimiter">; </span><span class="org-comment">expand</span>
                     (switch-to-buffer (lexic-get-buffer)))
        <span class="org-builtin">:n</span> <span class="org-string">"M"</span> (<span class="org-keyword">cmd!</span> (lexic-return-from-lexic) <span class="org-comment-delimiter">; </span><span class="org-comment">minimise</span>
                     (lexic-goto-lexic))
        <span class="org-builtin">:n</span> <span class="org-string">"C-p"</span> #'lexic-search-history-backwards
        <span class="org-builtin">:n</span> <span class="org-string">"C-n"</span> #'lexic-search-history-forwards
        <span class="org-builtin">:n</span> <span class="org-string">"/"</span> (<span class="org-keyword">cmd!</span> (call-interactively #'lexic-search))))
</pre>
</div>
    </details>

<p>
Now let&rsquo;s use this instead of wordnet.
</p>
<details id='dictionary,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#dictionary,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> +lookup/dictionary-definition-lexic (identifier <span class="org-type">&amp;optional</span> arg)
  <span class="org-doc">"Look up the definition of the word at point (or selection) using `</span><span class="org-doc"><span class="org-constant">lexic-search</span></span><span class="org-doc">'."</span>
  <span class="org-builtin">:override</span> #'+lookup/dictionary-definition
  (<span class="org-keyword">interactive</span>
   (list (<span class="org-keyword">or</span> (doom-thing-at-point-or-region 'word)
             (read-string <span class="org-string">"Look up in dictionary: "</span>))
         current-prefix-arg))
  (lexic-search identifier nil nil t))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-mail" class="outline-3">
<h3 id="mail"><span class="section-number-3">5.5</span> Mail<a aria-hidden="true" href="#mail">#</a> </h3>
<div class="outline-text-3" id="text-5-5">
<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/email.png' title="My New Year's resolution for 2014-54-12/30/14 Dec:12:1420001642 is to learn these stupid time formatting strings." alt='Email'>
</p>
</div>

<div id="outline-container-fetching" class="outline-4">
<h4 id="fetching"><span class="section-number-4">5.5.1</span> Fetching<a aria-hidden="true" href="#fetching">#</a> </h4>
<div class="outline-text-4" id="text-5-5-1">
<p>
The contenders for this seem to be:
</p>
<ul class="org-ul">
<li><a href="https://www.offlineimap.org/">OfflineIMAP</a> (<a href="https://wiki.archlinux.org/index.php/OfflineIMAP">ArchWiki page</a>)</li>
<li><a href="http://isync.sourceforge.net/mbsync.html">isync/mbsync</a> (<a href="https://wiki.archlinux.org/index.php/isync">ArchWiki page</a>)</li>
</ul>

<p>
From perusing r/emacs the prevailing opinion seems to be that
</p>
<ul class="org-ul">
<li>isync is faster</li>
<li>isync works more reliably</li>
</ul>
<p>
So let&rsquo;s use that.
</p>

<p>
The config was straightforward, and is located at <a href="file:///home/runner/.mbsyncrc">~/.mbsyncrc</a>.
I&rsquo;m currently successfully connecting to: Gmail, office365mail, and dovecot.
I&rsquo;m also shoving passwords in my <a href="file:///home/runner/.authinfo.gpg">authinfo.gpg</a> and fetching them using <code>PassCmd</code>:
</p>
<details id='fetching,code--1' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#fetching,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">gpg2 -q --for-your-eyes-only --no-tty -d ~/.authinfo.gpg | awk <span class="org-string">'/machine IMAP_SERCER login EMAIL_ADDR/ {print $NF}'</span>
</pre>
</div>
    </details>

<p>
We can run <code>mbsync -a</code> in a systemd service file or something, but we can do
better than that. <a href="https://github.com/vsemyonoff/easymail#usage">vsemyonoff/easymail</a> seems like the sort of thing we want, but
is written for <kbd>notmuch</kbd> unfortunately. We can still use it for inspiration though.
Using <a href="https://gitlab.com/shackra/goimapnotify">goimapnotify</a> we should be able to sync just after new
mail. Unfortunately this means <i>yet another</i> config file :(
</p>

<p>
We install with
</p>
<details id='fetching,code--2' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#fetching,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">go get -u gitlab.com/shackra/goimapnotify
<span class="org-type">ln</span> -s ~/.local/share/go/bin/goimapnotify ~/.local/bin/
</pre>
</div>
    </details>

<p>
Here&rsquo;s the general plan:
</p>
<ol class="org-ol">
<li>Use <code>goimapnotify</code> to monitor mailboxes
This needs it&rsquo;s own set of configs, and <kbd>systemd</kbd> services, which is a pain. We
remove this pain by writing a python script (found below) to setup these
config files, and systemd services by parsing the  <a href="file:///home/runner/.mbsyncrc">~/.mbsyncrc</a> file.</li>
<li>On new mail, call <code>mbsync --pull --new ACCOUNT:BOX</code>
We try to be as specific as possible, so <code>mbsync</code> returns as soon as possible,
and we can <i>get those emails as soon as possible</i>.</li>
<li>Try to call <code>mu index --lazy-fetch</code>.
This fails if mu4e is already open (due to a write lock on the database), so
in that case we just <code>touch</code> a tmp file (<kbd>/tmp/mu_reindex_now</kbd>).</li>
<li>Separately, we set up Emacs to check for the existance of
<kbd>/tmp/mu_reindex_now</kbd> once a second while mu4e is
running, and (after deleting the file) call <code>mu4e-update-index</code>.</li>
</ol>

<p>
Let&rsquo;s start off by handling the elisp side of things
</p>
</div>

<div id="outline-container-rebuild-mail-index" class="outline-5">
<h5 id="rebuild-mail-index"><span class="section-number-5">5.5.1.1</span> Rebuild mail index while using mu4e<a aria-hidden="true" href="#rebuild-mail-index">#</a> </h5>
<div class="outline-text-5" id="text-5-5-1-1">
<details id='rebuild-mail-index,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#rebuild-mail-index,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> mu4e
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">mu4e-reindex-request-file</span> <span class="org-string">"/tmp/mu_reindex_now"</span>
    <span class="org-doc">"Location of the reindex request, signaled by existance"</span>)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">mu4e-reindex-request-min-seperation</span> <span class="org-highlight-numbers-number">5.0</span>
    <span class="org-doc">"Don't refresh again until this many second have elapsed.</span>
<span class="org-doc">Prevents a series of redisplays from being called (when set to an appropriate value)"</span>)

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">mu4e-reindex-request--file-watcher</span> nil)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">mu4e-reindex-request--file-just-deleted</span> nil)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">mu4e-reindex-request--last-time</span> <span class="org-highlight-numbers-number">0</span>)

  (<span class="org-keyword">defun</span> <span class="org-function-name">mu4e-reindex-request--add-watcher</span> ()
    (<span class="org-keyword">setq</span> mu4e-reindex-request--file-just-deleted nil)
    (<span class="org-keyword">setq</span> mu4e-reindex-request--file-watcher
          (file-notify-add-watch mu4e-reindex-request-file
                                 '(change)
                                 #'mu4e-file-reindex-request)))

  (<span class="org-keyword">defadvice!</span> mu4e-stop-watching-for-reindex-request ()
    <span class="org-builtin">:after</span> #'mu4e~proc-kill
    (<span class="org-keyword">if</span> mu4e-reindex-request--file-watcher
        (file-notify-rm-watch mu4e-reindex-request--file-watcher)))

  (<span class="org-keyword">defadvice!</span> mu4e-watch-for-reindex-request ()
    <span class="org-builtin">:after</span> #'mu4e~proc-start
    (mu4e-stop-watching-for-reindex-request)
    (<span class="org-keyword">when</span> (file-exists-p mu4e-reindex-request-file)
      (delete-file mu4e-reindex-request-file))
    (mu4e-reindex-request--add-watcher))

  (<span class="org-keyword">defun</span> <span class="org-function-name">mu4e-file-reindex-request</span> (event)
    <span class="org-doc">"Act based on the existance of `</span><span class="org-doc"><span class="org-constant">mu4e-reindex-request-file</span></span><span class="org-doc">'"</span>
    (<span class="org-keyword">if</span> mu4e-reindex-request--file-just-deleted
        (mu4e-reindex-request--add-watcher)
      (<span class="org-keyword">when</span> (equal (nth <span class="org-highlight-numbers-number">1</span> event) 'created)
        (delete-file mu4e-reindex-request-file)
        (<span class="org-keyword">setq</span> mu4e-reindex-request--file-just-deleted t)
        (mu4e-reindex-maybe t))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">mu4e-reindex-maybe</span> (<span class="org-type">&amp;optional</span> new-request)
    <span class="org-doc">"Run `</span><span class="org-doc"><span class="org-constant">mu4e~proc-index</span></span><span class="org-doc">' if it's been more than</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">mu4e-reindex-request-min-seperation</span></span><span class="org-doc">'seconds since the last request,"</span>
    (<span class="org-keyword">let</span> ((time-since-last-request (- (float-time)
                                      mu4e-reindex-request--last-time)))
      (<span class="org-keyword">when</span> new-request
        (<span class="org-keyword">setq</span> mu4e-reindex-request--last-time (float-time)))
      (<span class="org-keyword">if</span> (&gt; time-since-last-request mu4e-reindex-request-min-seperation)
          (mu4e~proc-index nil t)
        (<span class="org-keyword">when</span> new-request
          (run-at-time (* <span class="org-highlight-numbers-number">1.1</span> mu4e-reindex-request-min-seperation) nil
                       #'mu4e-reindex-maybe))))))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-config-transcoding-service" class="outline-5">
<h5 id="config-transcoding-service"><span class="section-number-5">5.5.1.2</span> Config transcoding &amp; service management<a aria-hidden="true" href="#config-transcoding-service">#</a> </h5>
<div class="outline-text-5" id="text-5-5-1-2">
<p>
As long as the <kbd>mbsyncrc</kbd> file exists, this is as easy as running
</p>
<details id='config-transcoding-service,code--1' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#config-transcoding-service,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">~/.config/doom/misc/mbsync-imapnotify.py
</pre>
</div>
    </details>

<p>
When run without flags this will perform the following actions
</p>
<ul class="org-ul">
<li>Read, and parse <a href="file:///home/runner/.mbsyncrc">~/.mbsyncrc</a>, specifically recognising the following properties
<ul class="org-ul">
<li><code>IMAPAccount</code></li>
<li><code>Host</code></li>
<li><code>Port</code></li>
<li><code>User</code></li>
<li><code>Password</code></li>
<li><code>PassCmd</code></li>
<li><code>Patterns</code></li>
</ul></li>
<li>Call <code>mbsync --list ACCOUNT</code>, and filter results according to <code>Patterns</code></li>
<li>Construct a imapnotify config for each account, with the following hooks
<dl class="org-dl">
<dt>onNewMail</dt><dd></dd>

<dt>onNewMailPost</dt><dd></dd>
</dl></li>
<li>Compare accounts list to previous accounts, enable/disable the relevant
systemd services, called with the <code>--now</code> flag (start/stop services as well)</li>
</ul>

<p>
This script also supports the following flags
</p>
<ul class="org-ul">
<li><code>--status</code> to get the status of the relevant systemd services supports <kbd>active</kbd>,
<kbd>failing</kbd>, and <kbd>disabled</kbd></li>
<li><code>--enable</code> to enable all relevant systemd services</li>
<li><code>--disable</code> to disable all relevant systemd services</li>
</ul>
<details id='config-transcoding-service,code--2' class='code' open><summary><span class="lang">Python</span></summary>
    <div class='gutter'>
    <a href='#config-transcoding-service,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> pathlib <span class="org-keyword">import</span> Path
<span class="org-keyword">import</span> json
<span class="org-keyword">import</span> re
<span class="org-keyword">import</span> shutil
<span class="org-keyword">import</span> subprocess
<span class="org-keyword">import</span> sys
<span class="org-keyword">import</span> fnmatch

<span class="org-variable-name">mbsyncFile</span> = Path(<span class="org-string">"~/.mbsyncrc"</span>).expanduser()

<span class="org-variable-name">imapnotifyConfigFolder</span> = Path(<span class="org-string">"~/.config/imapnotify/"</span>).expanduser()
imapnotifyConfigFolder.mkdir(exist_ok=<span class="org-constant">True</span>)
<span class="org-variable-name">imapnotifyConfigFilename</span> = <span class="org-string">"notify.conf"</span>

<span class="org-variable-name">imapnotifyDefault</span> = {
    <span class="org-string">"host"</span>: <span class="org-string">""</span>,
    <span class="org-string">"port"</span>: <span class="org-highlight-numbers-number">993</span>,
    <span class="org-string">"tls"</span>: <span class="org-constant">True</span>,
    <span class="org-string">"tlsOptions"</span>: {<span class="org-string">"rejectUnauthorized"</span>: <span class="org-constant">True</span>},
    <span class="org-string">"onNewMail"</span>: <span class="org-string">""</span>,
    <span class="org-string">"onNewMailPost"</span>: <span class="org-string">"if mu index --lazy-check; then test -f /tmp/mu_reindex_now &amp;&amp; rm /tmp/mu_reindex_now; else touch /tmp/mu_reindex_now; fi"</span>,
}


<span class="org-keyword">def</span> <span class="org-function-name">stripQuotes</span>(string):
    <span class="org-keyword">if</span> string[<span class="org-highlight-numbers-number">0</span>] == <span class="org-string">'"'</span> <span class="org-keyword">and</span> string[-<span class="org-highlight-numbers-number">1</span>] == <span class="org-string">'"'</span>:
        <span class="org-keyword">return</span> string[<span class="org-highlight-numbers-number">1</span>:-<span class="org-highlight-numbers-number">1</span>].replace(<span class="org-string">'\\"'</span>, <span class="org-string">'"'</span>)


<span class="org-variable-name">mbsyncInotifyMapping</span> = {
    <span class="org-string">"Host"</span>: (<span class="org-builtin">str</span>, <span class="org-string">"host"</span>),
    <span class="org-string">"Port"</span>: (<span class="org-builtin">int</span>, <span class="org-string">"port"</span>),
    <span class="org-string">"User"</span>: (<span class="org-builtin">str</span>, <span class="org-string">"username"</span>),
    <span class="org-string">"Password"</span>: (<span class="org-builtin">str</span>, <span class="org-string">"password"</span>),
    <span class="org-string">"PassCmd"</span>: (stripQuotes, <span class="org-string">"passwordCmd"</span>),
    <span class="org-string">"Patterns"</span>: (<span class="org-builtin">str</span>, <span class="org-string">"_patterns"</span>),
}

<span class="org-variable-name">oldAccounts</span> = [d.name <span class="org-keyword">for</span> d <span class="org-keyword">in</span> imapnotifyConfigFolder.iterdir() <span class="org-keyword">if</span> d.is_dir()]

<span class="org-variable-name">currentAccount</span> = <span class="org-string">""</span>
<span class="org-variable-name">currentAccountData</span> = {}

<span class="org-variable-name">successfulAdditions</span> = []


<span class="org-keyword">def</span> <span class="org-function-name">processLine</span>(line):
    <span class="org-variable-name">newAcc</span> = re.match(r<span class="org-string">"^IMAPAccount ([^#]+)"</span>, line)

    <span class="org-variable-name">linecontent</span> = re.sub(r<span class="org-string">"(^|[^\\])#.*"</span>, <span class="org-string">""</span>, line).split(<span class="org-string">" "</span>, <span class="org-highlight-numbers-number">1</span>)
    <span class="org-keyword">if</span> <span class="org-builtin">len</span>(linecontent) != <span class="org-highlight-numbers-number">2</span>:
        <span class="org-keyword">return</span>

    <span class="org-variable-name">parameter</span>, <span class="org-variable-name">value</span> = linecontent

    <span class="org-keyword">if</span> parameter == <span class="org-string">"IMAPAccount"</span>:
        <span class="org-keyword">if</span> currentAccountNumber &gt; <span class="org-highlight-numbers-number">0</span>:
            finaliseAccount()
        newAccount(value)
    <span class="org-keyword">elif</span> parameter <span class="org-keyword">in</span> mbsyncInotifyMapping.keys():
        <span class="org-variable-name">parser</span>, <span class="org-variable-name">key</span> = mbsyncInotifyMapping[parameter]
        <span class="org-variable-name">currentAccountData</span>[key] = parser(value)
    <span class="org-keyword">elif</span> parameter == <span class="org-string">"Channel"</span>:
        <span class="org-variable-name">currentAccountData</span>[<span class="org-string">"onNewMail"</span>] = f<span class="org-string">"mbsync --pull --new {value}:'%s'"</span>


<span class="org-keyword">def</span> <span class="org-function-name">newAccount</span>(name):
    <span class="org-keyword">global</span> currentAccountNumber
    <span class="org-keyword">global</span> currentAccount
    <span class="org-keyword">global</span> currentAccountData
    <span class="org-variable-name">currentAccountNumber</span> += <span class="org-highlight-numbers-number">1</span>
    <span class="org-variable-name">currentAccount</span> = name
    <span class="org-variable-name">currentAccountData</span> = {}
    <span class="org-keyword">print</span>(f<span class="org-string">"\n\033[1;32m{currentAccountNumber}\033[0;32m - {name}\033[0;37m"</span>)


<span class="org-keyword">def</span> <span class="org-function-name">accountToFoldername</span>(name):
    <span class="org-keyword">return</span> re.sub(r<span class="org-string">"[^A-Za-z0-9]"</span>, <span class="org-string">""</span>, name)


<span class="org-keyword">def</span> <span class="org-function-name">finaliseAccount</span>():
    <span class="org-keyword">if</span> currentAccountNumber == <span class="org-highlight-numbers-number">0</span>:
        <span class="org-keyword">return</span>

    <span class="org-keyword">global</span> currentAccountData
    <span class="org-keyword">try</span>:
        <span class="org-variable-name">currentAccountData</span>[<span class="org-string">"boxes"</span>] = getMailBoxes(currentAccount)
    <span class="org-keyword">except</span> subprocess.CalledProcessError <span class="org-keyword">as</span> e:
        <span class="org-keyword">print</span>(
            f<span class="org-string">"\033[1;31mError:\033[0;31m failed to fetch mailboxes (skipping): "</span>
            + f<span class="org-string">"`{' '.join(e.cmd)}' returned code {e.returncode}\033[0;37m"</span>
        )
        <span class="org-keyword">return</span>
    <span class="org-keyword">except</span> subprocess.TimeoutExpired <span class="org-keyword">as</span> e:
        <span class="org-keyword">print</span>(
            f<span class="org-string">"\033[1;31mError:\033[0;31m failed to fetch mailboxes (skipping): "</span>
            + f<span class="org-string">"`{' '.join(e.cmd)}' timed out after {e.timeout:.2f} seconds\033[0;37m"</span>
        )
        <span class="org-keyword">return</span>

    <span class="org-keyword">if</span> <span class="org-string">"_patterns"</span> <span class="org-keyword">in</span> currentAccountData:
        currentAccountData[<span class="org-string">"boxes"</span>] = applyPatternFilter(
            currentAccountData[<span class="org-string">"_patterns"</span>], currentAccountData[<span class="org-string">"boxes"</span>]
        )

    <span class="org-comment-delimiter"># </span><span class="org-comment">strip not-to-be-exported data</span>
    <span class="org-variable-name">currentAccountData</span> = {
        k: currentAccountData[k] <span class="org-keyword">for</span> k <span class="org-keyword">in</span> currentAccountData <span class="org-keyword">if</span> k[<span class="org-highlight-numbers-number">0</span>] != <span class="org-string">"_"</span>
    }

    <span class="org-variable-name">parametersSet</span> = currentAccountData.keys()
    <span class="org-variable-name">currentAccountData</span> = {**imapnotifyDefault, **currentAccountData}
    <span class="org-keyword">for</span> key, val <span class="org-keyword">in</span> currentAccountData.items():
        <span class="org-variable-name">valColor</span> = <span class="org-string">"\033[0;33m"</span> <span class="org-keyword">if</span> key <span class="org-keyword">in</span> parametersSet <span class="org-keyword">else</span> <span class="org-string">"\033[0;37m"</span>
        <span class="org-keyword">print</span>(f<span class="org-string">"  \033[1;37m{key:&lt;13} {valColor}{val}\033[0;37m"</span>)

    <span class="org-keyword">if</span> (
            <span class="org-builtin">len</span>(currentAccountData[<span class="org-string">"boxes"</span>]) &gt; <span class="org-highlight-numbers-number">15</span>
            <span class="org-keyword">and</span> <span class="org-string">"@gmail.com"</span> <span class="org-keyword">in</span> currentAccountData[<span class="org-string">"username"</span>]
    ):
        <span class="org-keyword">print</span>(
            <span class="org-string">"  \033[1;31mWarning:\033[0;31m Gmail raises an error when more than"</span>
            + <span class="org-string">"\033[1;31m15\033[0;31m simultanious connections are attempted."</span>
            + <span class="org-string">"\n           You are attempting to monitor "</span>
            + f<span class="org-string">"\033[1;31m{len(currentAccountData['boxes'])}\033[0;31m mailboxes.\033[0;37m"</span>
        )

    <span class="org-variable-name">configFile</span> = (
        imapnotifyConfigFolder
        / accountToFoldername(currentAccount)
        / imapnotifyConfigFilename
    )
    configFile.parent.mkdir(exist_ok=<span class="org-constant">True</span>)

    json.dump(currentAccountData, <span class="org-builtin">open</span>(configFile, <span class="org-string">"w"</span>), indent=<span class="org-highlight-numbers-number">2</span>)
    <span class="org-keyword">print</span>(f<span class="org-string">" \033[0;35mConfig generated and saved to {configFile}\033[0;37m"</span>)

    <span class="org-keyword">global</span> successfulAdditions
    successfulAdditions.append(accountToFoldername(currentAccount))


<span class="org-keyword">def</span> <span class="org-function-name">getMailBoxes</span>(account):
    <span class="org-variable-name">boxes</span> = subprocess.run(
        [<span class="org-string">"mbsync"</span>, <span class="org-string">"--list"</span>, account], check=<span class="org-constant">True</span>, stdout=subprocess.PIPE, timeout=<span class="org-highlight-numbers-number">10.0</span>
    )
    <span class="org-keyword">return</span> boxes.stdout.decode(<span class="org-string">"utf-8"</span>).strip().split(<span class="org-string">"\n"</span>)


<span class="org-keyword">def</span> <span class="org-function-name">applyPatternFilter</span>(pattern, mailboxes):
    <span class="org-variable-name">patternRegexs</span> = getPatternRegexes(pattern)
    <span class="org-keyword">return</span> [m <span class="org-keyword">for</span> m <span class="org-keyword">in</span> mailboxes <span class="org-keyword">if</span> testPatternRegexs(patternRegexs, m)]


<span class="org-keyword">def</span> <span class="org-function-name">getPatternRegexes</span>(pattern):
    <span class="org-keyword">def</span> <span class="org-function-name">addGlob</span>(b):
        blobs.append(b.replace(<span class="org-string">'\\"'</span>, <span class="org-string">'"'</span>))
        <span class="org-keyword">return</span> <span class="org-string">""</span>

    <span class="org-variable-name">blobs</span> = []
    <span class="org-variable-name">pattern</span> = re.sub(r<span class="org-string">' ?"([^"]+)"'</span>, <span class="org-keyword">lambda</span> m: addGlob(m.groups()[<span class="org-highlight-numbers-number">0</span>]), pattern)
    blobs.extend(pattern.split(<span class="org-string">" "</span>))
    <span class="org-variable-name">blobs</span> = [
        (-<span class="org-highlight-numbers-number">1</span>, fnmatch.translate(b[<span class="org-highlight-numbers-number">1</span>::])) <span class="org-keyword">if</span> b[<span class="org-highlight-numbers-number">0</span>] == <span class="org-string">"!"</span> <span class="org-keyword">else</span> (<span class="org-highlight-numbers-number">1</span>, fnmatch.translate(b))
        <span class="org-keyword">for</span> b <span class="org-keyword">in</span> blobs
    ]
    <span class="org-keyword">return</span> blobs


<span class="org-keyword">def</span> <span class="org-function-name">testPatternRegexs</span>(regexCond, case):
    <span class="org-keyword">for</span> factor, regex <span class="org-keyword">in</span> regexCond:
        <span class="org-keyword">if</span> factor * <span class="org-builtin">bool</span>(re.match(regex, case)) &lt; <span class="org-highlight-numbers-number">0</span>:
            <span class="org-keyword">return</span> <span class="org-constant">False</span>
    <span class="org-keyword">return</span> <span class="org-constant">True</span>


<span class="org-keyword">def</span> <span class="org-function-name">processSystemdServices</span>():
    <span class="org-variable-name">keptAccounts</span> = [acc <span class="org-keyword">for</span> acc <span class="org-keyword">in</span> successfulAdditions <span class="org-keyword">if</span> acc <span class="org-keyword">in</span> oldAccounts]
    <span class="org-variable-name">freshAccounts</span> = [acc <span class="org-keyword">for</span> acc <span class="org-keyword">in</span> successfulAdditions <span class="org-keyword">if</span> acc <span class="org-keyword">not</span> <span class="org-keyword">in</span> oldAccounts]
    <span class="org-variable-name">staleAccounts</span> = [acc <span class="org-keyword">for</span> acc <span class="org-keyword">in</span> oldAccounts <span class="org-keyword">if</span> acc <span class="org-keyword">not</span> <span class="org-keyword">in</span> successfulAdditions]

    <span class="org-keyword">if</span> keptAccounts:
        <span class="org-keyword">print</span>(f<span class="org-string">"\033[1;34m{len(keptAccounts)}\033[0;34m kept accounts:\033[0;37m"</span>)
        restartAccountSystemdServices(keptAccounts)

    <span class="org-keyword">if</span> freshAccounts:
        <span class="org-keyword">print</span>(f<span class="org-string">"\033[1;32m{len(freshAccounts)}\033[0;32m new accounts:\033[0;37m"</span>)
        enableAccountSystemdServices(freshAccounts)
    <span class="org-keyword">else</span>:
        <span class="org-keyword">print</span>(f<span class="org-string">"\033[0;32mNo new accounts.\033[0;37m"</span>)

    <span class="org-variable-name">notActuallyEnabledAccounts</span> = [
        acc <span class="org-keyword">for</span> acc <span class="org-keyword">in</span> successfulAdditions <span class="org-keyword">if</span> <span class="org-keyword">not</span> getAccountServiceState(acc)[<span class="org-string">"enabled"</span>]
    ]
    <span class="org-keyword">if</span> notActuallyEnabledAccounts:
        <span class="org-keyword">print</span>(
            f<span class="org-string">"\033[1;32m{len(notActuallyEnabledAccounts)}\033[0;32m accounts need re-enabling:\033[0;37m"</span>
        )
        enableAccountSystemdServices(notActuallyEnabledAccounts)

    <span class="org-keyword">if</span> staleAccounts:
        <span class="org-keyword">print</span>(f<span class="org-string">"\033[1;33m{len(staleAccounts)}\033[0;33m removed accounts:\033[0;37m"</span>)
        disableAccountSystemdServices(staleAccounts)
    <span class="org-keyword">else</span>:
        <span class="org-keyword">print</span>(f<span class="org-string">"\033[0;33mNo removed accounts.\033[0;37m"</span>)


<span class="org-keyword">def</span> <span class="org-function-name">enableAccountSystemdServices</span>(accounts):
    <span class="org-keyword">for</span> account <span class="org-keyword">in</span> accounts:
        <span class="org-keyword">print</span>(f<span class="org-string">" \033[0;32m - \033[1;37m{account:&lt;18}"</span>, end=<span class="org-string">"\033[0;37m"</span>, flush=<span class="org-constant">True</span>)
        <span class="org-keyword">if</span> setSystemdServiceState(
                <span class="org-string">"enable"</span>, f<span class="org-string">"goimapnotify@{accountToFoldername(account)}.service"</span>
        ):
            <span class="org-keyword">print</span>(<span class="org-string">"\033[1;32m enabled"</span>)


<span class="org-keyword">def</span> <span class="org-function-name">disableAccountSystemdServices</span>(accounts):
    <span class="org-keyword">for</span> account <span class="org-keyword">in</span> accounts:
        <span class="org-keyword">print</span>(f<span class="org-string">" \033[0;33m - \033[1;37m{account:&lt;18}"</span>, end=<span class="org-string">"\033[0;37m"</span>, flush=<span class="org-constant">True</span>)
        <span class="org-keyword">if</span> setSystemdServiceState(
                <span class="org-string">"disable"</span>, f<span class="org-string">"goimapnotify@{accountToFoldername(account)}.service"</span>
        ):
            <span class="org-keyword">print</span>(<span class="org-string">"\033[1;33m disabled"</span>)


<span class="org-keyword">def</span> <span class="org-function-name">restartAccountSystemdServices</span>(accounts):
    <span class="org-keyword">for</span> account <span class="org-keyword">in</span> accounts:
        <span class="org-keyword">print</span>(f<span class="org-string">" \033[0;34m - \033[1;37m{account:&lt;18}"</span>, end=<span class="org-string">"\033[0;37m"</span>, flush=<span class="org-constant">True</span>)
        <span class="org-keyword">if</span> setSystemdServiceState(
                <span class="org-string">"restart"</span>, f<span class="org-string">"goimapnotify@{accountToFoldername(account)}.service"</span>
        ):
            <span class="org-keyword">print</span>(<span class="org-string">"\033[1;34m restarted"</span>)


<span class="org-keyword">def</span> <span class="org-function-name">setSystemdServiceState</span>(state, service):
    <span class="org-keyword">try</span>:
        <span class="org-variable-name">enabler</span> = subprocess.run(
            [<span class="org-string">"systemctl"</span>, <span class="org-string">"--user"</span>, state, service, <span class="org-string">"--now"</span>],
            check=<span class="org-constant">True</span>,
            stderr=subprocess.DEVNULL,
            timeout=<span class="org-highlight-numbers-number">5.0</span>,
        )
        <span class="org-keyword">return</span> <span class="org-constant">True</span>
    <span class="org-keyword">except</span> subprocess.CalledProcessError <span class="org-keyword">as</span> e:
        <span class="org-keyword">print</span>(
            f<span class="org-string">" \033[1;31mfailed\033[0;31m to {state}, `{' '.join(e.cmd)}'"</span>
            + f<span class="org-string">"returned code {e.returncode}\033[0;37m"</span>
        )
    <span class="org-keyword">except</span> subprocess.TimeoutExpired <span class="org-keyword">as</span> e:
        <span class="org-keyword">print</span>(f<span class="org-string">" \033[1;31mtimed out after {e.timeout:.2f} seconds\033[0;37m"</span>)
        <span class="org-keyword">return</span> <span class="org-constant">False</span>


<span class="org-keyword">def</span> <span class="org-function-name">getAccountServiceState</span>(account):
    <span class="org-keyword">return</span> {
        state: <span class="org-builtin">bool</span>(
            <span class="org-highlight-numbers-number">1</span>
            - subprocess.run(
                [
                    <span class="org-string">"systemctl"</span>,
                    <span class="org-string">"--user"</span>,
                    f<span class="org-string">"is-{state}"</span>,
                    <span class="org-string">"--quiet"</span>,
                    f<span class="org-string">"goimapnotify@{accountToFoldername(account)}.service"</span>,
                ],
                stderr=subprocess.DEVNULL,
            ).returncode
        )
        <span class="org-keyword">for</span> state <span class="org-keyword">in</span> (<span class="org-string">"enabled"</span>, <span class="org-string">"active"</span>, <span class="org-string">"failing"</span>)
    }


<span class="org-keyword">def</span> <span class="org-function-name">getAccountServiceStates</span>(accounts):
    <span class="org-keyword">for</span> account <span class="org-keyword">in</span> accounts:
        <span class="org-variable-name">enabled</span>, <span class="org-variable-name">active</span>, <span class="org-variable-name">failing</span> = getAccountServiceState(account).values()
        <span class="org-keyword">print</span>(f<span class="org-string">"  - \033[1;37m{account:&lt;18}\033[0;37m "</span>, end=<span class="org-string">""</span>, flush=<span class="org-constant">True</span>)
        <span class="org-keyword">if</span> <span class="org-keyword">not</span> enabled:
            <span class="org-keyword">print</span>(<span class="org-string">"\033[1;33mdisabled\033[0;37m"</span>)
        <span class="org-keyword">elif</span> active:
            <span class="org-keyword">print</span>(<span class="org-string">"\033[1;32mactive\033[0;37m"</span>)
        <span class="org-keyword">elif</span> failing:
            <span class="org-keyword">print</span>(<span class="org-string">"\033[1;31mfailing\033[0;37m"</span>)
        <span class="org-keyword">else</span>:
            <span class="org-keyword">print</span>(<span class="org-string">"\033[1;35min an unrecognised state\033[0;37m"</span>)


<span class="org-keyword">if</span> <span class="org-builtin">len</span>(sys.argv) &gt; <span class="org-highlight-numbers-number">1</span>:
    <span class="org-keyword">if</span> sys.argv[<span class="org-highlight-numbers-number">1</span>]   <span class="org-keyword">in</span> [<span class="org-string">"-e"</span>, <span class="org-string">"--enable"</span>]:
        enableAccountSystemdServices(oldAccounts)
        <span class="org-constant">exit</span>()
    <span class="org-keyword">elif</span> sys.argv[<span class="org-highlight-numbers-number">1</span>] <span class="org-keyword">in</span> [<span class="org-string">"-d"</span>, <span class="org-string">"--disable"</span>]:
        disableAccountSystemdServices(oldAccounts)
        <span class="org-constant">exit</span>()
    <span class="org-keyword">elif</span> sys.argv[<span class="org-highlight-numbers-number">1</span>] <span class="org-keyword">in</span> [<span class="org-string">"-r"</span>, <span class="org-string">"--restart"</span>]:
        restartAccountSystemdServices(oldAccounts)
        <span class="org-constant">exit</span>()
    <span class="org-keyword">elif</span> sys.argv[<span class="org-highlight-numbers-number">1</span>] <span class="org-keyword">in</span> [<span class="org-string">"-s"</span>, <span class="org-string">"--status"</span>]:
        getAccountServiceStates(oldAccounts)
        <span class="org-constant">exit</span>()
    <span class="org-keyword">elif</span> sys.argv[<span class="org-highlight-numbers-number">1</span>] <span class="org-keyword">in</span> [<span class="org-string">"-h"</span>, <span class="org-string">"--help"</span>]:
        <span class="org-keyword">print</span>(<span class="org-string">"""\033[1;37mMbsync to IMAP Notify config generator.\033[0;37m</span>

<span class="org-string">Usage: mbsync-imapnotify [options]</span>

<span class="org-string">Options:</span>
<span class="org-string">    -e, --enable       enable all services</span>
<span class="org-string">    -d, --disable      disable all services</span>
<span class="org-string">    -r, --restart      restart all services</span>
<span class="org-string">    -s, --status       fetch the status for all services</span>
<span class="org-string">    -h, --help         show this help</span>
<span class="org-string">"""</span>, end=<span class="org-string">''</span>)
        <span class="org-constant">exit</span>()
    <span class="org-keyword">else</span>:
        <span class="org-keyword">print</span>(f<span class="org-string">"\033[0;31mFlag {sys.argv[1]} not recognised, try --help\033[0;37m"</span>)
        <span class="org-constant">exit</span>()


<span class="org-variable-name">mbsyncData</span> = <span class="org-builtin">open</span>(mbsyncFile, <span class="org-string">"r"</span>).read()

<span class="org-variable-name">currentAccountNumber</span> = <span class="org-highlight-numbers-number">0</span>

<span class="org-variable-name">totalAccounts</span> = <span class="org-builtin">len</span>(re.findall(r<span class="org-string">"^IMAPAccount"</span>, mbsyncData, re.M))


<span class="org-keyword">def</span> <span class="org-function-name">main</span>():
    <span class="org-keyword">print</span>(<span class="org-string">"\033[1;34m:: MbSync to Go IMAP notify config file creator ::\033[0;37m"</span>)

    shutil.rmtree(imapnotifyConfigFolder)
    imapnotifyConfigFolder.mkdir(exist_ok=<span class="org-constant">False</span>)
    <span class="org-keyword">print</span>(<span class="org-string">"\033[1;30mImap Notify config dir purged\033[0;37m"</span>)

    <span class="org-keyword">print</span>(f<span class="org-string">"Identified \033[1;32m{totalAccounts}\033[0;32m accounts.\033[0;37m"</span>)

    <span class="org-keyword">for</span> line <span class="org-keyword">in</span> mbsyncData.split(<span class="org-string">"\n"</span>):
        processLine(line)

    finaliseAccount()

    <span class="org-keyword">print</span>(
        f<span class="org-string">"\nConfig files generated for \033[1;36m{len(successfulAdditions)}\033[0;36m"</span>
        + f<span class="org-string">" out of \033[1;36m{totalAccounts}\033[0;37m accounts.\n"</span>
    )

    processSystemdServices()


<span class="org-keyword">if</span> <span class="org-builtin">__name__</span> == <span class="org-string">"__main__"</span>:
    main()
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-fetching-systemd" class="outline-5">
<h5 id="fetching-systemd"><span class="section-number-5">5.5.1.3</span> Systemd<a aria-hidden="true" href="#fetching-systemd">#</a> </h5>
<div class="outline-text-5" id="text-5-5-1-3">
<p>
We then have a service file to run <code>goimapnotify</code> on all of these generated config files.
We&rsquo;ll use a template service file so we can enable a unit per-account.
</p>
<details id='systemd,code--2' class='code' open><summary><span class="lang">systemd</span></summary>
    <div class='gutter'>
    <a href='#systemd,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-systemd"><span class="org-type">[Unit]</span>
<span class="org-keyword">Description</span>=IMAP notifier using IDLE, golang version.
<span class="org-keyword">ConditionPathExists</span>=<span class="org-constant">%h</span>/.config/imapnotify/<span class="org-constant">%I</span>/notify.conf
<span class="org-keyword">After</span>=network.target

<span class="org-type">[Service]</span>
<span class="org-keyword">ExecStart</span>=<span class="org-constant">%h</span>/.local/bin/goimapnotify -conf <span class="org-constant">%h</span>/.config/imapnotify/<span class="org-constant">%I</span>/notify.conf
<span class="org-keyword">Restart</span>=<span class="org-builtin">always</span>
<span class="org-keyword">RestartSec</span>=<span class="org-highlight-numbers-number">30</span>

<span class="org-type">[Install]</span>
<span class="org-keyword">WantedBy</span>=default.target
</pre>
</div>
    </details>

<p>
Enabling the service is actually taken care of by that python script.
</p>

<p>
From one or two small tests, this can bring the delay down to as low as five
seconds, which I&rsquo;m quite happy with.
</p>

<p>
This works well for fetching new mail, but we also want to propagate other
changes (e.g. marking mail as read), and make sure we&rsquo;re up to date at the
start, so for that I&rsquo;ll do the &rsquo;normal&rsquo; thing and run <code>mbsync -all</code> every so often
&#x2014; let&rsquo;s say five minutes.
</p>

<p>
We can accomplish this via a systemd timer, and service file.
</p>
<details id='systemd,code--3' class='code' open><summary><span class="lang">systemd</span></summary>
    <div class='gutter'>
    <a href='#systemd,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-systemd"><span class="org-type">[Unit]</span>
<span class="org-keyword">Description</span>=call mbsync on all accounts every <span class="org-highlight-numbers-number">5</span> minutes
<span class="org-keyword">ConditionPathExists</span>=<span class="org-constant">%h</span>/.mbsyncrc

<span class="org-type">[Timer]</span>
<span class="org-keyword">OnBootSec</span>=5m
<span class="org-keyword">OnUnitInactiveSec</span>=5m

<span class="org-type">[Install]</span>
<span class="org-keyword">WantedBy</span>=default.target
</pre>
</div>
    </details>

<details id='systemd,code--4' class='code' open><summary><span class="lang">systemd</span></summary>
    <div class='gutter'>
    <a href='#systemd,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-systemd"><span class="org-type">[Unit]</span>
<span class="org-keyword">Description</span>=mbsync service, sync all mail
<span class="org-keyword">Documentation</span>=man:mbsync(<span class="org-highlight-numbers-number">1</span>)
<span class="org-keyword">ConditionPathExists</span>=<span class="org-constant">%h</span>/.mbsyncrc

<span class="org-type">[Service]</span>
<span class="org-keyword">Type</span>=<span class="org-builtin">oneshot</span>
<span class="org-keyword">ExecStart</span>=/usr/bin/mbsync -c <span class="org-constant">%h</span>/.mbsyncrc --all

<span class="org-type">[Install]</span>
<span class="org-keyword">WantedBy</span>=mail.target
</pre>
</div>
    </details>

<p>
Enabling (and starting) this is as simple as
</p>
<details id='systemd,code--5' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#systemd,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">systemctl --user enable mbsync.timer --now
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-indexing-searching" class="outline-4">
<h4 id="indexing-searching"><span class="section-number-4">5.5.2</span> Indexing/Searching<a aria-hidden="true" href="#indexing-searching">#</a> </h4>
<div class="outline-text-4" id="text-5-5-2">
<p>
This is performed by <a href="https://www.djcbsoftware.nl/code/mu/">Mu</a>. This is a tool for finding emails stored in the <a href="http://en.wikipedia.org/wiki/Maildir">Maildir</a> format.
According to the homepage, it&rsquo;s main features are
</p>
<ul class="org-ul">
<li>Fast indexing</li>
<li>Good searching</li>
<li>Support for encrypted and signed messages</li>
<li>Rich <span class='acr'>CLI</span> tooling</li>
<li>accent/case normalisation</li>
<li>strong integration with email clients</li>
</ul>

<p>
Unfortunately <code>mu</code> is not currently packaged from me. Oh well, I guess I&rsquo;m
building it from source then. I needed to install these packages
</p>
<ul class="org-ul">
<li><kbd>gmime-devel</kbd></li>
<li><kbd>xapian-core-devel</kbd></li>
</ul>

<details id='install-mu-from' class='code' open><summary class='named'><span class="name">Install mu from source</span><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#install-mu-from'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-type">cd</span> ~/.local/lib/
<span class="org-type">git</span> clone https://github.com/djcb/mu.git
<span class="org-type">cd</span> ./mu
./autogen.sh
<span class="org-type">make</span>
<span class="org-type">sudo</span> <span class="org-type">make</span> install
</pre>
</div>
    </details>

<p>
To check how my version compares to the latest published:
</p>

<details id='indexing-searching,code--1' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#indexing-searching,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-type">curl</span> --silent <span class="org-string">"https://api.github.com/repos/djcb/mu/releases/latest"</span> | <span class="org-type">grep</span> <span class="org-string">'"tag_name":'</span> | sed -E <span class="org-string">'s/.*"([^"]+)".*/\1/'</span>
mu --version | head -n <span class="org-highlight-numbers-number">1</span> | sed <span class="org-string">'s/.* version //'</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-sending" class="outline-4">
<h4 id="sending"><span class="section-number-4">5.5.3</span> Sending<a aria-hidden="true" href="#sending">#</a> </h4>
<div class="outline-text-4" id="text-5-5-3">
<p>
<a href="https://www.nongnu.org/smtpmail/">SmtpMail</a> seems to be the &rsquo;default&rsquo; starting point, but that&rsquo;s not packaged for
me. <a href="https://marlam.de/msmtp/">msmtp</a> is however, so I&rsquo;ll give that a shot. Reading around a bit (googling
&ldquo;msmtp vs sendmail&rdquo; for example) almost every comparison mentioned seems to
suggest msmtp to be a better choice. I have seen the following points raised
</p>
<ul class="org-ul">
<li><code>sendmail</code> has several vulnerabilities</li>
<li><code>sendmail</code> is tedious to configure</li>
<li><code>ssmtp</code> is no longer maintained</li>
<li><code>msmtp</code> is a maintained alternative to <code>ssmtp</code></li>
<li><code>msmtp</code> is easier to configure</li>
</ul>

<p>
The config file is <a href="file:///home/runner/.config/msmtp/config">~/.config/msmtp/config</a>.
</p>
</div>

<div id="outline-container-system-hackery" class="outline-5">
<h5 id="system-hackery"><span class="section-number-5">5.5.3.1</span> System hackery<a aria-hidden="true" href="#system-hackery">#</a> </h5>
<div class="outline-text-5" id="text-5-5-3-1">
<p>
Unfortunately, I seem to have run into a <a href="https://bugs.archlinux.org/task/44994">bug</a> present in my packaged version, so
we&rsquo;ll just install the latest from source.
</p>

<p>
For full use of the <code>auth</code> options, I need <kbd>GNU SASL</kbd>, which isn&rsquo;t packaged for me.
I don&rsquo;t think I want it, but in case I do, I&rsquo;ll need to do this.
</p>
<details id='install-gsasl-from' class='code' open><summary class='named'><span class="name">Install gsasl from source</span><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#install-gsasl-from'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">export</span> <span class="org-variable-name">GSASL_VERSION</span>=1.8.1
<span class="org-type">cd</span> ~/.local/lib/
<span class="org-type">curl</span> <span class="org-string">"ftp://ftp.gnu.org/gnu/gsasl/libgsasl-</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">GSASL_VERSION</span></span><span class="org-string">.tar.gz"</span> | tar xz
<span class="org-type">curl</span> <span class="org-string">"ftp://ftp.gnu.org/gnu/gsasl/gsasl-</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">GSASL_VERSION</span></span><span class="org-string">.tar.gz"</span> | tar xz
<span class="org-type">cd</span> <span class="org-string">"./libgsasl-</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">GSASL_VERSION</span></span><span class="org-string">"</span>
./configure
<span class="org-type">make</span>
<span class="org-type">sudo</span> <span class="org-type">make</span> install
<span class="org-type">cd</span> ..
<span class="org-type">cd</span> <span class="org-string">"./gsasl-</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">VERSION</span></span><span class="org-string">"</span>
./configure
<span class="org-type">make</span>
<span class="org-type">sudo</span> <span class="org-type">make</span> install
<span class="org-type">cd</span> ..
</pre>
</div>
    </details>

<p>
Now actually compile <code>msmtp</code>.
</p>
<details id='install-msmtp-from' class='code' open><summary class='named'><span class="name">Install msmtp from source</span><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#install-msmtp-from'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-type">cd</span> ~/.local/lib/
<span class="org-type">git</span> clone https://github.com/marlam/msmtp-mirror.git ./msmtp
<span class="org-type">cd</span> ./msmtp
libtoolize --force
aclocal
autoheader
automake --force-missing --add-missing
autoconf
<span class="org-comment-delimiter"># </span><span class="org-comment">if using GSASL</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">PKG_CONFIG_PATH=/usr/local/lib/pkgconfig ./configure --with-libgsasl</span>
./configure
<span class="org-type">make</span>
<span class="org-type">sudo</span> <span class="org-type">make</span> install
</pre>
</div>
    </details>

<p>
If using <kbd>GSASL</kbd> (from earlier) we need to make ensure that the dynamic library in
in the library path. We can do by adding an executable with the same name
earlier on in my <code>$PATH</code>.
</p>
<details id='system-hackery,code--1' class='code' open><summary><span class="lang">shell</span></summary>
    <div class='gutter'>
    <a href='#system-hackery,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">LD_LIBRARY_PATH</span>=/usr/local/lib exec /usr/local/bin/msmtp <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">@</span></span><span class="org-string">"</span>
</pre>
</div>
    </details>
</div>
</div>
</div>

<div id="outline-container-mu4e" class="outline-4">
<h4 id="mu4e"><span class="section-number-4">5.5.4</span> Mu4e<a aria-hidden="true" href="#mu4e">#</a> </h4>
<div class="outline-text-4" id="text-5-5-4">
<p>
Webmail clients are nice and all, but I still don&rsquo;t believe that <span class='acr'>SPA</span><small>s</small> in my
browser can replaced desktop apps &#x2026; sorry Gmail. I&rsquo;m also liking google less
and less.
</p>

<p>
Mailspring is a decent desktop client, quite lightweight for electron
(apparently the backend is in <kbd>C</kbd>, which probably helps), however I miss Emacs
stuff.
</p>

<p>
While <kbd>Notmuch</kbd> seems very promising, and I&rsquo;ve heard good things about it, it
doesn&rsquo;t seem to make any changes to the emails themselves. All data is stored in
Notmuch&rsquo;s database. While this is a very interesting model, occasionally I need
to pull up an email on say my phone, and so not I want the tagging/folders etc.
to be applied to the mail itself &#x2014; not stored in a database.
</p>

<p>
On the other hand <kbd>Mu4e</kbd> is also talked about a lot in positive terms, and seems
to possess a similarly strong feature set &#x2014; and modifies the mail itself (I.e.
information is accessible without the database). <kbd>Mu4e</kbd> also seems to have a large
user base, which tends to correlate with better support and attention.
</p>

<p>
As I installed mu4e from source, I need to add the <kbd>/usr/local/</kbd> loadpath so Mu4e has a chance of loading
</p>
<details id='mu4e,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#mu4e,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'load-path <span class="org-string">"/usr/local/share/emacs/site-lisp/mu4e"</span>)
</pre>
</div>
    </details>
</div>

<div id="outline-container-viewing-mail" class="outline-5">
<h5 id="viewing-mail"><span class="section-number-5">5.5.4.1</span> Viewing Mail<a aria-hidden="true" href="#viewing-mail">#</a> </h5>
<div class="outline-text-5" id="text-5-5-4-1">
<p>
There seem to be some advantages with using Gnus&rsquo; article view (such as inline
images), and judging from <a href="https://github.com/djcb/mu/pull/1442#issuecomment-591695814">djcb/mu!1442 (comment)</a> this seems to be the &rsquo;way of
the future&rsquo; for mu4e.
</p>

<p>
There are some all-the-icons font related issues, so we need to redefine the
fancy chars, and make sure they get the correct width.
</p>

<p>
To account for the increase width of each flag character, and make perform a
few more visual tweaks, we&rsquo;ll tweak the headers a bit
</p>
<details id='viewing-mail,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#viewing-mail,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> mu4e
  (<span class="org-keyword">setq</span> mu4e-headers-fields
        '((<span class="org-builtin">:flags</span> . <span class="org-highlight-numbers-number">6</span>)
          (<span class="org-builtin">:account-stripe</span> . <span class="org-highlight-numbers-number">2</span>)
          (<span class="org-builtin">:from-or-to</span> . <span class="org-highlight-numbers-number">25</span>)
          (<span class="org-builtin">:folder</span> . <span class="org-highlight-numbers-number">10</span>)
          (<span class="org-builtin">:recipnum</span> . <span class="org-highlight-numbers-number">2</span>)
          (<span class="org-builtin">:subject</span> . <span class="org-highlight-numbers-number">80</span>)
          (<span class="org-builtin">:human-date</span> . <span class="org-highlight-numbers-number">8</span>))
        +mu4e-min-header-frame-width <span class="org-highlight-numbers-number">142</span>
        mu4e-headers-date-format <span class="org-string">"%d/%m/%y"</span>
        mu4e-headers-time-format <span class="org-string">"&#10710; %H:%M"</span>
        mu4e-headers-results-limit <span class="org-highlight-numbers-number">1000</span>
        mu4e-index-cleanup t)

  (add-to-list 'mu4e-bookmarks
               '(<span class="org-builtin">:name</span> <span class="org-string">"Yesterday's messages"</span> <span class="org-builtin">:query</span> <span class="org-string">"date:2d..1d"</span> <span class="org-builtin">:key</span> ?y) t)

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">+mu4e-header--folder-colors</span> nil)
  (<span class="org-keyword">appendq!</span> mu4e-header-info-custom
            '((<span class="org-builtin">:folder</span> .
               (<span class="org-builtin">:name</span> <span class="org-string">"Folder"</span> <span class="org-builtin">:shortname</span> <span class="org-string">"Folder"</span> <span class="org-builtin">:help</span> <span class="org-string">"Lowest level folder"</span> <span class="org-builtin">:function</span>
                (<span class="org-keyword">lambda</span> (msg)
                  (+mu4e-colorize-str
                   (replace-regexp-in-string <span class="org-string">"\\`.*/"</span> <span class="org-string">""</span> (mu4e-message-field msg <span class="org-builtin">:maildir</span>))
                   '+mu4e-header--folder-colors)))))))
</pre>
</div>
    </details>

<p>
We&rsquo;ll also use a nicer alert icon
</p>
<details id='viewing-mail,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#viewing-mail,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> mu4e-alert-icon <span class="org-string">"/usr/share/icons/Papirus/64x64/apps/evolution.svg"</span>)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-sending-mail" class="outline-5">
<h5 id="sending-mail"><span class="section-number-5">5.5.4.2</span> Sending Mail<a aria-hidden="true" href="#sending-mail">#</a> </h5>
<div class="outline-text-5" id="text-5-5-4-2">
<p>
Let&rsquo;s send emails too.
</p>
<details id='sending-mail,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#sending-mail,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> mu4e
  (<span class="org-keyword">setq</span> sendmail-program <span class="org-string">"/usr/bin/msmtp"</span>
        send-mail-function #'smtpmail-send-it
        message-sendmail-f-is-evil t
        message-sendmail-extra-arguments '(<span class="org-string">"--read-envelope-from"</span>)<span class="org-comment-delimiter">; </span><span class="org-comment">, "--read-recipients")</span>
        message-send-mail-function #'message-send-mail-with-sendmail))
</pre>
</div>
    </details>

<p>
It&rsquo;s also nice to avoid accidentally sending emails with the wrong account.
If we can send from the address in the <code>To</code> field, let&rsquo;s do that. Opening an <code>ivy</code>
prompt otherwise also seems sensible.
</p>

<p>
We can register Emacs as a potential email client with the following desktop
file, thanks to Etienne Deparis&rsquo;s <a href="https://etienne.depar.is/emacs.d/mu4e.html">Mu4e customization</a>.
</p>
<details id='sending-mail,code--2' class='code' open><summary><span class="lang">Configuration File</span></summary>
    <div class='gutter'>
    <a href='#sending-mail,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-conf">[<span class="org-type">Desktop Entry</span>]
<span class="org-variable-name">Name</span>=Compose message in Emacs
<span class="org-variable-name">GenericName</span>=Compose a new message with Mu4e in Emacs
<span class="org-variable-name">Comment</span>=Open mu4e compose window
<span class="org-variable-name">MimeType</span>=x-scheme-handler/mailto;
<span class="org-variable-name">Exec</span>=emacsclient -create-frame --alternate-editor=<span class="org-string">""</span> --no-wait --eval <span class="org-string">'(progn (x-focus-frame nil) (mu4e-compose-from-mailto "%u"))'</span>
<span class="org-variable-name">Icon</span>=emacs
<span class="org-variable-name">Type</span>=Application
<span class="org-variable-name">Terminal</span>=false
<span class="org-variable-name">Categories</span>=Network;Email;
<span class="org-variable-name">StartupWMClass</span>=Emacs
</pre>
</div>
    </details>

<p>
To register this, just call
</p>
<details id='sending-mail,code--3' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#sending-mail,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">update-desktop-database ~/.local/share/applications
</pre>
</div>
    </details>

<p>
We also want to define <code>mu4e-compose-from-mailto</code>.
</p>
<details id='sending-mail,code--4' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#sending-mail,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">mu4e-compose-from-mailto</span> (mailto-string)
  (<span class="org-keyword">require</span> '<span class="org-constant">mu4e</span>)
  (<span class="org-keyword">unless</span> mu4e~server-props (mu4e t) (sleep-for <span class="org-highlight-numbers-number">0.1</span>))
  (<span class="org-keyword">let*</span> ((mailto (rfc2368-parse-mailto-url mailto-string))
         (to (cdr (assoc <span class="org-string">"To"</span> mailto)))
         (subject (<span class="org-keyword">or</span> (cdr (assoc <span class="org-string">"Subject"</span> mailto)) <span class="org-string">""</span>))
         (body (cdr (assoc <span class="org-string">"Body"</span> mailto)))
         (org-msg-greeting-fmt (<span class="org-keyword">if</span> (assoc <span class="org-string">"Body"</span> mailto)
                                   (replace-regexp-in-string <span class="org-string">"%"</span> <span class="org-string">"%%"</span>
                                                             (cdr (assoc <span class="org-string">"Body"</span> mailto)))
                                 org-msg-greeting-fmt))
         (headers (-filter (<span class="org-keyword">lambda</span> (spec) (not (-contains-p '(<span class="org-string">"To"</span> <span class="org-string">"Subject"</span> <span class="org-string">"Body"</span>) (car spec)))) mailto)))
    (mu4e~compose-mail to subject headers)))
</pre>
</div>
    </details>
<p>
This may not quite function as intended for now due to <a href="https://github.com/jeremy-compostella/org-msg/issues/52">jeremy-compostella/org-msg#52</a>.
</p>

<p>
It would also be nice to change the name pre-filled in <kbd>From:</kbd> when drafting.
</p>
<details id='sending-mail,code--5' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#sending-mail,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">mu4e-from-name</span> <span class="org-string">"Timothy"</span>
  <span class="org-doc">"Name used in \"From:\" template."</span>)
(<span class="org-keyword">defadvice!</span> mu4e~draft-from-construct-renamed (orig-fn)
  <span class="org-doc">"Wrap `</span><span class="org-doc"><span class="org-constant">mu4e~draft-from-construct-renamed</span></span><span class="org-doc">' to change the name."</span>
  <span class="org-builtin">:around</span> #'mu4e~draft-from-construct
  (<span class="org-keyword">let</span> ((user-full-name mu4e-from-name))
    (funcall orig-fn)))
</pre>
</div>
    </details>

<p>
We can also use this a signature,
</p>
<details id='sending-mail,code--6' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#sending-mail,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> message-signature mu4e-from-name)
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-org-msg" class="outline-4">
<h4 id="org-msg"><span class="section-number-4">5.5.5</span> Org Msg<a aria-hidden="true" href="#org-msg">#</a> </h4>
<div class="outline-text-4" id="text-5-5-5">
<p>
Doom does a fantastic stuff with the defaults with this, so we only make a few
minor tweaks.
</p>
<details id='org-msg,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-msg,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> +org-msg-accent-color <span class="org-string">"#1a5fb4"</span>
      org-msg-greeting-fmt <span class="org-string">"\nHi %s,\n\n"</span>
      org-msg-signature <span class="org-string">"\n\n#+begin_signature\nAll the best,\\\\\n*Timothy*\n#+end_signature"</span>)
(<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> org-msg-edit-mode-map
      <span class="org-builtin">:after</span> org-msg
      <span class="org-builtin">:n</span> <span class="org-string">"G"</span> #'org-msg-goto-body)
</pre>
</div>
    </details>
</div>
</div>
</div>
</div>
<div id="outline-container-language-configuration" class="outline-2">
<h2 id="language-configuration"><span class="section-number-2">6</span> Language configuration<a aria-hidden="true" href="#language-configuration">#</a> </h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-general" class="outline-3">
<h3 id="general"><span class="section-number-3">6.1</span> General<a aria-hidden="true" href="#general">#</a> </h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="outline-container-file-templates" class="outline-4">
<h4 id="file-templates"><span class="section-number-4">6.1.1</span> File Templates<a aria-hidden="true" href="#file-templates">#</a> </h4>
<div class="outline-text-4" id="text-6-1-1">
<p>
For some file types, we overwrite defaults in the <a href="./snippets">snippets</a> directory, others
need to have a template assigned.
</p>
<details id='file-templates,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#file-templates,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(set-file-template! <span class="org-string">"\\.tex$"</span> <span class="org-builtin">:trigger</span> <span class="org-string">"__"</span> <span class="org-builtin">:mode</span> 'latex-mode)
(set-file-template! <span class="org-string">"\\.org$"</span> <span class="org-builtin">:trigger</span> <span class="org-string">"__"</span> <span class="org-builtin">:mode</span> 'org-mode)
(set-file-template! <span class="org-string">"/LICEN[CS]E$"</span> <span class="org-builtin">:trigger</span> '+file-templates/insert-license)
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-plaintext" class="outline-3">
<h3 id="plaintext"><span class="section-number-3">6.2</span> Plaintext<a aria-hidden="true" href="#plaintext">#</a> </h3>
<div class="outline-text-3" id="text-6-2">
<p>
It&rsquo;s nice to see <span class='acr'>ANSI</span> colour codes displayed
</p>
<details id='plaintext,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#plaintext,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> text-mode
  (<span class="org-keyword">add-hook!</span> 'text-mode-hook
             <span class="org-comment-delimiter">;; </span><span class="org-comment">Apply ANSI color codes</span>
             (<span class="org-keyword">with-silent-modifications</span>
               (ansi-color-apply-on-region (point-min) (point-max)))))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-org" class="outline-3">
<h3 id="org"><span class="section-number-3">6.3</span> Org<a aria-hidden="true" href="#org">#</a> </h3>
<div class="outline-text-3" id="text-org">
<p>
I really like org mode, I&rsquo;ve given some thought to why, and below is the result.
</p>

<div id=',table--1' class='table'>
    <div class='gutter'><a href='#,table--1'>#</a></div>
    <div class='tabular'>
    <table>


<colgroup>
<col  class="org-left">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Format</th>
<th scope="col" class="org-right">Fine-grained control</th>
<th scope="col" class="org-right">Initial ease of use</th>
<th scope="col" class="org-right">Syntax simplicity</th>
<th scope="col" class="org-right">Editor Support</th>
<th scope="col" class="org-right">Integrations</th>
<th scope="col" class="org-right">Ease-of-referencing</th>
<th scope="col" class="org-right">Versatility</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Word</td>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">4</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">LaTeX</td>
<td class="org-right">4</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">Org Mode</td>
<td class="org-right">4</td>
<td class="org-right">2</td>
<td class="org-right">3.5</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">4</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-left">Markdown</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">Markdown + Pandoc</td>
<td class="org-right">2.5</td>
<td class="org-right">2.5</td>
<td class="org-right">2.5</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
    </div>    </div>


<figure id="org859309c">
<object type="image/svg+xml" data="misc/document-format-comparison.svg" class="invertible" alt="Radar chart comparing my opinions of document formats.">
Sorry, your browser does not support SVG.</object>

</figure>

<p>
Beyond the elegance in the markup language, tremendously rich integrations with
Emacs allow for some fantastic <a href="https://orgmode.org/features.html">features</a>, such as what seems to be the best
support for <a href="https://en.wikipedia.org/wiki/Literate_programming">literate programming</a> of any currently available technology.
</p>

<details id='org3b218da' class='code' open>
    <summary></summary>
    <div class='gutter'>    <a href='#org3b218da'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <pre class="example" style="line-height:1.13;" id="org3b218da">
      â•­â”€â•´Codeâ•¶â”€â•®            â•­â”€â•´Raw Codeâ•¶â”€â–¶ Computer
Ideasâ•ºâ”¥        â”â”â–¶ Org Modeâ•ºâ”¥
      â•°â”€â•´Textâ•¶â”€â•¯            â•°â”€â•´Documentâ•¶â”€â–¶ People
</pre>

    </details>

<p>
An <kbd>.org</kbd> file can contain blocks of code (with <a href="https://en.wikipedia.org/wiki/Noweb">noweb</a> templating support), which
can be <a href="https://orgmode.org/manual/Extracting-Source-Code.html">tangled</a> to dedicated source code files, and <a href="https://orgmode.org/manual/Extracting-Source-Code.html">woven</a> into a document
(report, documentation, presentation, etc.) through various (<i>extensible</i>) methods.
These source blocks may even create images or other content to be included in
the document, or generate source code.
</p>

<details id='orgf81e4f6' class='code' open>
    <summary></summary>
    <div class='gutter'>    <a href='#orgf81e4f6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <pre class="example" style="line-height:1.13;" id="orgf81e4f6">
                   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .pdf âŽ«
                  pdfLaTeX â–¶â•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•®                 âŽª
                   â•¿     â•¿                  â”Š                 âŽª
                   â”‚     â”Š                  â”Š                 âŽª
                 .tex    â”Š                  â”Š                 âŽª
                   â•¿     â”Š                  â”Š                 âŽª
                â•­â”€â”€â”´â•Œâ•Œâ•®  â”Š                  â”Š style.scss      âŽ¬ Weaving
graphc.png â”€â•®   â”‚  embedded TeX             â”Š      â•½          âŽª (Documents)
image.jpeg â”€â”¤ filters   â•¿                   â”Š    .css         âŽª
            â•Ž     â•¿     â”Š                   â”Š     â–¾â•Ž          âŽª
figure.pngâ•¶â”€â•§â”€â–¶ PROJECT.ORG â–¶â”€â”€â”€â•´filtersâ•¶â”€â”€â”€â•§â”€â”€â”€â”€â”€â”€â•ªâ”€â”€â–¶ .html âŽª
     â•¿           â•¿â”Š â•‘ â”‚ â•°â•Œâ•Œâ•Œâ–·â•Œâ•Œ embedded html â–¶â•Œâ•Œâ•Œâ•Œâ•¯          âŽª
     â”œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ–·â•Œâ•Œâ•Œâ•¯â”Š â•‘ â”‚                                       âŽª
    resultâ•¶â•Œâ•Œâ•Œâ•Œâ•Œâ•® â”Š â•‘ â”œâ”€â”€â”€â”€â”€â”€â•´filtersâ•¶â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .txt  âŽª
     â”Šâ–´         â”Š â”Š â•‘ â”‚                                       âŽª
    execution   â”Š â”Š â•‘ â•°â”€â”€â”€â”€â”€â”€â•´filtersâ•¶â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .md   âŽ­
     â”Šâ–´         â”Š â”Š â•‘
    code blocksâ—€â•¯ â”Š â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .c    âŽ«
     â•°â•Œâ•Œâ•Œâ•Œâ—â•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•¯ â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .sh   âŽ¬ Tangling
                    â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .hs   âŽª (Code)
                    â•™â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .el   âŽ­
</pre>

    </details>

<p>
Finally, because this section is fairly expensive to initialise, we&rsquo;ll wrap it
in an <code class="src src-elisp">(<span class="org-keyword">after!</span> ...)</code> block.
</p>
<details id='org,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org
  &lt;&lt;org-conf&gt;&gt;
)
</pre>
</div>
    </details>
</div>
<div id="outline-container-system-config" class="outline-4">
<h4 id="system-config"><span class="section-number-4">6.3.1</span> System config<a aria-hidden="true" href="#system-config">#</a> </h4>
<div class="outline-text-4" id="text-6-3-1">
</div>
<div id="outline-container-mime-types" class="outline-5">
<h5 id="mime-types"><span class="section-number-5">6.3.1.1</span> Mime types<a aria-hidden="true" href="#mime-types">#</a> </h5>
<div class="outline-text-5" id="text-6-3-1-1">
<p>
Org mode isn&rsquo;t recognised as it&rsquo;s own mime type by default, but that can easily
be changed with the following file. For system-wide changes try
<code>/usr/share/mime/packages/org.xml</code>.
</p>
<details id='mime-types,code--1' class='code' open><summary><span class="lang">XML</span></summary>
    <div class='gutter'>
    <a href='#mime-types,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" encoding="utf-8"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">mime-info</span> <span class="org-nxml-namespace-attribute-xmlns">xmlns</span>=<span class="org-string">'http://www.freedesktop.org/standards/shared-mime-info'</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">mime-type</span> <span class="org-nxml-attribute-local-name">type</span>=<span class="org-string">"text/org"</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">comment</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">Emacs Org-mode File</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">comment</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">glob</span> <span class="org-nxml-attribute-local-name">pattern</span>=<span class="org-string">"*.org"</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">alias</span> <span class="org-nxml-attribute-local-name">type</span>=<span class="org-string">"text/org"</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">mime-type</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">mime-info</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
    </details>
<p>
What&rsquo;s nice is that Papirus <a href="https://github.com/PapirusDevelopmentTeam/papirus-icon-theme/commit/a10fb7f2423d5e30b9c4477416ccdc93c4f3849d">now</a> has an icon for <kbd>text/org</kbd>.
One simply needs to refresh their mime database
</p>
<details id='mime-types,code--2' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#mime-types,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">update-mime-database ~/.local/share/mime
</pre>
</div>
    </details>
<p>
Then set Emacs as the default editor
</p>
<details id='mime-types,code--3' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#mime-types,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">xdg-mime default emacs.desktop text/org
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-git-diffs" class="outline-5">
<h5 id="git-diffs"><span class="section-number-5">6.3.1.2</span> Git diffs<a aria-hidden="true" href="#git-diffs">#</a> </h5>
<div class="outline-text-5" id="text-6-3-1-2">
<p>
Protesilaos wrote a <a href="https://protesilaos.com/codelog/2021-01-26-git-diff-hunk-elisp-org/">very helpful article</a> in which he explains how to change the
git diff chunk heading to something more useful than just the immediate line
above the hunk &#x2014; like the parent heading.
</p>

<p>
This can be achieved by first adding a new diff mode to git in <kbd>~/.config/git/attributes</kbd>
</p>
<details id='git-diffs,code--1' class='code' open><summary><span class="lang">fundamental</span></summary>
    <div class='gutter'>
    <a href='#git-diffs,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-fundamental">*.org   diff=org
</pre>
</div>
    </details>

<p>
Then adding a regex for it to <kbd>~/.config/git/config</kbd>
</p>
<details id='git-diffs,code--2' class='code' open><summary><span class="lang">gitconfig</span></summary>
    <div class='gutter'>
    <a href='#git-diffs,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-gitconfig">[<span class="org-type">diff</span> <span class="org-function-name">"org"</span>]
  <span class="org-variable-name">xfuncname</span> = <span class="org-string">"^(\\*+ +.*)$"</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-development" class="outline-5">
<h5 id="development"><span class="section-number-5">6.3.1.3</span> Development<a aria-hidden="true" href="#development">#</a> </h5>
<div class="outline-text-5" id="text-6-3-1-3">
<p>
Testing patches from the <span class='acr'>ML</span> is currently more hassle than it needs to be. Let&rsquo;s
change that.
</p>
<details id='development,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#development,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-ml-target-dir</span> <span class="org-string">"~/.emacs.d/.local/straight/repos/org-mode/"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-ml-max-age</span> <span class="org-highlight-numbers-number">600</span>
  <span class="org-doc">"Maximum permissible age in seconds."</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-ml--cache-timestamp</span> <span class="org-highlight-numbers-number">0</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-ml--cache</span> nil)

(<span class="org-keyword">defun</span> <span class="org-function-name">org-ml-current-patches</span> ()
  <span class="org-doc">"Get the currently open patches, as a list of alists.</span>
<span class="org-doc">Entries of the form (subject . id)."</span>
  (delq nil
        (mapcar
         (<span class="org-keyword">lambda</span> (entry)
           (<span class="org-keyword">unless</span> (plist-get entry <span class="org-builtin">:fixed</span>)
             (cons
              (format <span class="org-string">"%-8s  %s"</span>
                      (propertize
                       (replace-regexp-in-string <span class="org-string">"T.*"</span> <span class="org-string">""</span>
                                                 (plist-get entry <span class="org-builtin">:date</span>))
                       'face 'font-lock-doc-face)
                      (propertize
                       (replace-regexp-in-string <span class="org-string">"\\[</span><span class="org-string"><span class="org-constant">PATCH\\</span></span><span class="org-string">] ?"</span> <span class="org-string">""</span>
                                                 (plist-get entry <span class="org-builtin">:summary</span>))
                       'face 'font-lock-keyword-face))
              (plist-get entry <span class="org-builtin">:id</span>))))
         (<span class="org-keyword">with-current-buffer</span> (url-retrieve-synchronously <span class="org-string">"https://updates.orgmode.org/data/patches"</span>)
           (json-parse-buffer <span class="org-builtin">:object-type</span> 'plist)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-ml-select-patch-thread</span> ()
  <span class="org-doc">"Find and apply a proposed Org patch."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((current-workspace (+workspace-current))
        (patches (<span class="org-keyword">progn</span>
                   (<span class="org-keyword">when</span> (<span class="org-keyword">or</span> (not org-ml--cache)
                             (&gt; (- (float-time) org-ml--cache-timestamp)
                                org-ml-max-age))
                     (<span class="org-keyword">setq</span> org-ml--cache (org-ml-current-patches)
                           org-ml--cache-timestamp (float-time)))
                   org-ml--cache))
        msg-id)
    (ivy-read <span class="org-string">"Thread: "</span>
              patches
              <span class="org-builtin">:action</span> (<span class="org-keyword">lambda</span> (m) (<span class="org-keyword">setq</span> msg-id (cdr m))))
    (+workspace-switch +mu4e-workspace-name)
    (mu4e-view-message-with-message-id msg-id)
    (add-to-list 'mu4e-view-actions
                 (cons <span class="org-string">"apply patch to org"</span> #'org-ml-transient-mu4e-action))))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-ml-transient-mu4e-action</span> (msg)
  (<span class="org-keyword">setq</span> mu4e-view-actions
        (delete (cons <span class="org-string">"apply patch to org"</span> #'org-ml-transient-mu4e-action)
                mu4e-view-actions))
  (+workspace/other)
  (magit-status org-ml-target-dir)
  (<span class="org-keyword">with-current-buffer</span> (get-buffer-create <span class="org-string">"*Shell: Org apply patches*"</span>)
    (erase-buffer)
    (<span class="org-keyword">let</span> ((default-directory org-ml-target-dir))
      (shell-command
       (format <span class="org-string">"git am %s"</span>
               (shell-quote-argument (mu4e-message-field msg <span class="org-builtin">:path</span>)))
       (current-buffer))
      (magit-refresh))
    (<span class="org-keyword">when</span> (string-match-p <span class="org-string">"Error</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">failed"</span> (buffer-string))
      (+popup/buffer))))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-behaviour" class="outline-4">
<h4 id="behaviour"><span class="section-number-4">6.3.2</span> Behaviour<a aria-hidden="true" href="#behaviour">#</a> </h4>
<div class="outline-text-4" id="text-6-3-2">
<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/automation.png' title="'Automating' comes from the roots 'auto-' meaning 'self-', and 'mating', meaning 'screwing'." alt='Automation'>
</p>
</div>
<div id="outline-container-tweaking-defaults" class="outline-5">
<h5 id="tweaking-defaults"><span class="section-number-5">6.3.2.1</span> Tweaking defaults<a aria-hidden="true" href="#tweaking-defaults">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-1">
<details id='tweaking-defaults,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#tweaking-defaults,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-directory <span class="org-string">"~/.org"</span>                      <span class="org-comment-delimiter">; </span><span class="org-comment">let's put files here</span>
      org-use-property-inheritance t              <span class="org-comment-delimiter">; </span><span class="org-comment">it's convenient to have properties inherited</span>
      org-log-done 'time                          <span class="org-comment-delimiter">; </span><span class="org-comment">having the time a item is done sounds convenient</span>
      org-list-allow-alphabetical t               <span class="org-comment-delimiter">; </span><span class="org-comment">have a. A. a) A) list bullets</span>
      org-export-in-background t                  <span class="org-comment-delimiter">; </span><span class="org-comment">run export processes in external emacs process</span>
      org-catch-invisible-edits 'smart            <span class="org-comment-delimiter">; </span><span class="org-comment">try not to accidently do weird stuff in invisible regions</span>
      org-export-with-sub-superscripts '{})       <span class="org-comment-delimiter">; </span><span class="org-comment">don't treat lone _ / ^ as sub/superscripts, require _{} / ^{}</span>
</pre>
</div>
    </details>
<p>
I also like the <code class="src src-elisp"><span class="org-builtin">:comments</span></code> header-argument, so let&rsquo;s make that a
default.
</p>
<details id='tweaking-defaults,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#tweaking-defaults,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-babel-default-header-args
      '((<span class="org-builtin">:session</span> . <span class="org-string">"none"</span>)
        (<span class="org-builtin">:results</span> . <span class="org-string">"replace"</span>)
        (<span class="org-builtin">:exports</span> . <span class="org-string">"code"</span>)
        (<span class="org-builtin">:cache</span> . <span class="org-string">"no"</span>)
        (<span class="org-builtin">:noweb</span> . <span class="org-string">"no"</span>)
        (<span class="org-builtin">:hlines</span> . <span class="org-string">"no"</span>)
        (<span class="org-builtin">:tangle</span> . <span class="org-string">"no"</span>)
        (<span class="org-builtin">:comments</span> . <span class="org-string">"link"</span>)))
</pre>
</div>
    </details>

<p>
By default, <code>visual-line-mode</code> is turned <kbd>on</kbd>, and <code>auto-fill-mode</code> <kbd>off</kbd> by a hook.
However this messes with tables in Org-mode, and other plaintext files (e.g.
markdown, \LaTeX) so I&rsquo;ll turn it off for this, and manually enable it for more
specific modes as desired.
</p>
<details id='tweaking-defaults,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#tweaking-defaults,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(remove-hook 'text-mode-hook #'visual-line-mode)
(add-hook 'text-mode-hook #'auto-fill-mode)
</pre>
</div>
    </details>

<p>
There also seem to be a few keybindings which use <kbd>hjkl</kbd>, but miss arrow key equivalents.
</p>
<details id='tweaking-defaults,code--4' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#tweaking-defaults,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> evil-org-mode-map
      <span class="org-builtin">:after</span> evil-org
      <span class="org-builtin">:n</span> <span class="org-string">"g &lt;up&gt;"</span> #'org-backward-heading-same-level
      <span class="org-builtin">:n</span> <span class="org-string">"g &lt;down&gt;"</span> #'org-forward-heading-same-level
      <span class="org-builtin">:n</span> <span class="org-string">"g &lt;left&gt;"</span> #'org-up-element
      <span class="org-builtin">:n</span> <span class="org-string">"g &lt;right&gt;"</span> #'org-down-element)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-behaviour-extra-functionality" class="outline-5">
<h5 id="behaviour-extra-functionality"><span class="section-number-5">6.3.2.2</span> Extra functionality<a aria-hidden="true" href="#behaviour-extra-functionality">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-2">
</div>
<div id="outline-container-org-buffer-creation" class="outline-6">
<h6 id="org-buffer-creation"><span class="section-number-6">6.3.2.2.1</span> Org buffer creation<a aria-hidden="true" href="#org-buffer-creation">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-1">
<p>
Let&rsquo;s also make creating an org buffer just that little bit easier.
</p>
<details id='org-buffer-creation,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-buffer-creation,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">evil-define-command</span> <span class="org-function-name">evil-buffer-org-new</span> (count file)
  <span class="org-doc">"Creates a new ORG buffer replacing the current window, optionally</span>
<span class="org-doc">   editing a certain FILE"</span>
  <span class="org-builtin">:repeat</span> nil
  (<span class="org-keyword">interactive</span> <span class="org-string">"P&lt;f&gt;"</span>)
  (<span class="org-keyword">if</span> file
      (evil-edit file)
    (<span class="org-keyword">let</span> ((buffer (generate-new-buffer <span class="org-string">"*new org*"</span>)))
      (set-window-buffer nil buffer)
      (<span class="org-keyword">with-current-buffer</span> buffer
        (org-mode)))))
(<span class="org-keyword">map!</span> <span class="org-builtin">:leader</span>
      (<span class="org-builtin">:prefix</span> <span class="org-string">"b"</span>
       <span class="org-builtin">:desc</span> <span class="org-string">"New empty ORG buffer"</span> <span class="org-string">"o"</span> #'evil-buffer-org-new))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-utility-zero-width" class="outline-6">
<h6 id="utility-zero-width"><span class="section-number-6">6.3.2.2.2</span> The utility of zero-width spaces<a aria-hidden="true" href="#utility-zero-width">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-2">
<p>
Occasionally in Org you run into annoyances where you want to have two seperate
blocks right together without a space. For example, to <b>emph</b>asise part of a word,
or put a currency symbol immediately before an inline source block.
There is a solution to this, it just sounds slightly hacky &#x2014; zero width spaces.
Because this is Emacs, we can make this feel much less hacky by making a minor
addition to the Org key map ðŸ™‚.
</p>
<details id='utility-zero-width,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#utility-zero-width,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> org-mode-map
      <span class="org-builtin">:nie</span> <span class="org-string">"M-SPC M-SPC"</span> (<span class="org-keyword">cmd!</span> (insert <span class="org-string">"\u200B"</span>)))
</pre>
</div>
    </details>

<p>
We then want to stop the space from being included in exports, which can be done
with a little filter.
</p>
<details id='utility-zero-width,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#utility-zero-width,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+org-export-remove-zero-width-space</span> (text _backend _info)
  <span class="org-doc">"Remove zero width spaces from TEXT."</span>
  (<span class="org-keyword">unless</span> (org-export-derived-backend-p 'org)
    (replace-regexp-in-string <span class="org-string">"\u200B"</span> <span class="org-string">""</span> text)))

(add-to-list 'org-export-filter-final-output-functions #'+org-export-remove-zero-width-space t)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-list-bullet-sequence" class="outline-6">
<h6 id="list-bullet-sequence"><span class="section-number-6">6.3.2.2.3</span> List bullet sequence<a aria-hidden="true" href="#list-bullet-sequence">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-3">
<p>
I think it makes sense to have list bullets change with depth
</p>
<details id='list-bullet-sequence,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#list-bullet-sequence,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-list-demote-modify-bullet '((<span class="org-string">"+"</span> . <span class="org-string">"-"</span>) (<span class="org-string">"-"</span> . <span class="org-string">"+"</span>) (<span class="org-string">"*"</span> . <span class="org-string">"+"</span>) (<span class="org-string">"1."</span> . <span class="org-string">"a."</span>)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-citation" class="outline-6">
<h6 id="citation"><span class="section-number-6">6.3.2.2.4</span> Citation<a aria-hidden="true" href="#citation">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-4">
<p>
Occasionally I want to cite something, and <kbd>org-ref</kbd> is <i>the</i> package for that.
</p>

<p>
Unfortunately, it ignores the <code>file = {...}</code> <kbd>.bib</kbd> keys though. Let&rsquo;s fix that.
I separate files on <kbd>;</kbd>, which may just be a Zotero/BetterBibLaTeX thing, but it&rsquo;s
a good idea in my case at least.
</p>

<details id='citation,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#citation,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-ref
  <span class="org-builtin">:after</span> org
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> org-ref-completion-library 'org-ref-ivy-cite)
  (<span class="org-keyword">defadvice!</span> org-ref-open-bibtex-pdf-a ()
    <span class="org-builtin">:override</span> #'org-ref-open-bibtex-pdf
    (<span class="org-keyword">save-excursion</span>
      (bibtex-beginning-of-entry)
      (<span class="org-keyword">let*</span> ((bibtex-expand-strings t)
             (entry (bibtex-parse-entry t))
             (key (reftex-get-bib-field <span class="org-string">"=key="</span> entry))
             (pdf (<span class="org-keyword">or</span>
                   (car (-filter (<span class="org-keyword">lambda</span> (f) (string-match-p <span class="org-string">"\\.pdf$"</span> f))
                                 (split-string (reftex-get-bib-field <span class="org-string">"file"</span> entry) <span class="org-string">";"</span>)))
                   (funcall org-ref-get-pdf-filename-function key))))
        (<span class="org-keyword">if</span> (file-exists-p pdf)
            (org-open-file pdf)
          (ding)))))
  (<span class="org-keyword">defadvice!</span> org-ref-open-pdf-at-point-a ()
    <span class="org-doc">"Open the pdf for bibtex key under point if it exists."</span>
    <span class="org-builtin">:override</span> #'org-ref-open-pdf-at-point
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let*</span> ((results (org-ref-get-bibtex-key-and-file))
           (key (car results))
           (pdf-file (funcall org-ref-get-pdf-filename-function key)))
      (<span class="org-keyword">with-current-buffer</span> (find-file-noselect (cdr results))
        (<span class="org-keyword">save-excursion</span>
          (bibtex-search-entry (car results))
          (org-ref-open-bibtex-pdf))))))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-cdlatex" class="outline-6">
<h6 id="cdlatex"><span class="section-number-6">6.3.2.2.5</span> cdlatex<a aria-hidden="true" href="#cdlatex">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-5">
<p>
It&rsquo;s also nice to be able to use <code>cdlatex</code>.
</p>
<details id='cdlatex,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#cdlatex,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'org-mode-hook 'turn-on-org-cdlatex)
</pre>
</div>
    </details>

<p>
It&rsquo;s handy to be able to quickly insert environments with <kbd>C-c }</kbd>. I almost always
want to edit them afterwards though, so let&rsquo;s make that happen by default.
</p>
<details id='cdlatex,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#cdlatex,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> org-edit-latex-emv-after-insert ()
  <span class="org-builtin">:after</span> #'org-cdlatex-environment-indent
  (org-edit-latex-environment))
</pre>
</div>
    </details>

<p>
At some point in the future it could be good to investigate <a href="https://scripter.co/splitting-an-org-block-into-two/">splitting org blocks</a>.
Likewise <a href="https://archive.casouri.cat/note/2020/insert-math-symbol-in-emacs/">this</a> looks good for symbols.
</p>
</div>
</div>
<div id="outline-container-spellcheck" class="outline-6">
<h6 id="spellcheck"><span class="section-number-6">6.3.2.2.6</span> Spellcheck<a aria-hidden="true" href="#spellcheck">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-6">
<p>
My spelling is atrocious, so let&rsquo;s get flycheck going.
</p>
<details id='spellcheck,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#spellcheck,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'org-mode-hook 'turn-on-flyspell)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-lsp-support-src" class="outline-6">
<h6 id="lsp-support-src"><span class="section-number-6">6.3.2.2.7</span> <span class='acr'><span class='acr'>LSP</span></span> support in <code>src</code> blocks<a aria-hidden="true" href="#lsp-support-src">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-7">
<p>
Now, by default, <span class='acr'>LSP</span><small>s</small> don&rsquo;t really function at all in <code>src</code> blocks.
</p>
<details id='lsp-support-src,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#lsp-support-src,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">cl-defmacro</span> <span class="org-function-name">lsp-org-babel-enable</span> (lang)
  <span class="org-doc">"Support LANG in org source code block."</span>
  (<span class="org-keyword">setq</span> centaur-lsp 'lsp-mode)
  (<span class="org-warning">cl-check-type</span> lang stringp)
  (<span class="org-keyword">let*</span> ((edit-pre (intern (format <span class="org-string">"org-babel-edit-prep:%s"</span> lang)))
         (intern-pre (intern (format <span class="org-string">"lsp--%s"</span> (symbol-name edit-pre)))))
    `(<span class="org-keyword">progn</span>
       (<span class="org-keyword">defun</span> ,intern-pre (info)
         (<span class="org-keyword">let</span> ((file-name (<span class="org-keyword">-&gt;&gt;</span> info caddr (alist-get <span class="org-builtin">:file</span>))))
           (<span class="org-keyword">unless</span> file-name
             (<span class="org-keyword">setq</span> file-name (make-temp-file <span class="org-string">"babel-lsp-"</span>)))
           (<span class="org-keyword">setq</span> buffer-file-name file-name)
           (lsp-deferred)))
       (put ',intern-pre 'function-documentation
            (format <span class="org-string">"Enable lsp-mode in the buffer of org source block (%s)."</span>
                    (upcase ,lang)))
       (<span class="org-keyword">if</span> (fboundp ',edit-pre)
           (advice-add ',edit-pre <span class="org-builtin">:after</span> ',intern-pre)
         (<span class="org-keyword">progn</span>
           (<span class="org-keyword">defun</span> ,edit-pre (info)
             (,intern-pre info))
           (put ',edit-pre 'function-documentation
                (format <span class="org-string">"Prepare local buffer environment for org source block (%s)."</span>
                        (upcase ,lang))))))))
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-babel-lang-list</span>
  '(<span class="org-string">"go"</span> <span class="org-string">"python"</span> <span class="org-string">"ipython"</span> <span class="org-string">"bash"</span> <span class="org-string">"sh"</span>))
(<span class="org-keyword">dolist</span> (lang org-babel-lang-list)
  (eval `(<span class="org-keyword">lsp-org-babel-enable</span> ,lang)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-view-exported-file" class="outline-6">
<h6 id="view-exported-file"><span class="section-number-6">6.3.2.2.8</span> View exported file<a aria-hidden="true" href="#view-exported-file">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-8">
<p>
<kbd>'localeader v</kbd> has no pre-existing binding, so I may as well use it with the same
functionality as in LaTeX. Let&rsquo;s try viewing possible output files with this.
</p>
<details id='view-exported-file,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#view-exported-file,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> org-mode-map
      <span class="org-builtin">:localleader</span>
      <span class="org-builtin">:desc</span> <span class="org-string">"View exported file"</span> <span class="org-string">"v"</span> #'org-view-output-file)

(<span class="org-keyword">defun</span> <span class="org-function-name">org-view-output-file</span> (<span class="org-type">&amp;optional</span> org-file-path)
  <span class="org-doc">"Visit buffer open on the first output file (if any) found, using `</span><span class="org-doc"><span class="org-constant">org-view-output-file-extensions</span></span><span class="org-doc">'"</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((org-file-path (<span class="org-keyword">or</span> org-file-path (buffer-file-name) <span class="org-string">""</span>))
         (dir (file-name-directory org-file-path))
         (basename (file-name-base org-file-path))
         (output-file nil))
    (<span class="org-keyword">dolist</span> (ext org-view-output-file-extensions)
      (<span class="org-keyword">unless</span> output-file
        (<span class="org-keyword">when</span> (file-exists-p
               (concat dir basename <span class="org-string">"."</span> ext))
          (<span class="org-keyword">setq</span> output-file (concat dir basename <span class="org-string">"."</span> ext)))))
    (<span class="org-keyword">if</span> output-file
        (<span class="org-keyword">if</span> (member (file-name-extension output-file) org-view-external-file-extensions)
            (browse-url-xdg-open output-file)
          (pop-to-buffer (<span class="org-keyword">or</span> (find-buffer-visiting output-file)
                             (find-file-noselect output-file))))
      (message <span class="org-string">"No exported file found"</span>))))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-view-output-file-extensions</span> '(<span class="org-string">"pdf"</span> <span class="org-string">"md"</span> <span class="org-string">"rst"</span> <span class="org-string">"txt"</span> <span class="org-string">"tex"</span> <span class="org-string">"html"</span>)
  <span class="org-doc">"Search for output files with these extensions, in order, viewing the first that matches"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-view-external-file-extensions</span> '(<span class="org-string">"html"</span>)
  <span class="org-doc">"File formats that should be opened externally."</span>)
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-super-agenda" class="outline-5">
<h5 id="super-agenda"><span class="section-number-5">6.3.2.3</span> Super agenda<a aria-hidden="true" href="#super-agenda">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-3">
<details id='super-agenda,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#super-agenda,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-super-agenda
  <span class="org-builtin">:commands</span> (org-super-agenda-mode))
(<span class="org-keyword">after!</span> org-agenda
  (org-super-agenda-mode))

(<span class="org-keyword">setq</span> org-agenda-skip-scheduled-if-done t
      org-agenda-skip-deadline-if-done t
      org-agenda-include-deadlines t
      org-agenda-block-separator nil
      org-agenda-tags-column <span class="org-highlight-numbers-number">100</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">from testing this seems to be a good value</span>
      org-agenda-compact-blocks t)

(<span class="org-keyword">setq</span> org-agenda-custom-commands
      '((<span class="org-string">"o"</span> <span class="org-string">"Overview"</span>
         ((agenda <span class="org-string">""</span> ((org-agenda-span 'day)
                      (org-super-agenda-groups
                       '((<span class="org-builtin">:name</span> <span class="org-string">"Today"</span>
                          <span class="org-builtin">:time-grid</span> t
                          <span class="org-builtin">:date</span> today
                          <span class="org-builtin">:todo</span> <span class="org-string">"TODAY"</span>
                          <span class="org-builtin">:scheduled</span> today
                          <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">1</span>)))))
          (alltodo <span class="org-string">""</span> ((org-agenda-overriding-header <span class="org-string">""</span>)
                       (org-super-agenda-groups
                        '((<span class="org-builtin">:name</span> <span class="org-string">"Next to do"</span>
                           <span class="org-builtin">:todo</span> <span class="org-string">"NEXT"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">1</span>)
                          (<span class="org-builtin">:name</span> <span class="org-string">"Important"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"Important"</span>
                           <span class="org-builtin">:priority</span> <span class="org-string">"A"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">6</span>)
                          (<span class="org-builtin">:name</span> <span class="org-string">"Due Today"</span>
                           <span class="org-builtin">:deadline</span> today
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">2</span>)
                          (<span class="org-builtin">:name</span> <span class="org-string">"Due Soon"</span>
                           <span class="org-builtin">:deadline</span> future
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">8</span>)
                          (<span class="org-builtin">:name</span> <span class="org-string">"Overdue"</span>
                           <span class="org-builtin">:deadline</span> past
                           <span class="org-builtin">:face</span> error
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">7</span>)
                          (<span class="org-builtin">:name</span> <span class="org-string">"Assignments"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"Assignment"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">10</span>)
                          (<span class="org-builtin">:name</span> <span class="org-string">"Issues"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"Issue"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">12</span>)
                          (<span class="org-builtin">:name</span> <span class="org-string">"Emacs"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"Emacs"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">13</span>)
                          (<span class="org-builtin">:name</span> <span class="org-string">"Projects"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"Project"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">14</span>)
                          (<span class="org-builtin">:name</span> <span class="org-string">"Research"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"Research"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">15</span>)
                          (<span class="org-builtin">:name</span> <span class="org-string">"To read"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"Read"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">30</span>)
                          (<span class="org-builtin">:name</span> <span class="org-string">"Waiting"</span>
                           <span class="org-builtin">:todo</span> <span class="org-string">"WAITING"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">20</span>)
                          (<span class="org-builtin">:name</span> <span class="org-string">"University"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"uni"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">32</span>)
                          (<span class="org-builtin">:name</span> <span class="org-string">"Trivial"</span>
                           <span class="org-builtin">:priority&lt;=</span> <span class="org-string">"E"</span>
                           <span class="org-builtin">:tag</span> (<span class="org-string">"Trivial"</span> <span class="org-string">"Unimportant"</span>)
                           <span class="org-builtin">:todo</span> (<span class="org-string">"SOMEDAY"</span> )
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">90</span>)
                          (<span class="org-builtin">:discard</span> (<span class="org-builtin">:tag</span> (<span class="org-string">"Chore"</span> <span class="org-string">"Routine"</span> <span class="org-string">"Daily"</span>)))))))))))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-capture" class="outline-5">
<h5 id="capture"><span class="section-number-5">6.3.2.4</span> Capture<a aria-hidden="true" href="#capture">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-4">
<p>
Let&rsquo;s setup some org-capture templates, and make them visually nice to access.
</p>


<figure id="org240c900">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/org-capture.png" alt="My org-capture dialouge." class="invertible">

</figure>

<details id='capture,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#capture,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> doct
  <span class="org-builtin">:commands</span> (doct))

(<span class="org-keyword">after!</span> org-capture
  &lt;&lt;prettify-capture&gt;&gt;

  (<span class="org-keyword">defun</span> <span class="org-function-name">+doct-icon-declaration-to-icon</span> (declaration)
    <span class="org-doc">"Convert :icon declaration to icon"</span>
    (<span class="org-keyword">let</span> ((name (<span class="org-keyword">pop</span> declaration))
          (set  (intern (concat <span class="org-string">"all-the-icons-"</span> (plist-get declaration <span class="org-builtin">:set</span>))))
          (face (intern (concat <span class="org-string">"all-the-icons-"</span> (plist-get declaration <span class="org-builtin">:color</span>))))
          (v-adjust (<span class="org-keyword">or</span> (plist-get declaration <span class="org-builtin">:v-adjust</span>) <span class="org-highlight-numbers-number">0.01</span>)))
      (apply set `(,name <span class="org-builtin">:face</span> ,face <span class="org-builtin">:v-adjust</span> ,v-adjust))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+doct-iconify-capture-templates</span> (groups)
    <span class="org-doc">"Add declaration's :icon to each template group in GROUPS."</span>
    (<span class="org-keyword">let</span> ((templates (doct-flatten-lists-in groups)))
      (<span class="org-keyword">setq</span> doct-templates (mapcar (<span class="org-keyword">lambda</span> (template)
                                     (<span class="org-keyword">when-let*</span> ((props (nthcdr (<span class="org-keyword">if</span> (= (length template) <span class="org-highlight-numbers-number">4</span>) <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">5</span>) template))
                                                 (spec (plist-get (plist-get props <span class="org-builtin">:doct</span>) <span class="org-builtin">:icon</span>)))
                                       (<span class="org-keyword">setf</span> (nth <span class="org-highlight-numbers-number">1</span> template) (concat (+doct-icon-declaration-to-icon spec)
                                                                      <span class="org-string">"\t"</span>
                                                                      (nth <span class="org-highlight-numbers-number">1</span> template))))
                                     template)
                                   templates))))

  (<span class="org-keyword">setq</span> doct-after-conversion-functions '(+doct-iconify-capture-templates))

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">+org-capture-recipies</span>  <span class="org-string">"~/Desktop/TEC/Organisation/recipies.org"</span>)

  (<span class="org-keyword">defun</span> <span class="org-function-name">set-org-capture-templates</span> ()
    (<span class="org-keyword">setq</span> org-capture-templates
          (doct `((<span class="org-string">"Personal todo"</span> <span class="org-builtin">:keys</span> <span class="org-string">"t"</span>
                   <span class="org-builtin">:icon</span> (<span class="org-string">"checklist"</span> <span class="org-builtin">:set</span> <span class="org-string">"octicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"green"</span>)
                   <span class="org-builtin">:file</span> +org-capture-todo-file
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:headline</span> <span class="org-string">"Inbox"</span>
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:template</span> (<span class="org-string">"* </span><span class="org-string"><span class="org-bold"><span class="org-warning">TODO</span></span></span><span class="org-string"> %?"</span>
                              <span class="org-string">"%i %a"</span>)
                   )
                  (<span class="org-string">"Personal note"</span> <span class="org-builtin">:keys</span> <span class="org-string">"n"</span>
                   <span class="org-builtin">:icon</span> (<span class="org-string">"sticky-note-o"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"green"</span>)
                   <span class="org-builtin">:file</span> +org-capture-todo-file
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:headline</span> <span class="org-string">"Inbox"</span>
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:template</span> (<span class="org-string">"* %?"</span>
                              <span class="org-string">"%i %a"</span>))
                  (<span class="org-string">"Email"</span> <span class="org-builtin">:keys</span> <span class="org-string">"e"</span>
                   <span class="org-builtin">:icon</span> (<span class="org-string">"envelope"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"blue"</span>)
                   <span class="org-builtin">:file</span> +org-capture-todo-file
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:headline</span> <span class="org-string">"Inbox"</span>
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:template</span> (<span class="org-string">"* </span><span class="org-string"><span class="org-bold"><span class="org-warning">TODO</span></span></span><span class="org-string"> %^{type|reply to|contact} %\\3 %? :email:"</span>
                              <span class="org-string">"Send an email %^{urgancy|soon|ASAP|anon|at some point|eventually} to %^{recipiant}"</span>
                              <span class="org-string">"about %^{topic}"</span>
                              <span class="org-string">"%U %i %a"</span>))
                  (<span class="org-string">"Interesting"</span> <span class="org-builtin">:keys</span> <span class="org-string">"i"</span>
                   <span class="org-builtin">:icon</span> (<span class="org-string">"eye"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"lcyan"</span>)
                   <span class="org-builtin">:file</span> +org-capture-todo-file
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:headline</span> <span class="org-string">"Interesting"</span>
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:template</span> (<span class="org-string">"* [ ] %{desc}%? :%{i-type}:"</span>
                              <span class="org-string">"%i %a"</span>)
                   <span class="org-builtin">:children</span> ((<span class="org-string">"Webpage"</span> <span class="org-builtin">:keys</span> <span class="org-string">"w"</span>
                               <span class="org-builtin">:icon</span> (<span class="org-string">"globe"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"green"</span>)
                               <span class="org-builtin">:desc</span> <span class="org-string">"%(org-cliplink-capture) "</span>
                               <span class="org-builtin">:i-type</span> <span class="org-string">"read:web"</span>
                               )
                              (<span class="org-string">"Article"</span> <span class="org-builtin">:keys</span> <span class="org-string">"a"</span>
                               <span class="org-builtin">:icon</span> (<span class="org-string">"file-text"</span> <span class="org-builtin">:set</span> <span class="org-string">"octicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"yellow"</span>)
                               <span class="org-builtin">:desc</span> <span class="org-string">""</span>
                               <span class="org-builtin">:i-type</span> <span class="org-string">"read:reaserch"</span>
                               )
                              (<span class="org-string">"\tRecipie"</span> <span class="org-builtin">:keys</span> <span class="org-string">"r"</span>
                               <span class="org-builtin">:icon</span> (<span class="org-string">"spoon"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"dorange"</span>)
                               <span class="org-builtin">:file</span> +org-capture-recipies
                               <span class="org-builtin">:headline</span> <span class="org-string">"Unsorted"</span>
                               <span class="org-builtin">:template</span> <span class="org-string">"%(org-chef-get-recipe-from-url)"</span>
                               )
                              (<span class="org-string">"Information"</span> <span class="org-builtin">:keys</span> <span class="org-string">"i"</span>
                               <span class="org-builtin">:icon</span> (<span class="org-string">"info-circle"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"blue"</span>)
                               <span class="org-builtin">:desc</span> <span class="org-string">""</span>
                               <span class="org-builtin">:i-type</span> <span class="org-string">"read:info"</span>
                               )
                              (<span class="org-string">"Idea"</span> <span class="org-builtin">:keys</span> <span class="org-string">"I"</span>
                               <span class="org-builtin">:icon</span> (<span class="org-string">"bubble_chart"</span> <span class="org-builtin">:set</span> <span class="org-string">"material"</span> <span class="org-builtin">:color</span> <span class="org-string">"silver"</span>)
                               <span class="org-builtin">:desc</span> <span class="org-string">""</span>
                               <span class="org-builtin">:i-type</span> <span class="org-string">"idea"</span>
                               )))
                  (<span class="org-string">"Tasks"</span> <span class="org-builtin">:keys</span> <span class="org-string">"k"</span>
                   <span class="org-builtin">:icon</span> (<span class="org-string">"inbox"</span> <span class="org-builtin">:set</span> <span class="org-string">"octicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"yellow"</span>)
                   <span class="org-builtin">:file</span> +org-capture-todo-file
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:headline</span> <span class="org-string">"Tasks"</span>
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:template</span> (<span class="org-string">"* </span><span class="org-string"><span class="org-bold"><span class="org-warning">TODO</span></span></span><span class="org-string"> %? %^G%{extra}"</span>
                              <span class="org-string">"%i %a"</span>)
                   <span class="org-builtin">:children</span> ((<span class="org-string">"General Task"</span> <span class="org-builtin">:keys</span> <span class="org-string">"k"</span>
                               <span class="org-builtin">:icon</span> (<span class="org-string">"inbox"</span> <span class="org-builtin">:set</span> <span class="org-string">"octicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"yellow"</span>)
                               <span class="org-builtin">:extra</span> <span class="org-string">""</span>
                               )
                              (<span class="org-string">"Task with deadline"</span> <span class="org-builtin">:keys</span> <span class="org-string">"d"</span>
                               <span class="org-builtin">:icon</span> (<span class="org-string">"timer"</span> <span class="org-builtin">:set</span> <span class="org-string">"material"</span> <span class="org-builtin">:color</span> <span class="org-string">"orange"</span> <span class="org-builtin">:v-adjust</span> <span class="org-highlight-numbers-number">-0.1</span>)
                               <span class="org-builtin">:extra</span> <span class="org-string">"\nDEADLINE: %^{Deadline:}t"</span>
                               )
                              (<span class="org-string">"Scheduled Task"</span> <span class="org-builtin">:keys</span> <span class="org-string">"s"</span>
                               <span class="org-builtin">:icon</span> (<span class="org-string">"calendar"</span> <span class="org-builtin">:set</span> <span class="org-string">"octicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"orange"</span>)
                               <span class="org-builtin">:extra</span> <span class="org-string">"\nSCHEDULED: %^{Start time:}t"</span>
                               )
                              ))
                  (<span class="org-string">"Project"</span> <span class="org-builtin">:keys</span> <span class="org-string">"p"</span>
                   <span class="org-builtin">:icon</span> (<span class="org-string">"repo"</span> <span class="org-builtin">:set</span> <span class="org-string">"octicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"silver"</span>)
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:headline</span> <span class="org-string">"Inbox"</span>
                   <span class="org-builtin">:template</span> (<span class="org-string">"* %{time-or-todo} %?"</span>
                              <span class="org-string">"%i"</span>
                              <span class="org-string">"%a"</span>)
                   <span class="org-builtin">:file</span> <span class="org-string">""</span>
                   <span class="org-builtin">:custom</span> (<span class="org-builtin">:time-or-todo</span> <span class="org-string">""</span>)
                   <span class="org-builtin">:children</span> ((<span class="org-string">"Project-local todo"</span> <span class="org-builtin">:keys</span> <span class="org-string">"t"</span>
                               <span class="org-builtin">:icon</span> (<span class="org-string">"checklist"</span> <span class="org-builtin">:set</span> <span class="org-string">"octicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"green"</span>)
                               <span class="org-builtin">:time-or-todo</span> <span class="org-string">"</span><span class="org-string"><span class="org-bold"><span class="org-warning">TODO</span></span></span><span class="org-string">"</span>
                               <span class="org-builtin">:file</span> +org-capture-project-todo-file)
                              (<span class="org-string">"Project-local note"</span> <span class="org-builtin">:keys</span> <span class="org-string">"n"</span>
                               <span class="org-builtin">:icon</span> (<span class="org-string">"sticky-note"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"yellow"</span>)
                               <span class="org-builtin">:time-or-todo</span> <span class="org-string">"%U"</span>
                               <span class="org-builtin">:file</span> +org-capture-project-notes-file)
                              (<span class="org-string">"Project-local changelog"</span> <span class="org-builtin">:keys</span> <span class="org-string">"c"</span>
                               <span class="org-builtin">:icon</span> (<span class="org-string">"list"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"blue"</span>)
                               <span class="org-builtin">:time-or-todo</span> <span class="org-string">"%U"</span>
                               <span class="org-builtin">:heading</span> <span class="org-string">"Unreleased"</span>
                               <span class="org-builtin">:file</span> +org-capture-project-changelog-file))
                   )
                  (<span class="org-string">"\tCentralised project templates"</span>
                   <span class="org-builtin">:keys</span> <span class="org-string">"o"</span>
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:template</span> (<span class="org-string">"* %{time-or-todo} %?"</span>
                              <span class="org-string">"%i"</span>
                              <span class="org-string">"%a"</span>)
                   <span class="org-builtin">:children</span> ((<span class="org-string">"Project todo"</span>
                               <span class="org-builtin">:keys</span> <span class="org-string">"t"</span>
                               <span class="org-builtin">:prepend</span> nil
                               <span class="org-builtin">:time-or-todo</span> <span class="org-string">"</span><span class="org-string"><span class="org-bold"><span class="org-warning">TODO</span></span></span><span class="org-string">"</span>
                               <span class="org-builtin">:heading</span> <span class="org-string">"Tasks"</span>
                               <span class="org-builtin">:file</span> +org-capture-central-project-todo-file)
                              (<span class="org-string">"Project note"</span>
                               <span class="org-builtin">:keys</span> <span class="org-string">"n"</span>
                               <span class="org-builtin">:time-or-todo</span> <span class="org-string">"%U"</span>
                               <span class="org-builtin">:heading</span> <span class="org-string">"Notes"</span>
                               <span class="org-builtin">:file</span> +org-capture-central-project-notes-file)
                              (<span class="org-string">"Project changelog"</span>
                               <span class="org-builtin">:keys</span> <span class="org-string">"c"</span>
                               <span class="org-builtin">:time-or-todo</span> <span class="org-string">"%U"</span>
                               <span class="org-builtin">:heading</span> <span class="org-string">"Unreleased"</span>
                               <span class="org-builtin">:file</span> +org-capture-central-project-changelog-file))
                   )))))

  (set-org-capture-templates)
  (<span class="org-keyword">unless</span> (display-graphic-p)
    (add-hook 'server-after-make-frame-hook
              (<span class="org-keyword">defun</span> <span class="org-function-name">org-capture-reinitialise-hook</span> ()
                (<span class="org-keyword">when</span> (display-graphic-p)
                  (set-org-capture-templates)
                  (remove-hook 'server-after-make-frame-hook
                               #'org-capture-reinitialise-hook))))))
</pre>
</div>
    </details>
<p>
It would also be nice to improve how the capture dialogue looks
</p>
<details id='prettify-capture' class='code' open><summary class='named'><span class="name">prettify-capture</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#prettify-capture'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-capture-select-template-prettier</span> (<span class="org-type">&amp;optional</span> keys)
  <span class="org-doc">"Select a capture template, in a prettier way than default</span>
<span class="org-doc">Lisp programs can force the template by setting KEYS to a string."</span>
  (<span class="org-keyword">let</span> ((org-capture-templates
         (<span class="org-keyword">or</span> (org-contextualize-keys
              (org-capture-upgrade-templates org-capture-templates)
              org-capture-templates-contexts)
             '((<span class="org-string">"t"</span> <span class="org-string">"Task"</span> entry (file+headline <span class="org-string">""</span> <span class="org-string">"Tasks"</span>)
                <span class="org-string">"* </span><span class="org-string"><span class="org-bold"><span class="org-warning-1">TODO</span></span></span><span class="org-string"> %?\n  %u\n  %a"</span>)))))
    (<span class="org-keyword">if</span> keys
        (<span class="org-keyword">or</span> (assoc keys org-capture-templates)
            (<span class="org-warning">error</span> <span class="org-string">"No capture template referred to by \"%s\" keys"</span> keys))
      (org-mks org-capture-templates
               <span class="org-string">"Select a capture template\n&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;"</span>
               <span class="org-string">"Template key: "</span>
               `((<span class="org-string">"q"</span> ,(concat (all-the-icons-octicon <span class="org-string">"stop"</span> <span class="org-builtin">:face</span> 'all-the-icons-red <span class="org-builtin">:v-adjust</span> <span class="org-highlight-numbers-number">0.01</span>) <span class="org-string">"\tAbort"</span>)))))))
(advice-add 'org-capture-select-template <span class="org-builtin">:override</span> #'org-capture-select-template-prettier)

(<span class="org-keyword">defun</span> <span class="org-function-name">org-mks-pretty</span> (table title <span class="org-type">&amp;optional</span> prompt specials)
  <span class="org-doc">"Select a member of an alist with multiple keys. Prettified.</span>

<span class="org-doc">TABLE is the alist which should contain entries where the car is a string.</span>
<span class="org-doc">There should be two types of entries.</span>

<span class="org-doc">1. prefix descriptions like (\"a\" \"Description\")</span>
<span class="org-doc">   This indicates that `a' is a prefix key for multi-letter selection, and</span>
<span class="org-doc">   that there are entries following with keys like \"ab\", \"ax\"&#8230;</span>

<span class="org-doc">2. Select-able members must have more than two elements, with the first</span>
<span class="org-doc">   being the string of keys that lead to selecting it, and the second a</span>
<span class="org-doc">   short description string of the item.</span>

<span class="org-doc">The command will then make a temporary buffer listing all entries</span>
<span class="org-doc">that can be selected with a single key, and all the single key</span>
<span class="org-doc">prefixes.  When you press the key for a single-letter entry, it is selected.</span>
<span class="org-doc">When you press a prefix key, the commands (and maybe further prefixes)</span>
<span class="org-doc">under this key will be shown and offered for selection.</span>

<span class="org-doc">TITLE will be placed over the selection in the temporary buffer,</span>
<span class="org-doc">PROMPT will be used when prompting for a key.  SPECIALS is an</span>
<span class="org-doc">alist with (\"key\" \"description\") entries.  When one of these</span>
<span class="org-doc">is selected, only the bare key is returned."</span>
  (<span class="org-keyword">save-window-excursion</span>
    (<span class="org-keyword">let</span> ((inhibit-quit t)
          (buffer (org-switch-to-buffer-other-window <span class="org-string">"*Org Select*"</span>))
          (prompt (<span class="org-keyword">or</span> prompt <span class="org-string">"Select: "</span>))
          case-fold-search
          current)
      (<span class="org-keyword">unwind-protect</span>
          (<span class="org-keyword">catch</span> '<span class="org-constant">exit</span>
            (<span class="org-keyword">while</span> t
              (<span class="org-keyword">setq-local</span> evil-normal-state-cursor (list nil))
              (erase-buffer)
              (insert title <span class="org-string">"\n\n"</span>)
              (<span class="org-keyword">let</span> ((des-keys nil)
                    (allowed-keys '(<span class="org-string">"\C-g"</span>))
                    (tab-alternatives '(<span class="org-string">"\s"</span> <span class="org-string">"\t"</span> <span class="org-string">"\r"</span>))
                    (cursor-type nil))
                <span class="org-comment-delimiter">;; </span><span class="org-comment">Populate allowed keys and descriptions keys</span>
                <span class="org-comment-delimiter">;; </span><span class="org-comment">available with CURRENT selector.</span>
                (<span class="org-keyword">let</span> ((re (format <span class="org-string">"\\`%s</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\'"</span>
                                  (<span class="org-keyword">if</span> current (regexp-quote current) <span class="org-string">""</span>)))
                      (prefix (<span class="org-keyword">if</span> current (concat current <span class="org-string">" "</span>) <span class="org-string">""</span>)))
                  (<span class="org-keyword">dolist</span> (entry table)
                    (<span class="org-keyword">pcase</span> entry
                      <span class="org-comment-delimiter">;; </span><span class="org-comment">Description.</span>
                      (`(,(<span class="org-keyword">and</span> key (pred (string-match re))) ,desc)
                       (<span class="org-keyword">let</span> ((k (match-string <span class="org-highlight-numbers-number">1</span> key)))
                         (<span class="org-keyword">push</span> k des-keys)
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">Keys ending in tab, space or RET are equivalent.</span>
                         (<span class="org-keyword">if</span> (member k tab-alternatives)
                             (<span class="org-keyword">push</span> <span class="org-string">"\t"</span> allowed-keys)
                           (<span class="org-keyword">push</span> k allowed-keys))
                         (insert (propertize prefix 'face 'font-lock-comment-face) (propertize k 'face 'bold) (propertize <span class="org-string">"&#8250;"</span> 'face 'font-lock-comment-face) <span class="org-string">"  "</span> desc <span class="org-string">"&#8230;"</span> <span class="org-string">"\n"</span>)))
                      <span class="org-comment-delimiter">;; </span><span class="org-comment">Usable entry.</span>
                      (`(,(<span class="org-keyword">and</span> key (pred (string-match re))) ,desc . ,_)
                       (<span class="org-keyword">let</span> ((k (match-string <span class="org-highlight-numbers-number">1</span> key)))
                         (insert (propertize prefix 'face 'font-lock-comment-face) (propertize k 'face 'bold) <span class="org-string">"   "</span> desc <span class="org-string">"\n"</span>)
                         (<span class="org-keyword">push</span> k allowed-keys)))
                      (_ nil))))
                <span class="org-comment-delimiter">;; </span><span class="org-comment">Insert special entries, if any.</span>
                (<span class="org-keyword">when</span> specials
                  (insert <span class="org-string">"&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;\n"</span>)
                  (<span class="org-keyword">pcase-dolist</span> (`(,key ,description) specials)
                    (insert (format <span class="org-string">"%s   %s\n"</span> (propertize key 'face '(bold all-the-icons-red)) description))
                    (<span class="org-keyword">push</span> key allowed-keys)))
                <span class="org-comment-delimiter">;; </span><span class="org-comment">Display UI and let user select an entry or</span>
                <span class="org-comment-delimiter">;; </span><span class="org-comment">a sub-level prefix.</span>
                (goto-char (point-min))
                (<span class="org-keyword">unless</span> (pos-visible-in-window-p (point-max))
                  (org-fit-window-to-buffer))
                (<span class="org-keyword">let</span> ((pressed (org--mks-read-key allowed-keys
                                                  prompt
                                                  (not (pos-visible-in-window-p (1- (point-max)))))))
                  (<span class="org-keyword">setq</span> current (concat current pressed))
                  (<span class="org-keyword">cond</span>
                   ((equal pressed <span class="org-string">"\C-g"</span>) (<span class="org-warning">user-error</span> <span class="org-string">"Abort"</span>))
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">Selection is a prefix: open a new menu.</span>
                   ((member pressed des-keys))
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">Selection matches an association: return it.</span>
                   ((<span class="org-keyword">let</span> ((entry (assoc current table)))
                      (<span class="org-keyword">and</span> entry (<span class="org-keyword">throw</span> '<span class="org-constant">exit</span> entry))))
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">Selection matches a special entry: return the</span>
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">selection prefix.</span>
                   ((assoc current specials) (<span class="org-keyword">throw</span> '<span class="org-constant">exit</span> current))
                   (t (<span class="org-warning">error</span> <span class="org-string">"No entry available"</span>)))))))
        (<span class="org-keyword">when</span> buffer (kill-buffer buffer))))))
(advice-add 'org-mks <span class="org-builtin">:override</span> #'org-mks-pretty)
</pre>
</div>
    </details>
<p>
The <a href="file:///home/runner/.emacs.d/bin/org-capture">org-capture bin</a> is rather nice, but I&rsquo;d be nicer with a smaller frame, and
no modeline.
</p>
<details id='capture,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#capture,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setf</span> (alist-get 'height +org-capture-frame-parameters) <span class="org-highlight-numbers-number">15</span>)
<span class="org-comment-delimiter">;; </span><span class="org-comment">(alist-get 'name +org-capture-frame-parameters) "&#10070; Capture") ;; ATM hardcoded in other places, so changing breaks stuff</span>
(<span class="org-keyword">setq</span> +org-capture-fn
      (<span class="org-keyword">lambda</span> ()
        (<span class="org-keyword">interactive</span>)
        (set-window-parameter nil 'mode-line-format 'none)
        (org-capture)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-roam" class="outline-5">
<h5 id="roam"><span class="section-number-5">6.3.2.5</span> Roam<a aria-hidden="true" href="#roam">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-5">
</div>
<div id="outline-container-basic-settings" class="outline-6">
<h6 id="basic-settings"><span class="section-number-6">6.3.2.5.1</span> Basic settings<a aria-hidden="true" href="#basic-settings">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-5-1">
<p>
I&rsquo;ll just set this to be within <kbd>Organisation</kbd> folder for now, in the future it
could be worth seeing if I could hook this up to a <a href="https://nextcloud.com/">Nextcloud</a> instance.
</p>
<details id='basic-settings,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#basic-settings,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-roam-directory <span class="org-string">"~/Desktop/TEC/Organisation/Roam/"</span>)
</pre>
</div>
    </details>

<p>
That said, if the directory doesn&rsquo;t exist we likely don&rsquo;t want to be using roam.
Since we don&rsquo;t want to trigger errors (which will happen as soon as roam tries
to initialise), let&rsquo;s not load roam.
</p>
<details id='basic-settings,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#basic-settings,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-roam <span class="org-builtin">:disable</span> t)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-registering-roam-protocol" class="outline-6">
<h6 id="registering-roam-protocol"><span class="section-number-6">6.3.2.5.2</span> Registering roam protocol<a aria-hidden="true" href="#registering-roam-protocol">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-5-2">
<p>
The recommended method of registering a protocol is by registering a desktop
application, which seems reasonable.
</p>
<details id='registering-roam-protocol,code--1' class='code' open><summary><span class="lang">Configuration File</span></summary>
    <div class='gutter'>
    <a href='#registering-roam-protocol,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-conf">[<span class="org-type">Desktop Entry</span>]
<span class="org-variable-name">Name</span>=Org-Protocol
<span class="org-variable-name">Exec</span>=emacsclient %u
<span class="org-variable-name">Icon</span>=emacs-icon
<span class="org-variable-name">Type</span>=Application
<span class="org-variable-name">Terminal</span>=false
<span class="org-variable-name">MimeType</span>=x-scheme-handler/org-protocol
</pre>
</div>
    </details>
<p>
To associate <code>org-protocol://</code> links with the desktop file,
</p>
<details id='registering-roam-protocol,code--2' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#registering-roam-protocol,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">xdg-mime default org-protocol.desktop x-scheme-handler/org-protocol
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-graph-behaviour" class="outline-6">
<h6 id="graph-behaviour"><span class="section-number-6">6.3.2.5.3</span> Graph Behaviour<a aria-hidden="true" href="#graph-behaviour">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-5-3">
<p>
By default, clicking on an <code>org-protocol://</code> link messes with the <kbd>svg</kbd> view. To fix
this we can use an <code>iframe</code>, however that requires shifting to an <kbd>html</kbd> file.
Hence, we need to do a bit of overriding.
</p>
<details id='graph-behaviour,code--1' class='code' open><summary><span class="lang">HTML</span></summary>
    <div class='gutter'>
    <a href='#graph-behaviour,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-html">&lt;<span class="org-keyword">!DOCTYPE</span> html&gt;
&lt;<span class="org-function-name">html</span>&gt;
  &lt;<span class="org-function-name">head</span>&gt;
    &lt;<span class="org-function-name">meta</span> <span class="org-variable-name">charset</span>=<span class="org-string">"utf-8"</span>&gt;
    &lt;<span class="org-function-name">title</span>&gt;<span class="org-underline"><span class="org-bold">Roam Graph</span></span>&lt;/<span class="org-function-name">title</span>&gt;
    &lt;<span class="org-function-name">meta</span> <span class="org-variable-name">name</span>=<span class="org-string">"viewport"</span> <span class="org-variable-name">content</span>=<span class="org-string">"width=device-width"</span>&gt;
    &lt;<span class="org-function-name">style</span> <span class="org-variable-name">type</span>=<span class="org-string">"text/css"</span>&gt;
      body {
      background: white;
      }

      svg {
      position: relative;
      top: 50vh;
      left: 50vw;
      transform: translate(-50%, -50%);
      width: 95vw;
      }

      a &gt; polygon {
      transition-duration: 200ms;
      transition-property: fill;
      }

      a &gt; polyline {
      transition-duration: 400ms;
      transition-property: stroke;
      }

      a:hover &gt; polygon {
      fill: #d4d4d4;
      }
      a:hover &gt; polyline {
      stroke: #888;
      }
    &lt;/<span class="org-function-name">style</span>&gt;
    &lt;<span class="org-function-name">script</span>&gt;
      function create_iframe (url) {
      i = document.createElement('iframe');
      i.setAttribute('src', url);
      i.style.setProperty('display', 'none');
      document.body.append(i);
      }
      function listen_on_all_a () {
      document.querySelectorAll("svg a").forEach(elem =&gt; {
      elem.addEventListener('click', (e) =&gt; {
      e.preventDefault();
      create_iframe(elem.href.baseVal);
      });
      });
      }
    &lt;/<span class="org-function-name">script</span>&gt;
  &lt;/<span class="org-function-name">head</span>&gt;
  &lt;<span class="org-function-name">body</span> <span class="org-variable-name">onload</span>=<span class="org-string">"listen_on_all_a()"</span>&gt;
    <span class="org-variable-name">%s</span>
  &lt;/<span class="org-function-name">body</span>&gt;
&lt;/<span class="org-function-name">html</span>&gt;
</pre>
</div>
    </details>

<details id='graph-behaviour,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#graph-behaviour,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-roam
  (<span class="org-keyword">setq</span> org-roam-graph-node-extra-config
        '((<span class="org-string">"shape"</span>      . <span class="org-string">"underline"</span>)
          (<span class="org-string">"style"</span>      . <span class="org-string">"rounded,filled"</span>)
          (<span class="org-string">"fillcolor"</span>  . <span class="org-string">"#EEEEEE"</span>)
          (<span class="org-string">"color"</span>      . <span class="org-string">"#C9C9C9"</span>)
          (<span class="org-string">"fontcolor"</span>  . <span class="org-string">"#111111"</span>)
          (<span class="org-string">"fontname"</span>   . <span class="org-string">"Overpass"</span>)))

  (<span class="org-keyword">setq</span> +org-roam-graph--html-template
        (replace-regexp-in-string <span class="org-string">"%</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">s]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> <span class="org-string">"%%\\1"</span>
                                  (f-read-text (concat doom-private-dir <span class="org-string">"misc/org-roam-template.html"</span>))))

  (<span class="org-keyword">defadvice!</span> +org-roam-graph--build-html (<span class="org-type">&amp;optional</span> node-query callback)
    <span class="org-doc">"Generate a graph showing the relations between nodes in NODE-QUERY. HTML style."</span>
    <span class="org-builtin">:override</span> #'org-roam-graph--build
    (<span class="org-keyword">unless</span> (stringp org-roam-graph-executable)
      (<span class="org-warning">user-error</span> <span class="org-string">"`</span><span class="org-string"><span class="org-constant">org-roam-graph-executable</span></span><span class="org-string">' is not a string"</span>))
    (<span class="org-keyword">unless</span> (executable-find org-roam-graph-executable)
      (<span class="org-warning">user-error</span> (concat <span class="org-string">"Cannot find executable %s to generate the graph.  "</span>
                          <span class="org-string">"Please adjust `</span><span class="org-string"><span class="org-constant">org-roam-graph-executable</span></span><span class="org-string">'"</span>)
                  org-roam-graph-executable))
    (<span class="org-keyword">let*</span> ((node-query (<span class="org-keyword">or</span> node-query
                           `[<span class="org-builtin">:select</span> [file titles] <span class="org-builtin">:from</span> titles
                             ,@(org-roam-graph--expand-matcher 'file t)]))
           (graph      (org-roam-graph--dot node-query))
           (temp-dot   (make-temp-file <span class="org-string">"graph."</span> nil <span class="org-string">".dot"</span> graph))
           (temp-graph (make-temp-file <span class="org-string">"graph."</span> nil <span class="org-string">".svg"</span>))
           (temp-html  (make-temp-file <span class="org-string">"graph."</span> nil <span class="org-string">".html"</span>)))
      (org-roam-message <span class="org-string">"building graph"</span>)
      (make-process
       <span class="org-builtin">:name</span> <span class="org-string">"*org-roam-graph--build-process*"</span>
       <span class="org-builtin">:buffer</span> <span class="org-string">"*org-roam-graph--build-process*"</span>
       <span class="org-builtin">:command</span> `(,org-roam-graph-executable ,temp-dot <span class="org-string">"-Tsvg"</span> <span class="org-string">"-o"</span> ,temp-graph)
       <span class="org-builtin">:sentinel</span> (<span class="org-keyword">progn</span>
                   (<span class="org-keyword">lambda</span> (process _event)
                     (<span class="org-keyword">when</span> (= <span class="org-highlight-numbers-number">0</span> (process-exit-status process))
                       (write-region (format +org-roam-graph--html-template (f-read-text temp-graph)) nil temp-html)
                       (<span class="org-keyword">when</span> callback
                         (funcall callback temp-html)))))))))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-modeline-file-name" class="outline-6">
<h6 id="modeline-file-name"><span class="section-number-6">6.3.2.5.4</span> Modeline file name<a aria-hidden="true" href="#modeline-file-name">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-5-4">
<p>
All those numbers! It&rsquo;s messy. Let&rsquo;s adjust this in a similar way that I have in
the <a href="#window-title">Window title</a>.
</p>
<details id='modeline-file-name,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#modeline-file-name,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> doom-modeline--buffer-file-name-roam-aware-a (orig-fun)
  <span class="org-builtin">:around</span> #'doom-modeline-buffer-file-name <span class="org-comment-delimiter">; </span><span class="org-comment">takes no args</span>
  (<span class="org-keyword">if</span> (s-contains-p org-roam-directory (<span class="org-keyword">or</span> buffer-file-name <span class="org-string">""</span>))
      (replace-regexp-in-string
       <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">^</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">.*/</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]\\{4\\}</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]\\{2\\}</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]\\{2\\}</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">[0-9]*-"</span>
       <span class="org-string">"&#129172;(\\1-\\2-\\3) "</span>
       (subst-char-in-string ?_ ?  buffer-file-name))
    (funcall orig-fun)))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-nicer-generated-heading" class="outline-5">
<h5 id="nicer-generated-heading"><span class="section-number-5">6.3.2.6</span> Nicer generated heading <span class='acr'><span class='acr'>ID</span></span><small>s</small><a aria-hidden="true" href="#nicer-generated-heading">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-6">
<p>
Thanks to alphapapa&rsquo;s <a href="https://github.com/alphapapa/unpackaged.el#export-to-html-with-useful-anchors">unpackaged.el</a>.
</p>

<p>
By default, Org generated heading <span class='acr'>ID</span><small>s</small> like <kbd>#org80fc2a5</kbd> which &#x2026; works, but has
two issues
</p>
<ul class="org-ul">
<li>It&rsquo;s completely uninformative, I have no idea what&rsquo;s being referenced</li>
<li>If I export the same file, everything will change.
Now, while without hardcoded values it&rsquo;s impossible to set references in
stone, it would be nice for there to be a decent chance of staying the same.</li>
</ul>

<p>
Both of these issues can be addressed by generating <span class='acr'>ID</span><small>s</small> like
<kbd>#language-configuration</kbd>, which is what I&rsquo;ll do here.
</p>

<p>
It&rsquo;s worth noting that alphapapa&rsquo;s use of <code>url-hexify-string</code> seemed to cause me
some issues. Replacing that in <code>a53899</code> resolved this for me. To go one step
further, I create a function for producing nice short links, like an inferior
version of <code>reftex-label</code>.
</p>

<details id='nicer-generated-heading,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#nicer-generated-heading,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-reference-contraction-max-words</span> <span class="org-highlight-numbers-number">3</span>
  <span class="org-doc">"Maximum number of words in a reference reference."</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-reference-contraction-max-length</span> <span class="org-highlight-numbers-number">35</span>
  <span class="org-doc">"Maximum length of resulting reference reference, including joining characters."</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-reference-contraction-stripped-words</span>
  '(<span class="org-string">"the"</span> <span class="org-string">"on"</span> <span class="org-string">"in"</span> <span class="org-string">"off"</span> <span class="org-string">"a"</span> <span class="org-string">"for"</span> <span class="org-string">"by"</span> <span class="org-string">"of"</span> <span class="org-string">"and"</span> <span class="org-string">"is"</span> <span class="org-string">"to"</span>)
  <span class="org-doc">"Superfluous words to be removed from a reference."</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-reference-contraction-joining-char</span> <span class="org-string">"-"</span>
  <span class="org-doc">"Character used to join words in the reference reference."</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">org-reference-contraction-truncate-words</span> (words)
  <span class="org-doc">"Using `</span><span class="org-doc"><span class="org-constant">org-reference-contraction-max-length</span></span><span class="org-doc">' as the total character 'budget' for the WORDS</span>
<span class="org-doc">and truncate individual words to conform to this budget.</span>

<span class="org-doc">To arrive at a budget that accounts for words undershooting their requisite average length,</span>
<span class="org-doc">the number of characters in the budget freed by short words is distributed among the words</span>
<span class="org-doc">exceeding the average length.  This adjusts the per-word budget to be the maximum feasable for</span>
<span class="org-doc">this particular situation, rather than the universal maximum average.</span>

<span class="org-doc">This budget-adjusted per-word maximum length is given by the mathematical expression below:</span>

<span class="org-doc">max length = \\floor{ \\frac{total length - chars for seperators - \\sum_{word \\leq average length} length(word) }{num(words) &gt; average length} }"</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">trucate each word to a max word length determined by</span>
  <span class="org-comment-delimiter">;;</span>
  (<span class="org-keyword">let*</span> ((total-length-budget (- org-reference-contraction-max-length  <span class="org-comment-delimiter">; </span><span class="org-comment">how many non-separator chars we can use</span>
                                 (1- (length words))))
         (word-length-budget (/ total-length-budget                      <span class="org-comment-delimiter">; </span><span class="org-comment">max length of each word to keep within budget</span>
                                org-reference-contraction-max-words))
         (num-overlong (-count (<span class="org-keyword">lambda</span> (word)                            <span class="org-comment-delimiter">; </span><span class="org-comment">how many words exceed that budget</span>
                                 (&gt; (length word) word-length-budget))
                               words))
         (total-short-length (-sum (mapcar (<span class="org-keyword">lambda</span> (word)                <span class="org-comment-delimiter">; </span><span class="org-comment">total length of words under that budget</span>
                                             (<span class="org-keyword">if</span> (&lt;= (length word) word-length-budget)
                                                 (length word) <span class="org-highlight-numbers-number">0</span>))
                                           words)))
         (max-length (/ (- total-length-budget total-short-length)       <span class="org-comment-delimiter">; </span><span class="org-comment">max(max-length) that we can have to fit within the budget</span>
                        num-overlong)))
    (mapcar (<span class="org-keyword">lambda</span> (word)
              (<span class="org-keyword">if</span> (&lt;= (length word) max-length)
                  word
                (substring word <span class="org-highlight-numbers-number">0</span> max-length)))
            words)))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-reference-contraction</span> (reference-string)
  <span class="org-doc">"Give a contracted form of REFERENCE-STRING that is only contains alphanumeric characters.</span>
<span class="org-doc">Strips 'joining' words present in `</span><span class="org-doc"><span class="org-constant">org-reference-contraction-stripped-words</span></span><span class="org-doc">',</span>
<span class="org-doc">and then limits the result to the first `</span><span class="org-doc"><span class="org-constant">org-reference-contraction-max-words</span></span><span class="org-doc">' words.</span>
<span class="org-doc">If the total length is &gt; `</span><span class="org-doc"><span class="org-constant">org-reference-contraction-max-length</span></span><span class="org-doc">' then individual words are</span>
<span class="org-doc">truncated to fit within the limit using `</span><span class="org-doc"><span class="org-constant">org-reference-contraction-truncate-words</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">let</span> ((reference-words
         (-filter (<span class="org-keyword">lambda</span> (word)
                    (not (member word org-reference-contraction-stripped-words)))
                  (split-string
                   (<span class="org-keyword">-&gt;&gt;</span> reference-string
                        downcase
                        (replace-regexp-in-string <span class="org-string">"\\[\\[[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">]]+\\]\\[</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">]]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\]\\]"</span> <span class="org-string">"\\1"</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">get description from org-link</span>
                        (replace-regexp-in-string <span class="org-string">"[-/ ]+"</span> <span class="org-string">" "</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">replace seperator-type chars with space</span>
                        puny-encode-string
                        (replace-regexp-in-string <span class="org-string">"^xn--</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> ?-?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[a-z0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">$"</span> <span class="org-string">"\\2 \\1"</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">rearrange punycode</span>
                        (replace-regexp-in-string <span class="org-string">"[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">A-Za-z0-9 ]"</span> <span class="org-string">""</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">strip chars which need %-encoding in a uri</span>
                        ) <span class="org-string">" +"</span>))))
    (<span class="org-keyword">when</span> (&gt; (length reference-words)
             org-reference-contraction-max-words)
      (<span class="org-keyword">setq</span> reference-words
            (cl-subseq reference-words <span class="org-highlight-numbers-number">0</span> org-reference-contraction-max-words)))

    (<span class="org-keyword">when</span> (&gt; (apply #'+ (1- (length reference-words))
                    (mapcar #'length reference-words))
             org-reference-contraction-max-length)
      (<span class="org-keyword">setq</span> reference-words (org-reference-contraction-truncate-words reference-words)))

    (string-join reference-words org-reference-contraction-joining-char)))
</pre>
</div>
    </details>

<p>
Now here&rsquo;s alphapapa&rsquo;s subtly tweaked mode.
</p>
<details id='nicer-generated-heading,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#nicer-generated-heading,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">define-minor-mode</span> <span class="org-function-name">unpackaged/org-export-html-with-useful-ids-mode</span>
  <span class="org-doc">"Attempt to export Org as HTML with useful link IDs.</span>
<span class="org-doc">Instead of random IDs like \"#orga1b2c3\", use heading titles,</span>
<span class="org-doc">made unique when necessary."</span>
  <span class="org-builtin">:global</span> t
  (<span class="org-keyword">if</span> unpackaged/org-export-html-with-useful-ids-mode
      (advice-add #'org-export-get-reference <span class="org-builtin">:override</span> #'unpackaged/org-export-get-reference)
    (advice-remove #'org-export-get-reference #'unpackaged/org-export-get-reference)))
(unpackaged/org-export-html-with-useful-ids-mode <span class="org-highlight-numbers-number">1</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">ensure enabled, and advice run</span>

(<span class="org-keyword">defun</span> <span class="org-function-name">unpackaged/org-export-get-reference</span> (datum info)
  <span class="org-doc">"Like `</span><span class="org-doc"><span class="org-constant">org-export-get-reference</span></span><span class="org-doc">', except uses heading titles instead of random numbers."</span>
  (<span class="org-keyword">let</span> ((cache (plist-get info <span class="org-builtin">:internal-references</span>)))
    (<span class="org-keyword">or</span> (car (rassq datum cache))
        (<span class="org-keyword">let*</span> ((crossrefs (plist-get info <span class="org-builtin">:crossrefs</span>))
               (cells (org-export-search-cells datum))
               <span class="org-comment-delimiter">;; </span><span class="org-comment">Preserve any pre-existing association between</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">a search cell and a reference, i.e., when some</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">previously published document referenced a location</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">within current file (see</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">`</span><span class="org-comment"><span class="org-constant">org-publish-resolve-external-link</span></span><span class="org-comment">').</span>
               <span class="org-comment-delimiter">;;</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">However, there is no guarantee that search cells are</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">unique, e.g., there might be duplicate custom ID or</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">two headings with the same title in the file.</span>
               <span class="org-comment-delimiter">;;</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">As a consequence, before re-using any reference to</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">an element or object, we check that it doesn't refer</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">to a previous element or object.</span>
               (new (<span class="org-keyword">or</span> (cl-some
                         (<span class="org-keyword">lambda</span> (cell)
                           (<span class="org-keyword">let</span> ((stored (cdr (assoc cell crossrefs))))
                             (<span class="org-keyword">when</span> stored
                               (<span class="org-keyword">let</span> ((old (org-export-format-reference stored)))
                                 (<span class="org-keyword">and</span> (not (assoc old cache)) stored)))))
                         cells)
                        (<span class="org-keyword">when</span> (org-element-property <span class="org-builtin">:raw-value</span> datum)
                          <span class="org-comment-delimiter">;; </span><span class="org-comment">Heading with a title</span>
                          (unpackaged/org-export-new-named-reference datum cache))
                        (<span class="org-keyword">when</span> (member (car datum) '(src-block table example fixed-width property-drawer))
                          <span class="org-comment-delimiter">;; </span><span class="org-comment">Nameable elements</span>
                          (unpackaged/org-export-new-named-reference datum cache))
                        <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-bold"><span class="org-success">NOTE:</span></span></span><span class="org-comment"> This probably breaks some Org Export</span>
                        <span class="org-comment-delimiter">;; </span><span class="org-comment">feature, but if it does what I need, fine.</span>
                        (org-export-format-reference
                         (org-export-new-reference cache))))
               (reference-string new))
          <span class="org-comment-delimiter">;; </span><span class="org-comment">Cache contains both data already associated to</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment">a reference and in-use internal references, so as to make</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment">unique references.</span>
          (<span class="org-keyword">dolist</span> (cell cells) (<span class="org-keyword">push</span> (cons cell new) cache))
          <span class="org-comment-delimiter">;; </span><span class="org-comment">Retain a direct association between reference string and</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment">DATUM since (1) not every object or element can be given</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment">a search cell (2) it permits quick lookup.</span>
          (<span class="org-keyword">push</span> (cons reference-string datum) cache)
          (plist-put info <span class="org-builtin">:internal-references</span> cache)
          reference-string))))

(<span class="org-keyword">defun</span> <span class="org-function-name">unpackaged/org-export-new-named-reference</span> (datum cache)
  <span class="org-doc">"Return new reference for DATUM that is unique in CACHE."</span>
  (<span class="org-keyword">cl-macrolet</span> ((inc-suffixf (place)
                             `(<span class="org-keyword">progn</span>
                                (string-match (<span class="org-keyword">rx</span> bos
                                                  (minimal-match (group (1+ anything)))
                                                  (optional <span class="org-string">"--"</span> (group (1+ digit)))
                                                  eos)
                                              ,place)
                                <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-bold"><span class="org-constant">HACK:</span></span></span><span class="org-comment"> `</span><span class="org-comment"><span class="org-constant">s1</span></span><span class="org-comment">' instead of a gensym.</span>
                                (<span class="org-keyword">-let*</span> (((s1 suffix) (list (match-string <span class="org-highlight-numbers-number">1</span> ,place)
                                                           (match-string <span class="org-highlight-numbers-number">2</span> ,place)))
                                        (suffix (<span class="org-keyword">if</span> suffix
                                                    (string-to-number suffix)
                                                  <span class="org-highlight-numbers-number">0</span>)))
                                  (<span class="org-keyword">setf</span> ,place (format <span class="org-string">"%s--%s"</span> s1 (<span class="org-keyword">cl-incf</span> suffix)))))))
    (<span class="org-keyword">let*</span> ((headline-p (eq (car datum) 'headline))
           (title (<span class="org-keyword">if</span> headline-p
                      (org-element-property <span class="org-builtin">:raw-value</span> datum)
                    (<span class="org-keyword">or</span> (org-element-property <span class="org-builtin">:name</span> datum)
                        (concat (org-element-property <span class="org-builtin">:raw-value</span>
                                                      (org-element-property <span class="org-builtin">:parent</span>
                                                                            (org-element-property <span class="org-builtin">:parent</span> datum)))))))
           <span class="org-comment-delimiter">;; </span><span class="org-comment">get ascii-only form of title without needing percent-encoding</span>
           (ref (concat (org-reference-contraction (substring-no-properties title))
                        (<span class="org-keyword">unless</span> (<span class="org-keyword">or</span> headline-p (org-element-property <span class="org-builtin">:name</span> datum))
                          (concat <span class="org-string">","</span>
                                  (<span class="org-keyword">pcase</span> (car datum)
                                    ('src-block <span class="org-string">"code"</span>)
                                    ('example <span class="org-string">"example"</span>)
                                    ('fixed-width <span class="org-string">"mono"</span>)
                                    ('property-drawer <span class="org-string">"properties"</span>)
                                    (_ (symbol-name (car datum))))
                                  <span class="org-string">"--1"</span>))))
           (parent (<span class="org-keyword">when</span> headline-p (org-element-property <span class="org-builtin">:parent</span> datum))))
      (<span class="org-keyword">while</span> (<span class="org-keyword">--any</span> (equal ref (car it))
                    cache)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">Title not unique: make it so.</span>
        (<span class="org-keyword">if</span> parent
            <span class="org-comment-delimiter">;; </span><span class="org-comment">Append ancestor title.</span>
            (<span class="org-keyword">setf</span> title (concat (org-element-property <span class="org-builtin">:raw-value</span> parent)
                                <span class="org-string">"--"</span> title)
                  <span class="org-comment-delimiter">;; </span><span class="org-comment">get ascii-only form of title without needing percent-encoding</span>
                  ref (org-reference-contraction (substring-no-properties title))
                  parent (<span class="org-keyword">when</span> headline-p (org-element-property <span class="org-builtin">:parent</span> parent)))
          <span class="org-comment-delimiter">;; </span><span class="org-comment">No more ancestors: add and increment a number.</span>
          (inc-suffixf ref)))
      ref)))

(add-hook 'org-load-hook #'unpackaged/org-export-html-with-useful-ids-mode)
</pre>
</div>
    </details>
<p>
We also need to redefine <code class="src src-elisp">(org-export-format-reference)</code> as it now may
be passed a string as well as a number.
</p>
<details id='nicer-generated-heading,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#nicer-generated-heading,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> org-export-format-reference-a (reference)
  <span class="org-doc">"Format REFERENCE into a string.</span>

<span class="org-doc">REFERENCE is a either a number or a string representing a reference,</span>
<span class="org-doc">as returned by `</span><span class="org-doc"><span class="org-constant">org-export-new-reference</span></span><span class="org-doc">'."</span>
  <span class="org-builtin">:override</span> #'org-export-format-reference
  (<span class="org-keyword">if</span> (stringp reference) reference (format <span class="org-string">"org%07x"</span> reference)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-nicer-org-return" class="outline-5">
<h5 id="nicer-org-return"><span class="section-number-5">6.3.2.7</span> Nicer <code>org-return</code><a aria-hidden="true" href="#nicer-org-return">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-7">
<p>
Once again, from <a href="https://github.com/alphapapa/unpackaged.el#org-return-dwim">unpackaged.el</a>
</p>
<details id='nicer-org-return,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#nicer-org-return,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">unpackaged/org-element-descendant-of</span> (type element)
  <span class="org-doc">"Return non-nil if ELEMENT is a descendant of TYPE.</span>
<span class="org-doc">TYPE should be an element type, like `</span><span class="org-doc"><span class="org-constant">item</span></span><span class="org-doc">' or `</span><span class="org-doc"><span class="org-constant">paragraph</span></span><span class="org-doc">'.</span>
<span class="org-doc">ELEMENT should be a list like that returned by `</span><span class="org-doc"><span class="org-constant">org-element-context</span></span><span class="org-doc">'."</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">MAYBE: Use `</span><span class="org-comment"><span class="org-constant">org-element-lineage</span></span><span class="org-comment">'.</span>
  (<span class="org-keyword">when-let*</span> ((parent (org-element-property <span class="org-builtin">:parent</span> element)))
    (<span class="org-keyword">or</span> (eq type (car parent))
        (unpackaged/org-element-descendant-of type parent))))

<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning-1">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">unpackaged/org-return-dwim</span> (<span class="org-type">&amp;optional</span> default)
  <span class="org-doc">"A helpful replacement for `</span><span class="org-doc"><span class="org-constant">org-return-indent</span></span><span class="org-doc">'.  With prefix, call `</span><span class="org-doc"><span class="org-constant">org-return-indent</span></span><span class="org-doc">'.</span>

<span class="org-doc">On headings, move point to position after entry content.  In</span>
<span class="org-doc">lists, insert a new item or end the list, with checkbox if</span>
<span class="org-doc">appropriate.  In tables, insert a new row or end the table."</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Inspired by John Kitchin: http://kitchingroup.cheme.cmu.edu/blog/2017/04/09/A-better-return-in-org-mode/</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">if</span> default
      (org-return t)
    (<span class="org-keyword">cond</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Act depending on context around point.</span>

     <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-bold"><span class="org-success">NOTE:</span></span></span><span class="org-comment"> I prefer RET to not follow links, but by uncommenting this block, links will be</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">followed.</span>

     <span class="org-comment-delimiter">;; </span><span class="org-comment">((eq 'link (car (org-element-context)))</span>
     <span class="org-comment-delimiter">;;  </span><span class="org-comment">;; Link: Open it.</span>
     <span class="org-comment-delimiter">;;  </span><span class="org-comment">(org-open-at-point-global))</span>

     ((org-at-heading-p)
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Heading: Move to position after entry content.</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-bold"><span class="org-success">NOTE:</span></span></span><span class="org-comment"> This is probably the most interesting feature of this function.</span>
      (<span class="org-keyword">let</span> ((heading-start (org-entry-beginning-position)))
        (goto-char (org-entry-end-position))
        (<span class="org-keyword">cond</span> ((<span class="org-keyword">and</span> (org-at-heading-p)
                    (= heading-start (org-entry-beginning-position)))
               <span class="org-comment-delimiter">;; </span><span class="org-comment">Entry ends on its heading; add newline after</span>
               (end-of-line)
               (insert <span class="org-string">"\n\n"</span>))
              (t
               <span class="org-comment-delimiter">;; </span><span class="org-comment">Entry ends after its heading; back up</span>
               (forward-line <span class="org-highlight-numbers-number">-1</span>)
               (end-of-line)
               (<span class="org-keyword">when</span> (org-at-heading-p)
                 <span class="org-comment-delimiter">;; </span><span class="org-comment">At the same heading</span>
                 (forward-line)
                 (insert <span class="org-string">"\n"</span>)
                 (forward-line <span class="org-highlight-numbers-number">-1</span>))
               <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-bold"><span class="org-error">FIXME:</span></span></span><span class="org-comment"> looking-back is supposed to be called with more arguments.</span>
               (<span class="org-keyword">while</span> (not (looking-back (<span class="org-keyword">rx</span> (repeat <span class="org-highlight-numbers-number">3</span> (seq (optional blank) <span class="org-string">"\n"</span>)))))
                 (insert <span class="org-string">"\n"</span>))
               (forward-line <span class="org-highlight-numbers-number">-1</span>)))))

     ((org-at-item-checkbox-p)
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Checkbox: Insert new item with checkbox.</span>
      (org-insert-todo-heading nil))

     ((org-in-item-p)
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Plain list.  Yes, this gets a little complicated...</span>
      (<span class="org-keyword">let</span> ((context (org-element-context)))
        (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (eq 'plain-list (car context))  <span class="org-comment-delimiter">; </span><span class="org-comment">First item in list</span>
                (<span class="org-keyword">and</span> (eq 'item (car context))
                     (not (eq (org-element-property <span class="org-builtin">:contents-begin</span> context)
                              (org-element-property <span class="org-builtin">:contents-end</span> context))))
                (unpackaged/org-element-descendant-of 'item context))  <span class="org-comment-delimiter">; </span><span class="org-comment">Element in list item, e.g. a link</span>
            <span class="org-comment-delimiter">;; </span><span class="org-comment">Non-empty item: Add new item.</span>
            (org-insert-item)
          <span class="org-comment-delimiter">;; </span><span class="org-comment">Empty item: Close the list.</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-bold"><span class="org-warning">TODO:</span></span></span><span class="org-comment"> Do this with org functions rather than operating on the text. Can't seem to find the right function.</span>
          (delete-region (line-beginning-position) (line-end-position))
          (insert <span class="org-string">"\n"</span>))))

     ((<span class="org-keyword">when</span> (fboundp 'org-inlinetask-in-task-p)
        (org-inlinetask-in-task-p))
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Inline task: Don't insert a new heading.</span>
      (org-return t))

     ((org-at-table-p)
      (<span class="org-keyword">cond</span> ((<span class="org-keyword">save-excursion</span>
               (beginning-of-line)
               <span class="org-comment-delimiter">;; </span><span class="org-comment">See `</span><span class="org-comment"><span class="org-constant">org-table-next-field</span></span><span class="org-comment">'.</span>
               (<span class="org-keyword">cl-loop</span> with end = (line-end-position)
                        for cell = (org-element-table-cell-parser)
                        always (equal (org-element-property <span class="org-builtin">:contents-begin</span> cell)
                                      (org-element-property <span class="org-builtin">:contents-end</span> cell))
                        while (re-search-forward <span class="org-string">"|"</span> end t)))
             <span class="org-comment-delimiter">;; </span><span class="org-comment">Empty row: end the table.</span>
             (delete-region (line-beginning-position) (line-end-position))
             (org-return t))
            (t
             <span class="org-comment-delimiter">;; </span><span class="org-comment">Non-empty row: call `</span><span class="org-comment"><span class="org-constant">org-return-indent</span></span><span class="org-comment">'.</span>
             (org-return t))))
     (t
      <span class="org-comment-delimiter">;; </span><span class="org-comment">All other cases: call `</span><span class="org-comment"><span class="org-constant">org-return-indent</span></span><span class="org-comment">'.</span>
      (org-return t)))))

(<span class="org-keyword">map!</span>
 <span class="org-builtin">:after</span> evil-org
 <span class="org-builtin">:map</span> evil-org-mode-map
 <span class="org-builtin">:i</span> [return] #'unpackaged/org-return-dwim)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-snippet-helpers" class="outline-5">
<h5 id="snippet-helpers"><span class="section-number-5">6.3.2.8</span> Snippet Helpers<a aria-hidden="true" href="#snippet-helpers">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-8">
<p>
I often want to set <kbd>src-block</kbd> headers, and it&rsquo;s a pain to
</p>
<ul class="org-ul">
<li>type them out</li>
<li>remember what the accepted values are</li>
<li>oh, and specifying the same language again and again</li>
</ul>

<p>
We can solve this in three steps
</p>
<ul class="org-ul">
<li>having one-letter snippets, conditioned on <code>(point)</code> being within a src header</li>
<li>creating a nice prompt showing accepted values and the current default</li>
<li>pre-filling the <kbd>src-block</kbd> language with the last language used</li>
</ul>

<p>
For header args, the keys I&rsquo;ll use are
</p>
<ul class="org-ul">
<li><kbd>r</kbd> for <kbd>:results</kbd></li>
<li><kbd>e</kbd> for <kbd>:exports</kbd></li>
<li><kbd>v</kbd> for <kbd>:eval</kbd></li>
<li><kbd>s</kbd> for <kbd>:session</kbd></li>
<li><kbd>d</kbd> for <kbd>:dir</kbd></li>
</ul>

<details id='snippet-helpers,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#snippet-helpers,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+yas/org-src-header-p</span> ()
  <span class="org-doc">"Determine whether `</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' is within a src-block header or header-args."</span>
  (<span class="org-keyword">pcase</span> (org-element-type (org-element-context))
    ('src-block (&lt; (point) <span class="org-comment-delimiter">; </span><span class="org-comment">before code part of the src-block</span>
                   (<span class="org-keyword">save-excursion</span> (goto-char (org-element-property <span class="org-builtin">:begin</span> (org-element-context)))
                                   (forward-line <span class="org-highlight-numbers-number">1</span>)
                                   (point))))
    ('inline-src-block (&lt; (point) <span class="org-comment-delimiter">; </span><span class="org-comment">before code part of the inline-src-block</span>
                          (<span class="org-keyword">save-excursion</span> (goto-char (org-element-property <span class="org-builtin">:begin</span> (org-element-context)))
                                          (search-forward <span class="org-string">"]{"</span>)
                                          (point))))
    ('keyword (string-match-p <span class="org-string">"^header-args"</span> (org-element-property <span class="org-builtin">:value</span> (org-element-context))))))
</pre>
</div>
    </details>

<p>
Now let&rsquo;s write a function we can reference in yasnippets to produce a nice
interactive way to specify header args.
</p>

<details id='snippet-helpers,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#snippet-helpers,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+yas/org-prompt-header-arg</span> (arg question values)
  <span class="org-doc">"Prompt the user to set ARG header property to one of VALUES with QUESTION.</span>
<span class="org-doc">The default value is identified and indicated. If either default is selected,</span>
<span class="org-doc">or no selection is made: nil is returned."</span>
  (<span class="org-keyword">let*</span> ((src-block-p (not (looking-back <span class="org-string">"^#\\+property:[ \t]+header-args:.*"</span> (line-beginning-position))))
         (default
           (<span class="org-keyword">or</span>
            (cdr (assoc arg
                        (<span class="org-keyword">if</span> src-block-p
                            (nth <span class="org-highlight-numbers-number">2</span> (org-babel-get-src-block-info t))
                          (org-babel-merge-params
                           org-babel-default-header-args
                           (<span class="org-keyword">let</span> ((lang-headers
                                  (intern (concat <span class="org-string">"org-babel-default-header-args:"</span>
                                                  (+yas/org-src-lang)))))
                             (<span class="org-keyword">when</span> (boundp lang-headers) (eval lang-headers t)))))))
            <span class="org-string">""</span>))
         default-value)
    (<span class="org-keyword">setq</span> values (mapcar
                  (<span class="org-keyword">lambda</span> (value)
                    (<span class="org-keyword">if</span> (string-match-p (regexp-quote value) default)
                        (<span class="org-keyword">setq</span> default-value
                              (concat value <span class="org-string">" "</span>
                                      (propertize <span class="org-string">"(default)"</span> 'face 'font-lock-doc-face)))
                      value))
                  values))
    (<span class="org-keyword">let</span> ((selection (ivy-read question values <span class="org-builtin">:preselect</span> default-value)))
      (<span class="org-keyword">unless</span> (<span class="org-keyword">or</span> (string-match-p <span class="org-string">"(default)$"</span> selection)
                  (string= <span class="org-string">""</span> selection))
        selection))))
</pre>
</div>
    </details>

<p>
Finally, we fetch the language information for new source blocks.
</p>

<p>
Since we&rsquo;re getting this info, we might as well go a step further and also
provide the ability to determine the most popular language in the buffer that
doesn&rsquo;t have any <kbd>header-args</kbd> set for it (with <kbd>#+properties</kbd>).
</p>

<details id='snippet-helpers,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#snippet-helpers,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+yas/org-src-lang</span> ()
  <span class="org-doc">"Try to find the current language of the src/header at `</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">'.</span>
<span class="org-doc">Return nil otherwise."</span>
  (<span class="org-keyword">let</span> ((context (org-element-context)))
    (<span class="org-keyword">pcase</span> (org-element-type context)
      ('src-block (org-element-property <span class="org-builtin">:language</span> context))
      ('inline-src-block (org-element-property <span class="org-builtin">:language</span> context))
      ('keyword (<span class="org-keyword">when</span> (string-match <span class="org-string">"^header-args:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> ]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> (org-element-property <span class="org-builtin">:value</span> context))
                  (match-string <span class="org-highlight-numbers-number">1</span> (org-element-property <span class="org-builtin">:value</span> context)))))))

(<span class="org-keyword">defun</span> <span class="org-function-name">+yas/org-last-src-lang</span> ()
  <span class="org-doc">"Return the language of the last src-block, if it exists."</span>
  (<span class="org-keyword">save-excursion</span>
    (beginning-of-line)
    (<span class="org-keyword">when</span> (re-search-backward <span class="org-string">"^[ \t]*#\\+begin_src"</span> nil t)
      (org-element-property <span class="org-builtin">:language</span> (org-element-context)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">+yas/org-most-common-no-property-lang</span> ()
  <span class="org-doc">"Find the lang with the most source blocks that has no global header-args, else nil."</span>
  (<span class="org-keyword">let</span> (src-langs header-langs)
    (<span class="org-keyword">save-excursion</span>
      (goto-char (point-min))
      (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"^[ \t]*#\\+begin_src"</span> nil t)
        (<span class="org-keyword">push</span> (+yas/org-src-lang) src-langs))
      (goto-char (point-min))
      (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"^[ \t]*#\\+property: +header-args"</span> nil t)
        (<span class="org-keyword">push</span> (+yas/org-src-lang) header-langs)))

    (<span class="org-keyword">setq</span> src-langs
          (mapcar #'car
                  <span class="org-comment-delimiter">;; </span><span class="org-comment">sort alist by frequency (desc.)</span>
                  (sort
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">generate alist with form (value . frequency)</span>
                   (<span class="org-keyword">cl-loop</span> for (n . m) in (seq-group-by #'identity src-langs)
                            collect (cons n (length m)))
                   (<span class="org-keyword">lambda</span> (a b) (&gt; (cdr a) (cdr b))))))

    (car (cl-set-difference src-langs header-langs <span class="org-builtin">:test</span> #'string=))))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-translate-capital-keywords" class="outline-5">
<h5 id="translate-capital-keywords"><span class="section-number-5">6.3.2.9</span> Translate capital keywords (old) to lower case (new)<a aria-hidden="true" href="#translate-capital-keywords">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-9">
<p>
Everyone used to use <code>#+CAPITAL</code> keywords. Then people realised that <code>#+lowercase</code>
is actually both marginally easier and visually nicer, so now the capital
version is just used in the manual.
</p>
<blockquote>
<p>
Org is standardized on lower case. Uppercase is used in the manual as a poor
man&rsquo;s bold, and supported for historical reasons. &#x2014; <a href="https://orgmode.org/list/87tuuw3n15.fsf@nicolasgoaziou.fr">Nicolas Goaziou on the Org <span class='acr'>ML</span></a>
</p>
</blockquote>

<p>
To avoid sometimes having to choose between the hassle out of updating old
documents and using mixed syntax, I&rsquo;ll whip up a basic transcode-y function.
It likely misses some edge cases, but should mostly work.
</p>

<details id='translate-capital-keywords,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#translate-capital-keywords,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-syntax-convert-keyword-case-to-lower</span> ()
  <span class="org-doc">"Convert all #+KEYWORDS to #+keywords."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">save-excursion</span>
    (goto-char (point-min))
    (<span class="org-keyword">let</span> ((count <span class="org-highlight-numbers-number">0</span>)
          (case-fold-search nil))
      (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"^[ \t]*#\\+[A-Z_]+"</span> nil t)
        (<span class="org-keyword">unless</span> (s-matches-p <span class="org-string">"RESULTS"</span> (match-string <span class="org-highlight-numbers-number">0</span>))
          (replace-match (downcase (match-string <span class="org-highlight-numbers-number">0</span>)) t)
          (<span class="org-keyword">setq</span> count (1+ count))))
      (message <span class="org-string">"Replaced %d occurances"</span> count))))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-extra-links" class="outline-5">
<h5 id="extra-links"><span class="section-number-5">6.3.2.10</span> Extra links<a aria-hidden="true" href="#extra-links">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-10">
</div>
<div id="outline-container-extra-links-xkcd" class="outline-6">
<h6 id="extra-links-xkcd"><span class="section-number-6">6.3.2.10.1</span> xkcd<a aria-hidden="true" href="#extra-links-xkcd">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-10-1">
<p>
Because xkcd is cool, let&rsquo;s make it as easy and fun as possible to insert them.
Saving seconds adds up after all! (but only so much)
</p>

<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/is_it_worth_the_time.png' title="Don't forget the time you spend finding the chart to look up what you save. And the time spent reading this reminder about the time spent. And the time trying to figure out if either of those actually make sense. Remember, every second counts toward your life total, including these right now." alt='Is It Worth the Time?'>
</p>

<details id='xkcd,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#xkcd,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(org-link-set-parameters <span class="org-string">"xkcd"</span>
                         <span class="org-builtin">:image-data-fun</span> #'+org-xkcd-image-fn
                         <span class="org-builtin">:follow</span> #'+org-xkcd-open-fn
                         <span class="org-builtin">:export</span> #'+org-xkcd-export
                         <span class="org-builtin">:complete</span> #'+org-xkcd-complete)

(<span class="org-keyword">defun</span> <span class="org-function-name">+org-xkcd-open-fn</span> (link)
  (+org-xkcd-image-fn nil link nil))

(<span class="org-keyword">defun</span> <span class="org-function-name">+org-xkcd-image-fn</span> (protocol link description)
  <span class="org-doc">"Get image data for xkcd num LINK"</span>
  (<span class="org-keyword">let*</span> ((xkcd-info (+xkcd-fetch-info (string-to-number link)))
         (img (plist-get xkcd-info <span class="org-builtin">:img</span>))
         (alt (plist-get xkcd-info <span class="org-builtin">:alt</span>)))
    (message alt)
    (+org-image-file-data-fn protocol (xkcd-download img (string-to-number link)) description)))

(<span class="org-keyword">defun</span> <span class="org-function-name">+org-xkcd-export</span> (num desc backend _com)
  <span class="org-doc">"Convert xkcd to html/LaTeX form"</span>
  (<span class="org-keyword">let*</span> ((xkcd-info (+xkcd-fetch-info (string-to-number num)))
         (img (plist-get xkcd-info <span class="org-builtin">:img</span>))
         (alt (plist-get xkcd-info <span class="org-builtin">:alt</span>))
         (title (plist-get xkcd-info <span class="org-builtin">:title</span>))
         (file (xkcd-download img (string-to-number num))))
    (<span class="org-keyword">cond</span> ((org-export-derived-backend-p backend 'html)
           (format <span class="org-string">"&lt;img class='invertible' src='%s' title=\"%s\" alt='%s'&gt;"</span> img (subst-char-in-string ?\" ?<span class="org-warning">&#8220;</span> alt) title))
          ((org-export-derived-backend-p backend 'latex)
           (format <span class="org-string">"\\begin{figure}[!htb]</span>
<span class="org-string">  \\centering</span>
<span class="org-string">  \\includegraphics[scale=0.4]{%s}%s</span>
<span class="org-string">\\end{figure}"</span> file (<span class="org-keyword">if</span> (equal desc (format <span class="org-string">"xkcd:%s"</span> num)) <span class="org-string">""</span>
                      (format <span class="org-string">"\n  \\caption*{\\label{xkcd:%s} %s}"</span>
                              num
                              (<span class="org-keyword">or</span> desc
                                  (format <span class="org-string">"\\textbf{%s} %s"</span> title alt))))))
          (t (format <span class="org-string">"https://xkcd.com/%s"</span> num)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">+org-xkcd-complete</span> (<span class="org-type">&amp;optional</span> arg)
  <span class="org-doc">"Complete xkcd using `</span><span class="org-doc"><span class="org-constant">+xkcd-stored-info</span></span><span class="org-doc">'"</span>
  (format <span class="org-string">"xkcd:%d"</span> (+xkcd-select)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-music" class="outline-6">
<h6 id="music"><span class="section-number-6">6.3.2.10.2</span> Music<a aria-hidden="true" href="#music">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-10-2">
<p>
First, we set up all the necessarily &rsquo;utility&rsquo; functions.
</p>
<details id='music,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#music,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">org-music-player</span> 'mpris
    <span class="org-doc">"Music player type. Curretly only supports mpris."</span>)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">org-music-mpris-player</span> <span class="org-string">"Lollypop"</span>
    <span class="org-doc">"Name of the mpris player, used in the form org.gnome.MPRIS."</span>)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">org-music-track-search-method</span> 'beets
    <span class="org-doc">"Method to find the track file from the link."</span>)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">org-music-beets-db</span> <span class="org-string">"~/Music/library.db"</span>
    <span class="org-doc">"Location of the beets DB, for when using beets as the `</span><span class="org-doc"><span class="org-constant">org-music-track-search-method</span></span><span class="org-doc">'"</span>)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">org-music-folder</span> <span class="org-string">"~/Music/"</span>
    <span class="org-doc">"Location of your music folder, for when using file as the `</span><span class="org-doc"><span class="org-constant">org-music-track-search-method</span></span><span class="org-doc">'"</span>)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">org-music-recognised-extensions</span> '(<span class="org-string">"flac"</span> <span class="org-string">"mp4"</span> <span class="org-string">"m4a"</span> <span class="org-string">"aiff"</span> <span class="org-string">"wav"</span> <span class="org-string">"ogg"</span> <span class="org-string">"aiff"</span>)
    <span class="org-doc">"When searching for files in `</span><span class="org-doc"><span class="org-constant">org-music-track-search-method</span></span><span class="org-doc">', recognise these extensions as audio files."</span>)

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-get-link</span> (full <span class="org-type">&amp;optional</span> include-time)
    <span class="org-doc">"Generate link string for currently playing track, optionally including a time-stamp"</span>
    (<span class="org-keyword">pcase</span> org-music-player <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-bold"><span class="org-success">NOTE</span></span></span><span class="org-comment"> this could do with better generalisation</span>
      ('mpris (<span class="org-keyword">let*</span> ((track-metadata
                      (org-music-mpris-get-property <span class="org-string">"Metadata"</span>))
                     (album-artist (caar (cadr (assoc <span class="org-string">"xesam:albumArtist"</span> track-metadata))))
                     (artist (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (equal album-artist <span class="org-string">""</span>)
                                     (s-contains-p <span class="org-string">"various"</span> album-artist t))
                                 (caar (cadr (assoc <span class="org-string">"xesam:artist"</span> track-metadata)))
                               album-artist))
                     (track (car (cadr (assoc <span class="org-string">"xesam:title"</span> track-metadata))))
                     (start-time (<span class="org-keyword">when</span> include-time
                                   (/ (org-music-mpris-get-property <span class="org-string">"Position"</span>) <span class="org-highlight-numbers-number">1000000</span>))))
                (<span class="org-keyword">if</span> full
                    (format <span class="org-string">"[[music:%s][%s by %s]]"</span> (org-music-format-link artist track start-time) track artist)
                  (org-music-format-link artist track start-time))))
      (_ (<span class="org-keyword">user-error!</span> <span class="org-string">"The specified music player: %s is not supported"</span> org-music-player))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-format-link</span> (artist track <span class="org-type">&amp;optional</span> start-time end-time)
    (<span class="org-keyword">let</span> ((artist (replace-regexp-in-string <span class="org-string">":"</span> <span class="org-string">"\\:"</span> artist))
          (track (replace-regexp-in-string <span class="org-string">":"</span> <span class="org-string">"\\:"</span> track)))
      (concat artist <span class="org-string">":"</span> track
              (<span class="org-keyword">cond</span> ((<span class="org-keyword">and</span> start-time end-time)
                     (format <span class="org-string">"::%s-%s"</span>
                             (org-music-seconds-to-time start-time)
                             (org-music-seconds-to-time end-time)))
                    (start-time
                     (format <span class="org-string">"::%s"</span>
                             (org-music-seconds-to-time start-time)))))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-parse-link</span> (link)
    (<span class="org-keyword">let*</span> ((link-dc (<span class="org-keyword">-&gt;&gt;</span> link
                         (replace-regexp-in-string <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\\\\]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\\\:"</span> <span class="org-string">"\\1#COLON#"</span>)
                         (replace-regexp-in-string <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">::[a-z0-9]*[0-9]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\'"</span> <span class="org-string">"\\1s"</span>)))
           (link-components (mapcar (<span class="org-keyword">lambda</span> (lc) (replace-regexp-in-string <span class="org-string">"#COLON#"</span> <span class="org-string">":"</span> lc))
                                    (s-split <span class="org-string">":"</span> link-dc)))
           (artist (nth <span class="org-highlight-numbers-number">0</span> link-components))
           (track (nth <span class="org-highlight-numbers-number">1</span> link-components))
           (durations (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (&gt; (length link-components) <span class="org-highlight-numbers-number">3</span>)
                                 (equal (nth <span class="org-highlight-numbers-number">2</span> link-components) <span class="org-string">""</span>))
                        (s-split <span class="org-string">"-"</span> (nth <span class="org-highlight-numbers-number">3</span> link-components))))
           (start-time (<span class="org-keyword">when</span> durations
                         (org-music-time-to-seconds (car durations))))
           (end-time (<span class="org-keyword">when</span> (cdr durations)
                       (org-music-time-to-seconds (cadr durations)))))
      (list artist track start-time end-time)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-seconds-to-time</span> (seconds)
    <span class="org-doc">"Convert a number of seconds to a nice human duration, e.g. 5m21s.</span>
<span class="org-doc">This action is reversed by `</span><span class="org-doc"><span class="org-constant">org-music-time-to-seconds</span></span><span class="org-doc">'."</span>
    (<span class="org-keyword">if</span> (&lt; seconds <span class="org-highlight-numbers-number">60</span>)
        (format <span class="org-string">"%ss"</span> seconds)
      (<span class="org-keyword">if</span> (&lt; seconds <span class="org-highlight-numbers-number">3600</span>)
          (format <span class="org-string">"%sm%ss"</span> (/ seconds <span class="org-highlight-numbers-number">60</span>) (% seconds <span class="org-highlight-numbers-number">60</span>))
        (format <span class="org-string">"%sh%sm%ss"</span> (/ seconds <span class="org-highlight-numbers-number">3600</span>) (/ (% seconds <span class="org-highlight-numbers-number">3600</span>) <span class="org-highlight-numbers-number">60</span>) (% seconds <span class="org-highlight-numbers-number">60</span>)))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-time-to-seconds</span> (time-str)
    <span class="org-doc">"Get the number of seconds in a string produced by `</span><span class="org-doc"><span class="org-constant">org-music-seconds-to-time</span></span><span class="org-doc">'."</span>
    (<span class="org-keyword">let*</span> ((time-components (reverse (s-split <span class="org-string">"[a-z]"</span> time-str)))
           (seconds (string-to-number (nth <span class="org-highlight-numbers-number">1</span> time-components)))
           (minutes (<span class="org-keyword">when</span> (&gt; (length time-components) <span class="org-highlight-numbers-number">2</span>)
                      (string-to-number (nth <span class="org-highlight-numbers-number">2</span> time-components))))
           (hours (<span class="org-keyword">when</span> (&gt; (length time-components) <span class="org-highlight-numbers-number">3</span>)
                    (string-to-number (nth <span class="org-highlight-numbers-number">3</span> time-components)))))
      (+ (* <span class="org-highlight-numbers-number">3600</span> (<span class="org-keyword">or</span> hours <span class="org-highlight-numbers-number">0</span>)) (* <span class="org-highlight-numbers-number">60</span> (<span class="org-keyword">or</span> minutes <span class="org-highlight-numbers-number">0</span>)) seconds)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-play-track</span> (artist title <span class="org-type">&amp;optional</span> start-time end-time)
    <span class="org-doc">"Play the track specified by ARTIST and TITLE, optionally skipping to START-TIME in, stopping at END-TIME."</span>
    (<span class="org-keyword">if-let</span> ((file (org-music-find-track-file artist title)))
        (<span class="org-keyword">pcase</span> org-music-player
          ('mpris (org-music-mpris-play file start-time end-time))
          (_ (<span class="org-keyword">user-error!</span> <span class="org-string">"The specified music player: %s is not supported"</span> org-music-player)))
      (<span class="org-keyword">user-error!</span> <span class="org-string">"Could not find the track '%s' by '%s'"</span> title artist)))

  (<span class="org-keyword">add-transient-hook!</span> #'org-music-play-track
    (<span class="org-keyword">require</span> '<span class="org-constant">dbus</span>))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-mpris-play</span> (file <span class="org-type">&amp;optional</span> start-time end-time)
    (<span class="org-keyword">let</span> ((uri (url-encode-url (rng-file-name-uri file))))
      (org-music-mpris-call-method <span class="org-string">"OpenUri"</span> uri)
      (<span class="org-keyword">let</span> ((track-id (caadr (assoc <span class="org-string">"mpris:trackid"</span>
                                    (org-music-mpris-get-property <span class="org-string">"Metadata"</span>)))))
        (<span class="org-keyword">when</span> start-time
          (org-music-mpris-call-method <span class="org-string">"SetPosition"</span> <span class="org-builtin">:object-path</span> track-id
                                       <span class="org-builtin">:int64</span> (round (* start-time <span class="org-highlight-numbers-number">1000000</span>))))
        (<span class="org-keyword">when</span> end-time
          (org-music-mpris-stop-at-time uri end-time)))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">orgb3-music-mpris-stop-at-time</span> (url end-time)
    <span class="org-doc">"Check that url is playing, and if it is stop it at END-TIME."</span>
    (<span class="org-keyword">when</span> (equal url (caadr (assoc <span class="org-string">"xesam:url"</span> (org-music-mpris-get-property <span class="org-string">"Metadata"</span>))))
      (<span class="org-keyword">let*</span> ((time-current (/ (/ (org-music-mpris-get-property <span class="org-string">"Position"</span>) <span class="org-highlight-numbers-number">10000</span>) <span class="org-highlight-numbers-number">100.0</span>))
             (time-delta (- end-time time-current)))
        (message <span class="org-string">"%s"</span> time-delta)
        (<span class="org-keyword">if</span> (&lt; time-delta <span class="org-highlight-numbers-number">0</span>)
            (org-music-mpris-call-method <span class="org-string">"Pause"</span>)
          (<span class="org-keyword">if</span> (&lt; time-delta <span class="org-highlight-numbers-number">6</span>)
              (run-at-time (max <span class="org-highlight-numbers-number">0.001</span> (* <span class="org-highlight-numbers-number">0.9</span> time-delta)) nil #'org-music-mpris-stop-at-time url end-time)
            (run-at-time <span class="org-highlight-numbers-number">5</span> nil #'org-music-mpris-stop-at-time url end-time))))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-mpris-get-property</span> (property)
    <span class="org-doc">"Return the value of org.mpris.MediaPlayer2.Player.PROPERTY."</span>
    (dbus-get-property <span class="org-builtin">:session</span> (concat <span class="org-string">"org.gnome."</span> org-music-mpris-player)
                       <span class="org-string">"/org/mpris/MediaPlayer2"</span> <span class="org-string">"org.mpris.MediaPlayer2.Player"</span>
                       property))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-mpris-call-method</span> (property <span class="org-type">&amp;rest</span> args)
    <span class="org-doc">"Call org.mpris.MediaPlayer2.Player.PROPERTY with ARGS, returning the result."</span>
    (apply #'dbus-call-method <span class="org-builtin">:session</span> (concat <span class="org-string">"org.gnome."</span> org-music-mpris-player)
           <span class="org-string">"/org/mpris/MediaPlayer2"</span> <span class="org-string">"org.mpris.MediaPlayer2.Player"</span>
           property args))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-guess-mpris-player</span> ()
    (<span class="org-keyword">when-let</span> ((players
                (-filter (<span class="org-keyword">lambda</span> (interface)
                           (s-contains-p <span class="org-string">"org.mpris.MediaPlayer2"</span> interface))
                         (dbus-call-method <span class="org-builtin">:session</span>
                                           dbus-service-dbus
                                           dbus-path-dbus
                                           dbus-interface-dbus
                                           <span class="org-string">"ListNames"</span>))))
      (replace-regexp-in-string <span class="org-string">"org\\.mpris\\.MediaPlayer2\\."</span> <span class="org-string">""</span> (car players))))

  (<span class="org-keyword">when</span> (eq org-music-player 'mpris)
    (<span class="org-keyword">unless</span> org-music-mpris-player
      (<span class="org-keyword">setq</span> org-music-mpris-player (org-music-guess-mpris-player))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-find-track-file</span> (artist title)
    <span class="org-doc">"Try to find the file for TRACK by ARTIST, using `</span><span class="org-doc"><span class="org-constant">org-music-track-search-method</span></span><span class="org-doc">', returning nil if nothing could be found."</span>
    (<span class="org-keyword">pcase</span> org-music-track-search-method
      ('file (org-music-find-file artist title))
      ('beets (org-music-beets-find-file artist title))
      (_ (<span class="org-keyword">user-error!</span> <span class="org-string">"The specified music search method: %s is not supported"</span> org-music-track-search-method))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-beets-find-file</span> (artist title)
    <span class="org-doc">"Find the file correspanding to a given artist and title."</span>
    (<span class="org-keyword">let*</span> ((artist-escaped (replace-regexp-in-string <span class="org-string">"\""</span> <span class="org-string">"\\\""</span> artist))
           (title-escaped (replace-regexp-in-string <span class="org-string">"\""</span> <span class="org-string">"\\\""</span> title))
           (file
            (<span class="org-keyword">or</span>
             (shell-command-to-string
              (format
               <span class="org-string">"sqlite3 '%s' \"SELECT path FROM items WHERE albumartist IS '%s' AND title IS '%s' LIMIT 1 COLLATE NOCASE\""</span>
               (expand-file-name org-music-beets-db) artist-escaped title-escaped))
             (shell-command-to-string
              (format
               <span class="org-string">"sqlite3 '%s' \"SELECT path FROM items WHERE artist IS '%s' AND title IS '%s' LIMIT 1 COLLATE NOCASE\""</span>
               (expand-file-name org-music-beets-db) artist-escaped title-escaped)))))
      (<span class="org-keyword">if</span> (&gt; (length file) <span class="org-highlight-numbers-number">0</span>)
          (substring file <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-numbers-number">-1</span>)
        )))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-find-file</span> (artist title)
    <span class="org-doc">"Try to find a file in `</span><span class="org-doc"><span class="org-constant">org-music-folder</span></span><span class="org-doc">' which contains TITLE, looking first in ./ARTIST if possible."</span>
    (<span class="org-keyword">when-let*</span> ((music-folder (expand-file-name org-music-folder))
                (search-folders (<span class="org-keyword">or</span>
                                 (-filter <span class="org-comment-delimiter">; </span><span class="org-comment">look for folders which contain ARTIST</span>
                                  (<span class="org-keyword">lambda</span> (file-or-folder)
                                    (<span class="org-keyword">and</span>
                                     (s-contains-p artist (file-name-base file-or-folder) t)
                                     (file-directory-p file-or-folder)))
                                  (directory-files music-folder t))
                                 (list music-folder)))
                (extension-regex (format <span class="org-string">"\\.</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">%s</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\'"</span> (s-join <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">"</span> org-music-recognised-extensions)))
                (tracks (-filter
                         (<span class="org-keyword">lambda</span> (file)
                           (s-contains-p title (file-name-base file) t))
                         (-flatten (mapcar (<span class="org-keyword">lambda</span> (dir)
                                             (directory-files-recursively dir extension-regex))
                                           search-folders)))))
      (<span class="org-keyword">when</span> (&gt; (length tracks) <span class="org-highlight-numbers-number">1</span>)
        (message <span class="org-string">"Warning: multiple matches for %s by %s found"</span> title artist))
      (car tracks))))
</pre>
</div>
    </details>

<p>
Then we integrate this nicely with org-mode
</p>
<details id='music,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#music,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org
  (org-link-set-parameters <span class="org-string">"music"</span>
                           <span class="org-builtin">:follow</span> #'org-music-open-fn
                           <span class="org-builtin">:export</span> #'org-music-export-text)

  (org-link-set-parameters <span class="org-string">"Music"</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">like music, but visually fancier</span>
                           <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-bold"><span class="org-error">FIXME</span></span></span><span class="org-comment"> this should work as far as I can tell</span>
                           <span class="org-comment-delimiter">;; </span><span class="org-comment">:image-data-fun #'org-music-image-fn</span>
                           <span class="org-builtin">:follow</span> #'org-music-open-fn
                           <span class="org-builtin">:export</span> #'org-music-fancy-export)

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-open-fn</span> (link)
    (apply #'org-music-play-track (org-music-parse-link link)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-insert-current-track</span> (<span class="org-type">&amp;optional</span> include-time)
    <span class="org-doc">"Insert link to currest track, including a timestamp when the universal argument is supplied."</span>
    (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
    (pp include-time)
    (insert (org-music-get-link t include-time)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-export-text</span> (path desc backend _com <span class="org-type">&amp;optional</span> newline)
    (<span class="org-keyword">let*</span> ((track-info (org-music-parse-link path))
           (artist (nth <span class="org-highlight-numbers-number">0</span> track-info))
           (track (nth <span class="org-highlight-numbers-number">1</span> track-info))
           (start-time (nth <span class="org-highlight-numbers-number">2</span> track-info))
           (end-time (nth <span class="org-highlight-numbers-number">3</span> track-info))
           (emphasise (<span class="org-keyword">cond</span> ((org-export-derived-backend-p backend 'html)
                             (<span class="org-keyword">lambda</span> (s) (format <span class="org-string">"&lt;span style=\"font-style: italic\"&gt;%s&lt;/span&gt;"</span> s)))
                            ((org-export-derived-backend-p backend 'latex)
                             (<span class="org-keyword">lambda</span> (s) (format <span class="org-string">"\\emph{%s}"</span> s)))
                            (t (<span class="org-keyword">lambda</span> (s) s)))))
      (<span class="org-keyword">or</span> desc
          (concat
           (<span class="org-keyword">cond</span> ((<span class="org-keyword">and</span> start-time end-time)
                  (format <span class="org-string">"%s to %s seconds of%s"</span> start-time end-time (<span class="org-keyword">or</span> newline <span class="org-string">" "</span>)))
                 (start-time
                  (format <span class="org-string">"%s seconds into%s"</span> start-time (<span class="org-keyword">or</span> newline <span class="org-string">" "</span>))))
           (funcall emphasise track)
           (<span class="org-keyword">or</span> newline <span class="org-string">" "</span>)
           <span class="org-string">"by "</span>
           artist))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-cover-image</span> (track-file)
    <span class="org-doc">"Try to find a cover image for the track in the given location"</span>
    (car (-filter (<span class="org-keyword">lambda</span> (file)
                    (-contains-p '(<span class="org-string">"png"</span> <span class="org-string">"jpg"</span> <span class="org-string">"jpeg"</span>) (file-name-extension file)))
                  (directory-files (file-name-directory track-file) t <span class="org-string">"cover"</span>))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-image-fn</span> (_protocol link _description)
    (<span class="org-keyword">when-let*</span> ((track-data (org-music-parse-link link))
                (cover-file (org-music-cover-image
                             (org-music-find-track-file
                              (nth <span class="org-highlight-numbers-number">0</span> track-data) (nth <span class="org-highlight-numbers-number">1</span> track-data)))))
      (<span class="org-keyword">with-temp-buffer</span>
        (set-buffer-multibyte nil)
        (<span class="org-keyword">setq</span> buffer-file-coding-system 'binary)
        (insert-file-contents-literally cover-file)
        (buffer-substring-no-properties (point-min) (point-max)))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-music-fancy-export</span> (path desc backend _com)
    (<span class="org-keyword">let*</span> ((track-data (org-music-parse-link path))
           (file (org-music-find-track-file
                  (nth <span class="org-highlight-numbers-number">0</span> track-data) (nth <span class="org-highlight-numbers-number">1</span> track-data)))
           (cover-img (org-music-cover-image file))
           (newline-str (<span class="org-keyword">cond</span> ((org-export-derived-backend-p backend 'html) <span class="org-string">"&lt;br&gt;"</span>)
                              ((org-export-derived-backend-p backend 'latex) <span class="org-string">"\\newline "</span>)
                              (t <span class="org-string">" "</span>)))
           (text (org-music-export-text path nil backend nil newline-str)))
      (<span class="org-keyword">cond</span> ((org-export-derived-backend-p backend 'html)
             (format <span class="org-string">"&lt;div class='music-track'&gt;</span>
<span class="org-string">    &lt;img src='%s'&gt; &lt;span&gt;%s&lt;/span&gt;</span>
<span class="org-string">&lt;/div&gt;"</span> cover-img text)
             )
            ((org-export-derived-backend-p backend 'latex)
             (format <span class="org-string">"\\begin{tabular}{@{\\hspace{0.3\\columnwidth}}r@{\\hspace{0.1\\columnwidth}}p{0.4\\columnwidth}}</span>
<span class="org-string">  \\includegraphics[height=6em]{%s} &amp; \\vspace{-0.12\\columnwidth}%s</span>
<span class="org-string">\\end{tabular}"</span> cover-img text))
            (t text)))))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-youtube" class="outline-6">
<h6 id="youtube"><span class="section-number-6">6.3.2.10.3</span> YouTube<a aria-hidden="true" href="#youtube">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-10-3">
<p>
The <code>[[yt:...]]</code> links preview nicely, but don&rsquo;t export nicely. Thankfully, we can
fix that.
</p>
<details id='youtube,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#youtube,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(org-link-set-parameters <span class="org-string">"yt"</span> <span class="org-builtin">:export</span> #'+org-export-yt)
(<span class="org-keyword">defun</span> <span class="org-function-name">+org-export-yt</span> (path desc backend _com)
  (<span class="org-keyword">cond</span> ((org-export-derived-backend-p backend 'html)
         (format <span class="org-string">"&lt;iframe width='440' \</span>
<span class="org-string">height='335' \</span>
<span class="org-string">src='https://www.youtube.com/embed/%s' \</span>
<span class="org-string">frameborder='0' \</span>
<span class="org-string">allowfullscreen&gt;%s&lt;/iframe&gt;"</span> path (<span class="org-keyword">or</span> <span class="org-string">""</span> desc)))
        ((org-export-derived-backend-p backend 'latex)
         (format <span class="org-string">"\\href{https://youtu.be/%s}{%s}"</span> path (<span class="org-keyword">or</span> desc <span class="org-string">"youtube"</span>)))
        (t (format <span class="org-string">"https://youtu.be/%s"</span> path))))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-fix-problematic-hooks" class="outline-5">
<h5 id="fix-problematic-hooks"><span class="section-number-5">6.3.2.11</span> Fix problematic hooks<a aria-hidden="true" href="#fix-problematic-hooks">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-11">
<p>
When one of the <code class="src src-elisp">org-mode-hook</code> functions errors, it halts the hook
execution. This is problematic, and there are two hooks in particular which
cause issues. Let&rsquo;s make their failure less eventful.
</p>

<details id='fix-problematic-hooks,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fix-problematic-hooks,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> shut-up-org-problematic-hooks (orig-fn <span class="org-type">&amp;rest</span> args)
  <span class="org-builtin">:around</span> #'org-fancy-priorities-mode
  <span class="org-builtin">:around</span> #'org-superstar-mode
  (<span class="org-keyword">ignore-errors</span> (apply orig-fn args)))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-org-visuals" class="outline-4">
<h4 id="org-visuals"><span class="section-number-4">6.3.3</span> Visuals<a aria-hidden="true" href="#org-visuals">#</a> </h4>
<div class="outline-text-4" id="text-6-3-3">
<p>
Here I try to do two things: improve the styling of the various documents, via
font changes etc, and also propagate colours from the current theme.
</p>

<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/color_models.png' title="What if what *I* see as blue, *you* see as a slightly different blue because you're using Chrome instead of Firefox and despite a decade of messing with profiles we STILL can't get this right somehow." alt='Color Models'>
</p>
</div>

<div id="outline-container-font-display" class="outline-5">
<h5 id="font-display"><span class="section-number-5">6.3.3.1</span> Font Display<a aria-hidden="true" href="#font-display">#</a> </h5>
<div class="outline-text-5" id="text-6-3-3-1">
<p>
Mixed pitch is great. As is <code>+org-pretty-mode</code>, let&rsquo;s use them.
</p>
<details id='font-display,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-display,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'org-mode-hook #'+org-pretty-mode)
</pre>
</div>
    </details>

<p>
Let&rsquo;s make headings a bit bigger
</p>
<details id='font-display,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-display,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">custom-set-faces!</span>
  '(outline-1 <span class="org-builtin">:weight</span> extra-bold <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.25</span>)
  '(outline-2 <span class="org-builtin">:weight</span> bold <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.15</span>)
  '(outline-3 <span class="org-builtin">:weight</span> bold <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.12</span>)
  '(outline-4 <span class="org-builtin">:weight</span> semi-bold <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.09</span>)
  '(outline-5 <span class="org-builtin">:weight</span> semi-bold <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.06</span>)
  '(outline-6 <span class="org-builtin">:weight</span> semi-bold <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.03</span>)
  '(outline-8 <span class="org-builtin">:weight</span> semi-bold)
  '(outline-9 <span class="org-builtin">:weight</span> semi-bold))
</pre>
</div>
    </details>

<p>
And the same with the title.
</p>
<details id='font-display,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-display,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">custom-set-faces!</span>
  '(org-document-title <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.2</span>))
</pre>
</div>
    </details>

<p>
It seems reasonable to have deadlines in the error face when they&rsquo;re passed.
</p>
<details id='font-display,code--4' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-display,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-agenda-deadline-faces
      '((<span class="org-highlight-numbers-number">1.001</span> . error)
        (<span class="org-highlight-numbers-number">1.0</span> . org-warning)
        (<span class="org-highlight-numbers-number">0.5</span> . org-upcoming-deadline)
        (<span class="org-highlight-numbers-number">0.0</span> . org-upcoming-distant-deadline)))
</pre>
</div>
    </details>

<p>
We can then have quote blocks stand out a bit more by making them <i>italic</i>.
</p>
<details id='font-display,code--5' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-display,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-fontify-quote-and-verse-blocks t)
</pre>
</div>
    </details>

<p>
While <code>org-hide-emphasis-markers</code> is very nice, it can sometimes make edits which
occur at the border a bit more fiddley. We can improve this situation without
sacrificing visual amenities with the <kbd>org-appear</kbd> package.
</p>
<details id='font-display,code--6' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-display,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-appear
  <span class="org-builtin">:hook</span> (org-mode . org-appear-mode)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> org-appear-autoemphasis t
        org-appear-autosubmarkers t
        org-appear-autolinks nil)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">for proper first-time setup, `</span><span class="org-comment"><span class="org-constant">org-appear--set-elements</span></span><span class="org-comment">'</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">needs to be run after other hooks have acted.</span>
  (run-at-time nil nil #'org-appear--set-elements))
</pre>
</div>
    </details>

<p>
Org files can be rather nice to look at, particularly with some of the
customisations here. This comes at a cost however, expensive font-lock.
Feeling like you&rsquo;re typing through molasses in large files is no fun, but there
is a way I can defer font-locking when typing to make the experience more
responsive.
</p>
<details id='font-display,code--7' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-display,code--7'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">locally-defer-font-lock</span> ()
  <span class="org-doc">"Set jit-lock defer and stealth, when buffer is over a certain size."</span>
  (<span class="org-keyword">when</span> (&gt; (buffer-size) <span class="org-highlight-numbers-number">50000</span>)
    (<span class="org-keyword">setq-local</span> jit-lock-defer-time <span class="org-highlight-numbers-number">0.05</span>
                jit-lock-stealth-time <span class="org-highlight-numbers-number">1</span>)))

(add-hook 'org-mode-hook #'locally-defer-font-lock)
</pre>
</div>
    </details>
<p>
Apparently this causes issues with some people, but I haven&rsquo;t noticed anything
problematic beyond the expected slight delay in some fontification, so until I
do I&rsquo;ll use the above.
</p>
</div>
</div>

<div id="outline-container-fontifying-inline-src" class="outline-5">
<h5 id="fontifying-inline-src"><span class="section-number-5">6.3.3.2</span> Fontifying inline src blocks<a aria-hidden="true" href="#fontifying-inline-src">#</a> </h5>
<div class="outline-text-5" id="text-6-3-3-2">
<p>
Org does lovely things with <kbd>#+begin_src</kbd> blocks, like using font-lock for
language&rsquo;s major-mode behind the scenes and pulling out the lovely colourful
results. By contrast, inline <kbd>src_</kbd> blocks are somewhat neglected.
</p>

<p>
I am not the first person to feel this way, thankfully others have <a href="https://stackoverflow.com/questions/20309842/how-to-syntax-highlight-for-org-mode-inline-source-code-src-lang/28059832">taken to
stackexchange</a> to voice their desire for inline src fontification. I was going to
steal their work, but unfortunately they didn&rsquo;t perform <i>true</i> source code
fontification, but simply applied the <kbd>org-code</kbd> face to the content.
</p>

<p>
We can do better than that, and we shall! Using <code>org-src-font-lock-fontify-block</code>
we can apply language-appropriate syntax highlighting. Then, continuing on to
<kbd>{{{results(...)}}}</kbd> , it can have the <kbd>org-block</kbd> face applied to match, and then
the value-surrounding constructs hidden by mimicking the behaviour of
<code>prettify-symbols-mode</code>.
</p>

<div class="warning" id="orgc520788">
<p>
This currently only highlights a single inline src block per line.
I have no idea why it stops, but I&rsquo;d rather it didn&rsquo;t.
If you have any idea what&rsquo;s going on or how to fix this <i>please</i> get in touch.
</p>

</div>

<details id='fontifying-inline-src,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fontifying-inline-src,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-prettify-inline-results</span> t
  <span class="org-doc">"Whether to use (ab)use prettify-symbols-mode on {{{results(...)}}}.</span>
<span class="org-doc">Either t or a cons cell of strings which are used as substitutions</span>
<span class="org-doc">for the start and end of inline results, respectively."</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-fontify-inline-src-blocks-max-length</span> <span class="org-highlight-numbers-number">200</span>
  <span class="org-doc">"Maximum content length of an inline src block that will be fontified."</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">org-fontify-inline-src-blocks</span> (limit)
  <span class="org-doc">"Try to apply `</span><span class="org-doc"><span class="org-constant">org-fontify-inline-src-blocks-1</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">condition-case</span> nil
      (org-fontify-inline-src-blocks-1 limit)
    (<span class="org-warning">error</span> (message <span class="org-string">"Org mode fontification error in %S at %d"</span>
                    (current-buffer)
                    (line-number-at-pos)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-fontify-inline-src-blocks-1</span> (limit)
  <span class="org-doc">"Fontify inline src_LANG blocks, from `</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' up to LIMIT."</span>
  (<span class="org-keyword">let</span> ((case-fold-search t)
        (initial-point (point)))
    (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"\\_&lt;src_</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> \t\n[{]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">[{[]?"</span> limit t) <span class="org-comment-delimiter">; </span><span class="org-comment">stolen from `</span><span class="org-comment"><span class="org-constant">org-element-inline-src-block-parser</span></span><span class="org-comment">'</span>
      (<span class="org-keyword">let</span> ((beg (match-beginning <span class="org-highlight-numbers-number">0</span>))
            pt
            (lang-beg (match-beginning <span class="org-highlight-numbers-number">1</span>))
            (lang-end (match-end <span class="org-highlight-numbers-number">1</span>)))
        (remove-text-properties beg lang-end '(face nil))
        (font-lock-append-text-property lang-beg lang-end 'face 'org-meta-line)
        (font-lock-append-text-property beg lang-beg 'face 'shadow)
        (font-lock-append-text-property beg lang-end 'face 'org-block)
        (<span class="org-keyword">setq</span> pt (goto-char lang-end))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">`</span><span class="org-comment"><span class="org-constant">org-element--parse-paired-brackets</span></span><span class="org-comment">' doesn't take a limit, so to</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">prevent it searching the entire rest of the buffer we temporarily</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">narrow the active region.</span>
        (<span class="org-keyword">save-restriction</span>
          (narrow-to-region beg (min (point-max) limit (+ lang-end org-fontify-inline-src-blocks-max-length)))
          (<span class="org-keyword">when</span> (<span class="org-keyword">ignore-errors</span> (org-element--parse-paired-brackets ?\[))
            (remove-text-properties pt (point) '(face nil))
            (font-lock-append-text-property pt (point) 'face 'org-block)
            (<span class="org-keyword">setq</span> pt (point)))
          (<span class="org-keyword">when</span> (<span class="org-keyword">ignore-errors</span> (org-element--parse-paired-brackets ?\{))
            (remove-text-properties pt (point) '(face nil))
            (font-lock-append-text-property pt (1+ pt) 'face '(org-block shadow))
            (<span class="org-keyword">unless</span> (= (1+ pt) (1- (point)))
              (<span class="org-keyword">if</span> org-src-fontify-natively
                  (org-src-font-lock-fontify-block (buffer-substring-no-properties lang-beg lang-end) (1+ pt) (1- (point)))
                (font-lock-append-text-property (1+ pt) (1- (point)) 'face 'org-block)))
            (font-lock-append-text-property (1- (point)) (point) 'face '(org-block shadow))
            (<span class="org-keyword">setq</span> pt (point))))
        (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> org-prettify-inline-results (re-search-forward <span class="org-string">"\\= {{{results("</span> limit t))
          (font-lock-append-text-property pt (1+ pt) 'face 'org-block)
          (goto-char pt))))
    (<span class="org-keyword">when</span> org-prettify-inline-results
      (goto-char initial-point)
      (org-fontify-inline-src-results limit))))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-fontify-inline-src-results</span> (limit)
  (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"{{{results(</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.+?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">)}}}"</span> limit t)
    (remove-list-of-text-properties (match-beginning <span class="org-highlight-numbers-number">0</span>) (point)
                                    '(composition
                                      prettify-symbols-start
                                      prettify-symbols-end))
    (font-lock-append-text-property (match-beginning <span class="org-highlight-numbers-number">0</span>) (match-end <span class="org-highlight-numbers-number">0</span>) 'face 'org-block)
    (<span class="org-keyword">let</span> ((start (match-beginning <span class="org-highlight-numbers-number">0</span>)) (end (match-beginning <span class="org-highlight-numbers-number">1</span>)))
      (<span class="org-keyword">with-silent-modifications</span>
        (compose-region start end (<span class="org-keyword">if</span> (eq org-prettify-inline-results t) <span class="org-string">"&#10216;"</span> (car org-prettify-inline-results)))
        (add-text-properties start end `(prettify-symbols-start ,start prettify-symbols-end ,end))))
    (<span class="org-keyword">let</span> ((start (match-end <span class="org-highlight-numbers-number">1</span>)) (end (point)))
      (<span class="org-keyword">with-silent-modifications</span>
        (compose-region start end (<span class="org-keyword">if</span> (eq org-prettify-inline-results t) <span class="org-string">"&#10217;"</span> (cdr org-prettify-inline-results)))
        (add-text-properties start end `(prettify-symbols-start ,start prettify-symbols-end ,end))))))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-fontify-inline-src-blocks-enable</span> ()
  <span class="org-doc">"Add inline src fontification to font-lock in Org.</span>
<span class="org-doc">Must be run as part of `</span><span class="org-doc"><span class="org-constant">org-font-lock-set-keywords-hook</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">setq</span> org-font-lock-extra-keywords
        (append org-font-lock-extra-keywords '((org-fontify-inline-src-blocks)))))

(add-hook 'org-font-lock-set-keywords-hook #'org-fontify-inline-src-blocks-enable)
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-symbols" class="outline-5">
<h5 id="symbols"><span class="section-number-5">6.3.3.3</span> Symbols<a aria-hidden="true" href="#symbols">#</a> </h5>
<div class="outline-text-5" id="text-6-3-3-3">
<p>
It&rsquo;s also nice to change the character used for collapsed items (by default <code>â€¦</code>),
I think <code>â–¾</code> is better for indicating &rsquo;collapsed section&rsquo;.
and add an extra <code>org-bullet</code> to the default list of four.
I&rsquo;ve also added some fun alternatives, just commented out.
</p>
<details id='symbols,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#symbols,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(use-package org-pretty-tags</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">:config</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(setq org-pretty-tags-surrogate-strings</span>
<span class="org-comment-delimiter">;;        </span><span class="org-comment">`(("uni"        . ,(all-the-icons-faicon   "graduation-cap" :face 'all-the-icons-purple  :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("ucc"        . ,(all-the-icons-material "computer"       :face 'all-the-icons-silver  :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("assignment" . ,(all-the-icons-material "library_books"  :face 'all-the-icons-orange  :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("test"       . ,(all-the-icons-material "timer"          :face 'all-the-icons-red     :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("lecture"    . ,(all-the-icons-fileicon "keynote"        :face 'all-the-icons-orange  :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("email"      . ,(all-the-icons-faicon   "envelope"       :face 'all-the-icons-blue    :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("read"       . ,(all-the-icons-octicon  "book"           :face 'all-the-icons-lblue   :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("article"    . ,(all-the-icons-octicon  "file-text"      :face 'all-the-icons-yellow  :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("web"        . ,(all-the-icons-faicon   "globe"          :face 'all-the-icons-green   :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("info"       . ,(all-the-icons-faicon   "info-circle"    :face 'all-the-icons-blue    :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("issue"      . ,(all-the-icons-faicon   "bug"            :face 'all-the-icons-red     :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("someday"    . ,(all-the-icons-faicon   "calendar-o"     :face 'all-the-icons-cyan    :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("idea"       . ,(all-the-icons-octicon  "light-bulb"     :face 'all-the-icons-yellow  :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("emacs"      . ,(all-the-icons-fileicon "emacs"          :face 'all-the-icons-lpurple :v-adjust 0.01))))</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(org-pretty-tags-global-mode))</span>

(<span class="org-keyword">after!</span> org-superstar
  (<span class="org-keyword">setq</span> org-superstar-headline-bullets-list '(<span class="org-string">"&#9673;"</span> <span class="org-string">"&#9675;"</span> <span class="org-string">"&#10040;"</span> <span class="org-string">"&#10047;"</span> <span class="org-string">"&#10020;"</span> <span class="org-string">"&#10012;"</span> <span class="org-string">"&#9670;"</span> <span class="org-string">"&#9654;"</span>)
        org-superstar-prettify-item-bullets t ))

(<span class="org-keyword">setq</span> org-ellipsis <span class="org-string">" &#9662; "</span>
      org-hide-leading-stars t
      org-priority-highest ?A
      org-priority-lowest ?E
      org-priority-faces
      '((?A . 'all-the-icons-red)
        (?B . 'all-the-icons-orange)
        (?C . 'all-the-icons-yellow)
        (?D . 'all-the-icons-green)
        (?E . 'all-the-icons-blue)))
</pre>
</div>
    </details>
<p>
It&rsquo;s also nice to make use of the Unicode characters for check boxes, and other commands.
</p>
<details id='symbols,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#symbols,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">appendq!</span> +ligatures-extra-symbols
          `(<span class="org-builtin">:checkbox</span>      <span class="org-string">"&#9744;"</span>
            <span class="org-builtin">:pending</span>       <span class="org-string">"&#9724;"</span>
            <span class="org-builtin">:checkedbox</span>    <span class="org-string">"&#9745;"</span>
            <span class="org-builtin">:list_property</span> <span class="org-string">"&#8759;"</span>
            <span class="org-builtin">:em_dash</span>       <span class="org-string">"&#8212;"</span>
            <span class="org-builtin">:ellipses</span>      <span class="org-string">"&#8230;"</span>
            <span class="org-builtin">:arrow_right</span>   <span class="org-string">"&#8594;"</span>
            <span class="org-builtin">:arrow_left</span>    <span class="org-string">"&#8592;"</span>
            <span class="org-builtin">:title</span>         <span class="org-string">"&#120399;"</span>
            <span class="org-builtin">:subtitle</span>      <span class="org-string">"&#120425;"</span>
            <span class="org-builtin">:author</span>        <span class="org-string">"&#120380;"</span>
            <span class="org-builtin">:date</span>          <span class="org-string">"&#120383;"</span>
            <span class="org-builtin">:property</span>      <span class="org-string">"&#9784;"</span>
            <span class="org-builtin">:options</span>       <span class="org-string">"&#8997;"</span>
            <span class="org-builtin">:startup</span>       <span class="org-string">"&#9211;"</span>
            <span class="org-builtin">:macro</span>         <span class="org-string">"&#120028;"</span>
            <span class="org-builtin">:html_head</span>     <span class="org-string">"&#127351;"</span>
            <span class="org-builtin">:html</span>          <span class="org-string">"&#127319;"</span>
            <span class="org-builtin">:latex_class</span>   <span class="org-string">"&#127291;"</span>
            <span class="org-builtin">:latex_header</span>  <span class="org-string">"&#127355;"</span>
            <span class="org-builtin">:beamer_header</span> <span class="org-string">"&#127313;"</span>
            <span class="org-builtin">:latex</span>         <span class="org-string">"&#127323;"</span>
            <span class="org-builtin">:attr_latex</span>    <span class="org-string">"&#127259;"</span>
            <span class="org-builtin">:attr_html</span>     <span class="org-string">"&#127255;"</span>
            <span class="org-builtin">:attr_org</span>      <span class="org-string">"&#9386;"</span>
            <span class="org-builtin">:begin_quote</span>   <span class="org-string">"&#10077;"</span>
            <span class="org-builtin">:end_quote</span>     <span class="org-string">"&#10078;"</span>
            <span class="org-builtin">:caption</span>       <span class="org-string">"&#9776;"</span>
            <span class="org-builtin">:header</span>        <span class="org-string">"&#8250;"</span>
            <span class="org-builtin">:results</span>       <span class="org-string">"&#129078;"</span>
            <span class="org-builtin">:begin_export</span>  <span class="org-string">"&#9193;"</span>
            <span class="org-builtin">:end_export</span>    <span class="org-string">"&#9194;"</span>
            <span class="org-builtin">:properties</span>    <span class="org-string">"&#9881;"</span>
            <span class="org-builtin">:end</span>           <span class="org-string">"&#8718;"</span>
            <span class="org-builtin">:priority_a</span>   ,(propertize <span class="org-string">"&#9873;"</span> 'face 'all-the-icons-red)
            <span class="org-builtin">:priority_b</span>   ,(propertize <span class="org-string">"&#11014;"</span> 'face 'all-the-icons-orange)
            <span class="org-builtin">:priority_c</span>   ,(propertize <span class="org-string">"&#9632;"</span> 'face 'all-the-icons-yellow)
            <span class="org-builtin">:priority_d</span>   ,(propertize <span class="org-string">"&#11015;"</span> 'face 'all-the-icons-green)
            <span class="org-builtin">:priority_e</span>   ,(propertize <span class="org-string">"&#10067;"</span> 'face 'all-the-icons-blue)))
(set-ligatures! 'org-mode
  <span class="org-builtin">:merge</span> t
  <span class="org-builtin">:checkbox</span>      <span class="org-string">"[ ]"</span>
  <span class="org-builtin">:pending</span>       <span class="org-string">"[-]"</span>
  <span class="org-builtin">:checkedbox</span>    <span class="org-string">"[X]"</span>
  <span class="org-builtin">:list_property</span> <span class="org-string">"::"</span>
  <span class="org-builtin">:em_dash</span>       <span class="org-string">"---"</span>
  <span class="org-builtin">:ellipsis</span>      <span class="org-string">"..."</span>
  <span class="org-builtin">:arrow_right</span>   <span class="org-string">"-&gt;"</span>
  <span class="org-builtin">:arrow_left</span>    <span class="org-string">"&lt;-"</span>
  <span class="org-builtin">:title</span>         <span class="org-string">"#+title:"</span>
  <span class="org-builtin">:subtitle</span>      <span class="org-string">"#+subtitle:"</span>
  <span class="org-builtin">:author</span>        <span class="org-string">"#+author:"</span>
  <span class="org-builtin">:date</span>          <span class="org-string">"#+date:"</span>
  <span class="org-builtin">:property</span>      <span class="org-string">"#+property:"</span>
  <span class="org-builtin">:options</span>       <span class="org-string">"#+options:"</span>
  <span class="org-builtin">:startup</span>       <span class="org-string">"#+startup:"</span>
  <span class="org-builtin">:macro</span>         <span class="org-string">"#+macro:"</span>
  <span class="org-builtin">:html_head</span>     <span class="org-string">"#+html_head:"</span>
  <span class="org-builtin">:html</span>          <span class="org-string">"#+html:"</span>
  <span class="org-builtin">:latex_class</span>   <span class="org-string">"#+latex_class:"</span>
  <span class="org-builtin">:latex_header</span>  <span class="org-string">"#+latex_header:"</span>
  <span class="org-builtin">:beamer_header</span> <span class="org-string">"#+beamer_header:"</span>
  <span class="org-builtin">:latex</span>         <span class="org-string">"#+latex:"</span>
  <span class="org-builtin">:attr_latex</span>    <span class="org-string">"#+attr_latex:"</span>
  <span class="org-builtin">:attr_html</span>     <span class="org-string">"#+attr_html:"</span>
  <span class="org-builtin">:attr_org</span>      <span class="org-string">"#+attr_org:"</span>
  <span class="org-builtin">:begin_quote</span>   <span class="org-string">"#+begin_quote"</span>
  <span class="org-builtin">:end_quote</span>     <span class="org-string">"#+end_quote"</span>
  <span class="org-builtin">:caption</span>       <span class="org-string">"#+caption:"</span>
  <span class="org-builtin">:header</span>        <span class="org-string">"#+header:"</span>
  <span class="org-builtin">:begin_export</span>  <span class="org-string">"#+begin_export"</span>
  <span class="org-builtin">:end_export</span>    <span class="org-string">"#+end_export"</span>
  <span class="org-builtin">:results</span>       <span class="org-string">"#+RESULTS:"</span>
  <span class="org-builtin">:property</span>      <span class="org-string">":PROPERTIES:"</span>
  <span class="org-builtin">:end</span>           <span class="org-string">":END:"</span>
  <span class="org-builtin">:priority_a</span>    <span class="org-string">"[#A]"</span>
  <span class="org-builtin">:priority_b</span>    <span class="org-string">"[#B]"</span>
  <span class="org-builtin">:priority_c</span>    <span class="org-string">"[#C]"</span>
  <span class="org-builtin">:priority_d</span>    <span class="org-string">"[#D]"</span>
  <span class="org-builtin">:priority_e</span>    <span class="org-string">"[#E]"</span>)
(plist-put +ligatures-extra-symbols <span class="org-builtin">:name</span> <span class="org-string">"&#8269;"</span>)
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-latex-fragments" class="outline-5">
<h5 id="latex-fragments"><span class="section-number-5">6.3.3.4</span> LaTeX Fragments<a aria-hidden="true" href="#latex-fragments">#</a> </h5>
<div class="outline-text-5" id="text-6-3-3-4">
</div>
<div id="outline-container-prettier-highlighting" class="outline-6">
<h6 id="prettier-highlighting"><span class="section-number-6">6.3.3.4.1</span> Prettier highlighting<a aria-hidden="true" href="#prettier-highlighting">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-1">
<p>
First off, we want those fragments to look good.
</p>
<details id='prettier-highlighting,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#prettier-highlighting,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-highlight-latex-and-related '(native script entities))
</pre>
</div>
    </details>

<p>
However, by using <kbd>native</kbd> highlighting the <kbd>org-block</kbd> face is added, and that
doesn&rsquo;t look too great &#x2014; particularly when the fragments are previewed.
</p>

<p>
Ideally <code>org-src-font-lock-fontify-block</code> wouldn&rsquo;t add the <kbd>org-block</kbd> face, but we
can avoid advising that entire function by just adding another face with
<kbd>:inherit default</kbd> which will override the background colour.
</p>

<p>
Inspecting <code>org-do-latex-and-related</code> shows that <kbd>"latex"</kbd> is the language argument
passed, and so we can override the background as discussed above.
</p>
<details id='prettier-highlighting,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#prettier-highlighting,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">org-src</span>)
(add-to-list 'org-src-block-faces '(<span class="org-string">"latex"</span> (<span class="org-builtin">:inherit</span> default <span class="org-builtin">:extend</span> t)))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-more-eager-rendering" class="outline-6">
<h6 id="more-eager-rendering"><span class="section-number-6">6.3.3.4.2</span> More eager rendering<a aria-hidden="true" href="#more-eager-rendering">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-2">
<p>
What&rsquo;s better than syntax-highlighted LaTeX is <i>rendered</i> LaTeX though, and we can
have this be performed automatically with <kbd>org-fragtog</kbd>.
</p>
<details id='more-eager-rendering,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#more-eager-rendering,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-fragtog
  <span class="org-builtin">:hook</span> (org-mode . org-fragtog-mode))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-prettier-rendering" class="outline-6">
<h6 id="prettier-rendering"><span class="section-number-6">6.3.3.4.3</span> Prettier rendering<a aria-hidden="true" href="#prettier-rendering">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-3">
<p>
It&rsquo;s nice to customise the look of LaTeX fragments so they fit better in the
text &#x2014; like this \(\sqrt{\beta^2+3}-\sum_{\phi=1}^\infty \frac{x^\phi-1}{\Gamma(a)}\).
Let&rsquo;s start by adding a sans font. I&rsquo;d also like to use some of the
functionality from <kbd>bmc-maths</kbd>, so we&rsquo;ll load that too.
</p>

<details id='prettier-rendering,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#prettier-rendering,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-format-latex-header <span class="org-string">"\\documentclass{article}</span>
<span class="org-string">\\usepackage[usenames]{xcolor}</span>

<span class="org-string">\\usepackage[T1]{fontenc}</span>

<span class="org-string">\\usepackage{booktabs}</span>

<span class="org-string">\\pagestyle{empty}             % do not remove</span>
<span class="org-string">% The settings below are copied from fullpage.sty</span>
<span class="org-string">\\setlength{\\textwidth}{\\paperwidth}</span>
<span class="org-string">\\addtolength{\\textwidth}{-3cm}</span>
<span class="org-string">\\setlength{\\oddsidemargin}{1.5cm}</span>
<span class="org-string">\\addtolength{\\oddsidemargin}{-2.54cm}</span>
<span class="org-string">\\setlength{\\evensidemargin}{\\oddsidemargin}</span>
<span class="org-string">\\setlength{\\textheight}{\\paperheight}</span>
<span class="org-string">\\addtolength{\\textheight}{-\\headheight}</span>
<span class="org-string">\\addtolength{\\textheight}{-\\headsep}</span>
<span class="org-string">\\addtolength{\\textheight}{-\\footskip}</span>
<span class="org-string">\\addtolength{\\textheight}{-3cm}</span>
<span class="org-string">\\setlength{\\topmargin}{1.5cm}</span>
<span class="org-string">\\addtolength{\\topmargin}{-2.54cm}</span>
<span class="org-string">% my custom stuff</span>
<span class="org-string">\\usepackage[nofont,plaindd]{bmc-maths}</span>
<span class="org-string">\\usepackage{arev}</span>
<span class="org-string">"</span>)
</pre>
</div>
    </details>

<p>
Since we can, instead of making the background colour match the <kbd>default</kbd> face,
let&rsquo;s make it transparent.
</p>
<details id='prettier-rendering,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#prettier-rendering,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-format-latex-options
      (plist-put org-format-latex-options <span class="org-builtin">:background</span> <span class="org-string">"Transparent"</span>))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-rendering-speed-tests" class="outline-6">
<h6 id="rendering-speed-tests"><span class="section-number-6">6.3.3.4.4</span> Rendering speed tests<a aria-hidden="true" href="#rendering-speed-tests">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-4">
<p>
We can either render from a <code>dvi</code> or <code>pdf</code> file, so let&rsquo;s benchmark <code>latex</code> and
<code>pdflatex</code>.
</p>
<div id='rendering-speed-tests,table--1' class='table'>
    <div class='gutter'><a href='#rendering-speed-tests,table--1'>#</a></div>
    <div class='tabular'>
    <table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left"><code>latex</code> time</th>
<th scope="col" class="org-left"><code>pdflatex</code> time</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">135 &plusmn; 2 ms</td>
<td class="org-left">215 &plusmn; 3 ms</td>
</tr>
</tbody>
</table>
    </div>    </div>

<p>
On the rendering side, there are two <code>.dvi</code>-to-image converters which I am
interested in: <code>dvipng</code> and <code>dvisvgm</code>. Then with the a <code>.pdf</code> we have <code>pdf2svg</code>.
For inline preview we care about speed, while for exporting we care about file
size and prefer a vector graphic.
</p>

<p>
Using the above latex expression and benchmarking lead to the following results:
</p>
<div id='rendering-speed-tests,table--2' class='table'>
    <div class='gutter'><a href='#rendering-speed-tests,table--2'>#</a></div>
    <div class='tabular'>
    <table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left"><code>dvipng</code> time</th>
<th scope="col" class="org-left"><code>dvisvgm</code> time</th>
<th scope="col" class="org-left"><code>pdf2svg</code> time</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">89 &plusmn; 2 ms</td>
<td class="org-left">178 &plusmn; 2 ms</td>
<td class="org-left">12 &plusmn; 2 ms</td>
</tr>
</tbody>
</table>
    </div>    </div>

<p>
Now let&rsquo;s combine this to see what&rsquo;s best
</p>
<div id='rendering-speed-tests,table--3' class='table'>
    <div class='gutter'><a href='#rendering-speed-tests,table--3'>#</a></div>
    <div class='tabular'>
    <table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Tool chain</th>
<th scope="col" class="org-left">Total time</th>
<th scope="col" class="org-left">Resultant file size</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>latex</code> + <code>dvipng</code></td>
<td class="org-left">226 &plusmn; 2 ms</td>
<td class="org-left">7 KiB</td>
</tr>

<tr>
<td class="org-left"><code>latex</code> + <code>dvisvgm</code></td>
<td class="org-left">392 &plusmn; 4 ms</td>
<td class="org-left">8 KiB</td>
</tr>

<tr>
<td class="org-left"><code>pdflatex</code> + <code>pdf2svg</code></td>
<td class="org-left">230 &plusmn; 2 ms</td>
<td class="org-left">16 KiB</td>
</tr>
</tbody>
</table>
    </div>    </div>

<p>
So, let&rsquo;s use <code>dvipng</code> for previewing LaTeX fragments in-Emacs, but <code>dvisvgm</code> for <a href="#latex-rendering">6.3.5.12</a>.
</p>

<div class="warning" id="org0533c09">
<p>
Unfortunately, it seems that <span class='acr'>SVG</span> sizing is annoying <span class='acr'>ATM</span>, so let&rsquo;s actually not do this right now.
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-stolen-from-scimax" class="outline-5">
<h5 id="stolen-from-scimax"><span class="section-number-5">6.3.3.5</span> Stolen from <a href="https://github.com/jkitchin/scimax">scimax</a> (semi-working right now)<a aria-hidden="true" href="#stolen-from-scimax">#</a> </h5>
<div class="outline-text-5" id="text-6-3-3-5">
<p>
I want fragment justification
</p>
<details id='stolen-from-scimax,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#stolen-from-scimax,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">scimax-org-latex-fragment-justify</span> (justification)
  <span class="org-doc">"Justify the latex fragment at point with JUSTIFICATION.</span>
<span class="org-doc">JUSTIFICATION is a symbol for 'left, 'center or 'right."</span>
  (<span class="org-keyword">interactive</span>
   (list (intern-soft
          (completing-read <span class="org-string">"Justification (left): "</span> '(left center right)
                           nil t nil nil 'left))))
  (<span class="org-keyword">let*</span> ((ov (ov-at))
         (beg (ov-beg ov))
         (end (ov-end ov))
         (shift (- beg (line-beginning-position)))
         (img (overlay-get ov 'display))
         (img (<span class="org-keyword">and</span> (<span class="org-keyword">and</span> img (consp img) (eq (car img) 'image)
                        (image-type-available-p (plist-get (cdr img) <span class="org-builtin">:type</span>)))
                   img))
         space-left offset)
    (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> img
               <span class="org-comment-delimiter">;; </span><span class="org-comment">This means the equation is at the start of the line</span>
               (= beg (line-beginning-position))
               (<span class="org-keyword">or</span>
                (string= <span class="org-string">""</span> (s-trim (buffer-substring end (line-end-position))))
                (eq 'latex-environment (car (org-element-context)))))
      (<span class="org-keyword">setq</span> space-left (- (window-max-chars-per-line) (car (image-size img)))
            offset (floor (<span class="org-keyword">cond</span>
                           ((eq justification 'center)
                            (- (/ space-left <span class="org-highlight-numbers-number">2</span>) shift))
                           ((eq justification 'right)
                            (- space-left shift))
                           (t
                            <span class="org-highlight-numbers-number">0</span>))))
      (<span class="org-keyword">when</span> (&gt;= offset <span class="org-highlight-numbers-number">0</span>)
        (overlay-put ov 'before-string (make-string offset ?\ ))))))

(<span class="org-keyword">defun</span> <span class="org-function-name">scimax-org-latex-fragment-justify-advice</span> (beg end image imagetype)
  <span class="org-doc">"After advice function to justify fragments."</span>
  (scimax-org-latex-fragment-justify (<span class="org-keyword">or</span> (plist-get org-format-latex-options <span class="org-builtin">:justify</span>) 'left)))


(<span class="org-keyword">defun</span> <span class="org-function-name">scimax-toggle-latex-fragment-justification</span> ()
  <span class="org-doc">"Toggle if LaTeX fragment justification options can be used."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (not (get 'scimax-org-latex-fragment-justify-advice 'enabled))
      (<span class="org-keyword">progn</span>
        (advice-add 'org--format-latex-make-overlay <span class="org-builtin">:after</span> 'scimax-org-latex-fragment-justify-advice)
        (put 'scimax-org-latex-fragment-justify-advice 'enabled t)
        (message <span class="org-string">"Latex fragment justification enabled"</span>))
    (advice-remove 'org--format-latex-make-overlay 'scimax-org-latex-fragment-justify-advice)
    (put 'scimax-org-latex-fragment-justify-advice 'enabled nil)
    (message <span class="org-string">"Latex fragment justification disabled"</span>)))
</pre>
</div>
    </details>
<p>
There&rsquo;s also this lovely equation numbering stuff I&rsquo;ll nick
</p>
<details id='stolen-from-scimax,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#stolen-from-scimax,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Numbered equations all have (1) as the number for fragments with vanilla</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">org-mode. This code injects the correct numbers into the previews so they</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">look good.</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">scimax-org-renumber-environment</span> (orig-func <span class="org-type">&amp;rest</span> args)
  <span class="org-doc">"A function to inject numbers in LaTeX fragment previews."</span>
  (<span class="org-keyword">let</span> ((results '())
        (counter <span class="org-highlight-numbers-number">-1</span>)
        (numberp))
    (<span class="org-keyword">setq</span> results (<span class="org-keyword">cl-loop</span> for (begin . env) in
                           (org-element-map (org-element-parse-buffer) 'latex-environment
                             (<span class="org-keyword">lambda</span> (env)
                               (cons
                                (org-element-property <span class="org-builtin">:begin</span> env)
                                (org-element-property <span class="org-builtin">:value</span> env))))
                           collect
                           (<span class="org-keyword">cond</span>
                            ((<span class="org-keyword">and</span> (string-match <span class="org-string">"\\\\begin{equation}"</span> env)
                                  (not (string-match <span class="org-string">"\\\\tag{"</span> env)))
                             (<span class="org-keyword">cl-incf</span> counter)
                             (cons begin counter))
                            ((string-match <span class="org-string">"\\\\begin{align}"</span> env)
                             (<span class="org-keyword">prog2</span>
                                 (<span class="org-keyword">cl-incf</span> counter)
                                 (cons begin counter)
                               (<span class="org-keyword">with-temp-buffer</span>
                                 (insert env)
                                 (goto-char (point-min))
                                 <span class="org-comment-delimiter">;; </span><span class="org-comment">\\ is used for a new line. Each one leads to a number</span>
                                 (<span class="org-keyword">cl-incf</span> counter (count-matches <span class="org-string">"\\\\$"</span>))
                                 <span class="org-comment-delimiter">;; </span><span class="org-comment">unless there are nonumbers.</span>
                                 (goto-char (point-min))
                                 (<span class="org-keyword">cl-decf</span> counter (count-matches <span class="org-string">"\\nonumber"</span>)))))
                            (t
                             (cons begin nil)))))

    (<span class="org-keyword">when</span> (<span class="org-keyword">setq</span> numberp (cdr (assoc (point) results)))
      (<span class="org-keyword">setf</span> (car args)
            (concat
             (format <span class="org-string">"\\setcounter{equation}{%s}\n"</span> numberp)
             (car args)))))

  (apply orig-func args))


(<span class="org-keyword">defun</span> <span class="org-function-name">scimax-toggle-latex-equation-numbering</span> ()
  <span class="org-doc">"Toggle whether LaTeX fragments are numbered."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (not (get 'scimax-org-renumber-environment 'enabled))
      (<span class="org-keyword">progn</span>
        (advice-add 'org-create-formula-image <span class="org-builtin">:around</span> #'scimax-org-renumber-environment)
        (put 'scimax-org-renumber-environment 'enabled t)
        (message <span class="org-string">"Latex numbering enabled"</span>))
    (advice-remove 'org-create-formula-image #'scimax-org-renumber-environment)
    (put 'scimax-org-renumber-environment 'enabled nil)
    (message <span class="org-string">"Latex numbering disabled."</span>)))

(advice-add 'org-create-formula-image <span class="org-builtin">:around</span> #'scimax-org-renumber-environment)
(put 'scimax-org-renumber-environment 'enabled t)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-org-plot" class="outline-5">
<h5 id="org-plot"><span class="section-number-5">6.3.3.6</span> Org Plot<a aria-hidden="true" href="#org-plot">#</a> </h5>
<div class="outline-text-5" id="text-6-3-3-6">
<p>
We can use some of the variables in <kbd>org-plot</kbd> to use the current doom theme
colours.
</p>
<details id='org-plot,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-plot,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-plot
  (<span class="org-keyword">defun</span> <span class="org-function-name">org-plot/generate-theme</span> (_type)
    <span class="org-doc">"Use the current Doom theme colours to generate a GnuPlot preamble."</span>
    (format <span class="org-string">"</span>
<span class="org-string">fgt = \"textcolor rgb '%s'\" # foreground text</span>
<span class="org-string">fgat = \"textcolor rgb '%s'\" # foreground alt text</span>
<span class="org-string">fgl = \"linecolor rgb '%s'\" # foreground line</span>
<span class="org-string">fgal = \"linecolor rgb '%s'\" # foreground alt line</span>

<span class="org-string"># foreground colors</span>
<span class="org-string">set border lc rgb '%s'</span>
<span class="org-string"># change text colors of  tics</span>
<span class="org-string">set xtics @fgt</span>
<span class="org-string">set ytics @fgt</span>
<span class="org-string"># change text colors of labels</span>
<span class="org-string">set title @fgt</span>
<span class="org-string">set xlabel @fgt</span>
<span class="org-string">set ylabel @fgt</span>
<span class="org-string"># change a text color of key</span>
<span class="org-string">set key @fgt</span>

<span class="org-string"># line styles</span>
<span class="org-string">set linetype 1 lw 2 lc rgb '%s' # red</span>
<span class="org-string">set linetype 2 lw 2 lc rgb '%s' # blue</span>
<span class="org-string">set linetype 3 lw 2 lc rgb '%s' # green</span>
<span class="org-string">set linetype 4 lw 2 lc rgb '%s' # magenta</span>
<span class="org-string">set linetype 5 lw 2 lc rgb '%s' # orange</span>
<span class="org-string">set linetype 6 lw 2 lc rgb '%s' # yellow</span>
<span class="org-string">set linetype 7 lw 2 lc rgb '%s' # teal</span>
<span class="org-string">set linetype 8 lw 2 lc rgb '%s' # violet</span>

<span class="org-string"># palette</span>
<span class="org-string">set palette maxcolors 8</span>
<span class="org-string">set palette defined ( 0 '%s',\</span>
<span class="org-string">1 '%s',\</span>
<span class="org-string">2 '%s',\</span>
<span class="org-string">3 '%s',\</span>
<span class="org-string">4 '%s',\</span>
<span class="org-string">5 '%s',\</span>
<span class="org-string">6 '%s',\</span>
<span class="org-string">7 '%s' )</span>
<span class="org-string">"</span>
            (doom-color 'fg)
            (doom-color 'fg-alt)
            (doom-color 'fg)
            (doom-color 'fg-alt)
            (doom-color 'fg)
            <span class="org-comment-delimiter">;; </span><span class="org-comment">colours</span>
            (doom-color 'red)
            (doom-color 'blue)
            (doom-color 'green)
            (doom-color 'magenta)
            (doom-color 'orange)
            (doom-color 'yellow)
            (doom-color 'teal)
            (doom-color 'violet)
            <span class="org-comment-delimiter">;; </span><span class="org-comment">duplicated</span>
            (doom-color 'red)
            (doom-color 'blue)
            (doom-color 'green)
            (doom-color 'magenta)
            (doom-color 'orange)
            (doom-color 'yellow)
            (doom-color 'teal)
            (doom-color 'violet)
            ))
  (<span class="org-keyword">defun</span> <span class="org-function-name">org-plot/gnuplot-term-properties</span> (_type)
    (format <span class="org-string">"background rgb '%s' size 1050,650"</span>
            (doom-color 'bg)))
  (<span class="org-keyword">setq</span> org-plot/gnuplot-script-preamble #'org-plot/generate-theme)
  (<span class="org-keyword">setq</span> org-plot/gnuplot-term-extra #'org-plot/gnuplot-term-properties))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-exporting" class="outline-4">
<h4 id="exporting"><span class="section-number-4">6.3.4</span> Exporting<a aria-hidden="true" href="#exporting">#</a> </h4>
<div class="outline-text-4" id="text-6-3-4">
</div>
<div id="outline-container-general-settings" class="outline-5">
<h5 id="general-settings"><span class="section-number-5">6.3.4.1</span> General settings<a aria-hidden="true" href="#general-settings">#</a> </h5>
<div class="outline-text-5" id="text-6-3-4-1">
<p>
By default Org only exports the first three levels of headings as &#x2026; headings.
This is rather unfortunate as my documents frequently stray far beyond three
levels of depth. The two main formats I care about exporting to are LaTeX and
<span class='acr'>HTML</span>. When using an <kbd>article</kbd> class, LaTeX headlines go from <kbd>\section</kbd>,
<kbd>\subsection</kbd>, <kbd>\subsubsection</kbd>, and <kbd>\paragraph</kbd> to <kbd>\subgraph</kbd> &#x2014; <i>five</i> levels.
<span class='acr'>HTML</span>5 has six levels of headings (<kbd>&lt;h1&gt;</kbd> to <kbd>&lt;h6&gt;</kbd>), but first level Org headings
get exported as <kbd>&lt;h2&gt;</kbd> elements &#x2014; leaving <i>five</i> usable levels.
</p>

<p>
As such, it would seem to make sense to recognise the first <i>five</i> levels of Org
headings when exporting.
</p>

<details id='general-settings,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#general-settings,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-export-headline-levels <span class="org-highlight-numbers-number">5</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">I like nesting</span>
</pre>
</div>
    </details>

<p>
I&rsquo;m also going to make use of an item in <kbd>ox-extra</kbd> so that I can add an <kbd>:ignore:</kbd>
tag to headings for the content to be kept, but the heading itself ignored
(unlike <kbd>:noexport:</kbd> which ignored both heading and content). This is useful when
I want to use headings to provide a structure for writing that doesn&rsquo;t appear in
the final documents.
</p>
<details id='general-settings,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#general-settings,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">ox-extra</span>)
(ox-extras-activate '(ignore-headlines))
</pre>
</div>
    </details>

<p>
Since I (roughly) track Org <code>HEAD</code>, it makes sense to include the git version in
the creator string.
</p>
<details id='general-settings,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#general-settings,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-export-creator-string
      (format <span class="org-string">"Emacs %s (Org mode %s %s)"</span> emacs-version (org-release) (org-git-version)))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-acronym-formatting" class="outline-5">
<h5 id="acronym-formatting"><span class="section-number-5">6.3.4.2</span> Acronym formatting<a aria-hidden="true" href="#acronym-formatting">#</a> </h5>
<div class="outline-text-5" id="text-6-3-4-2">
<p>
I like automatically using spaced small caps for acronyms. For strings I want to
be unaffected let&rsquo;s use <code>;</code> as a prefix to prevent the transformation &#x2014; i.e.
<code>;JFK</code> (as one would want for two-letter geographic locations and names).
</p>

<p>
This has to be implemented on a per-format basis, currently <span class='acr'>HTML</span> and LaTeX
exports are supported.
</p>

<details id='acronym-formatting,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#acronym-formatting,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-export-filter-text-acronym</span> (text backend _info)
  <span class="org-doc">"Wrap suspected acronyms in acronyms-specific formatting.</span>
<span class="org-doc">Treat sequences of 2+ capital letters (optionally succeeded by \"s\") as an acronym.</span>
<span class="org-doc">Ignore if preceeded by \";\" (for manual prevention) or \"\\\" (for LaTeX commands).</span>

<span class="org-doc"><span class="org-bold"><span class="org-warning">TODO</span></span></span><span class="org-doc"> abstract backend implementations."</span>
  (<span class="org-keyword">let</span> ((base-backend
         (<span class="org-keyword">cond</span>
          ((org-export-derived-backend-p backend 'latex) 'latex)
          <span class="org-comment-delimiter">;; </span><span class="org-comment">Markdown is derived from HTML, but we don't want to format it</span>
          ((org-export-derived-backend-p backend 'md) nil)
          ((org-export-derived-backend-p backend 'html) 'html)))
        (case-fold-search nil))
    (<span class="org-keyword">when</span> base-backend
      (replace-regexp-in-string
       <span class="org-string">"[;\\\\]?\\b[A-Z][A-Z]+s?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">A-Za-z]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\b</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
       (<span class="org-keyword">lambda</span> (all-caps-str)
         (<span class="org-keyword">cond</span> ((equal (aref all-caps-str <span class="org-highlight-numbers-number">0</span>) ?\\) all-caps-str)                <span class="org-comment-delimiter">; </span><span class="org-comment">don't format LaTeX commands</span>
               ((equal (aref all-caps-str <span class="org-highlight-numbers-number">0</span>) ?\;) (substring all-caps-str <span class="org-highlight-numbers-number">1</span>))  <span class="org-comment-delimiter">; </span><span class="org-comment">just remove not-acronym indicator char ";"</span>
               (t (<span class="org-keyword">let*</span> ((final-char (<span class="org-keyword">if</span> (string-match-p <span class="org-string">"[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">A-Za-z]"</span> (substring all-caps-str <span class="org-highlight-numbers-number">-1</span> (length all-caps-str)))
                                         (substring all-caps-str <span class="org-highlight-numbers-number">-1</span> (length all-caps-str))
                                       nil)) <span class="org-comment-delimiter">; </span><span class="org-comment">needed to re-insert the [</span><span class="org-comment"><span class="org-negation-char">^</span></span><span class="org-comment">A-Za-z] at the end</span>
                         (trailing-s (equal (aref all-caps-str (- (length all-caps-str) (<span class="org-keyword">if</span> final-char <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">1</span>))) ?s))
                         (acr (<span class="org-keyword">if</span> final-char
                                  (substring all-caps-str <span class="org-highlight-numbers-number">0</span> (<span class="org-keyword">if</span> trailing-s <span class="org-highlight-numbers-number">-2</span> <span class="org-highlight-numbers-number">-1</span>))
                                (substring all-caps-str <span class="org-highlight-numbers-number">0</span> (+ (<span class="org-keyword">if</span> trailing-s <span class="org-highlight-numbers-number">-1</span> (length all-caps-str)))))))
                    (<span class="org-keyword">pcase</span> base-backend
                      ('latex (concat <span class="org-string">"\\acr{"</span> (s-downcase acr) <span class="org-string">"}"</span> (<span class="org-keyword">when</span> trailing-s <span class="org-string">"\\acrs{}"</span>) final-char))
                      ('html (concat <span class="org-string">"&lt;span class='acr'&gt;"</span> acr <span class="org-string">"&lt;/span&gt;"</span> (<span class="org-keyword">when</span> trailing-s <span class="org-string">"&lt;small&gt;s&lt;/small&gt;"</span>) final-char)))))))
       text t t))))

(add-to-list 'org-export-filter-plain-text-functions
             #'org-export-filter-text-acronym)

<span class="org-comment-delimiter">;; </span><span class="org-comment">We won't use `</span><span class="org-comment"><span class="org-constant">org-export-filter-headline-functions</span></span><span class="org-comment">' because it</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">passes (and formats) the entire section contents. That's no good.</span>

(<span class="org-keyword">defun</span> <span class="org-function-name">org-html-format-headline-acronymised</span> (todo todo-type priority text tags info)
  <span class="org-doc">"Like `</span><span class="org-doc"><span class="org-constant">org-html-format-headline-default-function</span></span><span class="org-doc">', but with acronym formatting."</span>
  (org-html-format-headline-default-function
   todo todo-type priority (org-export-filter-text-acronym text 'html info) tags info))
(<span class="org-keyword">setq</span> org-html-format-headline-function #'org-html-format-headline-acronymised)

(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-format-headline-acronymised</span> (todo todo-type priority text tags info)
  <span class="org-doc">"Like `</span><span class="org-doc"><span class="org-constant">org-latex-format-headline-default-function</span></span><span class="org-doc">', but with acronym formatting."</span>
  (org-latex-format-headline-default-function
   todo todo-type priority (org-export-filter-text-acronym text 'latex info) tags info))
(<span class="org-keyword">setq</span> org-latex-format-headline-function #'org-latex-format-headline-acronymised)
</pre>
</div>
    </details>
</div>
</div>
</div>

<div id="outline-container-html-export" class="outline-4">
<h4 id="html-export"><span class="section-number-4">6.3.5</span> <span class='acr'><span class='acr'>HTML</span></span> Export<a aria-hidden="true" href="#html-export">#</a> </h4>
<div class="outline-text-4" id="text-6-3-5">
<p>
I want to tweak a whole bunch of things. While I&rsquo;ll want my tweaks almost all
the time, occasionally I may want to test how something turns out using a more
default config. With that in mind, a global minor mode seems like the most
appropriate architecture to use.
</p>
<details id='html-export,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#html-export,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">define-minor-mode</span> <span class="org-function-name">org-fancy-html-export-mode</span>
  <span class="org-doc">"Toggle my fabulous org export tweaks. While this mode itself does a little bit,</span>
<span class="org-doc">the vast majority of the change in behaviour comes from switch statements in:</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-html-template-fancier</span></span><span class="org-doc">'</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-html--build-meta-info-extended</span></span><span class="org-doc">'</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-html-src-block-collapsable</span></span><span class="org-doc">'</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-html-block-collapsable</span></span><span class="org-doc">'</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-html-table-wrapped</span></span><span class="org-doc">'</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-html--format-toc-headline-colapseable</span></span><span class="org-doc">'</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-html--toc-text-stripped-leaves</span></span><span class="org-doc">'</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-export-html-headline-anchor</span></span><span class="org-doc">'"</span>
  <span class="org-builtin">:global</span> t
  <span class="org-builtin">:init-value</span> t
  (<span class="org-keyword">if</span> org-fancy-html-export-mode
      (<span class="org-keyword">setq</span> org-html-style-default org-html-style-fancy
            org-html-meta-tags #'org-html-meta-tags-fancy
            org-html-checkbox-type 'html-span)
    (<span class="org-keyword">setq</span> org-html-style-default org-html-style-plain
          org-html-meta-tags #'org-html-meta-tags-default
          org-html-checkbox-type 'html)))
</pre>
</div>
    </details>

<p>
There are quite a few instances where I want to modify variables defined in
<kbd>ox-html</kbd>, so we&rsquo;ll wrap the contents of this section in a
<code class="src src-elisp">(<span class="org-keyword">after!</span> ox-html ...)</code> block.
</p>
<details id='html-export,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#html-export,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> ox-html
  &lt;&lt;ox-html-conf&gt;&gt;
)
</pre>
</div>
    </details>
</div>
<div id="outline-container-extra-header-content" class="outline-5">
<h5 id="extra-header-content"><span class="section-number-5">6.3.5.1</span> Extra header content<a aria-hidden="true" href="#extra-header-content">#</a> </h5>
<div class="outline-text-5" id="text-6-3-5-1">
<p>
We want to tack on a few more bits to the start of the body. Unfortunately, there
doesn&rsquo;t seem to be any nice variable or hook, so we&rsquo;ll just override the
relevant function.
</p>

<p>
This is done to allow me to add the date and author to the page header,
implement a <span class='acr'>CSS</span>-only light/dark theme toggle, and a sprinkle of <a href="https://ogp.me/">Open Graph</a>
metadata.
</p>
<details id='extra-header-content,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-header-content,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> org-html-template-fancier (orig-fn contents info)
  <span class="org-doc">"Return complete document string after HTML conversion.</span>
<span class="org-doc">CONTENTS is the transcoded contents string.  INFO is a plist</span>
<span class="org-doc">holding export options. Adds a few extra things to the body</span>
<span class="org-doc">compared to the default implementation."</span>
  <span class="org-builtin">:around</span> #'org-html-template
  (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (not org-fancy-html-export-mode) (<span class="org-keyword">bound-and-true-p</span> org-msg-export-in-progress))
      (funcall orig-fn contents info)
    (concat
     (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (not (org-html-html5-p info)) (org-html-xhtml-p info))
       (<span class="org-keyword">let*</span> ((xml-declaration (plist-get info <span class="org-builtin">:html-xml-declaration</span>))
              (decl (<span class="org-keyword">or</span> (<span class="org-keyword">and</span> (stringp xml-declaration) xml-declaration)
                        (cdr (assoc (plist-get info <span class="org-builtin">:html-extension</span>)
                                    xml-declaration))
                        (cdr (assoc <span class="org-string">"html"</span> xml-declaration))
                        <span class="org-string">""</span>)))
         (<span class="org-keyword">when</span> (not (<span class="org-keyword">or</span> (not decl) (string= <span class="org-string">""</span> decl)))
           (format <span class="org-string">"%s\n"</span>
                   (format decl
                           (<span class="org-keyword">or</span> (<span class="org-keyword">and</span> org-html-coding-system
                                    (fboundp 'coding-system-get)
                                    (coding-system-get org-html-coding-system 'mime-charset))
                               <span class="org-string">"iso-8859-1"</span>))))))
     (org-html-doctype info)
     <span class="org-string">"\n"</span>
     (concat <span class="org-string">"&lt;html"</span>
             (<span class="org-keyword">cond</span> ((org-html-xhtml-p info)
                    (format
                     <span class="org-string">" xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"%s\" xml:lang=\"%s\""</span>
                     (plist-get info <span class="org-builtin">:language</span>) (plist-get info <span class="org-builtin">:language</span>)))
                   ((org-html-html5-p info)
                    (format <span class="org-string">" lang=\"%s\""</span> (plist-get info <span class="org-builtin">:language</span>))))
             <span class="org-string">"&gt;\n"</span>)
     <span class="org-string">"&lt;head&gt;\n"</span>
     (org-html--build-meta-info info)
     (org-html--build-head info)
     (org-html--build-mathjax-config info)
     <span class="org-string">"&lt;/head&gt;\n"</span>
     <span class="org-string">"&lt;body&gt;\n&lt;input type='checkbox' id='theme-switch'&gt;&lt;div id='page'&gt;&lt;label id='switch-label' for='theme-switch'&gt;&lt;/label&gt;"</span>
     (<span class="org-keyword">let</span> ((link-up (org-trim (plist-get info <span class="org-builtin">:html-link-up</span>)))
           (link-home (org-trim (plist-get info <span class="org-builtin">:html-link-home</span>))))
       (<span class="org-keyword">unless</span> (<span class="org-keyword">and</span> (string= link-up <span class="org-string">""</span>) (string= link-home <span class="org-string">""</span>))
         (format (plist-get info <span class="org-builtin">:html-home/up-format</span>)
                 (<span class="org-keyword">or</span> link-up link-home)
                 (<span class="org-keyword">or</span> link-home link-up))))
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Preamble.</span>
     (org-html--build-pre/postamble 'preamble info)
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Document contents.</span>
     (<span class="org-keyword">let</span> ((div (assq 'content (plist-get info <span class="org-builtin">:html-divs</span>))))
       (format <span class="org-string">"&lt;%s id=\"%s\"&gt;\n"</span> (nth <span class="org-highlight-numbers-number">1</span> div) (nth <span class="org-highlight-numbers-number">2</span> div)))
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Document title.</span>
     (<span class="org-keyword">when</span> (plist-get info <span class="org-builtin">:with-title</span>)
       (<span class="org-keyword">let</span> ((title (<span class="org-keyword">and</span> (plist-get info <span class="org-builtin">:with-title</span>)
                         (plist-get info <span class="org-builtin">:title</span>)))
             (subtitle (plist-get info <span class="org-builtin">:subtitle</span>))
             (html5-fancy (org-html--html5-fancy-p info)))
         (<span class="org-keyword">when</span> title
           (format
            (<span class="org-keyword">if</span> html5-fancy
                <span class="org-string">"&lt;header class=\"page-header\"&gt;%s\n&lt;h1 class=\"title\"&gt;%s&lt;/h1&gt;\n%s&lt;/header&gt;"</span>
              <span class="org-string">"&lt;h1 class=\"title\"&gt;%s%s&lt;/h1&gt;\n"</span>)
            (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (plist-get info <span class="org-builtin">:with-date</span>)
                    (plist-get info <span class="org-builtin">:with-author</span>))
                (concat <span class="org-string">"&lt;div class=\"page-meta\"&gt;"</span>
                        (<span class="org-keyword">when</span> (plist-get info <span class="org-builtin">:with-date</span>)
                          (org-export-data (plist-get info <span class="org-builtin">:date</span>) info))
                        (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (plist-get info <span class="org-builtin">:with-date</span>) (plist-get info <span class="org-builtin">:with-author</span>)) <span class="org-string">", "</span>)
                        (<span class="org-keyword">when</span> (plist-get info <span class="org-builtin">:with-author</span>)
                          (org-export-data (plist-get info <span class="org-builtin">:author</span>) info))
                        <span class="org-string">"&lt;/div&gt;\n"</span>)
              <span class="org-string">""</span>)
            (org-export-data title info)
            (<span class="org-keyword">if</span> subtitle
                (format
                 (<span class="org-keyword">if</span> html5-fancy
                     <span class="org-string">"&lt;p class=\"subtitle\" role=\"doc-subtitle\"&gt;%s&lt;/p&gt;\n"</span>
                   (concat <span class="org-string">"\n"</span> (org-html-close-tag <span class="org-string">"br"</span> nil info) <span class="org-string">"\n"</span>
                           <span class="org-string">"&lt;span class=\"subtitle\"&gt;%s&lt;/span&gt;\n"</span>))
                 (org-export-data subtitle info))
              <span class="org-string">""</span>)))))
     contents
     (format <span class="org-string">"&lt;/%s&gt;\n"</span> (nth <span class="org-highlight-numbers-number">1</span> (assq 'content (plist-get info <span class="org-builtin">:html-divs</span>))))
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Postamble.</span>
     (org-html--build-pre/postamble 'postamble info)
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Possibly use the Klipse library live code blocks.</span>
     (<span class="org-keyword">when</span> (plist-get info <span class="org-builtin">:html-klipsify-src</span>)
       (concat <span class="org-string">"&lt;script&gt;"</span> (plist-get info <span class="org-builtin">:html-klipse-selection-script</span>)
               <span class="org-string">"&lt;/script&gt;&lt;script src=\""</span>
               org-html-klipse-js
               <span class="org-string">"\"&gt;&lt;/script&gt;&lt;link rel=\"stylesheet\" type=\"text/css\" href=\""</span>
               org-html-klipse-css <span class="org-string">"\"/&gt;"</span>))
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Closing document.</span>
     <span class="org-string">"&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;"</span>)))
</pre>
</div>
    </details>

<p>
I think it would be nice if &ldquo;Table of Contents&rdquo; brought you back to the top of
the page. Well, since we&rsquo;ve done this much advising already&#x2026;
</p>
<details id='extra-header-content,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-header-content,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> org-html-toc-linked (depth info <span class="org-type">&amp;optional</span> scope)
  <span class="org-doc">"Build a table of contents.</span>

<span class="org-doc">Just like `</span><span class="org-doc"><span class="org-constant">org-html-toc</span></span><span class="org-doc">', except the header is a link to \"#\".</span>

<span class="org-doc">DEPTH is an integer specifying the depth of the table.  INFO is</span>
<span class="org-doc">a plist used as a communication channel.  Optional argument SCOPE</span>
<span class="org-doc">is an element defining the scope of the table.  Return the table</span>
<span class="org-doc">of contents as a string, or nil if it is empty."</span>
  <span class="org-builtin">:override</span> #'org-html-toc
  (<span class="org-keyword">let</span> ((toc-entries
         (mapcar (<span class="org-keyword">lambda</span> (headline)
                   (cons (org-html--format-toc-headline headline info)
                         (org-export-get-relative-level headline info)))
                 (org-export-collect-headlines info depth scope))))
    (<span class="org-keyword">when</span> toc-entries
      (<span class="org-keyword">let</span> ((toc (concat <span class="org-string">"&lt;div id=\"text-table-of-contents\"&gt;"</span>
                         (org-html--toc-text toc-entries)
                         <span class="org-string">"&lt;/div&gt;\n"</span>)))
        (<span class="org-keyword">if</span> scope toc
          (<span class="org-keyword">let</span> ((outer-tag (<span class="org-keyword">if</span> (org-html--html5-fancy-p info)
                               <span class="org-string">"nav"</span>
                             <span class="org-string">"div"</span>)))
            (concat (format <span class="org-string">"&lt;%s id=\"table-of-contents\"&gt;\n"</span> outer-tag)
                    (<span class="org-keyword">let</span> ((top-level (plist-get info <span class="org-builtin">:html-toplevel-hlevel</span>)))
                      (format <span class="org-string">"&lt;h%d&gt;&lt;a href=\"#\" style=\"color:inherit; text-decoration: none;\"&gt;%s&lt;/a&gt;&lt;/h%d&gt;\n"</span>
                              top-level
                              (org-html--translate <span class="org-string">"Table of Contents"</span> info)
                              top-level))
                    toc
                    (format <span class="org-string">"&lt;/%s&gt;\n"</span> outer-tag))))))))
</pre>
</div>
    </details>

<p>
Lastly, let&rsquo;s pile on some metadata. This gives my pages nice embeds.
</p>
<details id='extra-header-content,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-header-content,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-html-meta-tags-opengraph-image</span>
  '(<span class="org-builtin">:image</span> <span class="org-string">"https://tecosaur.com/resources/org/nib.png"</span>
    <span class="org-builtin">:type</span> <span class="org-string">"image/png"</span>
    <span class="org-builtin">:width</span> <span class="org-string">"200"</span>
    <span class="org-builtin">:height</span> <span class="org-string">"200"</span>
    <span class="org-builtin">:alt</span> <span class="org-string">"Green fountain pen nib"</span>)
  <span class="org-doc">"Plist of og:image:PROP properties and their value, for use in `</span><span class="org-doc"><span class="org-constant">org-html-meta-tags-fancy</span></span><span class="org-doc">'."</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">org-html-meta-tags-fancy</span> (info)
  <span class="org-doc">"Use the INFO plist to construct the meta tags, as described in `</span><span class="org-doc"><span class="org-constant">org-html-meta-tags</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">let</span> ((title (org-html-plain-text
                (org-element-interpret-data (plist-get info <span class="org-builtin">:title</span>)) info))
        (author (<span class="org-keyword">and</span> (plist-get info <span class="org-builtin">:with-author</span>)
                     (<span class="org-keyword">let</span> ((auth (plist-get info <span class="org-builtin">:author</span>)))
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">Return raw Org syntax.</span>
                       (<span class="org-keyword">and</span> auth (org-html-plain-text
                                  (org-element-interpret-data auth) info))))))
    (append
     (list
      (<span class="org-keyword">when</span> (org-string-nw-p author)
        (list <span class="org-string">"name"</span> <span class="org-string">"author"</span> author))
      (<span class="org-keyword">when</span> (org-string-nw-p (plist-get info <span class="org-builtin">:description</span>))
        (list <span class="org-string">"name"</span> <span class="org-string">"description"</span>
              (plist-get info <span class="org-builtin">:description</span>)))
      '(<span class="org-string">"name"</span> <span class="org-string">"generator"</span> <span class="org-string">"org mode"</span>)
      '(<span class="org-string">"name"</span> <span class="org-string">"theme-color"</span> <span class="org-string">"#77aa99"</span>)
      '(<span class="org-string">"property"</span> <span class="org-string">"og:type"</span> <span class="org-string">"article"</span>)
      (list <span class="org-string">"property"</span> <span class="org-string">"og:title"</span> title)
      (<span class="org-keyword">let</span> ((subtitle (org-export-data (plist-get info <span class="org-builtin">:subtitle</span>) info)))
        (<span class="org-keyword">when</span> (org-string-nw-p subtitle)
          (list <span class="org-string">"property"</span> <span class="org-string">"og:description"</span> subtitle))))
     (<span class="org-keyword">when</span> org-html-meta-tags-opengraph-image
       (list (list <span class="org-string">"property"</span> <span class="org-string">"og:image"</span> (plist-get org-html-meta-tags-opengraph-image <span class="org-builtin">:image</span>))
             (list <span class="org-string">"property"</span> <span class="org-string">"og:image:type"</span> (plist-get org-html-meta-tags-opengraph-image <span class="org-builtin">:type</span>))
             (list <span class="org-string">"property"</span> <span class="org-string">"og:image:width"</span> (plist-get org-html-meta-tags-opengraph-image <span class="org-builtin">:width</span>))
             (list <span class="org-string">"property"</span> <span class="org-string">"og:image:height"</span> (plist-get org-html-meta-tags-opengraph-image <span class="org-builtin">:height</span>))
             (list <span class="org-string">"property"</span> <span class="org-string">"og:image:alt"</span> (plist-get org-html-meta-tags-opengraph-image <span class="org-builtin">:alt</span>))))
     (list
      (<span class="org-keyword">when</span> (org-string-nw-p author)
        (list <span class="org-string">"property"</span> <span class="org-string">"og:article:author:first_name"</span> (car (s-split-up-to <span class="org-string">" "</span> author <span class="org-highlight-numbers-number">2</span>))))
      (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (org-string-nw-p author) (s-contains-p <span class="org-string">" "</span> author))
        (list <span class="org-string">"property"</span> <span class="org-string">"og:article:author:last_name"</span> (cadr (s-split-up-to <span class="org-string">" "</span> author <span class="org-highlight-numbers-number">2</span>))))
      (list <span class="org-string">"property"</span> <span class="org-string">"og:article:published_time"</span>
            (format-time-string
             <span class="org-string">"%FT%T%z"</span>
             (<span class="org-keyword">or</span>
              (<span class="org-keyword">when-let</span> ((date-str (cadar (org-collect-keywords '(<span class="org-string">"DATE"</span>)))))
                (<span class="org-keyword">unless</span> (string= date-str (format-time-string <span class="org-string">"%F"</span>))
                  (<span class="org-keyword">ignore-errors</span> (encode-time (org-parse-time-string date-str)))))
              (<span class="org-keyword">if</span> buffer-file-name
                  (file-attribute-modification-time (file-attributes buffer-file-name))
                (current-time)))))
      (<span class="org-keyword">when</span> buffer-file-name
        (list <span class="org-string">"property"</span> <span class="org-string">"og:article:modified_time"</span>
              (format-time-string <span class="org-string">"%FT%T%z"</span> (file-attribute-modification-time (file-attributes buffer-file-name)))))))))

(<span class="org-keyword">unless</span> (functionp #'org-html-meta-tags-default)
  (<span class="org-keyword">defalias</span> '<span class="org-function-name">org-html-meta-tags-default</span> #'ignore))
(<span class="org-keyword">setq</span> org-html-meta-tags #'org-html-meta-tags-fancy)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-custom-css-js" class="outline-5">
<h5 id="custom-css-js"><span class="section-number-5">6.3.5.2</span> Custom <span class='acr'><span class='acr'>CSS</span></span>/<span class='acr'><span class='acr'>JS</span></span><a aria-hidden="true" href="#custom-css-js">#</a> </h5>
<div class="outline-text-5" id="text-6-3-5-2">
<p>
The default org <span class='acr'>HTML</span> export is &#x2026; alright, but we can really jazz it up.
<a href="https://lepisma.xyz">lepisma.xyz</a> has a really nice style, and from and org export too!
Suffice to say I&rsquo;ve snatched it, with a few of my own tweaks applied.
</p>

<details id='custom-css-js,code--1' class='code' open><summary><span class="lang">HTML</span></summary>
    <div class='gutter'>
    <a href='#custom-css-js,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-html">&lt;<span class="org-function-name">link</span> <span class="org-variable-name">rel</span>=<span class="org-string">"icon"</span> <span class="org-variable-name">href</span>=<span class="org-string">"https://tecosaur.com/resources/org/nib.ico"</span> <span class="org-variable-name">type</span>=<span class="org-string">"image/ico"</span> /&gt;

&lt;<span class="org-function-name">link</span> <span class="org-variable-name">rel</span>=<span class="org-string">"preload"</span> <span class="org-variable-name">as</span>=<span class="org-string">"font"</span> <span class="org-variable-name">crossorigin</span>=<span class="org-string">"anonymous"</span> <span class="org-variable-name">type</span>=<span class="org-string">"font/woff2"</span> <span class="org-variable-name">href</span>=<span class="org-string">"https://tecosaur.com/resources/org/etbookot-roman-webfont.woff2"</span>&gt;
&lt;<span class="org-function-name">link</span> <span class="org-variable-name">rel</span>=<span class="org-string">"preload"</span> <span class="org-variable-name">as</span>=<span class="org-string">"font"</span> <span class="org-variable-name">crossorigin</span>=<span class="org-string">"anonymous"</span> <span class="org-variable-name">type</span>=<span class="org-string">"font/woff2"</span> <span class="org-variable-name">href</span>=<span class="org-string">"https://tecosaur.com/resources/org/etbookot-italic-webfont.woff2"</span>&gt;
&lt;<span class="org-function-name">link</span> <span class="org-variable-name">rel</span>=<span class="org-string">"preload"</span> <span class="org-variable-name">as</span>=<span class="org-string">"font"</span> <span class="org-variable-name">crossorigin</span>=<span class="org-string">"anonymous"</span> <span class="org-variable-name">type</span>=<span class="org-string">"font/woff2"</span> <span class="org-variable-name">href</span>=<span class="org-string">"https://tecosaur.com/resources/org/Merriweather-TextRegular.woff2"</span>&gt;
&lt;<span class="org-function-name">link</span> <span class="org-variable-name">rel</span>=<span class="org-string">"preload"</span> <span class="org-variable-name">as</span>=<span class="org-string">"font"</span> <span class="org-variable-name">crossorigin</span>=<span class="org-string">"anonymous"</span> <span class="org-variable-name">type</span>=<span class="org-string">"font/woff2"</span> <span class="org-variable-name">href</span>=<span class="org-string">"https://tecosaur.com/resources/org/Merriweather-TextItalic.woff2"</span>&gt;
&lt;<span class="org-function-name">link</span> <span class="org-variable-name">rel</span>=<span class="org-string">"preload"</span> <span class="org-variable-name">as</span>=<span class="org-string">"font"</span> <span class="org-variable-name">crossorigin</span>=<span class="org-string">"anonymous"</span> <span class="org-variable-name">type</span>=<span class="org-string">"font/woff2"</span> <span class="org-variable-name">href</span>=<span class="org-string">"https://tecosaur.com/resources/org/Merriweather-TextBold.woff2"</span>&gt;
</pre>
</div>
    </details>

<details id='custom-css-js,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#custom-css-js,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-html-style-plain org-html-style-default
      org-html-htmlize-output-type 'css
      org-html-doctype <span class="org-string">"html5"</span>
      org-html-html5-fancy t)

(<span class="org-keyword">defun</span> <span class="org-function-name">org-html-reload-fancy-style</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">setq</span> org-html-style-fancy
        (concat (f-read-text (expand-file-name <span class="org-string">"misc/org-export-header.html"</span> doom-private-dir))
                <span class="org-string">"&lt;script&gt;\n"</span>
                (f-read-text (expand-file-name <span class="org-string">"misc/org-css/main.js"</span> doom-private-dir))
                <span class="org-string">"&lt;/script&gt;\n&lt;style&gt;\n"</span>
                (f-read-text (expand-file-name <span class="org-string">"misc/org-css/main.min.css"</span> doom-private-dir))
                <span class="org-string">"&lt;/style&gt;"</span>))
  (<span class="org-keyword">when</span> org-fancy-html-export-mode
    (<span class="org-keyword">setq</span> org-html-style-default org-html-style-fancy)))
(org-html-reload-fancy-style)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-collapsable-src-example" class="outline-5">
<h5 id="collapsable-src-example"><span class="section-number-5">6.3.5.3</span> Collapsable src and example blocks<a aria-hidden="true" href="#collapsable-src-example">#</a> </h5>
<div class="outline-text-5" id="text-6-3-5-3">
<p>
By wrapping the <code>&lt;pre&gt;</code> element in a <code>&lt;details&gt;</code> block, we can obtain collapsable
blocks with no <span class='acr'>CSS</span>, though we will toss a little in anyway to have this looking
somewhat spiffy.
</p>

<p>
Since this collapsability seems useful to have on by default for certain chunks
of code, it would be nice if you could set it with <kbd>#+attr_html: :collapsed t</kbd>.
</p>

<p>
It would be nice to also have a corresponding global / session-local way of
setting this, but I haven&rsquo;t quite been able to get that working (yet).
</p>

<details id='collapsable-src-example,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#collapsable-src-example,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-html-export-collapsed</span> nil)
(eval '(cl-pushnew '(<span class="org-builtin">:collapsed</span> <span class="org-string">"COLLAPSED"</span> <span class="org-string">"collapsed"</span> org-html-export-collapsed t)
                   (org-export-backend-options (org-export-get-backend 'html))))
(add-to-list 'org-default-properties <span class="org-string">"EXPORT_COLLAPSED"</span>)
</pre>
</div>
    </details>

<p>
We can take our src block modification a step further, and add a gutter on the
side of the src block containing both an anchor referencing the current block,
and a button to copy the content of the block.
</p>

<details id='src-blocks' class='code' open><summary class='named'><span class="name">Src blocks</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#src-blocks'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> org-html-src-block-collapsable (orig-fn src-block contents info)
  <span class="org-doc">"Wrap the usual &lt;pre&gt; block in a &lt;details&gt;"</span>
  <span class="org-builtin">:around</span> #'org-html-src-block
  (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (not org-fancy-html-export-mode) (<span class="org-keyword">bound-and-true-p</span> org-msg-export-in-progress))
      (funcall orig-fn src-block contents info)
    (<span class="org-keyword">let*</span> ((properties (cadr src-block))
           (lang (mode-name-to-lang-name
                  (plist-get properties <span class="org-builtin">:language</span>)))
           (name (plist-get properties <span class="org-builtin">:name</span>))
           (ref (org-export-get-reference src-block info))
           (collapsed-p (member (<span class="org-keyword">or</span> (org-export-read-attribute <span class="org-builtin">:attr_html</span> src-block <span class="org-builtin">:collapsed</span>)
                                    (plist-get info <span class="org-builtin">:collapsed</span>))
                                '(<span class="org-string">"y"</span> <span class="org-string">"yes"</span> <span class="org-string">"t"</span> t <span class="org-string">"true"</span> <span class="org-string">"all"</span>))))
      (format
       <span class="org-string">"&lt;details id='%s' class='code'%s&gt;&lt;summary%s&gt;%s&lt;/summary&gt;</span>
<span class="org-string">&lt;div class='gutter'&gt;</span>
<span class="org-string">&lt;a href='#%s'&gt;#&lt;/a&gt;</span>
<span class="org-string">&lt;button title='Copy to clipboard' onclick='copyPreToClipbord(this)'&gt;&#9112;&lt;/button&gt;\</span>
<span class="org-string">&lt;/div&gt;</span>
<span class="org-string">%s</span>
<span class="org-string">&lt;/details&gt;"</span>
       ref
       (<span class="org-keyword">if</span> collapsed-p <span class="org-string">""</span> <span class="org-string">" open"</span>)
       (<span class="org-keyword">if</span> name <span class="org-string">" class='named'"</span> <span class="org-string">""</span>)
       (concat
        (<span class="org-keyword">when</span> name (concat <span class="org-string">"&lt;span class=\"name\"&gt;"</span> name <span class="org-string">"&lt;/span&gt;"</span>))
        <span class="org-string">"&lt;span class=\"lang\"&gt;"</span> lang <span class="org-string">"&lt;/span&gt;"</span>)
       ref
       (<span class="org-keyword">if</span> name
           (replace-regexp-in-string (format <span class="org-string">"&lt;pre</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"> class=\"[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\"]+\"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">? id=\"%s\"&gt;"</span> ref) <span class="org-string">"&lt;pre\\1&gt;"</span>
                                     (funcall orig-fn src-block contents info))
         (funcall orig-fn src-block contents info))))))

(<span class="org-keyword">defun</span> <span class="org-function-name">mode-name-to-lang-name</span> (mode)
  (<span class="org-keyword">or</span> (cadr (assoc mode
                   '((<span class="org-string">"asymptote"</span> <span class="org-string">"Asymptote"</span>)
                     (<span class="org-string">"awk"</span> <span class="org-string">"Awk"</span>)
                     (<span class="org-string">"C"</span> <span class="org-string">"C"</span>)
                     (<span class="org-string">"clojure"</span> <span class="org-string">"Clojure"</span>)
                     (<span class="org-string">"css"</span> <span class="org-string">"CSS"</span>)
                     (<span class="org-string">"D"</span> <span class="org-string">"D"</span>)
                     (<span class="org-string">"ditaa"</span> <span class="org-string">"ditaa"</span>)
                     (<span class="org-string">"dot"</span> <span class="org-string">"Graphviz"</span>)
                     (<span class="org-string">"calc"</span> <span class="org-string">"Emacs Calc"</span>)
                     (<span class="org-string">"emacs-lisp"</span> <span class="org-string">"Emacs Lisp"</span>)
                     (<span class="org-string">"fortran"</span> <span class="org-string">"Fortran"</span>)
                     (<span class="org-string">"gnuplot"</span> <span class="org-string">"gnuplot"</span>)
                     (<span class="org-string">"haskell"</span> <span class="org-string">"Haskell"</span>)
                     (<span class="org-string">"hledger"</span> <span class="org-string">"hledger"</span>)
                     (<span class="org-string">"java"</span> <span class="org-string">"Java"</span>)
                     (<span class="org-string">"js"</span> <span class="org-string">"Javascript"</span>)
                     (<span class="org-string">"latex"</span> <span class="org-string">"LaTeX"</span>)
                     (<span class="org-string">"ledger"</span> <span class="org-string">"Ledger"</span>)
                     (<span class="org-string">"lisp"</span> <span class="org-string">"Lisp"</span>)
                     (<span class="org-string">"lilypond"</span> <span class="org-string">"Lilypond"</span>)
                     (<span class="org-string">"lua"</span> <span class="org-string">"Lua"</span>)
                     (<span class="org-string">"matlab"</span> <span class="org-string">"MATLAB"</span>)
                     (<span class="org-string">"mscgen"</span> <span class="org-string">"Mscgen"</span>)
                     (<span class="org-string">"ocaml"</span> <span class="org-string">"Objective Caml"</span>)
                     (<span class="org-string">"octave"</span> <span class="org-string">"Octave"</span>)
                     (<span class="org-string">"org"</span> <span class="org-string">"Org mode"</span>)
                     (<span class="org-string">"oz"</span> <span class="org-string">"OZ"</span>)
                     (<span class="org-string">"plantuml"</span> <span class="org-string">"Plantuml"</span>)
                     (<span class="org-string">"processing"</span> <span class="org-string">"Processing.js"</span>)
                     (<span class="org-string">"python"</span> <span class="org-string">"Python"</span>)
                     (<span class="org-string">"R"</span> <span class="org-string">"R"</span>)
                     (<span class="org-string">"ruby"</span> <span class="org-string">"Ruby"</span>)
                     (<span class="org-string">"sass"</span> <span class="org-string">"Sass"</span>)
                     (<span class="org-string">"scheme"</span> <span class="org-string">"Scheme"</span>)
                     (<span class="org-string">"screen"</span> <span class="org-string">"Gnu Screen"</span>)
                     (<span class="org-string">"sed"</span> <span class="org-string">"Sed"</span>)
                     (<span class="org-string">"sh"</span> <span class="org-string">"shell"</span>)
                     (<span class="org-string">"sql"</span> <span class="org-string">"SQL"</span>)
                     (<span class="org-string">"sqlite"</span> <span class="org-string">"SQLite"</span>)
                     (<span class="org-string">"forth"</span> <span class="org-string">"Forth"</span>)
                     (<span class="org-string">"io"</span> <span class="org-string">"IO"</span>)
                     (<span class="org-string">"J"</span> <span class="org-string">"J"</span>)
                     (<span class="org-string">"makefile"</span> <span class="org-string">"Makefile"</span>)
                     (<span class="org-string">"maxima"</span> <span class="org-string">"Maxima"</span>)
                     (<span class="org-string">"perl"</span> <span class="org-string">"Perl"</span>)
                     (<span class="org-string">"picolisp"</span> <span class="org-string">"Pico Lisp"</span>)
                     (<span class="org-string">"scala"</span> <span class="org-string">"Scala"</span>)
                     (<span class="org-string">"shell"</span> <span class="org-string">"Shell Script"</span>)
                     (<span class="org-string">"ebnf2ps"</span> <span class="org-string">"ebfn2ps"</span>)
                     (<span class="org-string">"cpp"</span> <span class="org-string">"C++"</span>)
                     (<span class="org-string">"abc"</span> <span class="org-string">"ABC"</span>)
                     (<span class="org-string">"coq"</span> <span class="org-string">"Coq"</span>)
                     (<span class="org-string">"groovy"</span> <span class="org-string">"Groovy"</span>)
                     (<span class="org-string">"bash"</span> <span class="org-string">"bash"</span>)
                     (<span class="org-string">"csh"</span> <span class="org-string">"csh"</span>)
                     (<span class="org-string">"ash"</span> <span class="org-string">"ash"</span>)
                     (<span class="org-string">"dash"</span> <span class="org-string">"dash"</span>)
                     (<span class="org-string">"ksh"</span> <span class="org-string">"ksh"</span>)
                     (<span class="org-string">"mksh"</span> <span class="org-string">"mksh"</span>)
                     (<span class="org-string">"posh"</span> <span class="org-string">"posh"</span>)
                     (<span class="org-string">"ada"</span> <span class="org-string">"Ada"</span>)
                     (<span class="org-string">"asm"</span> <span class="org-string">"Assembler"</span>)
                     (<span class="org-string">"caml"</span> <span class="org-string">"Caml"</span>)
                     (<span class="org-string">"delphi"</span> <span class="org-string">"Delphi"</span>)
                     (<span class="org-string">"html"</span> <span class="org-string">"HTML"</span>)
                     (<span class="org-string">"idl"</span> <span class="org-string">"IDL"</span>)
                     (<span class="org-string">"mercury"</span> <span class="org-string">"Mercury"</span>)
                     (<span class="org-string">"metapost"</span> <span class="org-string">"MetaPost"</span>)
                     (<span class="org-string">"modula-2"</span> <span class="org-string">"Modula-2"</span>)
                     (<span class="org-string">"pascal"</span> <span class="org-string">"Pascal"</span>)
                     (<span class="org-string">"ps"</span> <span class="org-string">"PostScript"</span>)
                     (<span class="org-string">"prolog"</span> <span class="org-string">"Prolog"</span>)
                     (<span class="org-string">"simula"</span> <span class="org-string">"Simula"</span>)
                     (<span class="org-string">"tcl"</span> <span class="org-string">"tcl"</span>)
                     (<span class="org-string">"tex"</span> <span class="org-string">"LaTeX"</span>)
                     (<span class="org-string">"plain-tex"</span> <span class="org-string">"TeX"</span>)
                     (<span class="org-string">"verilog"</span> <span class="org-string">"Verilog"</span>)
                     (<span class="org-string">"vhdl"</span> <span class="org-string">"VHDL"</span>)
                     (<span class="org-string">"xml"</span> <span class="org-string">"XML"</span>)
                     (<span class="org-string">"nxml"</span> <span class="org-string">"XML"</span>)
                     (<span class="org-string">"conf"</span> <span class="org-string">"Configuration File"</span>))))
      mode))
</pre>
</div>
    </details>

<details id='example-fixed-width' class='code' open><summary class='named'><span class="name">Example, fixed width, and property blocks</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#example-fixed-width'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-html-block-collapsable</span> (orig-fn block contents info)
  <span class="org-doc">"Wrap the usual block in a &lt;details&gt;"</span>
  (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (not org-fancy-html-export-mode) (<span class="org-keyword">bound-and-true-p</span> org-msg-export-in-progress))
      (funcall orig-fn block contents info)
    (<span class="org-keyword">let</span> ((ref (org-export-get-reference block info))
          (type (<span class="org-keyword">pcase</span> (car block)
                  ('property-drawer <span class="org-string">"Properties"</span>)))
          (collapsed-default (<span class="org-keyword">pcase</span> (car block)
                               ('property-drawer t)
                               (_ nil)))
          (collapsed-value (org-export-read-attribute <span class="org-builtin">:attr_html</span> block <span class="org-builtin">:collapsed</span>))
          (collapsed-p (<span class="org-keyword">or</span> (member (org-export-read-attribute <span class="org-builtin">:attr_html</span> block <span class="org-builtin">:collapsed</span>)
                                   '(<span class="org-string">"y"</span> <span class="org-string">"yes"</span> <span class="org-string">"t"</span> t <span class="org-string">"true"</span>))
                           (member (plist-get info <span class="org-builtin">:collapsed</span>) '(<span class="org-string">"all"</span>)))))
      (format
       <span class="org-string">"&lt;details id='%s' class='code'%s&gt;</span>
<span class="org-string">&lt;summary%s&gt;%s&lt;/summary&gt;</span>
<span class="org-string">&lt;div class='gutter'&gt;\</span>
<span class="org-string">&lt;a href='#%s'&gt;#&lt;/a&gt;</span>
<span class="org-string">&lt;button title='Copy to clipboard' onclick='copyPreToClipbord(this)'&gt;&#9112;&lt;/button&gt;\</span>
<span class="org-string">&lt;/div&gt;</span>
<span class="org-string">%s\n</span>
<span class="org-string">&lt;/details&gt;"</span>
       ref
       (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> collapsed-p collapsed-default) <span class="org-string">""</span> <span class="org-string">" open"</span>)
       (<span class="org-keyword">if</span> type <span class="org-string">" class='named'"</span> <span class="org-string">""</span>)
       (<span class="org-keyword">if</span> type (format <span class="org-string">"&lt;span class='type'&gt;%s&lt;/span&gt;"</span> type) <span class="org-string">""</span>)
       ref
       (funcall orig-fn block contents info)))))

(advice-add 'org-html-example-block   <span class="org-builtin">:around</span> #'org-html-block-collapsable)
(advice-add 'org-html-fixed-width     <span class="org-builtin">:around</span> #'org-html-block-collapsable)
(advice-add 'org-html-property-drawer <span class="org-builtin">:around</span> #'org-html-block-collapsable)
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-include-extra-font" class="outline-5">
<h5 id="include-extra-font"><span class="section-number-5">6.3.5.4</span> Include extra font-locking in htmlize<a aria-hidden="true" href="#include-extra-font">#</a> </h5>
<div class="outline-text-5" id="text-6-3-5-4">
<p>
Org uses <a href="https://github.com/hniksic/emacs-htmlize">htmlize.el</a> to export buffers with syntax highlighting.
</p>

<p>
The works fantastically, for the most part. Minor modes that provide
font-locking are <i>not</i> loaded, and so do not impact the result.
</p>

<p>
By enabling these modes in <code>htmlize-before-hook</code> we can correct this behaviour.
</p>

<details id='include-extra-font,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#include-extra-font,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload #'highlight-numbers--turn-on <span class="org-string">"highlight-numbers"</span>)
(add-hook 'htmlize-before-hook #'highlight-numbers--turn-on)
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-handle-table-overflow" class="outline-5">
<h5 id="handle-table-overflow"><span class="section-number-5">6.3.5.5</span> Handle table overflow<a aria-hidden="true" href="#handle-table-overflow">#</a> </h5>
<div class="outline-text-5" id="text-6-3-5-5">
<p>
In order to accommodate wide tables &#x2014;particularly on mobile devices&#x2014; we want
to set a maximum width and scroll overflow. Unfortunately, this cannot be applied
directly to the <code>table</code> element, so we have to wrap it in a <code>div</code>.
</p>

<p>
While we&rsquo;re at it, we can a link gutter, as we did with src blocks, and show the
<code>#+name</code>, if one is given.
</p>

<details id='handle-table-overflow,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#handle-table-overflow,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> org-html-table-wrapped (orig-fn table contents info)
  <span class="org-doc">"Wrap the usual &lt;table&gt; in a &lt;div&gt;"</span>
  <span class="org-builtin">:around</span> #'org-html-table
  (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (not org-fancy-html-export-mode) (<span class="org-keyword">bound-and-true-p</span> org-msg-export-in-progress))
      (funcall orig-fn table contents info)
    (<span class="org-keyword">let*</span> ((name (plist-get (cadr table) <span class="org-builtin">:name</span>))
           (ref (org-export-get-reference table info)))
      (format <span class="org-string">"&lt;div id='%s' class='table'&gt;</span>
<span class="org-string">&lt;div class='gutter'&gt;&lt;a href='#%s'&gt;#&lt;/a&gt;&lt;/div&gt;</span>
<span class="org-string">&lt;div class='tabular'&gt;</span>
<span class="org-string">%s</span>
<span class="org-string">&lt;/div&gt;\</span>
<span class="org-string">&lt;/div&gt;"</span>
              ref ref
              (<span class="org-keyword">if</span> name
                  (replace-regexp-in-string (format <span class="org-string">"&lt;table id=\"%s\""</span> ref) <span class="org-string">"&lt;table"</span>
                                            (funcall orig-fn table contents info))
                (funcall orig-fn table contents info))))))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-toc-as-collapsable" class="outline-5">
<h5 id="toc-as-collapsable"><span class="section-number-5">6.3.5.6</span> <span class='acr'><span class='acr'>TOC</span></span> as a collapsable tree<a aria-hidden="true" href="#toc-as-collapsable">#</a> </h5>
<div class="outline-text-5" id="text-6-3-5-6">
<p>
The <span class='acr'>TOC</span> is much nicer to navigate as a collapsable tree. Unfortunately we cannot
achieve this with <span class='acr'>CSS</span> alone. Thankfully we can avoid <span class='acr'>JS</span> though, by adapting the
<span class='acr'>TOC</span> generation code to use a <code>label</code> for each item, and a hidden <code>checkbox</code> to keep
track of state.
</p>

<p>
To add this, we need to change one line in <a href="file:///home/runner/.emacs.d/.local/straight/repos/org-mode/lisp/ox-html.el#MissingReference">org-html&#x2013;format-toc-headline</a>.
</p>

<p>
Since we can actually accomplish the desired effect by adding advice <i>around</i> the
function, without overriding it &#x2014; let&rsquo;s do that to reduce the bug surface of
this config a tad.
</p>
<details id='toc-as-collapsable,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#toc-as-collapsable,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> org-html--format-toc-headline-colapseable (orig-fn headline info)
  <span class="org-doc">"Add a label and checkbox to `</span><span class="org-doc"><span class="org-constant">org-html--format-toc-headline</span></span><span class="org-doc">'s usual output,</span>
<span class="org-doc">to allow the TOC to be a collapseable tree."</span>
  <span class="org-builtin">:around</span> #'org-html--format-toc-headline
  (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (not org-fancy-html-export-mode) (<span class="org-keyword">bound-and-true-p</span> org-msg-export-in-progress))
      (funcall orig-fn headline info)
    (<span class="org-keyword">let</span> ((id (<span class="org-keyword">or</span> (org-element-property <span class="org-builtin">:CUSTOM_ID</span> headline)
                  (org-export-get-reference headline info))))
      (format <span class="org-string">"&lt;input type='checkbox' id='toc--%s'/&gt;&lt;label for='toc--%s'&gt;%s&lt;/label&gt;"</span>
              id id (funcall orig-fn headline info)))))
</pre>
</div>
    </details>

<p>
Now, leaves (headings with no children) shouldn&rsquo;t have the <code>label</code> item. The
obvious way to achieve this is by including some <i>if no children&#x2026;</i> logic in
<code>org-html--format-toc-headline-colapseable</code>. Unfortunately, I can&rsquo;t my elisp isn&rsquo;t
up to par to extract the number of child headings from the mountain of info that
org provides.
</p>
<details id='toc-as-collapsable,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#toc-as-collapsable,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> org-html--toc-text-stripped-leaves (orig-fn toc-entries)
  <span class="org-doc">"Remove label"</span>
  <span class="org-builtin">:around</span> #'org-html--toc-text
  (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (not org-fancy-html-export-mode) (<span class="org-keyword">bound-and-true-p</span> org-msg-export-in-progress))
      (funcall orig-fn toc-entries)
    (replace-regexp-in-string <span class="org-string">"&lt;input [</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">&gt;]+&gt;&lt;label [</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">&gt;]+&gt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.+?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">&lt;/label&gt;&lt;/li&gt;"</span> <span class="org-string">"\\1&lt;/li&gt;"</span>
                              (funcall orig-fn toc-entries))))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-make-verbatim-different" class="outline-5">
<h5 id="make-verbatim-different"><span class="section-number-5">6.3.5.7</span> Make verbatim different to code<a aria-hidden="true" href="#make-verbatim-different">#</a> </h5>
<div class="outline-text-5" id="text-6-3-5-7">
<p>
Since we have <kbd>verbatim</kbd> and <code>code</code>, let&rsquo;s make use of the difference.
</p>

<p>
We can use <code>code</code> exclusively for code snippets and commands like: &ldquo;calling
<code class="src src-elisp">(message <span class="org-string">"Hello"</span>)</code> in batch-mode Emacs prints to stdout like <code>echo</code>&rdquo;.
Then we can use <kbd>verbatim</kbd> for miscellaneous &rsquo;other monospace&rsquo; like keyboard
shortcuts: &ldquo;either <kbd>C-c C-c</kbd> or <kbd>C-g</kbd> is likely the most useful keybinding in Emacs&rdquo;,
or file names: &ldquo;I keep my configuration in <kbd>~/.config/doom/</kbd>&rdquo;, among other things.
</p>

<p>
Then, styling these two cases differently can help improve clarity in a document.
</p>

<details id='make-verbatim-different,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#make-verbatim-different,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-html-text-markup-alist
      '((bold . <span class="org-string">"&lt;b&gt;%s&lt;/b&gt;"</span>)
        (code . <span class="org-string">"&lt;code&gt;%s&lt;/code&gt;"</span>)
        (italic . <span class="org-string">"&lt;i&gt;%s&lt;/i&gt;"</span>)
        (strike-through . <span class="org-string">"&lt;del&gt;%s&lt;/del&gt;"</span>)
        (underline . <span class="org-string">"&lt;span class=\"underline\"&gt;%s&lt;/span&gt;"</span>)
        (verbatim . <span class="org-string">"&lt;kbd&gt;%s&lt;/kbd&gt;"</span>)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-change-checkbox-type" class="outline-5">
<h5 id="change-checkbox-type"><span class="section-number-5">6.3.5.8</span> Change checkbox type<a aria-hidden="true" href="#change-checkbox-type">#</a> </h5>
<div class="outline-text-5" id="text-6-3-5-8">
<p>
We also want to use <span class='acr'>HTML</span> checkboxes, however we want to get a bit fancier than default
</p>
<details id='change-checkbox-type,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#change-checkbox-type,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">appendq!</span> org-html-checkbox-types
          '((html-span
             (on . <span class="org-string">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span>)
             (off . <span class="org-string">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span>)
             (trans . <span class="org-string">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span>))))
(<span class="org-keyword">setq</span> org-html-checkbox-type 'html-span)
</pre>
</div>
    </details>
<ul class="org-ul">
<li class="off"><span class='checkbox'></span> I&rsquo;m yet to do this</li>
<li class="trans"><span class='checkbox'></span> Work in progress</li>
<li class="on"><span class='checkbox'></span> This is done</li>
</ul>
</div>
</div>
<div id="outline-container-extra-special-strings" class="outline-5">
<h5 id="extra-special-strings"><span class="section-number-5">6.3.5.9</span> Extra special strings<a aria-hidden="true" href="#extra-special-strings">#</a> </h5>
<div class="outline-text-5" id="text-6-3-5-9">
<p>
The <code>org-html-special-string-regexps</code> variable defines substitutions for:
</p>
<ul class="org-ul">
<li><kbd>\-</kbd>, a shy hyphen</li>
<li><kbd>---</kbd>, an em dash</li>
<li><kbd>--</kbd>, an en dash</li>
<li><kbd>...</kbd>, (horizontal) ellipses</li>
</ul>

<p>
However I think it would be nice if there was also a substitution for left/right
arrows (<kbd>-&gt;</kbd> and <kbd>&lt;-</kbd>). This is a <code>defconst</code>, but as you may tell from the amount of
advice in this config, I&rsquo;m not above messing with things I&rsquo;m not &rsquo;supposed&rsquo; to.
</p>

<p>
The only minor complication is that <kbd>&lt;</kbd> and <kbd>&gt;</kbd> are converted to <kbd>&amp;lt;</kbd> and <kbd>&amp;gt;</kbd>
before this stage of output processing.
</p>

<details id='extra-special-strings,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-special-strings,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">pushnew!</span> org-html-special-string-regexps
          '(<span class="org-string">"-&amp;gt;"</span> . <span class="org-string">"&amp;#8594;"</span>)
          '(<span class="org-string">"&amp;lt;-"</span> . <span class="org-string">"&amp;#8592;"</span>))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-header-anchors" class="outline-5">
<h5 id="header-anchors"><span class="section-number-5">6.3.5.10</span> Header anchors<a aria-hidden="true" href="#header-anchors">#</a> </h5>
<div class="outline-text-5" id="text-6-3-5-10">
<p>
I want to add GitHub-style links on hover for headings.
</p>
<details id='header-anchors,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#header-anchors,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-export-html-headline-anchor</span> (text backend info)
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (org-export-derived-backend-p backend 'html)
             (not (org-export-derived-backend-p backend 're-reveal))
             org-fancy-html-export-mode)
    (<span class="org-keyword">unless</span> (<span class="org-keyword">bound-and-true-p</span> org-msg-export-in-progress)
      (replace-regexp-in-string
       <span class="org-string">"&lt;h</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> id=\"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[a-z0-9-]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\"&gt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> ]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">&lt;\\/h[0-9]&gt;"</span> <span class="org-comment-delimiter">; </span><span class="org-comment">this is quite restrictive, but due to `</span><span class="org-comment"><span class="org-constant">org-reference-contraction</span></span><span class="org-comment">' I can do this</span>
       <span class="org-string">"&lt;h\\1 id=\"\\2\"&gt;\\3&lt;a aria-hidden=\"true\" href=\"#\\2\"&gt;#&lt;/a&gt; &lt;/h\\1&gt;"</span>
       text))))

(add-to-list 'org-export-filter-headline-functions
             'org-export-html-headline-anchor)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-link-previews" class="outline-5">
<h5 id="link-previews"><span class="section-number-5">6.3.5.11</span> Link previews<a aria-hidden="true" href="#link-previews">#</a> </h5>
<div class="outline-text-5" id="text-6-3-5-11">
<p>
Sometimes it&rsquo;s nice to make a link particularly prominent, an embed/preview like
Twitter does would be nice I think.
</p>

<p>
We can do this without too much trouble by adding a new link type ever so
slightly different from <kbd>https</kbd> &#x2014; <kbd>Https</kbd>.
</p>

<details id='link-previews,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#link-previews,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(org-link-set-parameters <span class="org-string">"Https"</span>
                         <span class="org-builtin">:follow</span> (<span class="org-keyword">lambda</span> (url arg) (browse-url (concat <span class="org-string">"https:"</span> url) arg))
                         <span class="org-builtin">:export</span> #'org-url-fancy-export)
</pre>
</div>
    </details>

<p>
Then, if we can fetch a plist of the form <code class="src src-elisp">(<span class="org-builtin">:title</span> <span class="org-string">"..."</span> <span class="org-builtin">:description</span> <span class="org-string">"..."</span> <span class="org-builtin">:image</span> <span class="org-string">"..."</span>)</code> for such links via a function <code>org-url-unfurl-metadata</code>, we
can make a fancy export.
</p>

<details id='link-previews,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#link-previews,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-url-fancy-export</span> (url _desc backend)
  (<span class="org-keyword">let</span> ((metadata (org-url-unfurl-metadata (concat <span class="org-string">"https:"</span> url))))
    (<span class="org-keyword">cond</span>
     ((org-export-derived-backend-p backend 'html)
      (concat
       <span class="org-string">"&lt;div class=\"link-preview\"&gt;"</span>
       (format <span class="org-string">"&lt;a href=\"%s\"&gt;"</span> (concat <span class="org-string">"https:"</span> url))
       (<span class="org-keyword">when</span> (plist-get metadata <span class="org-builtin">:image</span>)
         (format <span class="org-string">"&lt;img src=\"%s\"/&gt;"</span> (plist-get metadata <span class="org-builtin">:image</span>)))
       <span class="org-string">"&lt;small&gt;"</span>
       (replace-regexp-in-string <span class="org-string">"//</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">www\\.</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">/]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">/?.*"</span> <span class="org-string">"\\1"</span> url)
       <span class="org-string">"&lt;/small&gt;&lt;p&gt;"</span>
       (<span class="org-keyword">when</span> (plist-get metadata <span class="org-builtin">:title</span>)
         (concat <span class="org-string">"&lt;b&gt;"</span> (org-html-encode-plain-text (plist-get metadata <span class="org-builtin">:title</span>)) <span class="org-string">"&lt;/b&gt;&lt;/br&gt;"</span>))
       (<span class="org-keyword">when</span> (plist-get metadata <span class="org-builtin">:description</span>)
         (org-html-encode-plain-text (plist-get metadata <span class="org-builtin">:description</span>)))
       <span class="org-string">"&lt;/p&gt;&lt;/a&gt;&lt;/div&gt;"</span>))
     (t url))))
</pre>
</div>
    </details>

<p>
Now we just need to actually implement that metadata extraction function.
</p>
<details id='link-previews,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#link-previews,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-url-unfurl-metadata--cache nil)
(<span class="org-keyword">defun</span> <span class="org-function-name">org-url-unfurl-metadata</span> (url)
  (cdr (<span class="org-keyword">or</span> (assoc url org-url-unfurl-metadata--cache)
           (car (<span class="org-keyword">push</span>
                 (cons
                  url
                  (<span class="org-keyword">let*</span> ((head-data
                          (-filter #'listp
                                   (cdaddr
                                    (<span class="org-keyword">with-current-buffer</span> (<span class="org-keyword">progn</span> (message <span class="org-string">"Fetching metadata from %s"</span> url)
                                                                (url-retrieve-synchronously url t t <span class="org-highlight-numbers-number">5</span>))
                                      (goto-char (point-min))
                                      (delete-region (point-min) (- (search-forward <span class="org-string">"&lt;head"</span>) <span class="org-highlight-numbers-number">6</span>))
                                      (delete-region (search-forward <span class="org-string">"&lt;/head&gt;"</span>) (point-max))
                                      (goto-char (point-min))
                                      (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"&lt;script[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\u2800]+?&lt;/script&gt;"</span> nil t)
                                        (replace-match <span class="org-string">""</span>))
                                      (goto-char (point-min))
                                      (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"&lt;style[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\u2800]+?&lt;/style&gt;"</span> nil t)
                                        (replace-match <span class="org-string">""</span>))
                                      (libxml-parse-html-region (point-min) (point-max))))))
                         (meta (delq nil
                                     (mapcar
                                      (<span class="org-keyword">lambda</span> (tag)
                                        (<span class="org-keyword">when</span> (eq 'meta (car tag))
                                          (cons (<span class="org-keyword">or</span> (cdr (assoc 'name (cadr tag)))
                                                    (cdr (assoc 'property (cadr tag))))
                                                (cdr (assoc 'content (cadr tag))))))
                                      head-data))))
                    (<span class="org-keyword">let</span> ((title (<span class="org-keyword">or</span> (cdr (assoc <span class="org-string">"og:title"</span> meta))
                                     (cdr (assoc <span class="org-string">"twitter:title"</span> meta))
                                     (nth <span class="org-highlight-numbers-number">2</span> (assq 'title head-data))))
                          (description (<span class="org-keyword">or</span> (cdr (assoc <span class="org-string">"og:description"</span> meta))
                                           (cdr (assoc <span class="org-string">"twitter:description"</span> meta))
                                           (cdr (assoc <span class="org-string">"description"</span> meta))))
                          (image (<span class="org-keyword">or</span> (cdr (assoc <span class="org-string">"og:image"</span> meta))
                                     (cdr (assoc <span class="org-string">"twitter:image"</span> meta)))))
                      (<span class="org-keyword">when</span> image
                        (<span class="org-keyword">setq</span> image (replace-regexp-in-string
                                     <span class="org-string">"^/"</span> (concat <span class="org-string">"https://"</span> (replace-regexp-in-string <span class="org-string">"//</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">/]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">/?.*"</span> <span class="org-string">"\\1"</span> url) <span class="org-string">"/"</span>)
                                     (replace-regexp-in-string
                                      <span class="org-string">"^//"</span> <span class="org-string">"https://"</span>
                                      image))))
                      (list <span class="org-builtin">:title</span> title <span class="org-builtin">:description</span> description <span class="org-builtin">:image</span> image))))
                 org-url-unfurl-metadata--cache)))))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-latex-rendering" class="outline-5">
<h5 id="latex-rendering"><span class="section-number-5">6.3.5.12</span> LaTeX Rendering<a aria-hidden="true" href="#latex-rendering">#</a> </h5>
<div class="outline-text-5" id="text-6-3-5-12">
</div>
<div id="outline-container-pre-rendered" class="outline-6">
<h6 id="pre-rendered"><span class="section-number-6">6.3.5.12.1</span> Pre-rendered<a aria-hidden="true" href="#pre-rendered">#</a> </h6>
<div class="outline-text-6" id="text-6-3-5-12-1">
<p>
I consider <code>dvisvgm</code> to be a rather compelling option. However this isn&rsquo;t scaled
very well at the moment.
</p>
<details id='pre-rendered,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#pre-rendered,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(setq-default org-html-with-latex `dvisvgm)</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-mathjax" class="outline-6">
<h6 id="mathjax"><span class="section-number-6">6.3.5.12.2</span> MathJax<a aria-hidden="true" href="#mathjax">#</a> </h6>
<div class="outline-text-6" id="text-6-3-5-12-2">
<p>
If MathJax is used, we want to use version 3 instead of the default version 2.
Looking at a <a href="https://www.intmath.com/cg5/katex-mathjax-comparison.php">comparison</a> we seem to find that it is ~5 times as fast, uses a
single file instead of multiple, but seems to be a bit bigger unfortunately.
Thankfully this can be mitigated my adding the <code>async</code> attribute to defer loading.
</p>

<details id='mathjax,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#mathjax,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-html-mathjax-options
      '((path <span class="org-string">"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"</span> )
        (scale <span class="org-string">"1"</span>)
        (autonumber <span class="org-string">"ams"</span>)
        (multlinewidth <span class="org-string">"85%"</span>)
        (tagindent <span class="org-string">".8em"</span>)
        (tagside <span class="org-string">"right"</span>)))

(<span class="org-keyword">setq</span> org-html-mathjax-template
      <span class="org-string">"&lt;script&gt;</span>
<span class="org-string">MathJax = {</span>
<span class="org-string">  chtml: {</span>
<span class="org-string">    scale: %SCALE</span>
<span class="org-string">  },</span>
<span class="org-string">  svg: {</span>
<span class="org-string">    scale: %SCALE,</span>
<span class="org-string">    fontCache: \"global\"</span>
<span class="org-string">  },</span>
<span class="org-string">  tex: {</span>
<span class="org-string">    tags: \"%AUTONUMBER\",</span>
<span class="org-string">    multlineWidth: \"%MULTLINEWIDTH\",</span>
<span class="org-string">    tagSide: \"%TAGSIDE\",</span>
<span class="org-string">    tagIndent: \"%TAGINDENT\"</span>
<span class="org-string">  }</span>
<span class="org-string">};</span>
<span class="org-string">&lt;/script&gt;</span>
<span class="org-string">&lt;script id=\"MathJax-script\" async</span>
<span class="org-string">        src=\"%PATH\"&gt;&lt;/script&gt;"</span>)
</pre>
</div>
    </details>
</div>
</div>
</div>
</div>
<div id="outline-container-latex-export" class="outline-4">
<h4 id="latex-export"><span class="section-number-4">6.3.6</span> LaTeX Export<a aria-hidden="true" href="#latex-export">#</a> </h4>
<div class="outline-text-4" id="text-6-3-6">
</div>
<div id="outline-container-compiling" class="outline-5">
<h5 id="compiling"><span class="section-number-5">6.3.6.1</span> Compiling<a aria-hidden="true" href="#compiling">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-1">
<p>
By default Org uses <code>pdflatex</code> &times; 3 + <code>bibtex</code>. This simply won&rsquo;t do in our
modern world. <code>latexmk</code> + <code>biber</code> (which is used automatically with <code>latexmk</code>) is a
simply superior combination.
</p>

<details id='compiling,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#compiling,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">org-latex-compilers = ("pdflatex" "xelatex" "lualatex"), which are the possible values for %latex</span>
(<span class="org-keyword">setq</span> org-latex-pdf-process '(<span class="org-string">"latexmk -f -pdf -%latex -shell-escape -interaction=nonstopmode -output-directory=%o %f"</span>))
</pre>
</div>
    </details>

<p>
While <code>org-latex-pdf-process</code> does support a function, and we could use that
instead, this would no longer use the log buffer &#x2014; it&rsquo;s a bit blind, you give
it the file name and expect it to do its thing.
</p>

<p>
The default values of <code>org-latex-compilers</code> is given in commented form to see how
<code>org-latex-pdf-process</code> works with them.
</p>

<p>
While the <code>-%latex</code> above is slightly hacky (<code>-pdflatex</code> expects to be given a
value) it allows us to leave <code>org-latex-compilers</code> unmodified.
This is nice in case I open an org file that uses <kbd>#+LATEX_COMPILER</kbd> for example,
it should still work.
</p>
</div>
</div>

<div id="outline-container-nicer-checkboxes" class="outline-5">
<h5 id="nicer-checkboxes"><span class="section-number-5">6.3.6.2</span> Nicer checkboxes<a aria-hidden="true" href="#nicer-checkboxes">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-2">
<p>
We&rsquo;ll assume that thanks to the clever preamble the various custom <kbd>\checkbox...</kbd>
commands below are defined.
</p>

<details id='nicer-checkboxes,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#nicer-checkboxes,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+org-export-latex-fancy-item-checkboxes</span> (text backend info)
  (<span class="org-keyword">when</span> (org-export-derived-backend-p backend 'latex)
    (replace-regexp-in-string
     <span class="org-string">"\\\\item\\[{$\\\\</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\w+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">$}\\]"</span>
     (<span class="org-keyword">lambda</span> (fullmatch)
       (concat <span class="org-string">"\\\\item["</span> (<span class="org-keyword">pcase</span> (substring fullmatch <span class="org-highlight-numbers-number">9</span> <span class="org-highlight-numbers-number">-3</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">content of capture group</span>
                             (<span class="org-string">"square"</span>   <span class="org-string">"\\\\checkboxUnchecked"</span>)
                             (<span class="org-string">"boxminus"</span> <span class="org-string">"\\\\checkboxTransitive"</span>)
                             (<span class="org-string">"boxtimes"</span> <span class="org-string">"\\\\checkboxChecked"</span>)
                             (_ (substring fullmatch <span class="org-highlight-numbers-number">9</span> <span class="org-highlight-numbers-number">-3</span>))) <span class="org-string">"]"</span>))
     text)))

(add-to-list 'org-export-filter-item-functions
             '+org-export-latex-fancy-item-checkboxes)
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-class-templates" class="outline-5">
<h5 id="class-templates"><span class="section-number-5">6.3.6.3</span> Class templates<a aria-hidden="true" href="#class-templates">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-3">
<details id='class-templates,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#class-templates,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> ox-latex
  (add-to-list 'org-latex-classes
               '(<span class="org-string">"scr-article"</span>
                 <span class="org-string">"\\documentclass{scrartcl}"</span>
                 (<span class="org-string">"\\section{%s}"</span> . <span class="org-string">"\\section*{%s}"</span>)
                 (<span class="org-string">"\\subsection{%s}"</span> . <span class="org-string">"\\subsection*{%s}"</span>)
                 (<span class="org-string">"\\subsubsection{%s}"</span> . <span class="org-string">"\\subsubsection*{%s}"</span>)
                 (<span class="org-string">"\\paragraph{%s}"</span> . <span class="org-string">"\\paragraph*{%s}"</span>)
                 (<span class="org-string">"\\subparagraph{%s}"</span> . <span class="org-string">"\\subparagraph*{%s}"</span>)))
  (add-to-list 'org-latex-classes
               '(<span class="org-string">"blank"</span>
                 <span class="org-string">"[NO-DEFAULT-PACKAGES]\n[NO-PACKAGES]\n[EXTRA]"</span>
                 (<span class="org-string">"\\section{%s}"</span> . <span class="org-string">"\\section*{%s}"</span>)
                 (<span class="org-string">"\\subsection{%s}"</span> . <span class="org-string">"\\subsection*{%s}"</span>)
                 (<span class="org-string">"\\subsubsection{%s}"</span> . <span class="org-string">"\\subsubsection*{%s}"</span>)
                 (<span class="org-string">"\\paragraph{%s}"</span> . <span class="org-string">"\\paragraph*{%s}"</span>)
                 (<span class="org-string">"\\subparagraph{%s}"</span> . <span class="org-string">"\\subparagraph*{%s}"</span>)))
  (add-to-list 'org-latex-classes
               '(<span class="org-string">"bmc-article"</span>
                 <span class="org-string">"\\documentclass[article,code,maths]{bmc}\n[NO-DEFAULT-PACKAGES]\n[NO-PACKAGES]\n[EXTRA]"</span>
                 (<span class="org-string">"\\section{%s}"</span> . <span class="org-string">"\\section*{%s}"</span>)
                 (<span class="org-string">"\\subsection{%s}"</span> . <span class="org-string">"\\subsection*{%s}"</span>)
                 (<span class="org-string">"\\subsubsection{%s}"</span> . <span class="org-string">"\\subsubsection*{%s}"</span>)
                 (<span class="org-string">"\\paragraph{%s}"</span> . <span class="org-string">"\\paragraph*{%s}"</span>)
                 (<span class="org-string">"\\subparagraph{%s}"</span> . <span class="org-string">"\\subparagraph*{%s}"</span>)))
  (add-to-list 'org-latex-classes
               '(<span class="org-string">"bmc"</span>
                 <span class="org-string">"\\documentclass[code,maths]{bmc}\n[NO-DEFAULT-PACKAGES]\n[NO-PACKAGES]\n[EXTRA]"</span>
                 (<span class="org-string">"\\chapter{%s}"</span> . <span class="org-string">"\\chapter*{%s}"</span>)
                 (<span class="org-string">"\\section{%s}"</span> . <span class="org-string">"\\section*{%s}"</span>)
                 (<span class="org-string">"\\subsection{%s}"</span> . <span class="org-string">"\\subsection*{%s}"</span>)
                 (<span class="org-string">"\\subsubsection{%s}"</span> . <span class="org-string">"\\subsubsection*{%s}"</span>)
                 (<span class="org-string">"\\paragraph{%s}"</span> . <span class="org-string">"\\paragraph*{%s}"</span>)
                 (<span class="org-string">"\\subparagraph{%s}"</span> . <span class="org-string">"\\subparagraph*{%s}"</span>))))

(<span class="org-keyword">setq</span> org-latex-default-class <span class="org-string">"scr-article"</span>
      org-latex-tables-booktabs t
      org-latex-hyperref-template <span class="org-string">"</span>
<span class="org-string">&lt;&lt;latex-fancy-hyperref&gt;&gt;</span>
<span class="org-string">"</span>
      org-latex-reference-command <span class="org-string">"\\cref{%s}"</span>)
</pre>
</div>
    </details>


<p>
The <kbd>hyperref</kbd> setup needs to be handled separately however.
</p>
<details id='latex-fancy-hyperref' class='code' open><summary class='named'><span class="name">latex-fancy-hyperref</span><span class="lang">LaTeX</span></summary>
    <div class='gutter'>
    <a href='#latex-fancy-hyperref'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-LaTeX"><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">colorlet</span>{greenyblue}{blue!70!green}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">colorlet</span>{blueygreen}{blue!40!green}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">providecolor</span>{link}{named}{greenyblue}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">providecolor</span>{cite}{named}{blueygreen}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">hypersetup</span>{
  pdfauthor={<span class="org-comment">%a},</span>
  pdftitle={<span class="org-comment">%t},</span>
  pdfkeywords={<span class="org-comment">%k},</span>
  pdfsubject={<span class="org-comment">%d},</span>
  pdfcreator={<span class="org-comment">%c},</span>
  pdflang={<span class="org-comment">%L},</span>
  breaklinks=true,
  colorlinks=true,
  linkcolor=,
  urlcolor=link,
  citecolor=cite<span class="org-font-latex-sedate"><span class="org-keyword">\n</span></span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">urlstyle</span>{same}
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-cleverer-preamble" class="outline-5">
<h5 id="cleverer-preamble"><span class="section-number-5">6.3.6.4</span> A cleverer preamble<a aria-hidden="true" href="#cleverer-preamble">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-4">
</div>
<div id="outline-container-use-case" class="outline-6">
<h6 id="use-case"><span class="section-number-6">6.3.6.4.1</span> Use case<a aria-hidden="true" href="#use-case">#</a> </h6>
<div class="outline-text-6" id="text-6-3-6-4-1">
<p>
We often want particular snippets of LaTeX in our documents preambles.
It&rsquo;s a pain to have to work out / remember them every time.
For example, I almost always want to include the snippet below.
</p>

<details id='org-latex-embed' class='code' open><summary class='named'><span class="name">org-latex-embed-files-preamble</span><span class="lang">LaTeX</span></summary>
    <div class='gutter'>
    <a href='#org-latex-embed'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-LaTeX"><span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>[<span class="org-variable-name">main,include</span>]{<span class="org-function-name">embedall</span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">IfFileExists</span>{./<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">jobname</span>.org}{<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">embedfile</span>[desc=The original file]{<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">jobname</span>.org}}{}
</pre>
</div>
    </details>

<p>
We could have every package we could possibly need in every one of
<code>org-latex-classes</code>, but that&rsquo;s <i>horribly</i> inefficient and I don&rsquo;t want to think
about maintaining that.
</p>

<p>
Instead we can provide some granularity by splitting up the features we want,
and then take the experience to a whole new level by implementing a system to
automatically detect which features are desired and generating a preamble that
provides these features.
</p>
</div>
</div>

<div id="outline-container-conditional-content" class="outline-6">
<h6 id="conditional-content"><span class="section-number-6">6.3.6.4.2</span> Conditional Content<a aria-hidden="true" href="#conditional-content">#</a> </h6>
<div class="outline-text-6" id="text-6-3-6-4-2">
<p>
Let&rsquo;s consider content we want in particular situations.
</p>

<p>
Captions could do with a bit of tweaking such that
</p>
<ul class="org-ul">
<li>You can easily have multiple captions</li>
<li>Links to figures take you to the <i>top</i> of the figure (not the bottom)</li>
<li>Caption labels could do with being emphasised slightly more</li>
<li>Multiline captions should run ragged-right, but only when then span more than
one line</li>
</ul>

<details id='org-latex-caption' class='code' open><summary class='named'><span class="name">org-latex-caption-preamble</span><span class="lang">LaTeX</span></summary>
    <div class='gutter'>
    <a href='#org-latex-caption'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-LaTeX"><span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>{<span class="org-function-name">subcaption</span>}
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>[<span class="org-variable-name">hypcap=true</span>]{<span class="org-function-name">caption</span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">setkomafont</span>{caption}{<span class="org-font-latex-warning">\</span><span class="org-type"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-type"><span class="org-keyword">sffamily</span></span><span class="org-font-latex-warning">\</span><span class="org-type"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-type"><span class="org-keyword">small</span></span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">setkomafont</span>{captionlabel}{<span class="org-font-latex-warning">\</span><span class="org-font-latex-bold"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-font-latex-bold"><span class="org-keyword">upshape</span></span><span class="org-font-latex-warning">\</span><span class="org-font-latex-bold"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-font-latex-bold"><span class="org-keyword">bfseries</span></span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">captionsetup</span>{justification=raggedright,singlelinecheck=true}
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>{<span class="org-function-name">capt-of</span>} <span class="org-comment">% required by Org</span>
</pre>
</div>
    </details>

<p>
The default checkboxes look rather ugly, so let&rsquo;s provide some prettier alternatives.
</p>

<details id='org-latex-checkbox' class='code' open><summary class='named'><span class="name">org-latex-checkbox-preamble</span><span class="lang">LaTeX</span></summary>
    <div class='gutter'>
    <a href='#org-latex-checkbox'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-LaTeX"><span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">newcommand</span></span>{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">checkboxUnchecked</span></span>}{<span class="org-function-name"><span class="org-font-latex-math">$\</span></span><span class="org-function-name"><span class="org-font-latex-math"><span class="org-keyword">\square</span></span></span><span class="org-function-name"><span class="org-font-latex-math">$</span></span>}
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">newcommand</span></span>{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">checkboxTransitive</span></span>}{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">rlap</span></span><span class="org-function-name">{</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">raisebox</span></span><span class="org-function-name">{-0.1ex}{</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">hspace</span></span><span class="org-function-name">{0.35ex}</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-type"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-type"><span class="org-function-name"><span class="org-keyword">Large</span></span></span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span></span><span class="org-keyword"><span class="org-function-name"><span class="org-keyword">textbf</span></span></span><span class="org-function-name"> -}}</span><span class="org-function-name"><span class="org-font-latex-math">$\</span></span><span class="org-function-name"><span class="org-font-latex-math"><span class="org-keyword">\square</span></span></span><span class="org-function-name"><span class="org-font-latex-math">$</span></span>}
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">newcommand</span></span>{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">checkboxChecked</span></span>}{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">rlap</span></span><span class="org-function-name">{</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">raisebox</span></span><span class="org-function-name">{0.2ex}{</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">hspace</span></span><span class="org-function-name">{0.35ex}</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-type"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-type"><span class="org-function-name"><span class="org-keyword">scriptsize</span></span></span><span class="org-function-name"> </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">ding</span></span><span class="org-function-name">{52}}}</span><span class="org-function-name"><span class="org-font-latex-math">$\</span></span><span class="org-function-name"><span class="org-font-latex-math"><span class="org-keyword">\square</span></span></span><span class="org-function-name"><span class="org-font-latex-math">$</span></span>}
</pre>
</div>
    </details>

<p>
It&rsquo;s nice to have &ldquo;message blocks&rdquo;, things like info/warning/error/success.
A LaTeX macro should make them trivial to create.
</p>

<details id='org-latex-box' class='code' open><summary class='named'><span class="name">org-latex-box-preamble</span><span class="lang">LaTeX</span></summary>
    <div class='gutter'>
    <a href='#org-latex-box'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-LaTeX"><span class="org-comment-delimiter">% </span><span class="org-comment">args = #1 Name, #2 Colour, #3 Ding, #4 Label</span>
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">newcommand</span></span>{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">defsimplebox</span></span>}[<span class="org-variable-name">4</span>]{<span class="org-function-name"><span class="org-comment">%</span></span>
<span class="org-function-name">  </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">definecolor</span></span><span class="org-function-name">{#1}{HTML}{#2}</span>
<span class="org-function-name">  </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">newenvironment</span></span><span class="org-function-name">{#1}[1][]</span>
<span class="org-function-name">  {</span><span class="org-function-name"><span class="org-comment">%</span></span>
<span class="org-function-name">    </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">par</span></span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">vspace</span></span><span class="org-function-name">{-0.7</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">baselineskip</span></span><span class="org-function-name">}</span><span class="org-function-name"><span class="org-comment">%</span></span>
<span class="org-function-name">    </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">textcolor</span></span><span class="org-function-name">{#1}{#3} </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">textcolor</span></span><span class="org-function-name">{#1}{</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-keyword"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-keyword"><span class="org-function-name"><span class="org-keyword">textbf</span></span></span><span class="org-function-name">{</span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-font-latex-warning">\</span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-keyword">def</span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-font-latex-warning">\</span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-keyword">temp</span></span></span><span class="org-font-latex-bold"><span class="org-function-name">{##1}</span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-font-latex-warning">\</span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-keyword">ifx</span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-font-latex-warning">\</span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-keyword">temp</span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-font-latex-warning">\</span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-keyword">empty</span></span></span><span class="org-font-latex-bold"><span class="org-function-name">#4</span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-font-latex-warning">\</span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-keyword">else</span></span></span><span class="org-font-latex-bold"><span class="org-function-name">##1</span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-font-latex-warning">\</span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-font-latex-bold"><span class="org-function-name"><span class="org-keyword">fi</span></span></span><span class="org-function-name">}}</span><span class="org-function-name"><span class="org-comment">%</span></span>
<span class="org-function-name">    </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">vspace</span></span><span class="org-function-name">{-0.8</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">baselineskip</span></span><span class="org-function-name">}</span>
<span class="org-function-name">    </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">begin</span></span><span class="org-function-name">{addmargin}[1em]{1em}</span>
<span class="org-function-name">  }{</span><span class="org-function-name"><span class="org-comment">%</span></span>
<span class="org-function-name">    </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">end</span></span><span class="org-function-name">{addmargin}</span>
<span class="org-function-name">    </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">vspace</span></span><span class="org-function-name">{-0.5</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">baselineskip</span></span><span class="org-function-name">}</span>
<span class="org-function-name">  }</span><span class="org-function-name"><span class="org-comment">%</span></span>
}
</pre>
</div>
    </details>

<p>
Lastly, we will pass this content into some global variables we for ease of
access.
</p>

<details id='conditional-content,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#conditional-content,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-embed-files-preamble</span> <span class="org-string">"</span>
<span class="org-string">&lt;&lt;org-latex-embed-files-preamble&gt;&gt;</span>
<span class="org-string">"</span>
  <span class="org-doc">"Preamble that embeds files within the pdf."</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-caption-preamble</span> <span class="org-string">"</span>
<span class="org-string">&lt;&lt;org-latex-caption-preamble&gt;&gt;</span>
<span class="org-string">"</span>
  <span class="org-doc">"Preamble that improves captions."</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-checkbox-preamble</span> <span class="org-string">"</span>
<span class="org-string">&lt;&lt;org-latex-checkbox-preamble&gt;&gt;</span>
<span class="org-string">"</span>
  <span class="org-doc">"Preamble that improves checkboxes."</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-box-preamble</span> <span class="org-string">"</span>
<span class="org-string">&lt;&lt;org-latex-box-preamble&gt;&gt;</span>
<span class="org-string">"</span>
  <span class="org-doc">"Preamble that provides a macro for custom boxes."</span>)
</pre>
</div>
    </details>

<p>
In the &ldquo;universal preamble&rdquo;, we already embed the source <kbd>.org</kbd> file, but it would
be nice to embed all the tangled files. This is fairly easy to accomplish by
mapping each tangled file to a form which embeds the file if it exists.
</p>
<details id='conditional-content,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#conditional-content,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-embed-tangled-files</span> ()
  <span class="org-doc">"Return a string that uses embedfile to embed all tangled files."</span>
  (mapconcat
   (<span class="org-keyword">lambda</span> (tangle-file)
     (format <span class="org-string">"\\IfFileExists{%1$s}{\\embedfile[desc=Tangled %2$s file]{%1$s}}{}"</span>
             (<span class="org-keyword">-&gt;&gt;</span> (car tangle-file)
               (replace-regexp-in-string <span class="org-string">"\\\\"</span> <span class="org-string">"\\\\\\\\"</span>)
               (replace-regexp-in-string <span class="org-string">"~"</span> <span class="org-string">"\\\\string~"</span>))
             (cdr tangle-file)))
   (mapcar (<span class="org-keyword">lambda</span> (f-block) (cons (car f-block) (caadr f-block)))
           (org-babel-tangle-collect-blocks)) <span class="org-comment-delimiter">; </span><span class="org-comment">all files being tangled to</span>
   <span class="org-string">"\n"</span>))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-content-feature-preamble" class="outline-6">
<h6 id="content-feature-preamble"><span class="section-number-6">6.3.6.4.3</span> Content-feature-preamble association<a aria-hidden="true" href="#content-feature-preamble">#</a> </h6>
<div class="outline-text-6" id="text-6-3-6-4-3">
<p>
Initially this idea was implemented with an alist that associated a construct
that would search the current Org file for an indication that some feature was
needed, with a LaTeX snippet to be inserted in the preamble which would provide
that feature.
This is all well and good when there is a bijection between detected features
and the LaTeX code needed to support those features, but in many cases this
relation is not injective.
</p>

<p>
To better model the reality of the situation, I add an extra layer to this
process where each detected feature gives a list of required &ldquo;feature flags&rdquo;.
Simply be merging the lists of feature flags we no longer have to require
injectivity to avoid LaTeX duplication. Then the extra layer forms a bijection
between there feature flags and a specification which can be used to implement
the feature.
</p>

<p>
This model also provides a number of nice secondary benefits, such as a simple
implementation of feature dependency.
</p>


<figure id="org304d47f">
<object type="image/svg+xml" data="misc/org-latex-clever-preamble.svg" class="invertible" alt="DAG showing how Org features flow through to LaTeX" style="max-width:min(24em,100%)">
Sorry, your browser does not support SVG.</object>

<figcaption><span class="figure-number">Figure 18: </span>Association between Org features, feature flags, and LaTeX snippets required.</figcaption>
</figure>

<p>
First we will implement the feature detection component of this model. I&rsquo;d like
this to be able to use as much state information as possible, so the feature
tests should be very versatile.
</p>

<details id='content-feature-preamble,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#content-feature-preamble,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-embed-files</span> t
  <span class="org-doc">"Embed the source .org, .tex, and any tangled files."</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-use-microtype</span> t
  <span class="org-doc">"Use the microtype pakage."</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-italic-quotes</span> t
  <span class="org-doc">"Make \"quote\" environments italic."</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-par-sep</span> t
  <span class="org-doc">"Vertically seperate paragraphs, and remove indentation."</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-conditional-features</span>
  '((<span class="org-string">"\\[\\[</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">file</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">https?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">]]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\\\]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">+?\\.</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">eps</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">pdf</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">png</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">jpeg</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">jpg</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">jbig2</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\]\\]"</span> . image)
    (<span class="org-string">"\\[\\[</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">file</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">https?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">]]+?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\\\]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\.svg\\]\\]"</span> . svg)
    (<span class="org-string">"\\\\(</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\\\[</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\begin{</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">math</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">displaymath</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">equation</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">align</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">flalign</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">multiline</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">gather</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">[a-z]*\\*?}"</span> . maths)
    (<span class="org-string">"^[ \t]*|"</span> . table)
    (<span class="org-string">"cref:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\cref{</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\[\\[[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\\]]+\\]\\]"</span> . cleveref)
    (<span class="org-string">"[;\\\\]?\\b[A-Z][A-Z]+s?[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">A-Za-z]"</span> . acronym)
    (<span class="org-string">"\\+[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> ].*[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> ]\\+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">_[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> ].*[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> ]_</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\uu?line</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\uwave</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\sout</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\xout</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\dashuline</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\dotuline</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\markoverwith"</span> . underline)
    (<span class="org-string">":float wrap"</span> . float-wrap)
    (<span class="org-string">":float sideways"</span> . rotate)
    (<span class="org-string">"^[ \t]*#\\+caption:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\caption"</span> . caption)
    (<span class="org-string">"\\[\\[xkcd:"</span> . (image caption))
    (org-latex-use-microtype . microtype)
    ((<span class="org-keyword">and</span> org-latex-italic-quotes <span class="org-string">"^[ \t]*#\\+begin_quote</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\begin{quote}"</span>) . italic-quotes)
    (org-latex-par-sep . par-sep)
    ((org-latex-embed-tangled-files) . embed-files)
    ((<span class="org-keyword">and</span> org-latex-embed-files <span class="org-string">"^[ \t]*#\\+begin_src</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^[ \t]*#\\+BEGIN_SRC"</span>) . embed-tangled)
    (<span class="org-string">"^[ \t]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">[-+*]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">[0-9]+[.)]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">[A-Za-z]+[.)]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> \\[[ -X]\\]"</span> . checkbox)
    (<span class="org-string">"^[ \t]*#\\+begin_warning</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\begin{warning}"</span> . box-warning)
    (<span class="org-string">"^[ \t]*#\\+begin_info</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\begin{info}"</span>       . box-info)
    (<span class="org-string">"^[ \t]*#\\+begin_success</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\begin{success}"</span> . box-success)
    (<span class="org-string">"^[ \t]*#\\+begin_error</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\\\begin{error}"</span>     . box-error))
  <span class="org-doc">"Org feature tests and associated LaTeX feature flags.</span>

<span class="org-doc">Alist where the car is a test for the presense of the feature,</span>
<span class="org-doc">and the cdr is either a single feature symbol or list of feature symbols.</span>

<span class="org-doc">When a string, it is used as a regex search in the buffer.</span>
<span class="org-doc">The feature is registered as present when there is a match.</span>

<span class="org-doc">The car can also be a</span>
<span class="org-doc">- symbol, the value of which is fetched</span>
<span class="org-doc">- function, which is called with info as an argument</span>
<span class="org-doc">- list, which is `</span><span class="org-doc"><span class="org-constant">eval</span></span><span class="org-doc">'uated</span>

<span class="org-doc">If the symbol, function, or list produces a string: that is used as a regex</span>
<span class="org-doc">search in the buffer. Otherwise any non-nil return value will indicate the</span>
<span class="org-doc">existance of the feature."</span>)
</pre>
</div>
    </details>

<p>
Then we provide a way to generate the preamble that provides those features.
In addition to the features named in <code>org-latex-conditional-features</code> we&rsquo;ll also
create <i>meta-features</i>, which can be required by other features (with <kbd>:requires</kbd>),
or be active by default (<kbd>:eager t</kbd>). For further control I some features may only
be used when certain other features are active (with <kbd>:when</kbd>), and masked by other
features (with <kbd>:prevents</kbd>). I will use the convention of starting meta-features
with <kbd>.</kbd>, and <kbd>:eager</kbd> features with <kbd>!</kbd> to make their nature more readily apparent.
</p>

<p>
Another consideration in LaTeX is load order, which matters in some cases.
Beyond that, it&rsquo;s nice to have some sort of sensible ordering. For this I&rsquo;ll
introduce an <kbd>:order</kbd> keyword. Using this I&rsquo;ll arrange snippets as follows.
</p>

<ul class="org-ul">
<li><kbd>-2</kbd> Embed files setup</li>
<li><kbd>-1</kbd> Extra file embedding</li>
<li><kbd>0</kbd> Typography
<ul class="org-ul">
<li><kbd>0</kbd> Fonts themselves</li>
<li><kbd>0.1</kbd> Typographic tweaks (<kbd>microtype</kbd>)</li>
<li><kbd>0.2</kbd> Maths setup</li>
<li><kbd>0.3</kbd> Maths font</li>
<li><kbd>0.4</kbd> Extra text shaping (<code>\acr</code>)</li>
<li><kbd>0.5-0.9</kbd> Miscellaneous text modifications, trying to put shorter snippets first</li>
</ul></li>
<li><kbd>1</kbd> (<i>default</i>)</li>
<li><kbd>2</kbd> Tables and figures</li>
<li><kbd>3</kbd> Miscellaneous short content</li>
<li><kbd>4</kbd> Fancy boxes</li>
</ul>

<details id='content-feature-preamble,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#content-feature-preamble,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-feature-implementations</span>
  '((image         <span class="org-builtin">:snippet</span> <span class="org-string">"\\usepackage{graphicx}"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">2</span>)
    (svg           <span class="org-builtin">:snippet</span> <span class="org-string">"\\usepackage{svg}"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">2</span>)
    (maths         <span class="org-builtin">:snippet</span> <span class="org-string">"\\usepackage[nofont]{bmc-maths}"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">0.2</span>)
    (table         <span class="org-builtin">:snippet</span> <span class="org-string">"\\usepackage{longtable}\n\\usepackage{booktabs}"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">2</span>)
    (cleveref      <span class="org-builtin">:snippet</span> <span class="org-string">"\\usepackage[capitalize]{cleveref}"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">1</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">after bmc-maths</span>
    (underline     <span class="org-builtin">:snippet</span> <span class="org-string">"\\usepackage[normalem]{ulem}"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">0.5</span>)
    (float-wrap    <span class="org-builtin">:snippet</span> <span class="org-string">"\\usepackage{wrapfig}"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">2</span>)
    (rotate        <span class="org-builtin">:snippet</span> <span class="org-string">"\\usepackage{rotating}"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">2</span>)
    (caption       <span class="org-builtin">:snippet</span> org-latex-caption-preamble <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">2.1</span>)
    (microtype     <span class="org-builtin">:snippet</span> <span class="org-string">"\\usepackage[activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=true,factor=2000]{microtype}\n"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">0.1</span>)
    (embed-files   <span class="org-builtin">:snippet</span> org-latex-embed-files-preamble <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">-2</span>)
    (embed-tangled <span class="org-builtin">:requires</span> embed-files <span class="org-builtin">:snippet</span> (concat (org-latex-embed-tangled-files) <span class="org-string">"\n"</span>) <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">-1</span>)
    (acronym       <span class="org-builtin">:snippet</span> <span class="org-string">"\\newcommand{\\acr}[1]{\\protect\\textls*[110]{\\scshape #1}}\n\\newcommand{\\acrs}{\\protect\\scalebox{.91}[.84]{\\hspace{0.15ex}s}}"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">0.4</span>)
    (italic-quotes <span class="org-builtin">:snippet</span> <span class="org-string">"\\renewcommand{\\quote}{\\list{}{\\rightmargin\\leftmargin}\\item\\relax\\em}\n"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">0.5</span>)
    (par-sep       <span class="org-builtin">:snippet</span> <span class="org-string">"\\setlength{\\parskip}{\\baselineskip}\n\\setlength{\\parindent}{0pt}\n"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">0.5</span>)
    (.pifont       <span class="org-builtin">:snippet</span> <span class="org-string">"\\usepackage{pifont}"</span>)
    (checkbox      <span class="org-builtin">:requires</span> .pifont <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">3</span>
                   <span class="org-builtin">:snippet</span> (concat (<span class="org-keyword">unless</span> (memq 'maths features)
                                      <span class="org-string">"\\usepackage{amssymb} % provides \\square"</span>)
                                    org-latex-checkbox-preamble))
    (.fancy-box    <span class="org-builtin">:requires</span> .pifont    <span class="org-builtin">:snippet</span> org-latex-box-preamble <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">3.9</span>)
    (box-warning   <span class="org-builtin">:requires</span> .fancy-box <span class="org-builtin">:snippet</span> <span class="org-string">"\\defsimplebox{warning}{e66100}{\\ding{68}}{Warning}"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">4</span>)
    (box-info      <span class="org-builtin">:requires</span> .fancy-box <span class="org-builtin">:snippet</span> <span class="org-string">"\\defsimplebox{info}{3584e4}{\\ding{68}}{Information}"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">4</span>)
    (box-success   <span class="org-builtin">:requires</span> .fancy-box <span class="org-builtin">:snippet</span> <span class="org-string">"\\defsimplebox{success}{26a269}{\\ding{68}}{\\vspace{-\\baselineskip}}"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">4</span>)
    (box-error     <span class="org-builtin">:requires</span> .fancy-box <span class="org-builtin">:snippet</span> <span class="org-string">"\\defsimplebox{error}{c01c28}{\\ding{68}}{Important}"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">4</span>))
  <span class="org-doc">"LaTeX features and details required to implement them.</span>

<span class="org-doc">List where the car is the feature symbol, and the rest forms a plist with the</span>
<span class="org-doc">following keys:</span>
<span class="org-doc">- :snippet, which may be either</span>
<span class="org-doc">  - a string which should be included in the preamble</span>
<span class="org-doc">  - a symbol, the value of which is included in the preamble</span>
<span class="org-doc">  - a function, which is evaluated with the list of feature flags as its</span>
<span class="org-doc">    single argument. The result of which is included in the preamble</span>
<span class="org-doc">  - a list, which is passed to `</span><span class="org-doc"><span class="org-constant">eval</span></span><span class="org-doc">', with a list of feature flags available</span>
<span class="org-doc">    as \"features\"</span>

<span class="org-doc">- :requires, a feature or list of features that must be available</span>
<span class="org-doc">- :when, a feature or list of features that when all available should cause this</span>
<span class="org-doc">    to be automatically enabled.</span>
<span class="org-doc">- :prevents, a feature or list of features that should be masked</span>
<span class="org-doc">- :order, for when ordering is important. Lower values appear first.</span>
<span class="org-doc">    The default is 0.</span>

<span class="org-doc">Features that start with ! will be eagerly loaded, i.e. without being detected."</span>)
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-feature-determination" class="outline-6">
<h6 id="feature-determination"><span class="section-number-6">6.3.6.4.4</span> Feature determination<a aria-hidden="true" href="#feature-determination">#</a> </h6>
<div class="outline-text-6" id="text-6-3-6-4-4">
<p>
Now that we have <code>org-latex-conditional-features</code> defined, we need to use it to
extract a list of features found in an Org buffer.
</p>

<details id='feature-determination,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#feature-determination,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-detect-features</span> (<span class="org-type">&amp;optional</span> buffer info)
  <span class="org-doc">"List features from `</span><span class="org-doc"><span class="org-constant">org-latex-conditional-features</span></span><span class="org-doc">' detected in BUFFER."</span>
  (<span class="org-keyword">let</span> ((case-fold-search nil))
    (<span class="org-keyword">with-current-buffer</span> (<span class="org-keyword">or</span> buffer (current-buffer))
      (delete-dups
       (mapcan (<span class="org-keyword">lambda</span> (construct-feature)
                 (<span class="org-keyword">when</span> (<span class="org-keyword">let</span> ((out (<span class="org-keyword">pcase</span> (car construct-feature)
                                    ((pred stringp) (car construct-feature))
                                    ((pred functionp) (funcall (car construct-feature) info))
                                    ((pred listp) (eval (car construct-feature)))
                                    ((pred symbolp) (symbol-value (car construct-feature)))
                                    (_ (<span class="org-warning">user-error</span> <span class="org-string">"org-latex-conditional-features key %s unable to be used"</span> (car construct-feature))))))
                         (<span class="org-keyword">if</span> (stringp out)
                             (<span class="org-keyword">save-excursion</span>
                               (goto-char (point-min))
                               (re-search-forward out nil t))
                           out))
                   (<span class="org-keyword">if</span> (listp (cdr construct-feature)) (cdr construct-feature) (list (cdr construct-feature)))))
               org-latex-conditional-features)))))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-preamble-generation" class="outline-6">
<h6 id="preamble-generation"><span class="section-number-6">6.3.6.4.5</span> Preamble generation<a aria-hidden="true" href="#preamble-generation">#</a> </h6>
<div class="outline-text-6" id="text-6-3-6-4-5">
<p>
Once a list of required features has been determined, we want to use
<code>org-latex-feature-implementations</code> to generate the LaTeX which should be inserted
into the preamble to provide those features.
</p>

<p>
First we want to process our fancy keywords in <code>org-latex-feature-implementations</code>
to produce an <i>expanded</i> list of features. We&rsquo;ll do that by performing the
following steps.
</p>
<ul class="org-ul">
<li>The dependencies for each listed feature are added to feature list
(<code class="src src-elisp"><span class="org-builtin">:requires</span></code>).</li>
<li>The <code class="src src-elisp"><span class="org-builtin">:when</span></code> conditions of each feature, and available features with
<code class="src src-elisp"><span class="org-builtin">:eager</span> t</code>, are evaluated, and added/removed accordingly</li>
<li>Any features present in a <code class="src src-elisp"><span class="org-builtin">:prevents</span></code> value are removed</li>
<li>The feature list is scrubbed of duplicates</li>
<li>The feature list is sorted by <code class="src src-elisp"><span class="org-builtin">:order</span></code> (ascending)</li>
</ul>

<details id='preamble-generation,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#preamble-generation,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-expand-features</span> (features)
  <span class="org-doc">"For each feature in FEATURES process :requires, :when, and :prevents keywords and sort according to :order."</span>
  (<span class="org-keyword">dolist</span> (feature features)
    (<span class="org-keyword">unless</span> (assoc feature org-latex-feature-implementations)
      (<span class="org-warning">error</span> <span class="org-string">"Feature %s not provided in org-latex-feature-implementations"</span> feature)))
  (<span class="org-keyword">setq</span> current features)
  (<span class="org-keyword">while</span> current
    (<span class="org-keyword">when-let</span> ((requirements (plist-get (cdr (assq (car current) org-latex-feature-implementations)) <span class="org-builtin">:requires</span>)))
      (setcdr current (<span class="org-keyword">if</span> (listp requirements)
                          (append requirements (cdr current))
                        (cons requirements (cdr current)))))
    (<span class="org-keyword">setq</span> current (cdr current)))
  (<span class="org-keyword">dolist</span> (potential-feature
           (append features (delq nil (mapcar (<span class="org-keyword">lambda</span> (feat)
                                                (<span class="org-keyword">when</span> (plist-get (cdr feat) <span class="org-builtin">:eager</span>)
                                                  (car feat)))
                                              org-latex-feature-implementations))))
    (<span class="org-keyword">when-let</span> ((prerequisites (plist-get (cdr (assoc potential-feature org-latex-feature-implementations)) <span class="org-builtin">:when</span>)))
      (<span class="org-keyword">setf</span> features (<span class="org-keyword">if</span> (<span class="org-keyword">if</span> (listp prerequisites)
                             (cl-every (<span class="org-keyword">lambda</span> (preq) (memq preq features)) prerequisites)
                           (memq prerequisites features))
                         (append (list potential-feature) features)
                       (delq potential-feature features)))))
  (<span class="org-keyword">dolist</span> (feature features)
    (<span class="org-keyword">when-let</span> ((prevents (plist-get (cdr (assoc feature org-latex-feature-implementations)) <span class="org-builtin">:prevents</span>)))
      (<span class="org-keyword">setf</span> features (cl-set-difference features (<span class="org-keyword">if</span> (listp prevents) prevents (list prevents))))))
  (sort (delete-dups features)
        (<span class="org-keyword">lambda</span> (feat1 feat2)
          (<span class="org-keyword">if</span> (&lt; (<span class="org-keyword">or</span> (plist-get (cdr (assoc feat1 org-latex-feature-implementations)) <span class="org-builtin">:order</span>) <span class="org-highlight-numbers-number">1</span>)
                 (<span class="org-keyword">or</span> (plist-get (cdr (assoc feat2 org-latex-feature-implementations)) <span class="org-builtin">:order</span>) <span class="org-highlight-numbers-number">1</span>))
              t nil))))
</pre>
</div>
    </details>

<p>
Now that we have a nice list of the final features to use, we can just pull out
their snippets and join the result together.
</p>

<details id='preamble-generation,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#preamble-generation,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-generate-features-preamble</span> (features)
  <span class="org-doc">"Generate the LaTeX preamble content required to provide FEATURES.</span>
<span class="org-doc">This is done according to `</span><span class="org-doc"><span class="org-constant">org-latex-feature-implementations</span></span><span class="org-doc">'"</span>
  (<span class="org-keyword">let</span> ((expanded-features (org-latex-expand-features features)))
    (concat
     (format <span class="org-string">"\n%% features: %s\n"</span> expanded-features)
     (mapconcat (<span class="org-keyword">lambda</span> (feature)
                  (<span class="org-keyword">when-let</span> ((snippet (plist-get (cdr (assoc feature org-latex-feature-implementations)) <span class="org-builtin">:snippet</span>)))
                    (concat
                     (<span class="org-keyword">pcase</span> snippet
                       ((pred stringp) snippet)
                       ((pred functionp) (funcall snippet features))
                       ((pred listp) (eval `(<span class="org-keyword">let</span> ((features ',features)) (,@snippet))))
                       ((pred symbolp) (symbol-value snippet))
                       (_ (<span class="org-warning">user-error</span> <span class="org-string">"org-latex-feature-implementations :snippet value %s unable to be used"</span> snippet)))
                     <span class="org-string">"\n"</span>)))
                expanded-features
                <span class="org-string">""</span>)
     <span class="org-string">"% end features\n"</span>)))
</pre>
</div>
    </details>

<p>
Then Org needs to be advised to actually use this generated preamble content.
</p>

<details id='preamble-generation,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#preamble-generation,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">info--tmp</span> nil)

(<span class="org-keyword">defadvice!</span> org-latex-save-info (info <span class="org-type">&amp;optional</span> t_ s_)
  <span class="org-builtin">:before</span> #'org-latex-make-preamble
  (<span class="org-keyword">setq</span> info--tmp info))

(<span class="org-keyword">defadvice!</span> org-splice-latex-header-and-generated-preamble-a (orig-fn tpl def-pkg pkg snippets-p <span class="org-type">&amp;optional</span> extra)
  <span class="org-doc">"Dynamically insert preamble content based on `</span><span class="org-doc"><span class="org-constant">org-latex-conditional-preambles</span></span><span class="org-doc">'."</span>
  <span class="org-builtin">:around</span> #'org-splice-latex-header
  (<span class="org-keyword">let</span> ((header (funcall orig-fn tpl def-pkg pkg snippets-p extra)))
    (<span class="org-keyword">if</span> snippets-p header
      (concat header
              (org-latex-generate-features-preamble (org-latex-detect-features nil info--tmp))
              <span class="org-string">"\n"</span>))))
</pre>
</div>
    </details>

<p>
My use of <code>info--tmp</code> is somewhat hacky. When I try to upstream this, this should
become much cleaner as I can pass info through by directly modifying
<code>org-latex-make-preamble</code>.
</p>
</div>
</div>

<div id="outline-container-reduce-default-packages" class="outline-6">
<h6 id="reduce-default-packages"><span class="section-number-6">6.3.6.4.6</span> Reduce default packages<a aria-hidden="true" href="#reduce-default-packages">#</a> </h6>
<div class="outline-text-6" id="text-6-3-6-4-6">
<p>
Thanks to our additions, we can remove a few packages from
<code>org-latex-default-packages-alist</code>.
</p>

<p>
There are also some obsolete entries in the default value, specifically
</p>
<ul class="org-ul">
<li><kbd>grffile</kbd>&rsquo;s capabilities are built into the current version of <kbd>graphicx</kbd></li>
<li><kbd>textcomp</kbd>&rsquo;s functionality has been included in LaTeX&rsquo;s core for a while now</li>
</ul>

<details id='reduce-default-packages,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#reduce-default-packages,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-latex-default-packages-alist
      '((<span class="org-string">"AUTO"</span> <span class="org-string">"inputenc"</span> t (<span class="org-string">"pdflatex"</span>))
        (<span class="org-string">"T1"</span> <span class="org-string">"fontenc"</span> t (<span class="org-string">"pdflatex"</span>))
        (<span class="org-string">""</span> <span class="org-string">"xcolor"</span> nil) <span class="org-comment-delimiter">; </span><span class="org-comment">Generally useful</span>
        (<span class="org-string">""</span> <span class="org-string">"hyperref"</span> nil)))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-font-collections" class="outline-5">
<h5 id="font-collections"><span class="section-number-5">6.3.6.5</span> Font collections<a aria-hidden="true" href="#font-collections">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-5">
<p>
Using the lovely conditional preamble, I&rsquo;ll define a number of font collections
that can be used for LaTeX exports. Who knows, maybe I&rsquo;ll use it with other
export formats too at some point.
</p>

<p>
To start with I&rsquo;ll create a default state variable and register <kbd>fontset</kbd> as part
of <kbd>#+options</kbd>.
</p>

<details id='font-collections,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-collections,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-default-fontset</span> 'alegreya
  <span class="org-doc">"Fontset from `</span><span class="org-doc"><span class="org-constant">org-latex-fontsets</span></span><span class="org-doc">' to use by default.</span>
<span class="org-doc">As cm (computer modern) is TeX's default, that causes nothing</span>
<span class="org-doc">to be added to the document.</span>

<span class="org-doc">If \"nil\" no custom fonts will ever be used."</span>)

(eval '(cl-pushnew '(<span class="org-builtin">:latex-font-set</span> nil <span class="org-string">"fontset"</span> org-latex-default-fontset)
                   (org-export-backend-options (org-export-get-backend 'latex))))
</pre>
</div>
    </details>

<p>
Then a function is needed to generate a LaTeX snippet which applies the fontset. It
would be nice if this could be done for individual styles and use different
styles as the main document font. If the individual typefaces for a fontset are
defined individually as
<code class="src src-elisp"><span class="org-builtin">:serif</span></code>, <code class="src src-elisp"><span class="org-builtin">:sans</span></code>, <code class="src src-elisp"><span class="org-builtin">:mono</span></code>, and <code class="src src-elisp"><span class="org-builtin">:maths</span></code>.
I can use those to generate LaTeX for subsets of the full fontset. Then, if I
don&rsquo;t let any fontset names have <kbd>-</kbd> in them, I can use <kbd>-sans</kbd> and <kbd>-mono</kbd> as
suffixes that specify the document font to use.
</p>

<details id='font-collections,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-collections,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-fontset-entry</span> ()
  <span class="org-doc">"Get the fontset spec of the current file.</span>
<span class="org-doc">Has format \"name\" or \"name-style\" where 'name' is one of</span>
<span class="org-doc">the cars in `</span><span class="org-doc"><span class="org-constant">org-latex-fontsets</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">let</span> ((fontset-spec
         (symbol-name
          (<span class="org-keyword">or</span> (car (delq nil
                         (mapcar
                          (<span class="org-keyword">lambda</span> (opt-line)
                            (plist-get (org-export--parse-option-keyword opt-line 'latex)
                                       <span class="org-builtin">:latex-font-set</span>))
                          (cdar (org-collect-keywords '(<span class="org-string">"OPTIONS"</span>))))))
              org-latex-default-fontset))))
    (cons (intern (car (split-string fontset-spec <span class="org-string">"-"</span>)))
          (<span class="org-keyword">when</span> (cadr (split-string fontset-spec <span class="org-string">"-"</span>))
            (intern (concat <span class="org-string">":"</span> (cadr (split-string fontset-spec <span class="org-string">"-"</span>))))))))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-fontset</span> (<span class="org-type">&amp;rest</span> desired-styles)
  <span class="org-doc">"Generate a LaTeX preamble snippet which applies the current fontset for DESIRED-STYLES."</span>
  (<span class="org-keyword">let*</span> ((fontset-spec (org-latex-fontset-entry))
         (fontset (alist-get (car fontset-spec) org-latex-fontsets)))
    (<span class="org-keyword">if</span> fontset
        (concat
         (mapconcat
          (<span class="org-keyword">lambda</span> (style)
            (<span class="org-keyword">when</span> (plist-get fontset style)
              (concat (plist-get fontset style) <span class="org-string">"\n"</span>)))
          desired-styles
          <span class="org-string">""</span>)
         (<span class="org-keyword">when</span> (memq (cdr fontset-spec) desired-styles)
           (<span class="org-keyword">pcase</span> (cdr fontset-spec)
             (<span class="org-builtin">:serif</span> <span class="org-string">"\\renewcommand{\\familydefault}{\\rmdefault}\n"</span>)
             (<span class="org-builtin">:sans</span> <span class="org-string">"\\renewcommand{\\familydefault}{\\sfdefault}\n"</span>)
             (<span class="org-builtin">:mono</span> <span class="org-string">"\\renewcommand{\\familydefault}{\\ttdefault}\n"</span>))))
      (<span class="org-warning">error</span> <span class="org-string">"Font-set %s is not provided in org-latex-fontsets"</span> (car fontset-spec)))))
</pre>
</div>
    </details>

<p>
Now that all the functionality has been implemented, we should hook it into our
preamble generation.
</p>

<details id='font-collections,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-collections,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'org-latex-conditional-features '(org-latex-default-fontset . custom-font) t)
(add-to-list 'org-latex-feature-implementations '(custom-font <span class="org-builtin">:snippet</span> (org-latex-fontset <span class="org-builtin">:serif</span> <span class="org-builtin">:sans</span> <span class="org-builtin">:mono</span>) <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">0</span>) t)
(add-to-list 'org-latex-feature-implementations '(.custom-maths-font <span class="org-builtin">:eager</span> t <span class="org-builtin">:when</span> (custom-font maths) <span class="org-builtin">:snippet</span> (org-latex-fontset <span class="org-builtin">:maths</span>) <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">0.3</span>) t)
</pre>
</div>
    </details>

<p>
Finally, we just need to add some fonts.
</p>

<details id='font-collections,code--4' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-collections,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-fontsets</span>
  '((cm nil) <span class="org-comment-delimiter">; </span><span class="org-comment">computer modern</span>
    (## nil) <span class="org-comment-delimiter">; </span><span class="org-comment">no font set</span>
    (alegreya
     <span class="org-builtin">:serif</span> <span class="org-string">"\\usepackage[osf]{Alegreya}"</span>
     <span class="org-builtin">:sans</span> <span class="org-string">"\\usepackage{AlegreyaSans}"</span>
     <span class="org-builtin">:mono</span> <span class="org-string">"\\usepackage[scale=0.88]{sourcecodepro}"</span>
     <span class="org-builtin">:maths</span> <span class="org-string">"\\usepackage[varbb]{newpxmath}"</span>)
    (biolinum
     <span class="org-builtin">:serif</span> <span class="org-string">"\\usepackage[osf]{libertineRoman}"</span>
     <span class="org-builtin">:sans</span> <span class="org-string">"\\usepackage[sfdefault,osf]{biolinum}"</span>
     <span class="org-builtin">:mono</span> <span class="org-string">"\\usepackage[scale=0.88]{sourcecodepro}"</span>
     <span class="org-builtin">:maths</span> <span class="org-string">"\\usepackage[libertine,varvw]{newtxmath}"</span>)
    (fira
     <span class="org-builtin">:sans</span> <span class="org-string">"\\usepackage[sfdefault,scale=0.85]{FiraSans}"</span>
     <span class="org-builtin">:mono</span> <span class="org-string">"\\usepackage[scale=0.80]{FiraMono}"</span>
     <span class="org-builtin">:maths</span> <span class="org-string">"\\usepackage{newtxsf} % change to firamath in future?"</span>)
    (kp
     <span class="org-builtin">:serif</span> <span class="org-string">"\\usepackage{kpfonts}"</span>)
    (newpx
     <span class="org-builtin">:serif</span> <span class="org-string">"\\usepackage{newpxtext}"</span>
     <span class="org-builtin">:sans</span> <span class="org-string">"\\usepackage{gillius}"</span>
     <span class="org-builtin">:mono</span> <span class="org-string">"\\usepackage[scale=0.9]{sourcecodepro}"</span>
     <span class="org-builtin">:maths</span> <span class="org-string">"\\usepackage[varbb]{newpxmath}"</span>)
    (noto
     <span class="org-builtin">:serif</span> <span class="org-string">"\\usepackage[osf]{noto-serif}"</span>
     <span class="org-builtin">:sans</span> <span class="org-string">"\\usepackage[osf]{noto-sans}"</span>
     <span class="org-builtin">:mono</span> <span class="org-string">"\\usepackage[scale=0.96]{noto-mono}"</span>
     <span class="org-builtin">:maths</span> <span class="org-string">"\\usepackage{notomath}"</span>)
    (plex
     <span class="org-builtin">:serif</span> <span class="org-string">"\\usepackage{plex-serif}"</span>
     <span class="org-builtin">:sans</span> <span class="org-string">"\\usepackage{plex-sans}"</span>
     <span class="org-builtin">:mono</span> <span class="org-string">"\\usepackage[scale=0.95]{plex-mono}"</span>
     <span class="org-builtin">:maths</span> <span class="org-string">"\\usepackage{newtxmath}"</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">may be plex-based in future</span>
    (source
     <span class="org-builtin">:serif</span> <span class="org-string">"\\usepackage[osf]{sourceserifpro}"</span>
     <span class="org-builtin">:sans</span> <span class="org-string">"\\usepackage[osf]{sourcesanspro}"</span>
     <span class="org-builtin">:mono</span> <span class="org-string">"\\usepackage[scale=0.95]{sourcecodepro}"</span>
     <span class="org-builtin">:maths</span> <span class="org-string">"\\usepackage{newtxmath}"</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">may be sourceserifpro-based in future</span>
    (times
     <span class="org-builtin">:serif</span> <span class="org-string">"\\usepackage{newtxtext}"</span>
     <span class="org-builtin">:maths</span> <span class="org-string">"\\usepackage{newtxmath}"</span>))
  <span class="org-doc">"Alist of fontset specifications.</span>
<span class="org-doc">Each car is the name of the fontset (which cannot include \"-\").</span>

<span class="org-doc">Each cdr is a plist with (optional) keys :serif, :sans, :mono, and :maths.</span>
<span class="org-doc">A key's value is a LaTeX snippet which loads such a font."</span>)
</pre>
</div>
    </details>

<p>
When we&rsquo;re using Alegreya we can apply a lovely little tweak to <kbd>tabular</kbd> which
(locally) changes the figures used to lining fixed-width.
</p>

<details id='font-collections,code--5' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-collections,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'org-latex-conditional-features '((string= (car (org-latex-fontset-entry)) <span class="org-string">"alegreya"</span>) . alegreya-typeface))
(add-to-list 'org-latex-feature-implementations '(alegreya-typeface) t)
(add-to-list 'org-latex-feature-implementations'(.alegreya-tabular-figures <span class="org-builtin">:eager</span> t <span class="org-builtin">:when</span> (alegreya-typeface table) <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">0.5</span> <span class="org-builtin">:snippet</span> <span class="org-string">"</span>
<span class="org-string">\\makeatletter</span>
<span class="org-string">% tabular lining figures in tables</span>
<span class="org-string">\\renewcommand{\\tabular}{\\AlegreyaTLF\\let\\@halignto\\@empty\\@tabular}</span>
<span class="org-string">\\makeatother\n"</span>) t)
</pre>
</div>
    </details>

<p>
Due to the Alegreya&rsquo;s metrics, the <kbd>\LaTeX</kbd> symbol doesn&rsquo;t quite look right. We
can correct for this by redefining it with subtlety shifted kerning.
</p>

<details id='font-collections,code--6' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-collections,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'org-latex-conditional-features '(<span class="org-string">"LaTeX"</span> . latex-symbol))
(add-to-list 'org-latex-feature-implementations '(latex-symbol <span class="org-builtin">:when</span> alegreya-typeface <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">0.5</span> <span class="org-builtin">:snippet</span> <span class="org-string">"</span>
<span class="org-string">\\makeatletter</span>
<span class="org-string">% Kerning around the A needs adjusting</span>
<span class="org-string">\\DeclareRobustCommand{\\LaTeX}{L\\kern-.24em%</span>
<span class="org-string">        {\\sbox\\z@ T%</span>
<span class="org-string">         \\vbox to\\ht\\z@{\\hbox{\\check@mathfonts</span>
<span class="org-string">                              \\fontsize\\sf@size\\z@</span>
<span class="org-string">                              \\math@fontsfalse\\selectfont</span>
<span class="org-string">                              A}%</span>
<span class="org-string">                        \\vss}%</span>
<span class="org-string">        }%</span>
<span class="org-string">        \\kern-.10em%</span>
<span class="org-string">        \\TeX}</span>
<span class="org-string">\\makeatother\n"</span>) t)
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-cover-page" class="outline-5">
<h5 id="cover-page"><span class="section-number-5">6.3.6.6</span> Cover page<a aria-hidden="true" href="#cover-page">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-6">
<p>
To make a nice cover page, a simple method that comes to mind is just redefining
<kbd>\maketitle</kbd>. To get precise control over the positioning we&rsquo;ll use the <kbd>tikz</kbd>
package, and then add in the Tikz libraries <kbd>calc</kbd> and <kbd>shapes.geometric</kbd> to make
some nice decorations for the background.
</p>

<p>
I&rsquo;ll start off by setting up the required additions to the preamble.
This will accomplish the following:
</p>
<ul class="org-ul">
<li>Load the required packages</li>
<li>Redefine <kbd>\maketitle</kbd></li>
<li>Draw an Org icon with Tikz to use in the cover page (it&rsquo;s a little easter egg)</li>
<li>Start a new page after the table of contents by redefining <kbd>\tableofcontents</kbd></li>
</ul>

<details id='latex-cover-page' class='code' open><summary class='named'><span class="name">latex-cover-page</span><span class="lang">LaTeX</span></summary>
    <div class='gutter'>
    <a href='#latex-cover-page'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-LaTeX"><span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>{<span class="org-function-name">tikz</span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">usetikzlibrary</span>{shapes.geometric}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">usetikzlibrary</span>{calc}

<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">newsavebox</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">orgicon</span>
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">begin</span></span>{<span class="org-function-name">lrbox</span>}{<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">orgicon</span>}
  <span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">begin</span></span>{<span class="org-function-name">tikzpicture</span>}[y=0.80pt, x=0.80pt, inner sep=0pt, outer sep=0pt]
    <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">path</span>[fill=black!6] (16.15,24.00) .. controls (15.58,24.00) and (13.99,20.69) .. (12.77,18.06)arc(215.55:180.20:2.19) .. controls (12.33,19.91) and (11.27,19.09) .. (11.43,18.05) .. controls (11.36,18.09) and (10.17,17.83) .. (10.17,17.82) .. controls (9.94,18.75) and (9.37,19.44) .. (9.02,18.39) .. controls (8.32,16.72) and (8.14,15.40) .. (9.13,13.80) .. controls (8.22,9.74) and (2.18,7.75) .. (2.81,4.47) .. controls (2.99,4.47) and (4.45,0.99) .. (9.15,2.41) .. controls (14.71,3.99) and (17.77,0.30) .. (18.13,0.04) .. controls (18.65,-0.49) and (16.78,4.61) .. (12.83,6.90) .. controls (10.49,8.18) and (11.96,10.38) .. (12.12,11.15) .. controls (12.12,11.15) and (14.00,9.84) .. (15.36,11.85) .. controls (16.58,11.53) and (17.40,12.07) .. (18.46,11.69) .. controls (19.10,11.41) and (21.79,11.58) .. (20.79,13.08) .. controls (20.79,13.08) and (21.71,13.90) .. (21.80,13.99) .. controls (21.97,14.75) and (21.59,14.91) .. (21.47,15.12) .. controls (21.44,15.60) and (21.04,15.79) .. (20.55,15.44) .. controls (19.45,15.64) and (18.36,15.55) .. (17.83,15.59) .. controls (16.65,15.76) and (15.67,16.38) .. (15.67,16.38) .. controls (15.40,17.19) and (14.82,17.01) .. (14.09,17.32) .. controls (14.70,18.69) and (14.76,19.32) .. (15.50,21.32) .. controls (15.76,22.37) and (16.54,24.00) .. (16.15,24.00) -- cycle(7.83,16.74) .. controls (6.83,15.71) and (5.72,15.70) .. (4.05,15.42) .. controls (2.75,15.19) and (0.39,12.97) .. (0.02,10.68) .. controls (-0.02,10.07) and (-0.06,8.50) .. (0.45,7.18) .. controls (0.94,6.05) and (1.27,5.45) .. (2.29,4.85) .. controls (1.41,8.02) and (7.59,10.18) .. (8.55,13.80) -- (8.55,13.80) .. controls (7.73,15.00) and (7.80,15.64) .. (7.83,16.74) -- cycle;
  <span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">end</span></span>{<span class="org-function-name">tikzpicture</span>}
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">end</span></span>{<span class="org-function-name">lrbox</span>}

<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">makeatletter</span>
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">g@addto@macro</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">tableofcontents</span>{<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">clearpage</span>}
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-keyword"><span class="org-keyword">renewcommand</span></span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword">maketitle</span>{
  <span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">thispagestyle</span></span>{<span class="org-function-name">empty</span>}
  <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">hyphenpenalty</span>=10000 <span class="org-comment">% hyphens look bad in titles</span>
  <span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">renewcommand</span></span>{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">baselinestretch</span></span>}{<span class="org-function-name">1.1</span>}
  <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">let</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">oldtoday</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">today</span>
  <span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">renewcommand</span></span>{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">today</span></span>}{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-type"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-type"><span class="org-function-name"><span class="org-keyword">LARGE</span></span></span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">number</span></span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">year</span></span><span class="org-function-name"><span class="org-font-latex-warning">\\\\\</span></span><span class="org-type"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-type"><span class="org-function-name"><span class="org-keyword">large</span></span></span><span class="org-function-name"><span class="org-comment">%</span></span>
<span class="org-function-name">    </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">ifcase</span></span><span class="org-function-name"> </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">month</span></span><span class="org-function-name"> </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">or</span></span><span class="org-function-name"> Jan</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">or</span></span><span class="org-function-name"> Feb</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">or</span></span><span class="org-function-name"> Mar</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">or</span></span><span class="org-function-name"> Apr</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">or</span></span><span class="org-function-name"> May </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">or</span></span><span class="org-function-name"> Jun</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">or</span></span><span class="org-function-name"> Jul</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">or</span></span><span class="org-function-name"> Aug</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">or</span></span><span class="org-function-name"> Sep</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">or</span></span><span class="org-function-name"> Oct</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">or</span></span><span class="org-function-name"> Nov</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">or</span></span><span class="org-function-name"> Dec</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">fi</span></span>
<span class="org-function-name">    ~</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">number</span></span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">day</span></span>}
  <span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">begin</span></span>{<span class="org-function-name">tikzpicture</span>}[remember picture,overlay]
    <span class="org-comment-delimiter">%% </span><span class="org-comment">Background Polygons %%</span>
    <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">foreach</span> <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">i</span> in {2.5,...,22} <span class="org-comment">% bottom left</span>
    {<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">node</span>[rounded corners,black!3.5,draw,regular polygon,regular polygon sides=6, minimum size=<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">i</span> cm,ultra thick] at (<span class="org-font-latex-math">$(current page.west)+(2.5,-4.2)$</span>) {} ;}
    <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">foreach</span> <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">i</span> in {0.5,...,22} <span class="org-comment">% top left</span>
    {<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">node</span>[rounded corners,black!5,draw,regular polygon,regular polygon sides=6, minimum size=<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">i</span> cm,ultra thick] at (<span class="org-font-latex-math">$(current page.north west)+(2.5,2)$</span>) {} ;}
    <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">node</span>[rounded corners,fill=black!4,regular polygon,regular polygon sides=6, minimum size=5.5 cm,ultra thick] at (<span class="org-font-latex-math">$(current page.north west)+(2.5,2)$</span>) {};
    <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">foreach</span> <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">i</span> in {0.5,...,24} <span class="org-comment">% top right</span>
    {<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">node</span>[rounded corners,black!2,draw,regular polygon,regular polygon sides=6, minimum size=<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">i</span> cm,ultra thick] at (<span class="org-font-latex-math">$(current page.north east)+(0,-8.5)$</span>) {} ;}
    <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">node</span>[fill=black!3,rounded corners,regular polygon,regular polygon sides=6, minimum size=2.5 cm,ultra thick] at (<span class="org-font-latex-math">$(current page.north east)+(0,-8.5)$</span>) {};
    <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">foreach</span> <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">i</span> in {21,...,3} <span class="org-comment">% bottom right</span>
    {<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">node</span>[black!3,rounded corners,draw,regular polygon,regular polygon sides=6, minimum size=<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">i</span> cm,ultra thick] at (<span class="org-font-latex-math">$(current page.south east)+(-1.5,0.75)$</span>) {} ;}
    <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">node</span>[fill=black!3,rounded corners,regular polygon,regular polygon sides=6, minimum size=2 cm,ultra thick] at (<span class="org-font-latex-math">$(current page.south east)+(-1.5,0.75)$</span>) {};
    <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">node</span>[align=center, scale=1.4] at (<span class="org-font-latex-math">$(current page.south east)+(-1.5,0.75)$</span>) {<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">usebox</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">orgicon</span>};
    <span class="org-comment-delimiter">%% </span><span class="org-comment">Text %%</span>
    <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">node</span>[left, align=right, black, text width=0.8<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">paperwidth</span>, minimum height=3cm, rounded corners,font=<span class="org-font-latex-warning">\</span><span class="org-type"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-type"><span class="org-keyword">Huge</span></span><span class="org-font-latex-warning">\</span><span class="org-font-latex-bold"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-font-latex-bold"><span class="org-keyword">bfseries</span></span>] at (<span class="org-font-latex-math">$(current page.north east)+(-2,-8.5)$</span>)
    {<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">@title</span>};
    <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">node</span>[left, align=right, black, text width=0.8<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">paperwidth</span>, minimum height=2cm, rounded corners, font=<span class="org-font-latex-warning">\</span><span class="org-type"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-type"><span class="org-keyword">Large</span></span>] at (<span class="org-font-latex-math">$(current page.north east)+(-2,-11.8)$</span>)
    {<span class="org-font-latex-warning">\</span><span class="org-font-latex-bold"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-font-latex-bold"><span class="org-keyword">scshape</span></span> <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">@author</span>};
    <span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">renewcommand</span></span>{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">baselinestretch</span></span>}{<span class="org-function-name">0.75</span>}
    <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">node</span>[align=center,rounded corners,fill=black!3,text=black,regular polygon,regular polygon sides=6, minimum size=2.5 cm,inner sep=0, font=<span class="org-font-latex-warning">\</span><span class="org-type"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-type"><span class="org-keyword">Large</span></span><span class="org-font-latex-warning">\</span><span class="org-font-latex-bold"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-font-latex-bold"><span class="org-keyword">bfseries</span></span> ] at (<span class="org-font-latex-math">$(current page.west)+(2.5,-4.2)$</span>)
    {<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">@date</span>};
  <span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">end</span></span>{<span class="org-function-name">tikzpicture</span>}
  <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">let</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">today</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">oldtoday</span>
  <span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">clearpage</span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">makeatother</span>
</pre>
</div>
    </details>

<p>
Now we&rsquo;ve got a nice cover page to work with, we just need to use it every now
and then. Adding this to <kbd>#+options</kbd> feels most appropriate.
Let&rsquo;s have the <kbd>coverpage</kbd> option accept <kbd>auto</kbd> as a value and then decide whether
or not a cover page should be used based on the word count &#x2014; I&rsquo;ll have this be
the global default. Then we just want to insert a LaTeX snippet tweak the
subtitle format to use the cover page.
</p>

<details id='cover-page,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#cover-page,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-cover-page</span> 'auto
  <span class="org-doc">"When t, use a cover page by default.</span>
<span class="org-doc">When auto, use a cover page when the document's wordcount exceeds</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">org-latex-cover-page-wordcount-threshold</span></span><span class="org-doc">'.</span>

<span class="org-doc">Set with #+option: coverpage:{yes,auto,no} in org buffers."</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-cover-page-wordcount-threshold</span> <span class="org-highlight-numbers-number">5000</span>
  <span class="org-doc">"Document word count at which a cover page will be used automatically.</span>
<span class="org-doc">This condition is applied when cover page option is set to auto."</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-subtitle-coverpage-format</span> <span class="org-string">"\\\\\\bigskip\n\\LARGE\\mdseries\\itshape\\color{black!80} %s\\par"</span>
  <span class="org-doc">"Variant of `</span><span class="org-doc"><span class="org-constant">org-latex-subtitle-format</span></span><span class="org-doc">' to use with the cover page."</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-cover-page-maketitle</span> <span class="org-string">"</span>
<span class="org-string">&lt;&lt;latex-cover-page&gt;&gt;</span>
<span class="org-string">"</span>
  <span class="org-doc">"LaTeX snippet for the preamble that sets \\maketitle to produce a cover page."</span>)

(eval '(cl-pushnew '(<span class="org-builtin">:latex-cover-page</span> nil <span class="org-string">"coverpage"</span> org-latex-cover-page)
                   (org-export-backend-options (org-export-get-backend 'latex))))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-cover-page-p</span> ()
  <span class="org-doc">"Whether a cover page should be used when exporting this Org file."</span>
  (<span class="org-keyword">pcase</span> (<span class="org-keyword">or</span> (car
              (delq nil
                    (mapcar
                     (<span class="org-keyword">lambda</span> (opt-line)
                       (plist-get (org-export--parse-option-keyword opt-line 'latex) <span class="org-builtin">:latex-cover-page</span>))
                     (cdar (org-collect-keywords '(<span class="org-string">"OPTIONS"</span>))))))
             org-latex-cover-page)
    ((<span class="org-keyword">or</span> 't 'yes) t)
    ('auto (<span class="org-keyword">when</span> (&gt; (count-words (point-min) (point-max)) org-latex-cover-page-wordcount-threshold) t))
    (_ nil)))

(<span class="org-keyword">defadvice!</span> org-latex-set-coverpage-subtitle-format-a (contents info)
  <span class="org-doc">"Set the subtitle format when a cover page is being used."</span>
  <span class="org-builtin">:before</span> #'org-latex-template
  (<span class="org-keyword">when</span> (org-latex-cover-page-p)
    (<span class="org-keyword">setf</span> info (plist-put info <span class="org-builtin">:latex-subtitle-format</span> org-latex-subtitle-coverpage-format))))

(add-to-list 'org-latex-feature-implementations '(cover-page <span class="org-builtin">:snippet</span> org-latex-cover-page-maketitle <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">9</span>) t)
(add-to-list 'org-latex-conditional-features '((org-latex-cover-page-p) . cover-page) t)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-condensed-lists" class="outline-5">
<h5 id="condensed-lists"><span class="section-number-5">6.3.6.7</span> Condensed lists<a aria-hidden="true" href="#condensed-lists">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-7">
<p>
LaTeX is generally pretty good by default, but it&rsquo;s <i>really</i> generous with how
much space it puts between list items by default. I&rsquo;m generally not a fan.
</p>

<p>
Thankfully this is easy to correct with a small snippet:
</p>
<details id='latex-condense-lists' class='code' open><summary class='named'><span class="name">latex-condense-lists</span><span class="lang">LaTeX</span></summary>
    <div class='gutter'>
    <a href='#latex-condense-lists'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-LaTeX"><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">let</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">olditem</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">itemize</span><span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">renewcommand</span></span>{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">itemize</span></span>}{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">olditem</span></span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-function-name"><span class="org-keyword"><span class="org-keyword">setlength</span></span></span><span class="org-function-name">{</span><span class="org-function-name"><span class="org-variable-name"><span class="org-font-latex-warning">\</span></span></span><span class="org-function-name"><span class="org-variable-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-function-name"><span class="org-variable-name"><span class="org-keyword">itemsep</span></span></span><span class="org-function-name">}{</span><span class="org-function-name"><span class="org-variable-name">-2ex</span></span><span class="org-function-name">}</span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">let</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">oldenum</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">enumerate</span><span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">renewcommand</span></span>{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">enumerate</span></span>}{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">oldenum</span></span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-function-name"><span class="org-keyword"><span class="org-keyword">setlength</span></span></span><span class="org-function-name">{</span><span class="org-function-name"><span class="org-variable-name"><span class="org-font-latex-warning">\</span></span></span><span class="org-function-name"><span class="org-variable-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-function-name"><span class="org-variable-name"><span class="org-keyword">itemsep</span></span></span><span class="org-function-name">}{</span><span class="org-function-name"><span class="org-variable-name">-2ex</span></span><span class="org-function-name">}</span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">let</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">olddesc</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">description</span><span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">renewcommand</span></span>{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">description</span></span>}{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">olddesc</span></span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-function-name"><span class="org-keyword"><span class="org-keyword">setlength</span></span></span><span class="org-function-name">{</span><span class="org-function-name"><span class="org-variable-name"><span class="org-font-latex-warning">\</span></span></span><span class="org-function-name"><span class="org-variable-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-function-name"><span class="org-variable-name"><span class="org-keyword">itemsep</span></span></span><span class="org-function-name">}{</span><span class="org-function-name"><span class="org-variable-name">-2ex</span></span><span class="org-function-name">}</span>}
</pre>
</div>
    </details>

<p>
Then we can just hook this in with our clever preamble.
</p>

<details id='condensed-lists,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#condensed-lists,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-condense-lists</span> t
  <span class="org-doc">"Reduce the space between list items."</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-condensed-lists</span> <span class="org-string">"</span>
<span class="org-string">&lt;&lt;latex-condense-lists&gt;&gt;</span>
<span class="org-string">"</span>)

(add-to-list 'org-latex-conditional-features '((<span class="org-keyword">and</span> org-latex-condense-lists <span class="org-string">"^[ \t]*[-+]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^[ \t]*[1Aa][.)] "</span>) . condensed-lists) t)
(add-to-list 'org-latex-feature-implementations '(condensed-lists <span class="org-builtin">:snippet</span> org-latex-condensed-lists <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">0.7</span>) t)
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-pretty-code-blocks" class="outline-5">
<h5 id="pretty-code-blocks"><span class="section-number-5">6.3.6.8</span> Pretty code blocks<a aria-hidden="true" href="#pretty-code-blocks">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-8">
<p>
We could just use minted for syntax highlighting &#x2014; however, we can do better!
The <kbd>engrave-faces</kbd> package lets us use Emacs&rsquo; font-lock for syntax highlighting,
exporting that as LaTeX commands.
</p>

<details id='pretty-code-blocks,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#pretty-code-blocks,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-latex-listings 'engraved) <span class="org-comment-delimiter">; </span><span class="org-comment"><span class="org-bold"><span class="org-success">NOTE</span></span></span><span class="org-comment"> non-standard value</span>
</pre>
</div>
    </details>

<p>
Thanks to <code>org-latex-conditional-features</code> and some copy-paste with the <kbd>minted</kbd>
entry in <code>org-latex-scr-block</code> we can easily add this as a recognised
<code>org-latex-listings</code> value.
</p>

<details id='pretty-code-blocks,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#pretty-code-blocks,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> org-latex-src-block-engraved (orig-fn src-block contents info)
  <span class="org-doc">"Like `</span><span class="org-doc"><span class="org-constant">org-latex-src-block</span></span><span class="org-doc">', but supporting an engraved backend"</span>
  <span class="org-builtin">:around</span> #'org-latex-src-block
  (<span class="org-keyword">if</span> (eq 'engraved (plist-get info <span class="org-builtin">:latex-listings</span>))
      (org-latex-scr-block--engraved src-block contents info)
    (funcall orig-fn src-block contents info)))

(<span class="org-keyword">defadvice!</span> org-latex-inline-src-block-engraved (orig-fn inline-src-block contents info)
  <span class="org-doc">"Like `</span><span class="org-doc"><span class="org-constant">org-latex-inline-src-block</span></span><span class="org-doc">', but supporting an engraved backend"</span>
  <span class="org-builtin">:around</span> #'org-latex-inline-src-block
  (<span class="org-keyword">if</span> (eq 'engraved (plist-get info <span class="org-builtin">:latex-listings</span>))
      (org-latex-inline-scr-block--engraved inline-src-block contents info)
    (funcall orig-fn src-block contents info)))

(<span class="org-keyword">defvar-local</span> <span class="org-variable-name">org-export-has-code-p</span> nil)

(<span class="org-keyword">defadvice!</span> org-export-expect-no-code (<span class="org-type">&amp;rest</span> _)
  <span class="org-builtin">:before</span> #'org-export-as
  (<span class="org-keyword">setq</span> org-export-has-code-p nil))

(<span class="org-keyword">defadvice!</span> org-export-register-code (<span class="org-type">&amp;rest</span> _)
  <span class="org-builtin">:after</span> #'org-latex-src-block-engraved
  <span class="org-builtin">:after</span> #'org-latex-inline-src-block-engraved
  (<span class="org-keyword">setq</span> org-export-has-code-p t))

(<span class="org-keyword">setq</span> org-latex-engraved-code-preamble <span class="org-string">"</span>
<span class="org-string">&lt;&lt;org-latex-engraved-code-preamble&gt;&gt;</span>
<span class="org-string">"</span>)

(add-to-list 'org-latex-conditional-features '((<span class="org-keyword">and</span> org-export-has-code-p <span class="org-string">"^[ \t]*#\\+begin_src</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^[ \t]*#\\+BEGIN_SRC</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">src_[A-Za-z]"</span>) . engraved-code) t)
(add-to-list 'org-latex-conditional-features '(<span class="org-string">"^[ \t]*#\\+begin_example</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^[ \t]*#\\+BEGIN_EXAMPLE"</span> . engraved-code-setup) t)
(add-to-list 'org-latex-feature-implementations '(engraved-code <span class="org-builtin">:requires</span> engraved-code-setup <span class="org-builtin">:snippet</span> (engrave-faces-latex-gen-preamble) <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">99</span>) t)
(add-to-list 'org-latex-feature-implementations '(engraved-code-setup <span class="org-builtin">:snippet</span> org-latex-engraved-code-preamble <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">98</span>) t)

(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-scr-block--engraved</span> (src-block contents info)
  (<span class="org-keyword">let*</span> ((lang (org-element-property <span class="org-builtin">:language</span> src-block))
         (attributes (org-export-read-attribute <span class="org-builtin">:attr_latex</span> src-block))
         (float (plist-get attributes <span class="org-builtin">:float</span>))
         (num-start (org-export-get-loc src-block info))
         (retain-labels (org-element-property <span class="org-builtin">:retain-labels</span> src-block))
         (caption (org-element-property <span class="org-builtin">:caption</span> src-block))
         (caption-above-p (org-latex--caption-above-p src-block info))
         (caption-str (org-latex--caption/label-string src-block info))
         (placement (<span class="org-keyword">or</span> (org-unbracket-string <span class="org-string">"["</span> <span class="org-string">"]"</span> (plist-get attributes <span class="org-builtin">:placement</span>))
                        (plist-get info <span class="org-builtin">:latex-default-figure-position</span>)))
         (float-env
          (<span class="org-keyword">cond</span>
           ((string= <span class="org-string">"multicolumn"</span> float)
            (format <span class="org-string">"\\begin{listing*}[%s]\n%s%%s\n%s\\end{listing*}"</span>
                    placement
                    (<span class="org-keyword">if</span> caption-above-p caption-str <span class="org-string">""</span>)
                    (<span class="org-keyword">if</span> caption-above-p <span class="org-string">""</span> caption-str)))
           (caption
            (format <span class="org-string">"\\begin{listing}[%s]\n%s%%s\n%s\\end{listing}"</span>
                    placement
                    (<span class="org-keyword">if</span> caption-above-p caption-str <span class="org-string">""</span>)
                    (<span class="org-keyword">if</span> caption-above-p <span class="org-string">""</span> caption-str)))
           ((string= <span class="org-string">"t"</span> float)
            (concat (format <span class="org-string">"\\begin{listing}[%s]\n"</span>
                            placement)
                    <span class="org-string">"%s\n\\end{listing}"</span>))
           (t <span class="org-string">"%s"</span>)))
         (options (plist-get info <span class="org-builtin">:latex-minted-options</span>))
         (content-buffer
          (<span class="org-keyword">with-temp-buffer</span>
            (insert
             (<span class="org-keyword">let*</span> ((code-info (org-export-unravel-code src-block))
                    (max-width
                     (apply 'max
                            (mapcar 'length
                                    (org-split-string (car code-info)
                                                      <span class="org-string">"\n"</span>)))))
               (org-export-format-code
                (car code-info)
                (<span class="org-keyword">lambda</span> (loc _num ref)
                  (concat
                   loc
                   (<span class="org-keyword">when</span> ref
                     <span class="org-comment-delimiter">;; </span><span class="org-comment">Ensure references are flushed to the right,</span>
                     <span class="org-comment-delimiter">;; </span><span class="org-comment">separated with 6 spaces from the widest line</span>
                     <span class="org-comment-delimiter">;; </span><span class="org-comment">of code.</span>
                     (concat (make-string (+ (- max-width (length loc)) <span class="org-highlight-numbers-number">6</span>)
                                          ?\s)
                             (format <span class="org-string">"(%s)"</span> ref)))))
                nil (<span class="org-keyword">and</span> retain-labels (cdr code-info)))))
            (funcall (org-src-get-lang-mode lang))
            (engrave-faces-latex-buffer)))
         (content
          (<span class="org-keyword">with-current-buffer</span> content-buffer
            (buffer-string)))
         (body
          (format
           <span class="org-string">"\\begin{Code}\n\\begin{Verbatim}[%s]\n%s\\end{Verbatim}\n\\end{Code}"</span>
           <span class="org-comment-delimiter">;; </span><span class="org-comment">Options.</span>
           (concat
            (org-latex--make-option-string
             (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (not num-start) (assoc <span class="org-string">"linenos"</span> options))
                 options
               (append
                `((<span class="org-string">"linenos"</span>)
                  (<span class="org-string">"firstnumber"</span> ,(number-to-string (1+ num-start))))
                options)))
            (<span class="org-keyword">let</span> ((local-options (plist-get attributes <span class="org-builtin">:options</span>)))
              (<span class="org-keyword">and</span> local-options (concat <span class="org-string">","</span> local-options))))
           content)))
    (kill-buffer content-buffer)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Return value.</span>
    (format float-env body)))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-inline-scr-block--engraved</span> (inline-src-block _contents info)
  (<span class="org-keyword">let</span> ((options (org-latex--make-option-string
                  (plist-get info <span class="org-builtin">:latex-minted-options</span>)))
        code-buffer code)
    (<span class="org-keyword">setq</span> code-buffer
          (<span class="org-keyword">with-temp-buffer</span>
            (insert (org-element-property <span class="org-builtin">:value</span> inline-src-block))
            (funcall (org-src-get-lang-mode
                      (org-element-property <span class="org-builtin">:language</span> inline-src-block)))
            (engrave-faces-latex-buffer)))
    (<span class="org-keyword">setq</span> code (<span class="org-keyword">with-current-buffer</span> code-buffer
                 (buffer-string)))
    (kill-buffer code-buffer)
    (format <span class="org-string">"\\Verb%s{%s}"</span>
            (<span class="org-keyword">if</span> (string= options <span class="org-string">""</span>) <span class="org-string">""</span>
              (format <span class="org-string">"[%s]"</span> options))
            code)))
</pre>
</div>
    </details>

<p>
Whenever this is used, in order for it to actually work (and look a little
better) we add bit to the preamble:
</p>

<details id='org-latex-engraved' class='code' open><summary class='named'><span class="name">org-latex-engraved-code-preamble</span><span class="lang">LaTeX</span></summary>
    <div class='gutter'>
    <a href='#org-latex-engraved'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-LaTeX"><span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>{<span class="org-function-name">fvextra</span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">fvset</span>{
  commandchars=<span class="org-font-latex-warning">\\\\\\</span>{<span class="org-font-latex-warning">\\</span>},
  highlightcolor=white!95!black!80!blue,
  breaklines=true,
  breaksymbol=<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">color</span>{white!60!black}<span class="org-font-latex-warning">\</span><span class="org-type"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-type"><span class="org-keyword">tiny</span></span><span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">ensuremath</span></span>{<span class="org-font-latex-math"><span class="org-font-latex-warning">\</span></span><span class="org-font-latex-math"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-font-latex-math"><span class="org-keyword">hookrightarrow</span></span>}}
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-keyword"><span class="org-keyword">renewcommand</span></span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword">theFancyVerbLine</span>{<span class="org-font-latex-warning">\</span><span class="org-type"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-type"><span class="org-keyword">footnotesize</span></span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">color</span>{black!40!white}<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">arabic</span></span>{<span class="org-variable-name">FancyVerbLine</span>}}

<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">definecolor</span>{codebackground}{HTML}{f7f7f7}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">definecolor</span>{codeborder}{HTML}{f0f0f0}

<span class="org-comment-delimiter">% </span><span class="org-comment">TODO have code boxes keep line vertical alignment</span>
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>[<span class="org-variable-name">breakable,xparse</span>]{<span class="org-function-name">tcolorbox</span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">DeclareTColorBox</span>[]{Code}{o}<span class="org-comment">%</span>
{colback=codebackground, colframe=codeborder,
  fontupper=<span class="org-font-latex-warning">\</span><span class="org-type"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-type"><span class="org-keyword">footnotesize</span></span>,
  colupper=EFD,
  IfNoValueTF={#1}<span class="org-comment">%</span>
  {boxsep=2pt, arc=2.5pt, outer arc=2.5pt,
    boxrule=0.5pt, left=2pt}<span class="org-comment">%</span>
  {boxsep=2.5pt, arc=0pt, outer arc=0pt,
    boxrule=0pt, leftrule=1.5pt, left=0.5pt},
  right=2pt, top=1pt, bottom=0.5pt,
  breakable}
</pre>
</div>
    </details>

<p>
At some point it would be nice to make the box colours easily customisable. At
the moment it&rsquo;s fairly easy to change the syntax highlighting colours with
<code class="src src-elisp">(<span class="org-keyword">setq</span> engrave-faces-preset-styles (engrave-faces-generate-preset))</code>,
but perhaps a toggle which specifies whether to use the default values, the
current theme, or any named theme could be a good idea. It should also possible
to set the box background dynamically to match. The named theme could work by
looking for a style definition with a certain name in a cache dir, and then
switching to that theme and producing (and saving) the style definition if it
doesn&rsquo;t exist.
</p>

<p>
Now let&rsquo;s have the example block be styled similarly.
</p>
<details id='pretty-code-blocks,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#pretty-code-blocks,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> org-latex-example-block-engraved (orig-fn example-block contents info)
  <span class="org-doc">"Like `</span><span class="org-doc"><span class="org-constant">org-latex-example-block</span></span><span class="org-doc">', but supporting an engraved backend"</span>
  <span class="org-builtin">:around</span> #'org-latex-example-block
  (<span class="org-keyword">let</span> ((output-block (funcall orig-fn example-block contents info)))
    (<span class="org-keyword">if</span> (eq 'engraved (plist-get info <span class="org-builtin">:latex-listings</span>))
        (format <span class="org-string">"\\begin{Code}[alt]\n%s\n\\end{Code}"</span> output-block)
      output-block)))
</pre>
</div>
    </details>

<p>
In addition to the vastly superior visual output, this should also be much
faster to compile for code-heavy documents (like this config).
</p>

<p>
Performing a little benchmark with this document, I find that this is indeed the
case.
</p>

<div id='pretty-code-blocks,table--1' class='table'>
    <div class='gutter'><a href='#pretty-code-blocks,table--1'>#</a></div>
    <div class='tabular'>
    <table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">LaTeX syntax highlighting backend</th>
<th scope="col" class="org-left">Compile time</th>
<th scope="col" class="org-left">Overhead</th>
<th scope="col" class="org-right">Overhead ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">verbatim</td>
<td class="org-left">12 s</td>
<td class="org-left">0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-left">lstlistings</td>
<td class="org-left">15 s</td>
<td class="org-left">3 s</td>
<td class="org-right">0.2</td>
</tr>

<tr>
<td class="org-left">Engrave</td>
<td class="org-left">34 s</td>
<td class="org-left">22 s</td>
<td class="org-right">1.8</td>
</tr>

<tr>
<td class="org-left">Pygments (Minted)</td>
<td class="org-left">184 s</td>
<td class="org-left">172 s</td>
<td class="org-right">14.3</td>
</tr>
</tbody>
</table>
    </div>    </div>

<p>
Treating the verbatim (no syntax highlighting) result as a baseline; this
rudimentary test suggest that <kbd>engrave-faces</kbd> is around eight times faster than
<kbd>pygments</kbd>, and takes three times as long as no syntax highlighting (verbatim).
</p>
</div>
</div>

<div id="outline-container-julia-code-blocks" class="outline-5">
<h5 id="julia-code-blocks"><span class="section-number-5">6.3.6.9</span> Julia code blocks<a aria-hidden="true" href="#julia-code-blocks">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-9">
<p>
Julia code has fantastic support for unicode! The downside is that <kbd>pdflatex</kbd> is
<i>still</i> a pain to use with unicode symbols. The solution &#x2014; <kbd>lualatex</kbd>. Now we just
need to make it automatic
</p>

<details id='julia-code-blocks,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#julia-code-blocks,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> org-latex-pick-compiler (_contents info)
  <span class="org-builtin">:before</span> #'org-latex-template
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> org-export-has-code-p (memq 'julia-code (org-latex-detect-features)))
    (<span class="org-keyword">setf</span> info (plist-put
                (<span class="org-keyword">if</span> (member #'+org-latex-replace-non-ascii-chars (plist-get info <span class="org-builtin">:filter-final-output</span>))
                    (plist-put info <span class="org-builtin">:filter-final-output</span>
                               (delq #'+org-latex-replace-non-ascii-chars (plist-get info <span class="org-builtin">:filter-final-output</span>)))
                  info)
                <span class="org-builtin">:latex-compiler</span> <span class="org-string">"lualatex"</span>))))
</pre>
</div>
    </details>

<p>
Then a font with unicode support must be used. JuliaMono is the obvious choice,
and we can use it with the <kbd>fontspec</kbd> package. In future it may be nice to set
this just as a fallback font (when it isn&rsquo;t a pain to do so).
</p>

<details id='julia-mono-fontspec' class='code' open><summary class='named'><span class="name">julia-mono-fontspec</span><span class="lang">LaTeX</span></summary>
    <div class='gutter'>
    <a href='#julia-mono-fontspec'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-LaTeX"><span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>{<span class="org-function-name">fontspec</span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">newfontfamily</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">JuliaMono</span>{JuliaMono-Regular.ttf}[Path=/usr/share/fonts/truetype/, Extension=.ttf]
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">newfontface</span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">JuliaMonoRegular</span>{JuliaMono-Regular}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">setmonofont</span>{JuliaMonoRegular}[Contextuals=Alternate, Scale=MatchLowercase]
</pre>
</div>
    </details>

<p>
Now all that remains is to hook this into the preamble generation.
</p>

<details id='julia-code-blocks,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#julia-code-blocks,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-latex-julia-mono-fontspec <span class="org-string">"</span>
<span class="org-string">&lt;&lt;julia-mono-fontspec&gt;&gt;</span>
<span class="org-string">"</span>)

(add-to-list 'org-latex-feature-implementations '(julia-code <span class="org-builtin">:snippet</span> org-latex-julia-mono-fontspec <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">0</span>) t)
(add-to-list 'org-latex-conditional-features '((<span class="org-keyword">and</span> org-export-has-code-p <span class="org-string">"^[ \t]*#\\+begin_src julia</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^[ \t]*#\\+BEGIN_SRC julia</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">src_julia"</span>) . julia-code) t)

(add-to-list 'org-latex-feature-implementations '(.microtype-lualatex <span class="org-builtin">:eager</span> t <span class="org-builtin">:when</span> (microtype julia-code) <span class="org-builtin">:prevents</span> microtype <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">0.1</span> <span class="org-builtin">:snippet</span> <span class="org-string">"\\usepackage[activate={true,nocompatibility},final,tracking=true,factor=2000]{microtype}\n"</span>))
(add-to-list 'org-latex-feature-implementations '(.custom-font-no-mono <span class="org-builtin">:eager</span> t <span class="org-builtin">:prevents</span> custom-font <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">0</span> <span class="org-builtin">:snippet</span> (org-latex-fontset <span class="org-builtin">:serif</span> <span class="org-builtin">:sans</span>)) t)
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-latex-export-emojis" class="outline-5">
<h5 id="latex-export-emojis"><span class="section-number-5">6.3.6.10</span> Emojis<a aria-hidden="true" href="#latex-export-emojis">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-10">
<p>
It would be nice to actually include emojis where used.
Thanks to <kbd>emojify</kbd>, we have a folder of emoji images just sitting and waiting to
be used ðŸ™‚.
</p>

<p>
First up, we want to detect when emojis are actually present. We can try
checking the unicode ranges with a collection of <kbd>[?-?]</kbd> regex groups, but Emojis
are actually spread around a fair bit and so this isn&rsquo;t very straightforward.
Instead I can iterate thorough non-<span class='acr'>ASCII</span> characters and check if any have the
text property <kbd>emojified</kbd>.
</p>

<details id='emojis,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#emojis,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">emojify-emoji-in-buffer-p</span> ()
  <span class="org-doc">"Determine if any emojis are present in the current buffer, using `</span><span class="org-doc"><span class="org-constant">emojify-mode</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">unless</span> emojify-mode
    (emojify-mode <span class="org-highlight-numbers-number">1</span>)
    (emojify-display-emojis-in-region (point-min) (point-max)))
  (<span class="org-keyword">let</span> (emoji-found end)
    (<span class="org-keyword">save-excursion</span>
      (goto-char (point-min))
      (<span class="org-keyword">while</span> (not (<span class="org-keyword">or</span> emoji-found end))
        (<span class="org-keyword">if-let</span> ((pos (re-search-forward <span class="org-string">"[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">[:ascii:]]"</span> nil t)))
            (<span class="org-keyword">when</span> (get-text-property (1- pos) 'emojified)
              (<span class="org-keyword">setq</span> emoji-found t))
          (<span class="org-keyword">setq</span> end t))))
    emoji-found))
</pre>
</div>
    </details>

<p>
Once we know that there are emojis present we can add a bit of preamble to the
buffer to make insertion easier.
</p>

<details id='emojis,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#emojis,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-emoji-setup</span> ()
  (format <span class="org-string">"\\newcommand\\emoji[1]{\\raisebox{-0.3ex}{\\includegraphics[height=1.8ex]{%s/#1}}}"</span> (emojify-image-dir)))

(add-to-list 'org-latex-conditional-features '((emojify-emoji-in-buffer-p) . emoji) t)
(add-to-list 'org-latex-feature-implementations '(emoji <span class="org-builtin">:requires</span> image <span class="org-builtin">:snippet</span> (org-latex-emoji-setup) <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">3</span> ))
</pre>
</div>
    </details>

<p>
Once again making use of <kbd>emojify</kbd>, we can generate LaTeX commands for our emojis
fairly easily.
</p>

<details id='emojis,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#emojis,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">emojify-latexify-emoji-in-buffer</span> ()
  (<span class="org-keyword">unless</span> emojify-mode
    (emojify-mode <span class="org-highlight-numbers-number">1</span>)
    (emojify-display-emojis-in-region (point-min) (point-max)))
  (<span class="org-keyword">let</span> (end)
    (<span class="org-keyword">save-excursion</span>
      (goto-char (point-min))
      (<span class="org-keyword">while</span> (not end)
        (<span class="org-keyword">if-let</span> ((pos (re-search-forward <span class="org-string">"[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">[:ascii:]]\\{1,2\\}"</span> nil t)))
            (<span class="org-keyword">when-let</span> ((char (get-text-property (1- pos) 'emojify-text))
                       (emoji (emojify-get-emoji char)))
              (replace-match (format <span class="org-string">"\\\\emoji{%s}"</span> (file-name-sans-extension (ht-get emoji <span class="org-string">"image"</span>)))))
          (<span class="org-keyword">setq</span> end t))))))
</pre>
</div>
    </details>

<p>
Now we just need to hook this handy function into Org&rsquo;s export.
We can&rsquo;t use standard string-replacement as we rely on the buffer modifications
enacted by <code class="src src-elisp">(emojify-mode)</code>.
</p>

<p>
As I have not yet implemented a nice way of sharing feature detection
information outside of <code class="src src-elisp">(org-latex-generate-features-preamble)</code>, we&rsquo;ll
use the same check before attempting to LaTeXify emojis and hope that nothing
strange happens.
</p>

<details id='emojis,code--4' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#emojis,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+org-latex-convert-emojis</span> (text backend _info)
  (<span class="org-keyword">when</span> (org-export-derived-backend-p backend 'latex)
    (<span class="org-keyword">with-temp-buffer</span>
      (insert text)
      (<span class="org-keyword">when</span> (emojify-emoji-in-buffer-p)
        (emojify-latexify-emoji-in-buffer)
        (buffer-string)))))

(add-to-list 'org-export-filter-final-output-functions #'+org-latex-convert-emojis)
</pre>
</div>
    </details>

<p>
This works fairly nicely, there&rsquo;s just one little <span class='acr'>QOL</span> upgrade that we can
perform. <kbd>emojify</kbd> downloads the <code>72x72</code> versions of Twemoji, however <span class='acr'>SVG</span> versions
are also produced. We could use <code>inkscape</code> to convert those to <span class='acr'>PDF</span><small>s</small>, which would
likely be best for including.
</p>

<p>
First, it&rsquo;s worth checking whether <kbd>.pdf</kbd> graphics files will be prioritised over
<kbd>.png</kbd> files. If so, that would be ideal as no extra effort is required past
fetching and converting the files.
</p>

<details id='emojis,code--5' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#emojis,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">texdef -t pdflatex -p graphicx Gin@extensions
</pre>
</div>
    </details>

<details id='org3746e43' class='code' open>
    <summary></summary>
    <div class='gutter'>    <a href='#org3746e43'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <pre class="example" id="org3746e43">
\Gin@extensions:
macro:-&gt;.pdf,.png,.jpg,.mps,.jpeg,.jbig2,.jb2,.PDF,.PNG,.JPG,.JPEG,.JBIG2,.JB2,.eps
</pre>

    </details>

<p>
Fantastic! We can see that <kbd>.pdf</kbd> actually comes first in the priority list. So
now we just need to fetch and convert those <span class='acr'>SVG</span><small>s</small> &#x2014; ideally with a handy
command to do so for us.
</p>

<details id='emojis,code--6' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#emojis,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-emoji-install-vector-graphics</span> ()
  <span class="org-doc">"Dowload, convert, and install vector emojis for use with LaTeX."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((dir (org-latex-emoji-install-vector-graphics--download)))
    (org-latex-emoji-install-vector-graphics--convert dir)
    (org-latex-emoji-install-vector-graphics--install dir))
  (message <span class="org-string">"Vector emojis installed."</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-emoji-install-vector-graphics--download</span> ()
  (message <span class="org-string">"Locating latest emojis..."</span>)
  (<span class="org-keyword">let*</span> ((twemoji-url (substring (shell-command-to-string <span class="org-string">"echo \"https://github.com$(curl -sL https://github.com/twitter/twemoji/releases/latest | grep '.zip\"' | cut -d '\"' -f 2)\""</span>) <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-numbers-number">-1</span>))
         (twemoji-version (replace-regexp-in-string <span class="org-string">"^.*tags/v</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\.zip"</span> <span class="org-string">"\\1"</span> twemoji-url))
         (twemoji-dest-folder (make-temp-file <span class="org-string">"twemoji-"</span> t)))
    (message <span class="org-string">"Downloading Twemoji v%s"</span> twemoji-version)
    (<span class="org-keyword">let</span> ((default-directory twemoji-dest-folder))
      (call-process <span class="org-string">"curl"</span> nil nil nil <span class="org-string">"-L"</span> twemoji-url <span class="org-string">"--output"</span> <span class="org-string">"twemoji.zip"</span>)
      (message <span class="org-string">"Unzipping"</span>)
      (call-process <span class="org-string">"unzip"</span> nil nil nil <span class="org-string">"twemoji.zip"</span>)
      (concat twemoji-dest-folder <span class="org-string">"/twemoji-"</span> twemoji-version <span class="org-string">"/assets/svg"</span>))))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-emoji-install-vector-graphics--convert</span> (dir)
  (<span class="org-keyword">let</span> ((default-directory dir))
    (<span class="org-keyword">if</span> (executable-find <span class="org-string">"cairosvg"</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">cairo's PDFs are ~10% smaller</span>
        (<span class="org-keyword">let*</span> ((images (directory-files dir nil <span class="org-string">".*.svg"</span>))
               (num-images (length images))
               (index <span class="org-highlight-numbers-number">0</span>)
               (max-threads (1- (string-to-number (shell-command-to-string <span class="org-string">"nproc"</span>))))
               (threads <span class="org-highlight-numbers-number">0</span>))
          (<span class="org-keyword">while</span> (&lt; index num-images)
            (<span class="org-keyword">setf</span> threads (1+ threads))
            (message <span class="org-string">"Converting emoji %d/%d (%s)"</span> (1+ index) num-images (nth index images))
            (make-process <span class="org-builtin">:name</span> <span class="org-string">"cairosvg"</span>
                          <span class="org-builtin">:command</span> (list <span class="org-string">"cairosvg"</span> (nth index images) <span class="org-string">"-o"</span> (concat (file-name-sans-extension (nth index images)) <span class="org-string">".pdf"</span>))
                          <span class="org-builtin">:sentinel</span> (<span class="org-keyword">lambda</span> (proc msg)
                                      (<span class="org-keyword">when</span> (memq (process-status proc) '(exit signal))
                                        (<span class="org-keyword">setf</span> threads (1- threads)))))
            (<span class="org-keyword">setq</span> index (1+ index))
            (<span class="org-keyword">while</span> (&gt; threads max-threads)
              (sleep-for <span class="org-highlight-numbers-number">0.01</span>)))
          (<span class="org-keyword">while</span> (&gt; threads <span class="org-highlight-numbers-number">0</span>)
            (sleep-for <span class="org-highlight-numbers-number">0.01</span>))
          (message <span class="org-string">"Finished conversion!"</span>)))
    (shell-command <span class="org-string">"inkscape --batch-process --export-type='pdf' *.svg"</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-emoji-install-vector-graphics--install</span> (dir)
  (message <span class="org-string">"Installing vector emojis into emoji directory"</span>)
  (<span class="org-keyword">let</span> ((images (directory-files dir t <span class="org-string">".*.pdf"</span>))
        (emoji-dir (concat (emojify-image-dir) <span class="org-string">"/"</span>)))
    (mapcar
     (<span class="org-keyword">lambda</span> (image)
       (rename-file image emoji-dir t))
     images)))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-remove-non-ascii" class="outline-5">
<h5 id="remove-non-ascii"><span class="section-number-5">6.3.6.11</span> Remove non-ascii chars<a aria-hidden="true" href="#remove-non-ascii">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-11">
<p>
When using <code>pdflatex</code>, almost non-ascii characters are generally problematic, and
don&rsquo;t appear in the pdf. It&rsquo;s preferable to see that there was <i>some</i> character
which wasn&rsquo;t displayed as opposed to nothing.
</p>

<p>
We check every non-ascii character to make sure it&rsquo;s not a character encoded by
the <kbd>inputenc</kbd> packages when loaded with the <kbd>utf8</kbd> option. Finally, we see if we
have our own LaTeX conversion we can apply and if there is none we replace the
non-ascii char with <kbd>Â¿</kbd>.
</p>

<p>
No to make sure we only remove characters that can&rsquo;t be displayed, we check
<kbd>/usr/share/texmf/tex/latex/base/utf8enc.dfu</kbd>.
</p>

<p>
We just need to make sure this is appended to the list of filter functions,
since we want to let emoji processing occur first.
</p>

<details id='remove-non-ascii,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#remove-non-ascii,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">+org-pdflatex-inputenc-encoded-chars</span>
    <span class="org-string">"[[:ascii:]\u00A0-\u01F0\u0218-\u021B&#562;&#563;&#567;&#710;&#711;&#732;&#728;&#729;&#731;&#733;\u0400-\u04FF&#7682;&#7683;&#7838;\u200C\u2010-\u201E&#8224;&#8225;&#8226;&#8230;&#8240;&#8241;&#8249;&#8250;&#8251;&#8253;&#8260;&#8270;&#8274;&#8353;&#8356;&#8358;&#8361;&#8363;&#8364;&#8369;&#8451;&#8470;&#8471;&#8478;&#8480;&#8482;&#8486;&#8487;&#8494;&#8592;&#8593;&#8594;&#8595;&#9001;&#9002;&#9250;&#9251;&#9702;&#9711;&#9834;&#10216;&#10217;&#7712;&#7713;\uFB00-\uFB06]"</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">+org-latex-replace-non-ascii-chars</span> (text backend info)
  <span class="org-doc">"Replace non-ascii chars with \\char\"XYZ forms."</span>
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (org-export-derived-backend-p backend 'latex)
             (string= (plist-get info <span class="org-builtin">:latex-compiler</span>) <span class="org-string">"pdflatex"</span>))
    (replace-regexp-in-string <span class="org-string">"[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">[:ascii:]]"</span>
                              (<span class="org-keyword">lambda</span> (nonascii)
                                (<span class="org-keyword">if</span> (string-match-p +org-pdflatex-inputenc-encoded-chars nonascii) nonascii
                                  (<span class="org-keyword">or</span> (cdr (assoc nonascii +org-latex-non-ascii-char-substitutions)) <span class="org-string">"&#191;"</span>)))
                              text)))

(add-to-list 'org-export-filter-final-output-functions #'+org-latex-replace-non-ascii-chars t)
</pre>
</div>
    </details>

<p>
Now, there are some symbols that aren&rsquo;t included in <kbd>inputenc</kbd>, but we should be
able to handle anyway. For them we define a table of LaTeX translations
</p>

<div id='latex-non-ascii' class='table'>
    <div class='gutter'><a href='#latex-non-ascii'>#</a></div>
    <div class='tabular'>
    <table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Character</th>
<th scope="col" class="org-left">LaTeX</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">É‘</td>
<td class="org-left">\(\alpha\)</td>
</tr>

<tr>
<td class="org-left">Î²</td>
<td class="org-left">\(\beta\)</td>
</tr>

<tr>
<td class="org-left">Î³</td>
<td class="org-left">\(\gamma\)</td>
</tr>

<tr>
<td class="org-left">Î´</td>
<td class="org-left">\(\delta\)</td>
</tr>

<tr>
<td class="org-left">Îµ</td>
<td class="org-left">\(\epsilon\)</td>
</tr>

<tr>
<td class="org-left">Ïµ</td>
<td class="org-left">\(\varepsilon\)</td>
</tr>

<tr>
<td class="org-left">Î¶</td>
<td class="org-left">\(\zeta\)</td>
</tr>

<tr>
<td class="org-left">Î·</td>
<td class="org-left">\(\eta\)</td>
</tr>

<tr>
<td class="org-left">Î¸</td>
<td class="org-left">\(\theta\)</td>
</tr>

<tr>
<td class="org-left">Ï‘</td>
<td class="org-left">\(\vartheta\)</td>
</tr>

<tr>
<td class="org-left">Î¹</td>
<td class="org-left">\(\iota\)</td>
</tr>

<tr>
<td class="org-left">Îº</td>
<td class="org-left">\(\kappa\)</td>
</tr>

<tr>
<td class="org-left">Î»</td>
<td class="org-left">\(\lambda\)</td>
</tr>

<tr>
<td class="org-left">Î¼</td>
<td class="org-left">\(\mu\)</td>
</tr>

<tr>
<td class="org-left">Î½</td>
<td class="org-left">\(\nu\)</td>
</tr>

<tr>
<td class="org-left">Î¾</td>
<td class="org-left">\(\xi\)</td>
</tr>

<tr>
<td class="org-left">Ï€</td>
<td class="org-left">\(\pi\)</td>
</tr>

<tr>
<td class="org-left">Ï–</td>
<td class="org-left">\(\varpi\)</td>
</tr>

<tr>
<td class="org-left">Ï</td>
<td class="org-left">\(\rho\)</td>
</tr>

<tr>
<td class="org-left">Ï±</td>
<td class="org-left">\(\varrho\)</td>
</tr>

<tr>
<td class="org-left">Ïƒ</td>
<td class="org-left">\(\sigma\)</td>
</tr>

<tr>
<td class="org-left">Ï‚</td>
<td class="org-left">\(\varsigma\)</td>
</tr>

<tr>
<td class="org-left">Ï„</td>
<td class="org-left">\(\tau\)</td>
</tr>

<tr>
<td class="org-left">Ï…</td>
<td class="org-left">\(\upsilon\)</td>
</tr>

<tr>
<td class="org-left">Ï•</td>
<td class="org-left">\(\phi\)</td>
</tr>

<tr>
<td class="org-left">Ï†</td>
<td class="org-left">\(\varphi\)</td>
</tr>

<tr>
<td class="org-left">Ïˆ</td>
<td class="org-left">\(\psi\)</td>
</tr>

<tr>
<td class="org-left">Ï‰</td>
<td class="org-left">\(\omega\)</td>
</tr>

<tr>
<td class="org-left">Î“</td>
<td class="org-left">\(\Gamma\)</td>
</tr>

<tr>
<td class="org-left">Î”</td>
<td class="org-left">\(\Delta\)</td>
</tr>

<tr>
<td class="org-left">Î˜</td>
<td class="org-left">\(\Theta\)</td>
</tr>

<tr>
<td class="org-left">Î›</td>
<td class="org-left">\(\Lambda\)</td>
</tr>

<tr>
<td class="org-left">Îž</td>
<td class="org-left">\(\Xi\)</td>
</tr>

<tr>
<td class="org-left">Î </td>
<td class="org-left">\(\Pi\)</td>
</tr>

<tr>
<td class="org-left">Î£</td>
<td class="org-left">\(\Sigma\)</td>
</tr>

<tr>
<td class="org-left">Î¥</td>
<td class="org-left">\(\Upsilon\)</td>
</tr>

<tr>
<td class="org-left">Î¦</td>
<td class="org-left">\(\Phi\)</td>
</tr>

<tr>
<td class="org-left">Î¨</td>
<td class="org-left">\(\Psi\)</td>
</tr>

<tr>
<td class="org-left">Î©</td>
<td class="org-left">\(\Omega\)</td>
</tr>

<tr>
<td class="org-left">×</td>
<td class="org-left">\(\aleph\)</td>
</tr>

<tr>
<td class="org-left">×‘</td>
<td class="org-left">\(\beth\)</td>
</tr>

<tr>
<td class="org-left">×“</td>
<td class="org-left">\(\daleth\)</td>
</tr>

<tr>
<td class="org-left">×’</td>
<td class="org-left">\(\gimel\)</td>
</tr>
</tbody>
</table>
    </div>    </div>

<details id='gen-latex-non' class='code' open><summary class='named'><span class="name">gen-latex-non-ascii-char-substitutions</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#gen-latex-non'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(replace-regexp-in-string
 <span class="org-string">" '(("</span> <span class="org-string">"\n   '(("</span>
 (replace-regexp-in-string
  <span class="org-string">") ("</span> <span class="org-string">")\n     ("</span>
  (prin1-to-string
   `(<span class="org-keyword">defvar</span> <span class="org-variable-name">+org-latex-non-ascii-char-substitutions</span>
      ',(mapcar
         (<span class="org-keyword">lambda</span> (entry)
           (cons (car entry) (replace-regexp-in-string <span class="org-string">"\\\\"</span> <span class="org-string">"\\\\\\\\"</span> (cadr entry))))
         latex-non-ascii-char-substitutions)))))
</pre>
</div>
    </details>

<details id='remove-non-ascii,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#remove-non-ascii,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">&lt;&lt;gen-latex-non-ascii-char-substitutions()&gt;&gt;
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-latex-export-extra" class="outline-5">
<h5 id="latex-export-extra"><span class="section-number-5">6.3.6.12</span> Extra special strings<a aria-hidden="true" href="#latex-export-extra">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-12">
<p>
LaTeX already recognises <kbd>---</kbd> and <kbd>--</kbd> as em/en-dashes, <kbd>\-</kbd> as a shy hyphen, and the
conversion of <kbd>...</kbd> to <kbd>\ldots{}</kbd> is hardcoded into <code>org-latex-plain-text</code> (unlike
<code>org-html-plain-text</code>).
</p>

<p>
I&rsquo;d quite like to also recognise <kbd>-&gt;</kbd> and <kbd>&lt;-</kbd>, so let&rsquo;s set come up with some advice.
</p>

<details id='extra-special-strings,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-special-strings,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-extra-special-string-regexps</span>
  '((<span class="org-string">"-&gt;"</span> . <span class="org-string">"\\\\textrightarrow{}"</span>)
    (<span class="org-string">"&lt;-"</span> . <span class="org-string">"\\\\textleftarrow{}"</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-convert-extra-special-strings</span> (string)
  <span class="org-doc">"Convert special characters in STRING to LaTeX."</span>
  (<span class="org-keyword">dolist</span> (a org-latex-extra-special-string-regexps string)
    (<span class="org-keyword">let</span> ((re (car a))
          (rpl (cdr a)))
      (<span class="org-keyword">setq</span> string (replace-regexp-in-string re rpl string t)))))

(<span class="org-keyword">defadvice!</span> org-latex-plain-text-extra-special-a (orig-fn text info)
  <span class="org-doc">"Make `</span><span class="org-doc"><span class="org-constant">org-latex-plain-text</span></span><span class="org-doc">' handle some extra special strings."</span>
  <span class="org-builtin">:around</span> #'org-latex-plain-text
  (<span class="org-keyword">let</span> ((output (funcall orig-fn text info)))
    (<span class="org-keyword">when</span> (plist-get info <span class="org-builtin">:with-special-strings</span>)
      (<span class="org-keyword">setq</span> output (org-latex-convert-extra-special-strings output)))
    output))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-support-images-from" class="outline-5">
<h5 id="support-images-from"><span class="section-number-5">6.3.6.13</span> Support images from <span class='acr'><span class='acr'>URL</span></span><small>s</small><a aria-hidden="true" href="#support-images-from">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-13">
<p>
You can link to remote images easily, and they work nicely with <span class='acr'>HTML</span>-based
exports. However, LaTeX can only include local files, and so the current
behaviour of <kbd>org-latex-link</kbd> is just to insert a <span class='acr'>URL</span> to the image.
</p>

<p>
We can do better than that by downloading the image to a predictable location,
and using that. By making the filename predictable as opposed to just another
tempfile, this can provide a caching mechanism.
</p>

<details id='support-images-from,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#support-images-from,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> +org-latex-link (orig-fn link desc info)
  <span class="org-doc">"Acts as `</span><span class="org-doc"><span class="org-constant">org-latex-link</span></span><span class="org-doc">', but supports remote images."</span>
  <span class="org-builtin">:around</span> #'org-latex-link
  (<span class="org-keyword">setq</span> o-link link
        o-desc desc
        o-info info)
  (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (member (plist-get (cadr link) <span class="org-builtin">:type</span>) '(<span class="org-string">"http"</span> <span class="org-string">"https"</span>))
           (member (file-name-extension (plist-get (cadr link) <span class="org-builtin">:path</span>))
                   '(<span class="org-string">"png"</span> <span class="org-string">"jpg"</span> <span class="org-string">"jpeg"</span> <span class="org-string">"pdf"</span> <span class="org-string">"svg"</span>)))
      (org-latex-link--remote link desc info)
    (funcall orig-fn link desc info)))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-link--remote</span> (link _desc info)
  (<span class="org-keyword">let*</span> ((url (plist-get (cadr link) <span class="org-builtin">:raw-link</span>))
         (ext (file-name-extension url))
         (target (format <span class="org-string">"%s%s.%s"</span>
                         (temporary-file-directory)
                         (replace-regexp-in-string <span class="org-string">"[./]"</span> <span class="org-string">"-"</span>
                                                   (file-name-sans-extension (substring (plist-get (cadr link) <span class="org-builtin">:path</span>) <span class="org-highlight-numbers-number">2</span>)))
                         ext)))
    (<span class="org-keyword">unless</span> (file-exists-p target)
      (url-copy-file url target))
    (setcdr link (<span class="org-keyword">--&gt;</span> (cadr link)
                   (plist-put it <span class="org-builtin">:type</span> <span class="org-string">"file"</span>)
                   (plist-put it <span class="org-builtin">:path</span> target)
                   (plist-put it <span class="org-builtin">:raw-link</span> (concat <span class="org-string">"file:"</span> target))
                   (list it)))
    (concat <span class="org-string">"% fetched from "</span> url <span class="org-string">"\n"</span>
            (org-latex--inline-image link info))))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-chameleon-aka-match" class="outline-5">
<h5 id="chameleon-aka-match"><span class="section-number-5">6.3.6.14</span> Chameleon &#x2014; aka. match theme<a aria-hidden="true" href="#chameleon-aka-match">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-14">
<p>
Once I had the idea of having the look of the LaTeX document produced match the
current Emacs theme, I was enraptured. The result is the pseudo-class <code>chameleon</code>.
</p>
<details id='chameleon-aka-match,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#chameleon-aka-match,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> ox
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">ox-chameleon-base-class</span> <span class="org-string">"scr-article"</span>
    <span class="org-doc">"The base class that chameleon builds on"</span>)

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">ox-chameleon--p</span> nil
    <span class="org-doc">"Used to indicate whether the current export is trying to blend in. Set just before being accessed."</span>)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setf (alist-get :filter-latex-class</span>
  <span class="org-comment-delimiter">;;                  </span><span class="org-comment">(org-export-backend-filters</span>
  <span class="org-comment-delimiter">;;                   </span><span class="org-comment">(org-export-get-backend 'latex)))</span>
  <span class="org-comment-delimiter">;;       </span><span class="org-comment">'ox-chameleon-latex-class-detector-filter)</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">(defun ox-chameleon-latex-class-detector-filter (info backend)</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">""</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">(setq ox-chameleon--p (when (equal (plist-get info :latex-class)</span>
  <span class="org-comment-delimiter">;;                                      </span><span class="org-comment">"chameleon")</span>
  <span class="org-comment-delimiter">;;                           </span><span class="org-comment">(plist-put info :latex-class ox-chameleon-base-class)</span>
  <span class="org-comment-delimiter">;;                           </span><span class="org-comment">t)))</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-bold"><span class="org-warning">TODO</span></span></span><span class="org-comment"> make this less hacky. One ideas was as follows</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(map-put (org-export-backend-filters (org-export-get-backend 'latex))</span>
  <span class="org-comment-delimiter">;;           </span><span class="org-comment">:filter-latex-class 'ox-chameleon-latex-class-detector-filter))</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Never seemed to execute though</span>
  (<span class="org-keyword">defadvice!</span> ox-chameleon-org-latex-detect (orig-fun info)
    <span class="org-builtin">:around</span> #'org-export-install-filters
    (<span class="org-keyword">setq</span> ox-chameleon--p (<span class="org-keyword">when</span> (equal (plist-get info <span class="org-builtin">:latex-class</span>)
                                       <span class="org-string">"chameleon"</span>)
                            (plist-put info <span class="org-builtin">:latex-class</span> ox-chameleon-base-class)
                            t))
    (funcall orig-fun info))

  (<span class="org-keyword">defadvice!</span> ox-chameleon-org-latex-export (orig-fn info <span class="org-type">&amp;optional</span> template snippet?)
    <span class="org-builtin">:around</span> #'org-latex-make-preamble
    (<span class="org-keyword">if</span> ox-chameleon--p
        (<span class="org-keyword">let</span> ((engrave-faces-preset-styles (engrave-faces-generate-preset)))
          (concat (funcall orig-fn info template snippet?)
                  (ox-chameleon-generate-colourings)))
      (funcall orig-fn info template snippet?)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">ox-chameleon-generate-colourings</span> ()
    (apply #'format
           <span class="org-string">"%% make document follow Emacs theme</span>
<span class="org-string">\\definecolor{bg}{HTML}{%s}</span>
<span class="org-string">\\definecolor{fg}{HTML}{%s}</span>

<span class="org-string">\\definecolor{red}{HTML}{%s}</span>
<span class="org-string">\\definecolor{orange}{HTML}{%s}</span>
<span class="org-string">\\definecolor{green}{HTML}{%s}</span>
<span class="org-string">\\definecolor{teal}{HTML}{%s}</span>
<span class="org-string">\\definecolor{yellow}{HTML}{%s}</span>
<span class="org-string">\\definecolor{blue}{HTML}{%s}</span>
<span class="org-string">\\definecolor{dark-blue}{HTML}{%s}</span>
<span class="org-string">\\definecolor{magenta}{HTML}{%s}</span>
<span class="org-string">\\definecolor{violet}{HTML}{%s}</span>
<span class="org-string">\\definecolor{cyan}{HTML}{%s}</span>
<span class="org-string">\\definecolor{dark-cyan}{HTML}{%s}</span>

<span class="org-string">\\definecolor{documentTitle}{HTML}{%s}</span>
<span class="org-string">\\definecolor{documentInfo}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level1}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level2}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level3}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level4}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level5}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level6}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level7}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level8}{HTML}{%s}</span>

<span class="org-string">\\definecolor{link}{HTML}{%s}</span>
<span class="org-string">\\definecolor{cite}{HTML}{%s}</span>
<span class="org-string">\\definecolor{itemlabel}{HTML}{%s}</span>
<span class="org-string">\\definecolor{code}{HTML}{%s}</span>
<span class="org-string">\\definecolor{verbatim}{HTML}{%s}</span>

<span class="org-string">\\definecolor{codebackground}{HTML}{%s}</span>
<span class="org-string">\\colorlet{EFD}{fg}</span>
<span class="org-string">\\definecolor{codeborder}{HTML}{%s}</span>

<span class="org-string">\\pagecolor{bg}</span>
<span class="org-string">\\color{fg}</span>

<span class="org-string">\\addtokomafont{title}{\\color{documentTitle}}</span>
<span class="org-string">\\addtokomafont{author}{\\color{documentInfo}}</span>
<span class="org-string">\\addtokomafont{date}{\\color{documentInfo}}</span>
<span class="org-string">\\addtokomafont{section}{\\color{level1}}</span>
<span class="org-string">\\newkomafont{sectionprefix}{\\color{level1}}</span>
<span class="org-string">\\addtokomafont{subsection}{\\color{level2}}</span>
<span class="org-string">\\newkomafont{subsectionprefix}{\\color{level2}}</span>
<span class="org-string">\\addtokomafont{subsubsection}{\\color{level3}}</span>
<span class="org-string">\\newkomafont{subsubsectionprefix}{\\color{level3}}</span>
<span class="org-string">\\addtokomafont{paragraph}{\\color{level4}}</span>
<span class="org-string">\\newkomafont{paragraphprefix}{\\color{level4}}</span>
<span class="org-string">\\addtokomafont{subparagraph}{\\color{level5}}</span>
<span class="org-string">\\newkomafont{subparagraphprefix}{\\color{level5}}</span>

<span class="org-string">\\renewcommand{\\labelitemi}{\\textcolor{itemlabel}{\\textbullet}}</span>
<span class="org-string">\\renewcommand{\\labelitemii}{\\textcolor{itemlabel}{\\normalfont\\bfseries \\textendash}}</span>
<span class="org-string">\\renewcommand{\\labelitemiii}{\\textcolor{itemlabel}{\\textasteriskcentered}}</span>
<span class="org-string">\\renewcommand{\\labelitemiv}{\\textcolor{itemlabel}{\\textperiodcentered}}</span>

<span class="org-string">\\renewcommand{\\labelenumi}{\\textcolor{itemlabel}{\\theenumi.}}</span>
<span class="org-string">\\renewcommand{\\labelenumii}{\\textcolor{itemlabel}{(\\theenumii)}}</span>
<span class="org-string">\\renewcommand{\\labelenumiii}{\\textcolor{itemlabel}{\\theenumiii.}}</span>
<span class="org-string">\\renewcommand{\\labelenumiv}{\\textcolor{itemlabel}{\\theenumiv.}}</span>

<span class="org-string">\\DeclareTextFontCommand{\\texttt}{\\color{code}\\ttfamily}</span>
<span class="org-string">\\makeatletter</span>
<span class="org-string">\\def\\verbatim@font{\\color{verbatim}\\normalfont\\ttfamily}</span>
<span class="org-string">\\makeatother</span>
<span class="org-string">%% end customisations</span>
<span class="org-string">"</span>
           (mapcar (doom-rpartial #'substring <span class="org-highlight-numbers-number">1</span>)
                   (list
                    (face-attribute 'solaire-default-face <span class="org-builtin">:background</span>)
                    (face-attribute 'default <span class="org-builtin">:foreground</span>)
                    <span class="org-comment-delimiter">;;</span>
                    (doom-color 'red)
                    (doom-color 'orange)
                    (doom-color 'green)
                    (doom-color 'teal)
                    (doom-color 'yellow)
                    (doom-color 'blue)
                    (doom-color 'dark-blue)
                    (doom-color 'magenta)
                    (doom-color 'violet)
                    (doom-color 'cyan)
                    (doom-color 'dark-cyan)
                    <span class="org-comment-delimiter">;;</span>
                    (face-attribute 'org-document-title <span class="org-builtin">:foreground</span>)
                    (face-attribute 'org-document-info <span class="org-builtin">:foreground</span>)
                    (face-attribute 'outline-1 <span class="org-builtin">:foreground</span>)
                    (face-attribute 'outline-2 <span class="org-builtin">:foreground</span>)
                    (face-attribute 'outline-3 <span class="org-builtin">:foreground</span>)
                    (face-attribute 'outline-4 <span class="org-builtin">:foreground</span>)
                    (face-attribute 'outline-5 <span class="org-builtin">:foreground</span>)
                    (face-attribute 'outline-6 <span class="org-builtin">:foreground</span>)
                    (face-attribute 'outline-7 <span class="org-builtin">:foreground</span>)
                    (face-attribute 'outline-8 <span class="org-builtin">:foreground</span>)
                    <span class="org-comment-delimiter">;;</span>
                    (face-attribute 'link <span class="org-builtin">:foreground</span>)
                    (<span class="org-keyword">or</span> (face-attribute 'org-ref-cite-face <span class="org-builtin">:foreground</span>) (doom-color 'yellow))
                    (face-attribute 'org-list-dt <span class="org-builtin">:foreground</span>)
                    (face-attribute 'org-code <span class="org-builtin">:foreground</span>)
                    (face-attribute 'org-verbatim <span class="org-builtin">:foreground</span>)
                    <span class="org-comment-delimiter">;;</span>
                    (face-attribute 'default <span class="org-builtin">:background</span>)
                    (doom-blend (face-attribute 'default <span class="org-builtin">:background</span>)
                                (face-attribute 'default <span class="org-builtin">:foreground</span>)
                                <span class="org-highlight-numbers-number">0.95</span>))))))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-latex-export-make" class="outline-5">
<h5 id="latex-export-make"><span class="section-number-5">6.3.6.15</span> Make verbatim different to code<a aria-hidden="true" href="#latex-export-make">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-15">
<p>
Since have just gone to so much effort above let&rsquo;s make the most of it by making
<kbd>verbatim</kbd> use <code>verb</code> instead of <code>protectedtexttt</code> (default).
</p>

<p>
This gives the same advantages as mentioned in the <a href="#make-verbatim-different"><span class='acr'>HTML</span> export section</a>.
</p>

<details id='make-verbatim-different,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#make-verbatim-different,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-latex-text-markup-alist
      '((bold . <span class="org-string">"\\textbf{%s}"</span>)
        (code . protectedtexttt)
        (italic . <span class="org-string">"\\emph{%s}"</span>)
        (strike-through . <span class="org-string">"\\sout{%s}"</span>)
        (underline . <span class="org-string">"\\uline{%s}"</span>)
        (verbatim . verb)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-no-auctex-please" class="outline-5">
<h5 id="no-auctex-please"><span class="section-number-5">6.3.6.16</span> No AucTeX please<a aria-hidden="true" href="#no-auctex-please">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-16">
<p>
For some reason, the way that <code>org-export-to-file</code> works, I find that <kbd>latex-mode</kbd>
is called on the produced buffer prior to saving. This has two undesirable
side-effects:
</p>
<ul class="org-ul">
<li>I get unwanted warnings from AuxTeX</li>
<li>A spurious <kbd>.auctex-auto</kbd> folder is produced.</li>
</ul>

<p>
There are a few ways I could try to avoid this, but the most obvious to me is
locally binding <code>auto-mode-alist</code> to <code>nil</code>.
</p>
<details id='no-auctex-please,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#no-auctex-please,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> no-auto-mode-alist (orig-fn <span class="org-type">&amp;rest</span> args)
  <span class="org-doc">"Wrap ORIG-FN in a let-binding that sets `</span><span class="org-doc"><span class="org-constant">auto-mode-alist</span></span><span class="org-doc">' to nil."</span>
  <span class="org-builtin">:around</span> #'org-export-to-file
  (<span class="org-keyword">let</span> ((auto-mode-alist nil))
    (apply orig-fn args)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-check-required-packages" class="outline-5">
<h5 id="check-required-packages"><span class="section-number-5">6.3.6.17</span> Check for required packages<a aria-hidden="true" href="#check-required-packages">#</a> </h5>
<div class="outline-text-5" id="text-6-3-6-17">
<p>
For how I&rsquo;ve setup Org&rsquo;s LaTeX export, the following packages are needed:
</p>
<ul class="org-ul">
<li>adjustbox</li>
<li>arev</li>
<li>amsmath</li>
<li>booktabs</li>
<li>cancel</li>
<li>capt-of</li>
<li>caption</li>
<li>cleveref</li>
<li>embedall</li>
<li>fourier</li>
<li>fvextra</li>
<li>gillius</li>
<li>graphicx</li>
<li>hyperref</li>
<li>mathalpha</li>
<li>mathtools</li>
<li>microtype</li>
<li>pdfx</li>
<li>pifont</li>
<li>preview</li>
<li>siunitx</li>
<li>soul</li>
<li>subcaption</li>
<li>svg</li>
<li>tcolorbox</li>
<li>xcolor</li>
<li>xparse</li>
</ul>

<p>
Then for the various fontsets:
</p>
<ul class="org-ul">
<li>Alegreya</li>
<li>biolinum</li>
<li>FiraMono</li>
<li>FiraSans</li>
<li>kpfonts</li>
<li>libertine</li>
<li>newpxmath</li>
<li>newpxtext</li>
<li>newtxmath</li>
<li>newtxtext</li>
<li>newtxsf</li>
<li>noto</li>
<li>plex-mono</li>
<li>plex-sans</li>
<li>plex-serif</li>
<li>sourcecodepro</li>
<li>sourcesanspro</li>
<li>sourceserifpro</li>
</ul>

<p>
We can write a function which will check for each of these packages with
<kbd>kpsewhich</kbd>, and then if any of them are missing we&rsquo;ll inject some advice into the
generated config that gets a list of missing packages and warns us every time we
export to a <span class='acr'>PDF</span>.
</p>

<details id='org-missing-latex' class='code' open><summary class='named'><span class="name">org-missing-latex-packages</span><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-missing-latex'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-required-latex-packages (append (mapcar #'car org-latex-required-packages-list)
                                          (mapcar #'car org-latex-font-packages-list)))

(<span class="org-keyword">defun</span> <span class="org-function-name">check-for-latex-packages</span> (packages)
  (delq nil (mapcar (<span class="org-keyword">lambda</span> (package)
                      (<span class="org-keyword">unless</span>
                          (= <span class="org-highlight-numbers-number">0</span> (shell-command (format <span class="org-string">"kpsewhich %s.sty"</span> package)))
                        package))
                    packages)))

(<span class="org-keyword">if-let</span> ((missing-pkgs (check-for-latex-packages org-required-latex-packages)))
    (concat
     (pp-to-string `(<span class="org-keyword">setq</span> org-required-latex-packages ',org-required-latex-packages))
     (message <span class="org-string">";; Detected missing LaTeX packages: %s\n"</span> (mapconcat #'identity missing-pkgs <span class="org-string">", "</span>))
     (pp-to-string
      '(<span class="org-keyword">defun</span> <span class="org-function-name">check-for-latex-packages</span> (packages)
         (delq nil (mapcar (<span class="org-keyword">lambda</span> (package)
                             (<span class="org-keyword">unless</span>
                                 (= <span class="org-highlight-numbers-number">0</span> (shell-command (format <span class="org-string">"kpsewhich %s.sty"</span> package)))
                               package))
                           packages))))
     (pp-to-string
      '(<span class="org-keyword">defun</span> <span class="org-function-name">+org-warn-about-missing-latex-packages</span> (<span class="org-type">&amp;rest</span> _)
         (message <span class="org-string">"Checking for missing LaTeX packages..."</span>)
         (sleep-for <span class="org-highlight-numbers-number">0.4</span>)
         (<span class="org-keyword">if-let</span> (missing-pkgs (check-for-latex-packages org-required-latex-packages))
             (message <span class="org-string">"%s You are missing the following LaTeX packages: %s."</span>
                      (propertize <span class="org-string">"Warning!"</span> 'face '(bold warning))
                      (mapconcat (<span class="org-keyword">lambda</span> (pkg) (propertize pkg 'face 'font-lock-variable-name-face))
                                 missing-pkgs
                                 <span class="org-string">", "</span>))
           (message <span class="org-string">"%s You have all the required LaTeX packages. Run %s to make this message go away."</span>
                    (propertize <span class="org-string">"Success!"</span> 'face '(bold success))
                    (propertize <span class="org-string">"doom sync"</span> 'face 'font-lock-keyword-face))
           (advice-remove 'org-latex-export-to-pdf #'+org-warn-about-missing-latex-packages))
         (sleep-for <span class="org-highlight-numbers-number">1</span>)))
     (pp-to-string
      '(advice-add 'org-latex-export-to-pdf <span class="org-builtin">:before</span> #'+org-warn-about-missing-latex-packages)))
  <span class="org-string">";; No missing LaTeX packags detected"</span>)
</pre>
</div>
    </details>

<details id='check-required-packages,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#check-required-packages,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">&lt;&lt;org-missing-latex-packages()&gt;&gt;
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-beamer-export" class="outline-4">
<h4 id="beamer-export"><span class="section-number-4">6.3.7</span> Beamer Export<a aria-hidden="true" href="#beamer-export">#</a> </h4>
<div class="outline-text-4" id="text-6-3-7">
<p>
It&rsquo;s nice to use a different theme
</p>
<details id='beamer-export,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#beamer-export,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-beamer-theme <span class="org-string">"[progressbar=foot]metropolis"</span>)
</pre>
</div>
    </details>

<details id='beamer-export,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#beamer-export,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-beamer-p</span> (info)
  (eq 'beamer (<span class="org-keyword">and</span> (plist-get info <span class="org-builtin">:back-end</span>) (org-export-backend-name (plist-get info <span class="org-builtin">:back-end</span>)))))

(add-to-list 'org-latex-conditional-features '(org-beamer-p . beamer) t)
(add-to-list 'org-latex-feature-implementations '(beamer <span class="org-builtin">:requires</span> .missing-koma <span class="org-builtin">:prevents</span> (italic-quotes condensed-lists)) t)
(add-to-list 'org-latex-feature-implementations '(.missing-koma <span class="org-builtin">:snippet</span> <span class="org-string">"\\usepackage{scrextend}"</span> <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">3</span>) t)
</pre>
</div>
    </details>

<p>
And I think that it&rsquo;s natural to divide a presentation into sections, e.g.
Introduction, Overview&#x2026; so let&rsquo;s set bump up the headline level that becomes a
frame from <code>1</code> to <code>2</code>.
</p>
<details id='beamer-export,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#beamer-export,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-beamer-frame-level <span class="org-highlight-numbers-number">2</span>)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-reveal-export" class="outline-4">
<h4 id="reveal-export"><span class="section-number-4">6.3.8</span> Reveal export<a aria-hidden="true" href="#reveal-export">#</a> </h4>
<div class="outline-text-4" id="text-6-3-8">
<p>
By default reveal is rather nice, there are just a few tweaks that I consider a
good idea.
</p>

<details id='reveal-export,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#reveal-export,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-re-reveal-theme <span class="org-string">"white"</span>
      org-re-reveal-transition <span class="org-string">"slide"</span>
      org-re-reveal-plugins '(markdown notes math search zoom))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-ascii-export" class="outline-4">
<h4 id="ascii-export"><span class="section-number-4">6.3.9</span> <span class='acr'><span class='acr'>ASCII</span></span> export<a aria-hidden="true" href="#ascii-export">#</a> </h4>
<div class="outline-text-4" id="text-6-3-9">
<p>
To start with, why settle for <span class='acr'>ASCII</span> when <span class='acr'>UTF</span>-8 exists?
</p>
<details id='ascii-export,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ascii-export,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-ascii-charset 'utf-8)
</pre>
</div>
    </details>

<p>
The <span class='acr'>ASCII</span> export is generally fairly nice. I think the main aspect that could
benefit from improvement is the appearance of LaTeX fragments. There&rsquo;s a nice
utility we can use to create unicode representation, which are much nicer.
It&rsquo;s called <code>latex2text</code>, and it&rsquo;s part of the <kbd>pylatexenc</kbd> package, and it&rsquo;s <a href="https://repology.org/project/python:pylatexenc/versions">not
really packaged</a>. So, we&rsquo;ll resort to installing it with <kbd>pip</kbd>.
</p>

<details id='ascii-export,code--2' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#ascii-export,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-type">sudo</span> python3 -m pip install pylatexenc
</pre>
</div>
    </details>

<p>
With that installed, we can override the <code class="src src-elisp">(org-ascii-latex-fragment)</code> and
<code class="src src-elisp">(org-ascii-latex-environment)</code> functions, which are conveniently very
slim &#x2014; just extracting the content, and indenting. We&rsquo;ll only do something
different when <kbd>utf-8</kbd> is set.
</p>

<details id='ascii-export,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ascii-export,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> ox-ascii
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">org-ascii-convert-latex</span> t
    <span class="org-doc">"Use latex2text to convert LaTeX elements to unicode."</span>)

  (<span class="org-keyword">defadvice!</span> org-ascii-latex-environment-unicode-a (latex-environment _contents info)
    <span class="org-doc">"Transcode a LATEX-ENVIRONMENT element from Org to ASCII, converting to unicode.</span>
<span class="org-doc">CONTENTS is nil.  INFO is a plist holding contextual</span>
<span class="org-doc">information."</span>
    <span class="org-builtin">:override</span> #'org-ascii-latex-environment
    (<span class="org-keyword">when</span> (plist-get info <span class="org-builtin">:with-latex</span>)
      (org-ascii--justify-element
       (org-remove-indentation
        (<span class="org-keyword">let*</span> ((latex (org-element-property <span class="org-builtin">:value</span> latex-environment))
               (unicode (<span class="org-keyword">and</span> (eq (plist-get info <span class="org-builtin">:ascii-charset</span>) 'utf-8)
                             org-ascii-convert-latex
                             (doom-call-process <span class="org-string">"latex2text"</span> <span class="org-string">"-q"</span> <span class="org-string">"--code"</span> latex))))
          (<span class="org-keyword">if</span> (= (car unicode) <span class="org-highlight-numbers-number">0</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">utf-8 set, and sucessfully ran latex2text</span>
              (cdr unicode) latex)))
       latex-environment info)))

  (<span class="org-keyword">defadvice!</span> org-ascii-latex-fragment-unicode-a (latex-fragment _contents info)
    <span class="org-doc">"Transcode a LATEX-FRAGMENT object from Org to ASCII, converting to unicode.</span>
<span class="org-doc">CONTENTS is nil.  INFO is a plist holding contextual</span>
<span class="org-doc">information."</span>
    <span class="org-builtin">:override</span> #'org-ascii-latex-fragment
    (<span class="org-keyword">when</span> (plist-get info <span class="org-builtin">:with-latex</span>)
      (<span class="org-keyword">let*</span> ((latex (org-element-property <span class="org-builtin">:value</span> latex-fragment))
             (unicode (<span class="org-keyword">and</span> (eq (plist-get info <span class="org-builtin">:ascii-charset</span>) 'utf-8)
                           org-ascii-convert-latex
                             (doom-call-process <span class="org-string">"latex2text"</span> <span class="org-string">"-q"</span> <span class="org-string">"--code"</span> latex))))
        (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> unicode (= (car unicode) <span class="org-highlight-numbers-number">0</span>)) <span class="org-comment-delimiter">; </span><span class="org-comment">utf-8 set, and sucessfully ran latex2text</span>
            (cdr unicode) latex)))))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-markdown-export" class="outline-4">
<h4 id="markdown-export"><span class="section-number-4">6.3.10</span> Markdown Export<a aria-hidden="true" href="#markdown-export">#</a> </h4>
<div class="outline-text-4" id="text-6-3-10">
<p>
When I want to paste exported markdown somewhere (for example when using <a href="#package-configuration-emacs">Emacs
Everywhere</a>), it can be preferable to have unicode characters for <kbd>---</kbd> etc. instead
of <kbd>&amp;#x2014;</kbd>.
</p>

<p>
To accomplish this, we just need to locally rebind the alist which provides
these substitution.
</p>

<details id='markdown-export,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#markdown-export,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> org-md-plain-text-unicode-a (orig-fn text info)
  <span class="org-doc">"Locally rebind `</span><span class="org-doc"><span class="org-constant">org-html-special-string-regexps</span></span><span class="org-doc">'"</span>
  <span class="org-builtin">:around</span> #'org-md-plain-text
  (<span class="org-keyword">let</span> ((org-html-special-string-regexps
         '((<span class="org-string">"\\\\-"</span> . <span class="org-string">"-"</span>)
           (<span class="org-string">"---</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">-]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">$</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> . <span class="org-string">"&#8212;\\1"</span>)
           (<span class="org-string">"--</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">-]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">$</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> . <span class="org-string">"&#8211;\\1"</span>)
           (<span class="org-string">"\\.\\.\\."</span> . <span class="org-string">"&#8230;"</span>)
           (<span class="org-string">"-&gt;"</span> . <span class="org-string">"&#8594;"</span>)
           (<span class="org-string">"&lt;-"</span> . <span class="org-string">"&#8592;"</span>))))
    (funcall orig-fn text (plist-put info <span class="org-builtin">:with-smart-quotes</span> nil))))
</pre>
</div>
    </details>

<p>
In the future, I may want to check <kbd>info</kbd> to only have this active when <kbd>ox-gfm</kbd> is
being used.
</p>

<p>
Another worthwhile consideration is LaTeX formatting. It seems most Markdown
parsers are fixated on TeX-style syntax (<kbd>$</kbd> and <kbd>$$</kbd>). As unfortunate as this is,
it&rsquo;s probably best to accommodate them, for the sake of decent rendering.
</p>

<p>
<kbd>ox-md</kbd> doesn&rsquo;t provide any transcoders for this, so we&rsquo;ll have to whip up our own
and push them onto the <kbd>md</kbd> transcoders alist.
</p>

<details id='markdown-export,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#markdown-export,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> ox-md
  (<span class="org-keyword">defun</span> <span class="org-function-name">org-md-latex-fragment</span> (latex-fragment _contents info)
    <span class="org-doc">"Transcode a LATEX-FRAGMENT object from Org to Markdown."</span>
    (<span class="org-keyword">let</span> ((frag (org-element-property <span class="org-builtin">:value</span> latex-fragment)))
      (<span class="org-keyword">cond</span>
       ((string-match-p <span class="org-string">"^\\\\("</span> frag)
        (concat <span class="org-string">"$"</span> (substring frag <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">-2</span>) <span class="org-string">"$"</span>))
       ((string-match-p <span class="org-string">"^\\\\\\["</span> frag)
        (concat <span class="org-string">"$$"</span> (substring frag <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">-2</span>) <span class="org-string">"$$"</span>))
       (t (message <span class="org-string">"unrecognised fragment: %s"</span> frag)
          frag))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-md-latex-environment</span> (latex-environment contents info)
    <span class="org-doc">"Transcode a LATEX-ENVIRONMENT object from Org to Markdown."</span>
    (concat <span class="org-string">"$$\n"</span>
            (org-html-latex-environment latex-environment contents info)
            <span class="org-string">"$$\n"</span>))

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-utf8-entity</span> (entity _contents _info)
    <span class="org-doc">"Transcode an ENTITY object from Org to utf-8.</span>
<span class="org-doc">CONTENTS are the definition itself.  INFO is a plist holding</span>
<span class="org-doc">contextual information."</span>
    (org-element-property <span class="org-builtin">:utf-8</span> entity))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">We can't let this be immediately parsed and evaluated,</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">because eager macro-expansion tries to call as-of-yet</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">undefined functions.</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-bold"><span class="org-success">NOTE</span></span></span><span class="org-comment"> in the near future this shouldn't be required</span>
  (eval
   '(dolist (extra-transcoder
             '((latex-fragment . org-md-latex-fragment)
               (latex-environment . org-md-latex-environment)
               (entity . org-utf8-entity)))
      (<span class="org-keyword">unless</span> (member extra-transcoder (org-export-backend-transcoders
                                        (org-export-get-backend 'md)))
        (<span class="org-keyword">push</span> extra-transcoder (org-export-backend-transcoders
                                (org-export-get-backend 'md)))))))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-babel" class="outline-4">
<h4 id="babel"><span class="section-number-4">6.3.11</span> Babel<a aria-hidden="true" href="#babel">#</a> </h4>
<div class="outline-text-4" id="text-6-3-11">
<p>
Doom lazy-loads babel languages, with is lovely.
It also pulls in <a href="https://github.com/astahlman/ob-async">ob-async</a>, which is nice, but it would be even better if it was
used by default.
</p>

<p>
There are two caveats to <kbd>ob-async</kbd>:
</p>
<ol class="org-ol">
<li>It does not support <kbd>:session</kbd>
<ul class="org-ul">
<li>So, we don&rsquo;t want <kbd>:async</kbd> used when <kbd>:session</kbd> is set</li>
</ul></li>
<li>It adds a fixed delay to execution
<ul class="org-ul">
<li>This is undesirable in a number of cases, for example it&rsquo;s generally
unwanted with <kbd>emacs-lisp</kbd> code</li>
<li>As such, I also introduce a async language blacklist to control when it&rsquo;s
automatically enabled</li>
</ul></li>
</ol>

<p>
Due to the nuance in the desired behaviour, instead of just adding <kbd>:async</kbd> to
<code>org-babel-default-header-args</code>, I advice <code>org-babel-get-src-block-info</code> to add
<kbd>:async</kbd> intelligently. As an escape hatch, it also recognises <kbd>:sync</kbd> as an
indication that <kbd>:async</kbd> should not be added.
</p>

<p>
I did originally have this enabled for everything except for <kbd>emacs-lisp</kbd> and
<kbd>LaTeX</kbd> (there were weird issues), but this added  a ~3s &ldquo;startup&rdquo; cost to every
src block evaluation, which was a bit of a pain. Since <kbd>:async</kbd> can be added
easily with <kbd>#+properties</kbd>, I&rsquo;ve turned this behaviour from a blacklist to a
whitelist.
</p>

<details id='babel,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#babel,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">add-transient-hook!</span> #'org-babel-execute-src-block
  (<span class="org-keyword">require</span> '<span class="org-constant">ob-async</span>))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-babel-auto-async-languages</span> '()
  <span class="org-doc">"Babel languages which should be executed asyncronously by default."</span>)

(<span class="org-keyword">defadvice!</span> org-babel-get-src-block-info-eager-async-a (orig-fn <span class="org-type">&amp;optional</span> light datum)
  <span class="org-doc">"Eagarly add an :async parameter to the src information, unless it seems problematic.</span>
<span class="org-doc">This only acts o languages in `</span><span class="org-doc"><span class="org-constant">org-babel-auto-async-languages</span></span><span class="org-doc">'.</span>
<span class="org-doc">Not added when either:</span>
<span class="org-doc">+ session is not \"none\"</span>
<span class="org-doc">+ :sync is set"</span>
  <span class="org-builtin">:around</span> #'org-babel-get-src-block-info
  (<span class="org-keyword">let</span> ((result (funcall orig-fn light datum)))
    (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (string= <span class="org-string">"none"</span> (cdr (assoc <span class="org-builtin">:session</span> (caddr result))))
               (member (car result) org-babel-auto-async-languages)
               (not (assoc <span class="org-builtin">:async</span> (caddr result))) <span class="org-comment-delimiter">; </span><span class="org-comment">don't duplicate</span>
               (not (assoc <span class="org-builtin">:sync</span> (caddr result))))
      (<span class="org-keyword">push</span> '(<span class="org-builtin">:async</span>) (caddr result)))
    result))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-org-ess" class="outline-4">
<h4 id="org-ess"><span class="section-number-4">6.3.12</span> <span class='acr'><span class='acr'>ESS</span></span><a aria-hidden="true" href="#org-ess">#</a> </h4>
<div class="outline-text-4" id="text-6-3-12">
<p>
We don&rsquo;t want <code>R</code> evaluation to hang the editor, hence
</p>
<details id='ess,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ess,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> ess-eval-visibly 'nowait)
</pre>
</div>
    </details>

<p>
Syntax highlighting is nice, so let&rsquo;s turn all of that on
</p>
<details id='ess,code--4' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ess,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> ess-R-font-lock-keywords
      '((ess-R-fl-keyword:keywords . t)
        (ess-R-fl-keyword:constants . t)
        (ess-R-fl-keyword:modifiers . t)
        (ess-R-fl-keyword:fun-defs . t)
        (ess-R-fl-keyword:assign-ops . t)
        (ess-R-fl-keyword:%op% . t)
        (ess-fl-keyword:fun-calls . t)
        (ess-fl-keyword:numbers . t)
        (ess-fl-keyword:operators . t)
        (ess-fl-keyword:delimiters . t)
        (ess-fl-keyword:= . t)
        (ess-R-fl-keyword:F&amp;T . t)))
</pre>
</div>
    </details>

<p>
Lastly, in the event that I use <kbd>JAGS</kbd>, it would be nice to be able to use <kbd>jags</kbd> as
the language identifier, not <kbd>ess-jags</kbd>.
</p>
<details id='ess,code--5' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ess,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list '+org-babel-mode-alist '(jags . ess-jags))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-language-configuration-latex" class="outline-3">
<h3 id="language-configuration-latex"><span class="section-number-3">6.4</span> LaTeX<a aria-hidden="true" href="#language-configuration-latex">#</a> </h3>
<div class="outline-text-3" id="text-6-4">
<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/file_extensions.png' title="I have never been lied to by data in a .txt file which has been hand-aligned." alt='File Extensions'>
</p>
</div>
<div id="outline-container-be-implemented-ideas" class="outline-4">
<h4 id="be-implemented-ideas"><span class="section-number-4">6.4.1</span> To-be-implemented ideas<a aria-hidden="true" href="#be-implemented-ideas">#</a> </h4>
<div class="outline-text-4" id="text-6-4-1">
<ul class="org-ul">
<li><p>
Paste image from clipboard
</p>
<ul class="org-ul">
<li>Determine first folder in <code>graphicspath</code> if applicable</li>
<li>Ask for file name</li>
<li>Use <code>xclip</code> to save file to graphics folder, or current directory (whichever applies)</li>
</ul>
<details id=',code--3' class='code' open><summary><span class="lang">Shell Script</span></summary>
    <div class='gutter'>
    <a href='#,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">command</span> -v xclip &gt;/dev/null <span class="org-highlight-numbers-number">2</span>&gt;&amp;<span class="org-highlight-numbers-number">1</span> || <span class="org-rainbow-delimiters-depth-1">{</span> <span class="org-type">echo</span> &gt;&amp;<span class="org-highlight-numbers-number">1</span> <span class="org-string">"no xclip"</span>; <span class="org-keyword">exit</span> <span class="org-highlight-numbers-number">1</span>; <span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-keyword">if</span>
    xclip -selection clipboard -target image/png -o &gt;/dev/null <span class="org-highlight-numbers-number">2</span>&gt;&amp;<span class="org-highlight-numbers-number">1</span>
<span class="org-keyword">then</span>
    xclip -selection clipboard -target image/png -o &gt;$<span class="org-highlight-numbers-number">1</span> <span class="org-highlight-numbers-number">2</span>&gt;/dev/null
    <span class="org-type">echo</span> $<span class="org-highlight-numbers-number">1</span>
<span class="org-keyword">else</span>
    <span class="org-type">echo</span> <span class="org-string">"no image"</span>
<span class="org-keyword">fi</span>
</pre>
</div>
    </details>
<ul class="org-ul">
<li>Insert figure, with filled in details as a result (activate <kbd>yasnippet</kbd> with
filename as variable maybe?)</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-compilation" class="outline-4">
<h4 id="compilation"><span class="section-number-4">6.4.2</span> Compilation<a aria-hidden="true" href="#compilation">#</a> </h4>
<div class="outline-text-4" id="text-6-4-2">
<details id='compilation,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#compilation,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> TeX-save-query nil
      TeX-show-compilation t
      TeX-command-extra-options <span class="org-string">"-shell-escape"</span>)
(<span class="org-keyword">after!</span> latex
  (add-to-list 'TeX-command-list '(<span class="org-string">"XeLaTeX"</span> <span class="org-string">"%`xelatex%(mode)%' %t"</span> TeX-run-TeX nil t)))
</pre>
</div>
    </details>

<p>
For viewing the <span class='acr'>PDF</span>, I rather like the pdf-tools viewer. While auctex is trying
to be nice in recognising that I have some <span class='acr'>PDF</span> viewing apps installed, I&rsquo;d
rather not have it default to using them, so let&rsquo;s re-order the preferences.
</p>
<details id='compilation,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#compilation,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> +latex-viewers '(pdf-tools evince zathura okular skim sumatrapdf))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-latex-snippet-helpers" class="outline-4">
<h4 id="latex-snippet-helpers"><span class="section-number-4">6.4.3</span> Snippet helpers<a aria-hidden="true" href="#latex-snippet-helpers">#</a> </h4>
<div class="outline-text-4" id="text-6-4-3">
</div>
<div id="outline-container-template" class="outline-5">
<h5 id="template"><span class="section-number-5">6.4.3.1</span> Template<a aria-hidden="true" href="#template">#</a> </h5>
<div class="outline-text-5" id="text-6-4-3-1">
<p>
For use in the new-file template, let&rsquo;s set out a nice preamble we may want to use.
Then let&rsquo;s bind the content to a function, and define some nice helpers.
</p>
<details id='template,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#template,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> tec/yas-latex-template-preamble <span class="org-string">"</span>
<span class="org-string">&lt;&lt;latex-nice-preamble&gt;&gt;</span>
<span class="org-string">"</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">tec/yas-latex-get-class-choice</span> ()
  <span class="org-doc">"Prompt user for LaTeX class choice"</span>
  (<span class="org-keyword">setq</span> tec/yas-latex-class-choice (ivy-read <span class="org-string">"Select document class: "</span> '(<span class="org-string">"article"</span> <span class="org-string">"scrartcl"</span> <span class="org-string">"bmc"</span>) <span class="org-builtin">:def</span> <span class="org-string">"bmc"</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">tec/yas-latex-preamble-if</span> ()
  <span class="org-doc">"Based on class choice prompt for insertion of default preamble"</span>
  (<span class="org-keyword">if</span> (equal tec/yas-latex-class-choice <span class="org-string">"bmc"</span>) 'nil
    (eq (read-char-choice <span class="org-string">"Include default preamble? [Type y/n]"</span> '(?y ?n)) ?y)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-deliminators" class="outline-5">
<h5 id="deliminators"><span class="section-number-5">6.4.3.2</span> Deliminators<a aria-hidden="true" href="#deliminators">#</a> </h5>
<div class="outline-text-5" id="text-6-4-3-2">
<details id='deliminators,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#deliminators,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> tex
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">tec/tex-last-delim-char</span> nil
    <span class="org-doc">"Last open delim expanded in a tex document"</span>)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">tec/tex-delim-dot-second</span> t
    <span class="org-doc">"When the `</span><span class="org-doc"><span class="org-constant">tec/tex-last-delim-char</span></span><span class="org-doc">' is . a second character (this) is prompted for"</span>)
  (<span class="org-keyword">defun</span> <span class="org-function-name">tec/get-open-delim-char</span> ()
    <span class="org-doc">"Exclusivly read next char to tec/tex-last-delim-char"</span>
    (<span class="org-keyword">setq</span> tec/tex-delim-dot-second nil)
    (<span class="org-keyword">setq</span> tec/tex-last-delim-char (read-char-exclusive <span class="org-string">"Opening deliminator, recognises: 9 ( [ { &lt; | ."</span>))
    (<span class="org-keyword">when</span> (eql ?. tec/tex-last-delim-char)
      (<span class="org-keyword">setq</span> tec/tex-delim-dot-second (read-char-exclusive <span class="org-string">"Other deliminator, recognises: 0 9 (  ) [ ] { } &lt; &gt; |"</span>))))
  (<span class="org-keyword">defun</span> <span class="org-function-name">tec/tex-open-delim-from-char</span> (<span class="org-type">&amp;optional</span> open-char)
    <span class="org-doc">"Find the associated opening delim as string"</span>
    (<span class="org-keyword">unless</span> open-char (<span class="org-keyword">setq</span> open-char (<span class="org-keyword">if</span> (eql ?. tec/tex-last-delim-char)
                                          tec/tex-delim-dot-second
                                        tec/tex-last-delim-char)))
    (<span class="org-keyword">pcase</span> open-char
      (?\( <span class="org-string">"("</span>)
      (?9  <span class="org-string">"("</span>)
      (?\[ <span class="org-string">"["</span>)
      (?\{ <span class="org-string">"\\{"</span>)
      (?&lt;  <span class="org-string">"&lt;"</span>)
      (?|  (<span class="org-keyword">if</span> tec/tex-delim-dot-second <span class="org-string">"."</span> <span class="org-string">"|"</span>))
      (_   <span class="org-string">"."</span>)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">tec/tex-close-delim-from-char</span> (<span class="org-type">&amp;optional</span> open-char)
    <span class="org-doc">"Find the associated closing delim as string"</span>
    (<span class="org-keyword">if</span> tec/tex-delim-dot-second
        (<span class="org-keyword">pcase</span> tec/tex-delim-dot-second
          (?\) <span class="org-string">")"</span>)
          (?0  <span class="org-string">")"</span>)
          (?\] <span class="org-string">"]"</span>)
          (?\} <span class="org-string">"\\}"</span>)
          (?\&gt; <span class="org-string">"&gt;"</span>)
          (?|  <span class="org-string">"|"</span>)
          (_   <span class="org-string">"."</span>))
      (<span class="org-keyword">pcase</span> (<span class="org-keyword">or</span> open-char tec/tex-last-delim-char)
        (?\( <span class="org-string">")"</span>)
        (?9  <span class="org-string">")"</span>)
        (?\[ <span class="org-string">"]"</span>)
        (?\{ <span class="org-string">"\\}"</span>)
        (?&lt;  <span class="org-string">"&gt;"</span>)
        (?\) <span class="org-string">")"</span>)
        (?0  <span class="org-string">")"</span>)
        (?\] <span class="org-string">"]"</span>)
        (?\} <span class="org-string">"\\}"</span>)
        (?\&gt; <span class="org-string">"&gt;"</span>)
        (?|  <span class="org-string">"|"</span>)
        (_   <span class="org-string">"."</span>))))
  (<span class="org-keyword">defun</span> <span class="org-function-name">tec/tex-next-char-smart-close-delim</span> (<span class="org-type">&amp;optional</span> open-char)
    (<span class="org-keyword">and</span> (<span class="org-keyword">bound-and-true-p</span> smartparens-mode)
         (eql (char-after) (<span class="org-keyword">pcase</span> (<span class="org-keyword">or</span> open-char tec/tex-last-delim-char)
                             (?\( ?\))
                             (?\[ ?\])
                             (?{ ?})
                             (?&lt; ?&gt;)))))
  (<span class="org-keyword">defun</span> <span class="org-function-name">tec/tex-delim-yas-expand</span> (<span class="org-type">&amp;optional</span> open-char)
    (yas-expand-snippet (yas-lookup-snippet <span class="org-string">"_deliminators"</span> 'latex-mode) (point) (+ (point) (<span class="org-keyword">if</span> (tec/tex-next-char-smart-close-delim open-char) <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">1</span>)))))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-editor-visuals" class="outline-4">
<h4 id="editor-visuals"><span class="section-number-4">6.4.4</span> Editor visuals<a aria-hidden="true" href="#editor-visuals">#</a> </h4>
<div class="outline-text-4" id="text-6-4-4">
<p>
Let&rsquo;s enhance <code>TeX-fold-math</code> a bit
</p>
<details id='editor-visuals,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#editor-visuals,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> latex
  (setcar (assoc <span class="org-string">"&#8902;"</span> LaTeX-fold-math-spec-list) <span class="org-string">"&#9733;"</span>)) <span class="org-comment-delimiter">;; </span><span class="org-comment">make \star bigger</span>

(<span class="org-keyword">setq</span> TeX-fold-math-spec-list
      `(<span class="org-comment-delimiter">;; </span><span class="org-comment">missing/better symbols</span>
        (<span class="org-string">"&#8804;"</span> (<span class="org-string">"le"</span>))
        (<span class="org-string">"&#8805;"</span> (<span class="org-string">"ge"</span>))
        (<span class="org-string">"&#8800;"</span> (<span class="org-string">"ne"</span>))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">convenience shorts -- these don't work nicely ATM</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">("&#8249;" ("left"))</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">("&#8250;" ("right"))</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">private macros</span>
        (<span class="org-string">"&#8477;"</span> (<span class="org-string">"RR"</span>))
        (<span class="org-string">"&#8469;"</span> (<span class="org-string">"NN"</span>))
        (<span class="org-string">"&#8484;"</span> (<span class="org-string">"ZZ"</span>))
        (<span class="org-string">"&#8474;"</span> (<span class="org-string">"QQ"</span>))
        (<span class="org-string">"&#8450;"</span> (<span class="org-string">"CC"</span>))
        (<span class="org-string">"&#8473;"</span> (<span class="org-string">"PP"</span>))
        (<span class="org-string">"&#8461;"</span> (<span class="org-string">"HH"</span>))
        (<span class="org-string">"&#120124;"</span> (<span class="org-string">"EE"</span>))
        (<span class="org-string">"&#119889;"</span> (<span class="org-string">"dd"</span>))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">known commands</span>
        (<span class="org-string">""</span> (<span class="org-string">"phantom"</span>))
        (,(<span class="org-keyword">lambda</span> (num den) (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (TeX-string-single-token-p num) (TeX-string-single-token-p den))
                                (concat num <span class="org-string">"&#65295;"</span> den)
                              (concat <span class="org-string">"&#10090;"</span> num <span class="org-string">"&#65295;"</span> den <span class="org-string">"&#10091;"</span>))) (<span class="org-string">"frac"</span>))
        (,(<span class="org-keyword">lambda</span> (arg) (concat <span class="org-string">"&#8730;"</span> (TeX-fold-parenthesize-as-necessary arg))) (<span class="org-string">"sqrt"</span>))
        (,(<span class="org-keyword">lambda</span> (arg) (concat <span class="org-string">"&#11105;"</span> (TeX-fold-parenthesize-as-necessary arg))) (<span class="org-string">"vec"</span>))
        (<span class="org-string">"&#8216;</span><span class="org-string"><span class="org-constant">{1}</span></span><span class="org-string">&#8217;"</span> (<span class="org-string">"text"</span>))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">private commands</span>
        (<span class="org-string">"|{1}|"</span> (<span class="org-string">"abs"</span>))
        (<span class="org-string">"&#8214;{1}&#8214;"</span> (<span class="org-string">"norm"</span>))
        (<span class="org-string">"&#8970;{1}&#8971;"</span> (<span class="org-string">"floor"</span>))
        (<span class="org-string">"&#8968;{1}&#8969;"</span> (<span class="org-string">"ceil"</span>))
        (<span class="org-string">"&#8970;{1}&#8969;"</span> (<span class="org-string">"round"</span>))
        (<span class="org-string">"&#119889;{1}/&#119889;{2}"</span> (<span class="org-string">"dv"</span>))
        (<span class="org-string">"&#8706;{1}/&#8706;{2}"</span> (<span class="org-string">"pdv"</span>))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">fancification</span>
        (<span class="org-string">"{1}"</span> (<span class="org-string">"mathrm"</span>))
        (,(<span class="org-keyword">lambda</span> (word) (string-offset-roman-chars <span class="org-highlight-numbers-number">119743</span> word)) (<span class="org-string">"mathbf"</span>))
        (,(<span class="org-keyword">lambda</span> (word) (string-offset-roman-chars <span class="org-highlight-numbers-number">119951</span> word)) (<span class="org-string">"mathcal"</span>))
        (,(<span class="org-keyword">lambda</span> (word) (string-offset-roman-chars <span class="org-highlight-numbers-number">120003</span> word)) (<span class="org-string">"mathfrak"</span>))
        (,(<span class="org-keyword">lambda</span> (word) (string-offset-roman-chars <span class="org-highlight-numbers-number">120055</span> word)) (<span class="org-string">"mathbb"</span>))
        (,(<span class="org-keyword">lambda</span> (word) (string-offset-roman-chars <span class="org-highlight-numbers-number">120159</span> word)) (<span class="org-string">"mathsf"</span>))
        (,(<span class="org-keyword">lambda</span> (word) (string-offset-roman-chars <span class="org-highlight-numbers-number">120367</span> word)) (<span class="org-string">"mathtt"</span>))
        )
      TeX-fold-macro-spec-list
      '(
        <span class="org-comment-delimiter">;; </span><span class="org-comment">as the defaults</span>
        (<span class="org-string">"[f]"</span> (<span class="org-string">"footnote"</span> <span class="org-string">"marginpar"</span>))
        (<span class="org-string">"[c]"</span> (<span class="org-string">"cite"</span>))
        (<span class="org-string">"[l]"</span> (<span class="org-string">"label"</span>))
        (<span class="org-string">"[r]"</span> (<span class="org-string">"ref"</span> <span class="org-string">"pageref"</span> <span class="org-string">"eqref"</span>))
        (<span class="org-string">"[i]"</span> (<span class="org-string">"index"</span> <span class="org-string">"glossary"</span>))
        (<span class="org-string">"..."</span> (<span class="org-string">"dots"</span>))
        (<span class="org-string">"{1}"</span> (<span class="org-string">"emph"</span> <span class="org-string">"textit"</span> <span class="org-string">"textsl"</span> <span class="org-string">"textmd"</span> <span class="org-string">"textrm"</span> <span class="org-string">"textsf"</span> <span class="org-string">"texttt"</span>
                <span class="org-string">"textbf"</span> <span class="org-string">"textsc"</span> <span class="org-string">"textup"</span>))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">tweaked defaults</span>
        (<span class="org-string">"&#169;"</span> (<span class="org-string">"copyright"</span>))
        (<span class="org-string">"&#174;"</span> (<span class="org-string">"textregistered"</span>))
        (<span class="org-string">"&#8482;"</span>  (<span class="org-string">"texttrademark"</span>))
        (<span class="org-string">"[1]:||&#9658;"</span> (<span class="org-string">"item"</span>))
        (<span class="org-string">"&#10081;&#10081;&#8198;{1}"</span> (<span class="org-string">"part"</span> <span class="org-string">"part*"</span>))
        (<span class="org-string">"&#10081;&#8198;{1}"</span> (<span class="org-string">"chapter"</span> <span class="org-string">"chapter*"</span>))
        (<span class="org-string">"&#167;&#8198;{1}"</span> (<span class="org-string">"section"</span> <span class="org-string">"section*"</span>))
        (<span class="org-string">"&#167;&#167;&#8198;{1}"</span> (<span class="org-string">"subsection"</span> <span class="org-string">"subsection*"</span>))
        (<span class="org-string">"&#167;&#167;&#167;&#8198;{1}"</span> (<span class="org-string">"subsubsection"</span> <span class="org-string">"subsubsection*"</span>))
        (<span class="org-string">"&#182;&#8198;{1}"</span> (<span class="org-string">"paragraph"</span> <span class="org-string">"paragraph*"</span>))
        (<span class="org-string">"&#182;&#182;&#8198;{1}"</span> (<span class="org-string">"subparagraph"</span> <span class="org-string">"subparagraph*"</span>))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">extra</span>
        (<span class="org-string">"&#11030;&#8198;{1}"</span> (<span class="org-string">"begin"</span>))
        (<span class="org-string">"&#11031;&#8198;{1}"</span> (<span class="org-string">"end"</span>))
        ))

(<span class="org-keyword">defun</span> <span class="org-function-name">string-offset-roman-chars</span> (offset word)
  <span class="org-doc">"Shift the codepoint of each character in WORD by OFFSET with an extra -6 shift if the letter is lowercase"</span>
  (apply 'string
         (mapcar (<span class="org-keyword">lambda</span> (c)
                   (string-offset-apply-roman-char-exceptions
                    (+ (<span class="org-keyword">if</span> (&gt;= c <span class="org-highlight-numbers-number">97</span>) (- c <span class="org-highlight-numbers-number">6</span>) c) offset)))
                 word)))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">string-offset-roman-char-exceptions</span>
  '(<span class="org-comment-delimiter">;; </span><span class="org-comment">lowercase serif</span>
    (<span class="org-highlight-numbers-number">119892</span> .  <span class="org-highlight-numbers-number">8462</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8462;</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">lowercase caligraphic</span>
    (<span class="org-highlight-numbers-number">119994</span> . <span class="org-highlight-numbers-number">8495</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8495;</span>
    (<span class="org-highlight-numbers-number">119996</span> . <span class="org-highlight-numbers-number">8458</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8458;</span>
    (<span class="org-highlight-numbers-number">120004</span> . <span class="org-highlight-numbers-number">8500</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8500;</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">caligraphic</span>
    (<span class="org-highlight-numbers-number">119965</span> . <span class="org-highlight-numbers-number">8492</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8492;</span>
    (<span class="org-highlight-numbers-number">119968</span> . <span class="org-highlight-numbers-number">8496</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8496;</span>
    (<span class="org-highlight-numbers-number">119969</span> . <span class="org-highlight-numbers-number">8497</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8497;</span>
    (<span class="org-highlight-numbers-number">119971</span> . <span class="org-highlight-numbers-number">8459</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8459;</span>
    (<span class="org-highlight-numbers-number">119972</span> . <span class="org-highlight-numbers-number">8464</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8464;</span>
    (<span class="org-highlight-numbers-number">119975</span> . <span class="org-highlight-numbers-number">8466</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8466;</span>
    (<span class="org-highlight-numbers-number">119976</span> . <span class="org-highlight-numbers-number">8499</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8499;</span>
    (<span class="org-highlight-numbers-number">119981</span> . <span class="org-highlight-numbers-number">8475</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8475;</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">fraktur</span>
    (<span class="org-highlight-numbers-number">120070</span> . <span class="org-highlight-numbers-number">8493</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8493;</span>
    (<span class="org-highlight-numbers-number">120075</span> . <span class="org-highlight-numbers-number">8460</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8460;</span>
    (<span class="org-highlight-numbers-number">120076</span> . <span class="org-highlight-numbers-number">8465</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8465;</span>
    (<span class="org-highlight-numbers-number">120085</span> . <span class="org-highlight-numbers-number">8476</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8476;</span>
    (<span class="org-highlight-numbers-number">120092</span> . <span class="org-highlight-numbers-number">8488</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8488;</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">blackboard</span>
    (<span class="org-highlight-numbers-number">120122</span> . <span class="org-highlight-numbers-number">8450</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8450;</span>
    (<span class="org-highlight-numbers-number">120127</span> . <span class="org-highlight-numbers-number">8461</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8461;</span>
    (<span class="org-highlight-numbers-number">120133</span> . <span class="org-highlight-numbers-number">8469</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8469;</span>
    (<span class="org-highlight-numbers-number">120135</span> . <span class="org-highlight-numbers-number">8473</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8473;</span>
    (<span class="org-highlight-numbers-number">120136</span> . <span class="org-highlight-numbers-number">8474</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8474;</span>
    (<span class="org-highlight-numbers-number">120137</span> . <span class="org-highlight-numbers-number">8477</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8477;</span>
    (<span class="org-highlight-numbers-number">120145</span> . <span class="org-highlight-numbers-number">8484</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">&#8484;</span>
    )
  <span class="org-doc">"An alist of deceptive codepoints, and then where the glyph actually resides."</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">string-offset-apply-roman-char-exceptions</span> (char)
  <span class="org-doc">"Sometimes the codepoint doesn't contain the char you expect.</span>
<span class="org-doc">Such special cases should be remapped to another value, as given in `</span><span class="org-doc"><span class="org-constant">string-offset-roman-char-exceptions</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">if</span> (assoc char string-offset-roman-char-exceptions)
      (cdr (assoc char string-offset-roman-char-exceptions))
    char))

(<span class="org-keyword">defun</span> <span class="org-function-name">TeX-fold-parenthesize-as-necessary</span> (tokens <span class="org-type">&amp;optional</span> suppress-left suppress-right)
  <span class="org-doc">"Add &#10090; &#10091; parenthesis as if multiple LaTeX tokens appear to be present"</span>
  (<span class="org-keyword">if</span> (TeX-string-single-token-p tokens) tokens
    (concat (<span class="org-keyword">if</span> suppress-left <span class="org-string">""</span> <span class="org-string">"&#10090;"</span>)
            tokens
            (<span class="org-keyword">if</span> suppress-right <span class="org-string">""</span> <span class="org-string">"&#10091;"</span>))))

(<span class="org-keyword">defun</span> <span class="org-function-name">TeX-string-single-token-p</span> (teststring)
  <span class="org-doc">"Return t if TESTSTRING appears to be a single token, nil otherwise"</span>
  (<span class="org-keyword">if</span> (string-match-p <span class="org-string">"^\\\\?\\w+$"</span> teststring) t nil))
</pre>
</div>
    </details>

<p>
Some local keybindings to make life a bit easier
</p>
<details id='editor-visuals,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#editor-visuals,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> tex
  (<span class="org-keyword">map!</span>
   <span class="org-builtin">:map</span> LaTeX-mode-map
   <span class="org-builtin">:ei</span> [C-return] #'LaTeX-insert-item)
  (<span class="org-keyword">setq</span> TeX-electric-math '(<span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">"</span> . <span class="org-string">""</span>)))
</pre>
</div>
    </details>

<p>
Maths deliminators can be de-emphasised a bit
</p>
<details id='editor-visuals,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#editor-visuals,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Making \( \) less visible</span>
(<span class="org-keyword">defface</span> <span class="org-variable-name">unimportant-latex-face</span>
  '((t <span class="org-builtin">:inherit</span> font-lock-comment-face <span class="org-builtin">:weight</span> extra-light))
  <span class="org-doc">"Face used to make \\(\\), \\[</span><span class="org-doc"><span class="org-constant">\\</span></span><span class="org-doc">] less visible."</span>
  <span class="org-builtin">:group</span> 'LaTeX-math)

(font-lock-add-keywords
 'latex-mode
 `((,(<span class="org-keyword">rx</span> (<span class="org-keyword">and</span> <span class="org-string">"\\"</span> (any <span class="org-string">"()[]"</span>))) <span class="org-highlight-numbers-number">0</span> 'unimportant-latex-face prepend))
 'end)

(font-lock-add-keywords
 'latex-mode
 `((,<span class="org-string">"\\\\[[:word:]]+"</span> <span class="org-highlight-numbers-number">0</span> 'font-lock-keyword-face prepend))
 'end)
</pre>
</div>
    </details>

<p>
And enable shell escape for the preview
</p>
<details id='editor-visuals,code--4' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#editor-visuals,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> preview-LaTeX-command '(<span class="org-string">"%`%l \"\\nonstopmode\\nofiles\</span>
<span class="org-string">\\PassOptionsToPackage{"</span> (<span class="org-string">","</span> . preview-required-option-list) <span class="org-string">"}{preview}\</span>
<span class="org-string">\\AtBeginDocument{\\ifx\\ifPreview\\undefined"</span>
preview-default-preamble <span class="org-string">"\\fi}\"%' \"\\detokenize{\" %t \"}\""</span>))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-latex-cdlatex" class="outline-4">
<h4 id="latex-cdlatex"><span class="section-number-4">6.4.5</span> CDLaTeX<a aria-hidden="true" href="#latex-cdlatex">#</a> </h4>
<div class="outline-text-4" id="text-6-4-5">
<p>
The symbols and modifies are very nice by default, but could do with a bit of
fleshing out. Let&rsquo;s change the prefix to a key which is similarly rarely used,
but more convenient, like <kbd>;</kbd>.
</p>
<details id='cdlatex,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#cdlatex,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> cdlatex
  (<span class="org-keyword">setq</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">cdlatex-math-symbol-prefix ?\; ;; doesn't work at the moment :(</span>
   cdlatex-math-symbol-alist
   '( <span class="org-comment-delimiter">;; </span><span class="org-comment">adding missing functions to 3rd level symbols</span>
     (?_    (<span class="org-string">"\\downarrow"</span>  <span class="org-string">""</span>           <span class="org-string">"\\inf"</span>))
     (?2    (<span class="org-string">"^2"</span>           <span class="org-string">"\\sqrt{?}"</span>     <span class="org-string">""</span>     ))
     (?3    (<span class="org-string">"^3"</span>           <span class="org-string">"\\sqrt[3]{?}"</span>  <span class="org-string">""</span>     ))
     (?^    (<span class="org-string">"\\uparrow"</span>    <span class="org-string">""</span>           <span class="org-string">"\\sup"</span>))
     (?k    (<span class="org-string">"\\kappa"</span>      <span class="org-string">""</span>           <span class="org-string">"\\ker"</span>))
     (?m    (<span class="org-string">"\\mu"</span>         <span class="org-string">""</span>           <span class="org-string">"\\lim"</span>))
     (?c    (<span class="org-string">""</span>             <span class="org-string">"\\circ"</span>     <span class="org-string">"\\cos"</span>))
     (?d    (<span class="org-string">"\\delta"</span>      <span class="org-string">"\\partial"</span>  <span class="org-string">"\\dim"</span>))
     (?D    (<span class="org-string">"\\Delta"</span>      <span class="org-string">"\\nabla"</span>    <span class="org-string">"\\deg"</span>))
     <span class="org-comment-delimiter">;; </span><span class="org-comment">no idea why \Phi isnt on 'F' in first place, \phi is on 'f'.</span>
     (?F    (<span class="org-string">"\\Phi"</span>))
     <span class="org-comment-delimiter">;; </span><span class="org-comment">now just convenience</span>
     (?.    (<span class="org-string">"\\cdot"</span> <span class="org-string">"\\dots"</span>))
     (?:    (<span class="org-string">"\\vdots"</span> <span class="org-string">"\\ddots"</span>))
     (?*    (<span class="org-string">"\\times"</span> <span class="org-string">"\\star"</span> <span class="org-string">"\\ast"</span>)))
   cdlatex-math-modify-alist
   '( <span class="org-comment-delimiter">;; </span><span class="org-comment">my own stuff</span>
     (?B    <span class="org-string">"\\mathbb"</span>        nil          t    nil  nil)
     (?a    <span class="org-string">"\\abs"</span>           nil          t    nil  nil))))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-synctex" class="outline-4">
<h4 id="synctex"><span class="section-number-4">6.4.6</span> SyncTeX<a aria-hidden="true" href="#synctex">#</a> </h4>
<div class="outline-text-4" id="text-6-4-6">
<details id='synctex,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#synctex,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> tex
  (add-to-list 'TeX-view-program-list '(<span class="org-string">"Evince"</span> <span class="org-string">"evince %o"</span>))
  (add-to-list 'TeX-view-program-selection '(output-pdf <span class="org-string">"Evince"</span>)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-fixes" class="outline-4">
<h4 id="fixes"><span class="section-number-4">6.4.7</span> Fixes<a aria-hidden="true" href="#fixes">#</a> </h4>
<div class="outline-text-4" id="text-6-4-7">
<p>
In case of Emacs28,
</p>
<details id='fixes,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fixes,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">when</span> EMACS28+
  (add-hook 'latex-mode-hook #'TeX-latex-mode))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-python" class="outline-3">
<h3 id="python"><span class="section-number-3">6.5</span> Python<a aria-hidden="true" href="#python">#</a> </h3>
<div class="outline-text-3" id="text-6-5">
<p>
Since I&rsquo;m using <kbd>mypyls</kbd>, as suggested in <a href="file:///home/runner/.emacs.d/modules/lang/python/README.html#MissingReference">:lang python <span class='acr'>LSP</span> support</a> I&rsquo;ll tweak the
priority of <kbd>mypyls</kbd>
</p>
<details id='python,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#python,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> lsp-python-ms
  (set-lsp-priority! 'mspyls <span class="org-highlight-numbers-number">1</span>))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-pdf" class="outline-3">
<h3 id="pdf"><span class="section-number-3">6.6</span> <span class='acr'><span class='acr'>PDF</span></span><a aria-hidden="true" href="#pdf">#</a> </h3>
<div class="outline-text-3" id="text-6-6">
<p>
<kbd>pdf-tools</kbd> is quite nice (though <kbd>paper</kbd> is looking quite promising), however
sometimes I&rsquo;m in a terminal and I still want to see the content. Additionally,
sometimes I&rsquo;d like to act on the content and so would like a plaintext version.
</p>

<div class="info" id="org4c6c508">
<p>
This is a candidate for a dedicated package.
Let me know if you&rsquo;d like to see this.
</p>

</div>

<p>
Thanks to we have a convenient way of performing this
conversion.
</p>

<details id='pdf,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#pdf,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">pdf-text--update</span> (<span class="org-type">&amp;optional</span> _window)
  (<span class="org-keyword">when</span> (eq major-mode 'pdf-text-mode)
    (<span class="org-keyword">let*</span> ((converted-file (expand-file-name (concat
                                              (file-name-base buffer-file-name)
                                              <span class="org-string">"-"</span>
                                              (substring (secure-hash 'sha1 (expand-file-name buffer-file-name)) <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-numbers-number">6</span>)
                                              <span class="org-string">".txt"</span>)
                                             temporary-file-directory))
           (width (number-to-string (- (min (window-width) fill-column)
                                       (<span class="org-keyword">if</span> display-line-numbers display-line-numbers-width <span class="org-highlight-numbers-number">0</span>))))
           (width-adjusted-file (concat (file-name-sans-extension converted-file) <span class="org-string">"-w"</span> width <span class="org-string">".txt"</span>)))
      (<span class="org-keyword">unless</span> (<span class="org-keyword">and</span> (file-exists-p converted-file)
                   (&gt; (time-convert (file-attribute-modification-time (file-attributes converted-file)) 'integer)
                      (time-convert (file-attribute-modification-time (file-attributes buffer-file-name)) 'integer)))
        (call-process <span class="org-string">"pdftotext"</span> nil nil nil <span class="org-string">"-layout"</span> <span class="org-string">"-eol"</span> <span class="org-string">"unix"</span> buffer-file-name converted-file))
      (<span class="org-keyword">unless</span> (<span class="org-keyword">and</span> (file-exists-p width-adjusted-file)
                   (&gt;= (time-convert (file-attribute-modification-time (file-attributes width-adjusted-file)) 'integer)
                       (time-convert (file-attribute-modification-time (file-attributes converted-file)) 'integer)))
        (call-process <span class="org-string">"fmt"</span> nil (list <span class="org-builtin">:file</span> width-adjusted-file) nil <span class="org-string">"-w"</span> width converted-file))
      (<span class="org-keyword">unless</span> (<span class="org-keyword">and</span> (boundp 'pdf-text--file)
                   (string= pdf-text--file width-adjusted-file))
        (<span class="org-keyword">let</span> ((pos (<span class="org-keyword">when</span> (boundp 'pdf-text--file) (pdf-text--position-info))))
          (<span class="org-keyword">with-silent-modifications</span>
            (<span class="org-keyword">let</span> ((inhibit-read-only t)
                  (coding-system-for-read 'utf-8))
              (erase-buffer)
              (insert-file-contents width-adjusted-file)
              (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"\n?\f\n?"</span> nil t)
                (replace-match <span class="org-string">"\n\f\n"</span>))
              (goto-char (point-min)))
            (<span class="org-keyword">setq-local</span> pdf-text--file width-adjusted-file))
          (<span class="org-keyword">setq-default</span> saved-pos pos)
          (<span class="org-keyword">when</span> pos (<span class="org-keyword">ignore-errors</span> (pdf-text--goto-pos pos))))))))
</pre>
</div>
    </details>

<p>
Now we just need to make a mode to use this.
</p>

<details id='pdf,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#pdf,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">define-derived-mode</span> <span class="org-function-name">pdf-text-mode</span> so-long-mode <span class="org-string">"PDF Text"</span> <span class="org-comment-delimiter">; </span><span class="org-comment">so-long for the initial buffer load time</span>
  <span class="org-doc">"Major mode for viewing the plaintext version of a PDF."</span>
  (set-buffer-multibyte t)
  (read-only-mode t)
  (add-hook 'before-save-hook (<span class="org-keyword">lambda</span> () (<span class="org-warning">user-error</span> <span class="org-string">"Will not overwrite PDF with plaintext version"</span>)))
  (<span class="org-keyword">dolist</span> (hook '(window-configuration-change-hook
                  window-size-change-functions
                  display-line-numbers-mode-hook))
    (add-hook hook 'pdf-text--update))
  (pdf-text--update)
  (text-mode)
  (<span class="org-keyword">setq</span> mode-name <span class="org-string">"PDF Text"</span>))
</pre>
</div>
    </details>

<p>
In <code class="src src-elisp">(pdf-text--update)</code> there&rsquo;s mention of position saving and
restoring. This needs to be implemented, and it&rsquo;s a bit difficult since the line
numbers and buffer positions are liable to change. So, instead we can try to
take note of some markers (such as the line breaks) and try to make our way to
them.
</p>

<details id='pdf,code--3' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#pdf,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">pdf-text--position-info</span> ()
  (list <span class="org-builtin">:page-no</span> (<span class="org-keyword">let</span> ((current-point (point))
                       (page-no <span class="org-highlight-numbers-number">0</span>))
                   (<span class="org-keyword">save-excursion</span>
                     (<span class="org-keyword">while</span> (search-forward <span class="org-string">"\f"</span> current-point t)
                       (<span class="org-keyword">setq</span> page-no (1+ page-no))))
                   page-no)
        <span class="org-builtin">:par-start</span> (<span class="org-keyword">save-excursion</span>
                     (forward-paragraph <span class="org-highlight-numbers-number">-1</span>)
                     (forward-line <span class="org-highlight-numbers-number">1</span>)
                     (thing-at-point 'line t))
        <span class="org-builtin">:previous-line-content</span> (<span class="org-keyword">save-excursion</span>
                                 (forward-line <span class="org-highlight-numbers-number">-1</span>)
                                 (thing-at-point 'line t))))

(<span class="org-keyword">defun</span> <span class="org-function-name">pdf-text--goto-pos</span> (pos)
  (goto-char (point-min))
  (search-forward <span class="org-string">"\f"</span> nil nil (plist-get pos <span class="org-builtin">:page-no</span>))
  (re-search-forward (replace-regexp-in-string <span class="org-string">" +"</span> <span class="org-string">"[ \n]+"</span> (regexp-quote (plist-get pos <span class="org-builtin">:par-start</span>))))
  (<span class="org-keyword">unless</span> (string= (plist-get pos <span class="org-builtin">:par-start</span>)
                   (plist-get pos <span class="org-builtin">:previous-line-content</span>))
    (re-search-forward (replace-regexp-in-string <span class="org-string">" +"</span> <span class="org-string">"[ \n]+"</span> (regexp-quote (plist-get pos <span class="org-builtin">:previous-line-content</span>)))
                       (<span class="org-keyword">save-excursion</span> (forward-paragraph <span class="org-highlight-numbers-number">1</span>) (point)))))
</pre>
</div>
    </details>

<p>
Unfortunately while in isolated testing this position restoring works well, for
some reason as it&rsquo;s currently used it doesn&rsquo;t seem to work at all.
</p>

<p>
The output can be slightly nicer without spelling errors, and with prettier page
feeds (<kbd>^L</kbd> by default).
</p>

<details id='pdf,code--4' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#pdf,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'pdf-text-mode-hook #'spell-fu-mode-disable)
(add-hook 'pdf-text-mode-hook (<span class="org-keyword">lambda</span> () (page-break-lines-mode <span class="org-highlight-numbers-number">1</span>)))
</pre>
</div>
    </details>

<p>
This is very nice, now we just need to associate it with <kbd>.pdf</kbd> files, and make
sure <kbd>pdf-tools</kbd> doesn&rsquo;t take priority.
</p>

<details id='pdf,code--5' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#pdf,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">pdf-text-auto-mode-alist-entry</span>
  '(<span class="org-string">"\\.[pP][dD][fF]\\'"</span> . pdf-text-mode)
  <span class="org-doc">"The entry to use for `</span><span class="org-doc"><span class="org-constant">auto-mode-alist</span></span><span class="org-doc">'."</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">pdf-text-install</span> ()
  <span class="org-doc">"Add a \".pdf\" associaton for all future buffers."</span>
  (<span class="org-keyword">interactive</span>)
  (add-to-list 'auto-mode-alist pdf-text-auto-mode-alist-entry)
  (<span class="org-keyword">when</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">pdf-tools</span>)
    (<span class="org-keyword">setq-default</span> auto-mode-alist
                  (remove pdf-tools-auto-mode-alist-entry auto-mode-alist))
    (<span class="org-keyword">setq-default</span> magic-mode-alist
                  (remove pdf-tools-magic-mode-alist-entry magic-mode-alist))))

(<span class="org-keyword">defun</span> <span class="org-function-name">pdf-tools-uninstall</span> ()
  <span class="org-doc">"Remove the \".pdf\" associaton for all future buffers."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">setq-default</span> auto-mode-alist
                (remove pdf-text-auto-mode-alist-entry auto-mode-alist)))
</pre>
</div>
    </details>

<p>
Lastly, whenever Emacs is non-graphical (i.e. a <span class='acr'>TUI</span>), we want to use this by default.
</p>

<details id='pdf,code--6' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#pdf,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">unless</span> (display-graphic-p)
  (pdf-text-install)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">From Doom's :tools pdf (use-package! pdf-tools)</span>
  (<span class="org-keyword">setq-default</span> auto-mode-alist
                (remove '(<span class="org-string">"\\.pdf\\'"</span> . pdf-view-mode) auto-mode-alist))
  (<span class="org-keyword">setq-default</span> magic-mode-alist
                (remove '(<span class="org-string">"%PDF"</span> . pdf-view-mode) magic-mode-alist))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">I have no idea why this is needed</span>
  (<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> pdf-text-mode-map
        <span class="org-string">"&lt;mouse-4&gt;"</span> (<span class="org-keyword">cmd!</span> (scroll-down mouse-wheel-scroll-amount-horizontal))
        <span class="org-string">"&lt;mouse-5&gt;"</span> (<span class="org-keyword">cmd!</span> (scroll-up mouse-wheel-scroll-amount-horizontal))))
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-r" class="outline-3">
<h3 id="r"><span class="section-number-3">6.7</span> R<a aria-hidden="true" href="#r">#</a> </h3>
<div class="outline-text-3" id="text-6-7">
</div>
<div id="outline-container-r-editor-visuals" class="outline-4">
<h4 id="r-editor-visuals"><span class="section-number-4">6.7.1</span> Editor Visuals<a aria-hidden="true" href="#r-editor-visuals">#</a> </h4>
<div class="outline-text-4" id="text-6-7-1">
<details id='editor-visuals,code--5' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#editor-visuals,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> ess-r-mode
  (<span class="org-keyword">appendq!</span> +ligatures-extra-symbols
            '(<span class="org-builtin">:assign</span> <span class="org-string">"&#10229;"</span>
              <span class="org-builtin">:multiply</span> <span class="org-string">"&#215;"</span>))
  (set-ligatures! 'ess-r-mode
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Functional</span>
    <span class="org-builtin">:def</span> <span class="org-string">"function"</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Types</span>
    <span class="org-builtin">:null</span> <span class="org-string">"NULL"</span>
    <span class="org-builtin">:true</span> <span class="org-string">"TRUE"</span>
    <span class="org-builtin">:false</span> <span class="org-string">"FALSE"</span>
    <span class="org-builtin">:int</span> <span class="org-string">"int"</span>
    <span class="org-builtin">:floar</span> <span class="org-string">"float"</span>
    <span class="org-builtin">:bool</span> <span class="org-string">"bool"</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Flow</span>
    <span class="org-builtin">:not</span> <span class="org-string">"!"</span>
    <span class="org-builtin">:and</span> <span class="org-string">"&amp;&amp;"</span> <span class="org-builtin">:or</span> <span class="org-string">"||"</span>
    <span class="org-builtin">:for</span> <span class="org-string">"for"</span>
    <span class="org-builtin">:in</span> <span class="org-string">"%in%"</span>
    <span class="org-builtin">:return</span> <span class="org-string">"return"</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Other</span>
    <span class="org-builtin">:assign</span> <span class="org-string">"&lt;-"</span>
    <span class="org-builtin">:multiply</span> <span class="org-string">"%*%"</span>))
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-julia" class="outline-3">
<h3 id="julia"><span class="section-number-3">6.8</span> Julia<a aria-hidden="true" href="#julia">#</a> </h3>
<div class="outline-text-3" id="text-6-8">
<p>
As mentioned in <a href="https://github.com/non-Jedi/lsp-julia/issues/35">lsp-julia#35</a>, <kbd>lsp-mode</kbd> seems to serve an invalid response to the
Julia server. The pseudo-fix is rather simple at least
</p>
<details id='julia,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#julia,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> julia-mode
  (<span class="org-keyword">add-hook!</span> 'julia-mode-hook
    (<span class="org-keyword">setq-local</span> lsp-enable-folding t
                lsp-folding-range-limit <span class="org-highlight-numbers-number">100</span>)))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-language-configuration-graphviz" class="outline-3">
<h3 id="language-configuration-graphviz"><span class="section-number-3">6.9</span> Graphviz<a aria-hidden="true" href="#language-configuration-graphviz">#</a> </h3>
<div class="outline-text-3" id="text-6-9">
<details id='graphviz,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#graphviz,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> graphviz-dot-mode
  <span class="org-builtin">:commands</span> graphviz-dot-mode
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.dot\\'"</span> <span class="org-string">"\\.gz\\'"</span>)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">after!</span> org
    (setcdr (assoc <span class="org-string">"dot"</span> org-src-lang-modes)
            'graphviz-dot)))

(<span class="org-keyword">use-package!</span> company-graphviz-dot
  <span class="org-builtin">:after</span> graphviz-dot-mode)
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-markdown" class="outline-3">
<h3 id="markdown"><span class="section-number-3">6.10</span> Markdown<a aria-hidden="true" href="#markdown">#</a> </h3>
<div class="outline-text-3" id="text-6-10">
<p>
Most of the time when I write markdown, it&rsquo;s going into some app/website which
will do it&rsquo;s own line wrapping, hence we <i>only</i> want to use visual line wrapping. No hard stuff.
</p>
<details id='markdown,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#markdown,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">add-hook!</span> (gfm-mode markdown-mode) #'visual-line-mode #'turn-off-auto-fill)
</pre>
</div>
    </details>

<p>
Since markdown is often seen as rendered <span class='acr'>HTML</span>, let&rsquo;s try to somewhat mirror the
style or markdown renderers.
</p>

<p>
Most markdown renders seem to make the first three headings levels larger than
normal text, the first two much so. Then the fourth level tends to be the same
as body text, while the fifth and sixth are (increasingly) smaller, with the
sixth greyed out. Since the sixth level is so small, I&rsquo;ll turn up the boldness a notch.
</p>
<details id='markdown,code--2' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#markdown,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">custom-set-faces!</span>
  '(markdown-header-face-1 <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.25</span> <span class="org-builtin">:weight</span> extra-bold <span class="org-builtin">:inherit</span> markdown-header-face)
  '(markdown-header-face-2 <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.15</span> <span class="org-builtin">:weight</span> bold       <span class="org-builtin">:inherit</span> markdown-header-face)
  '(markdown-header-face-3 <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.08</span> <span class="org-builtin">:weight</span> bold       <span class="org-builtin">:inherit</span> markdown-header-face)
  '(markdown-header-face-4 <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.00</span> <span class="org-builtin">:weight</span> bold       <span class="org-builtin">:inherit</span> markdown-header-face)
  '(markdown-header-face-5 <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">0.90</span> <span class="org-builtin">:weight</span> bold       <span class="org-builtin">:inherit</span> markdown-header-face)
  '(markdown-header-face-6 <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">0.75</span> <span class="org-builtin">:weight</span> extra-bold <span class="org-builtin">:inherit</span> markdown-header-face))
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-beancount" class="outline-3">
<h3 id="beancount"><span class="section-number-3">6.11</span> Beancount<a aria-hidden="true" href="#beancount">#</a> </h3>
<div class="outline-text-3" id="text-6-11">
<p>
There are a number of rather compelling advantages to <a href="https://plaintextaccounting.org/">plain text accounting</a>,
with <a href="https://www.ledger-cli.org/">ledger</a> being the most obvious example. However, <a href="https://github.com/beancount/beancount">beancount</a>, a more recent
implementation of the idea is ledger-compatible (meaning I can switch easily if
I change my mind) and has a gorgeous front-end &#x2014; <a href="https://beancount.github.io/fava/">fava</a>.
</p>

<p>
Of course, there&rsquo;s an Emacs mode for this.
</p>

<details id='beancount,code--1' class='code' open><summary><span class="lang">Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#beancount,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> beancount
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.beancount\\'"</span> . beancount-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">after!</span> all-the-icons
    (add-to-list 'all-the-icons-icon-alist
                 '(<span class="org-string">"\\.beancount\\'"</span> all-the-icons-material <span class="org-string">"attach_money"</span> <span class="org-builtin">:face</span> all-the-icons-lblue))
    (add-to-list 'all-the-icons-mode-icon-alist
                 '(beancount-mode all-the-icons-material <span class="org-string">"attach_money"</span> <span class="org-builtin">:face</span> all-the-icons-lblue)))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> beancount-electric-currency t)
  (<span class="org-keyword">defun</span> <span class="org-function-name">beancount-bal</span> ()
    <span class="org-doc">"Run bean-report bal."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let</span> ((compilation-read-command nil))
      (beancount--run <span class="org-string">"bean-report"</span>
                      (file-relative-name buffer-file-name) <span class="org-string">"bal"</span>)))
  (<span class="org-keyword">map!</span> <span class="org-builtin">:map</span> beancount-mode-map
        <span class="org-builtin">:n</span> <span class="org-string">"TAB"</span> #'beancount-align-to-previous-number
        <span class="org-builtin">:i</span> <span class="org-string">"RET"</span> (<span class="org-keyword">cmd!</span> (newline-and-indent) (beancount-align-to-previous-number))))
</pre>
</div>
    </details>
</div>
</div>


<div id="outline-container-snippets" class="outline-3">
<h3 id="snippets"><span class="section-number-3">6.12</span> Snippets<a aria-hidden="true" href="#snippets">#</a> </h3>
<div class="outline-text-3" id="text-6-12">
</div>
<div id="outline-container-latex-mode" class="outline-4">
<h4 id="latex-mode"><span class="section-number-4">6.12.1</span> Latex mode<a aria-hidden="true" href="#latex-mode">#</a> </h4>
<div class="outline-text-4" id="text-6-12-1">
<p>
File template
</p>
<details id='latex-mode,code--1' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: LaTeX template                                                                                         </span>
<span class="org-comment"># --</span>
\documentclass${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:opt1,...<span class="org-keyword">}</span>]<span class="org-keyword">}</span>{`(tec/yas-latex-get-class-choice)`<span class="org-keyword">}</span>

\title{${<span class="org-warning">3</span>:`(s-titleized-words (file-name-base (<span class="org-keyword">or</span> buffer-file-name <span class="org-string">"new buffer"</span>)))`<span class="org-keyword">}}</span>
\author{${<span class="org-warning">4</span>:`(user-full-name)`<span class="org-keyword">}}</span>
\date{${<span class="org-warning">5</span>:`(format-time-string <span class="org-string">"%Y-%m-%d"</span>)`<span class="org-keyword">}}</span>
`(<span class="org-keyword">if</span> (tec/yas-latex-preamble-if) tec/yas-latex-template-preamble <span class="org-string">""</span>)`
\begin{document<span class="org-keyword">}</span>

\maketitle

<span class="org-keyword">$</span><span class="org-string">0</span>

\end{document<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
Deliminators
</p>
<details id='latex-mode,code--2' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># name: _deliminators                                                                 </span>
<span class="org-comment"># --</span>
\left`(tec/tex-open-delim-from-char)` `%`<span class="org-keyword">$</span><span class="org-string">1</span> \right`(tec/tex-close-delim-from-char)` <span class="org-keyword">$</span><span class="org-string">0</span>

</pre>
</div>
    </details>

<p>
Aligned equals
</p>
<details id='latex-mode,code--3' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># key: ==</span>
<span class="org-comment"># name: aligned equals</span>
<span class="org-comment"># --</span>
<span class="org-type">&amp;=</span> 
</pre>
</div>
    </details>

<p>
Begin alias
</p>
<details id='latex-mode,code--4' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: begin-alias</span>
<span class="org-comment"># key: beg</span>
<span class="org-comment"># type: command</span>
<span class="org-comment"># --</span>
(doom-snippets-expand :name <span class="org-string">"begin"</span>)
</pre>
</div>
    </details>

<p>
Cases
</p>
<details id='latex-mode,code--5' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># key: cs</span>
<span class="org-comment"># name: cases</span>
<span class="org-comment"># group: math</span>
<span class="org-comment"># condition: (texmathp)</span>
<span class="org-comment"># --</span>
\begin{cases<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">1</span>
\end{cases<span class="org-keyword">}$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Code
</p>
<details id='latex-mode,code--6' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: code</span>
<span class="org-comment"># --</span>
\begin{minted<span class="org-keyword">}</span>{${<span class="org-warning">1</span>:language<span class="org-keyword">}}</span>
${<span class="org-warning">0</span>:`%`<span class="org-keyword">}</span>
\end{minted<span class="org-keyword">}</span>

</pre>
</div>
    </details>

<p>
Corollary
</p>
<details id='latex-mode,code--7' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--7'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: corollary</span>
<span class="org-comment"># key: clr</span>
<span class="org-comment"># group: theorems</span>
<span class="org-comment"># --</span>
\begin{corollary<span class="org-keyword">}</span>${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:name<span class="org-keyword">}</span>]<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{corollary<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
Definition
</p>
<details id='latex-mode,code--8' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--8'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: definition</span>
<span class="org-comment"># key: def</span>
<span class="org-comment"># group: theorems</span>
<span class="org-comment"># --</span>
\begin{definition<span class="org-keyword">}</span>${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:name<span class="org-keyword">}</span>]<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{definition<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
Deliminators
</p>
<details id='latex-mode,code--9' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--9'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: deliminators</span>
<span class="org-comment"># key: @</span>
<span class="org-comment"># condition: (texmathp)</span>
<span class="org-comment"># type: command                                                    </span>
<span class="org-comment"># --</span>
(tec/get-open-delim-char)
(yas-expand-snippet (yas-lookup-snippet <span class="org-string">"_deliminators"</span> 'latex-mode))
</pre>
</div>
    </details>

<p>
Deliminators angle
</p>
<details id='latex-mode,code--10' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--10'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: deliminators - angle &lt;&gt;</span>
<span class="org-comment"># key: &lt;</span>
<span class="org-comment"># condition: (texmathp)</span>
<span class="org-comment"># type: command                  </span>
<span class="org-comment"># --</span>
(<span class="org-keyword">setq</span> tec/tex-last-delim-char ?\&lt;)
(<span class="org-keyword">setq</span> tec/tex-delim-dot-second nil)
(tec/tex-delim-yas-expand)
</pre>
</div>
    </details>

<p>
Deliminators bracket
</p>
<details id='latex-mode,code--11' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--11'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: deliminators - bracket []</span>
<span class="org-comment"># key: [</span>
<span class="org-comment"># condition: (texmathp)</span>
<span class="org-comment"># type: command</span>
<span class="org-comment"># --</span>
(<span class="org-keyword">setq</span> tec/tex-last-delim-char ?\[)
(<span class="org-keyword">setq</span> tec/tex-delim-dot-second nil)
(tec/tex-delim-yas-expand)
</pre>
</div>
    </details>

<p>
Deliminators curly
</p>
<details id='latex-mode,code--12' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--12'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: deliminators - curley {}</span>
<span class="org-comment"># key: {</span>
<span class="org-comment"># condition: (texmathp)</span>
<span class="org-comment"># type: command                  </span>
<span class="org-comment"># --</span>
(<span class="org-keyword">setq</span> tec/tex-last-delim-char ?\{)
(<span class="org-keyword">setq</span> tec/tex-delim-dot-second nil)
(tec/tex-delim-yas-expand)

</pre>
</div>
    </details>

<p>
Deliminators paren
</p>
<details id='latex-mode,code--13' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--13'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: deliminators - paren ()</span>
<span class="org-comment"># key: (</span>
<span class="org-comment"># condition: (texmathp)</span>
<span class="org-comment"># type: command</span>
<span class="org-comment"># --</span>
(<span class="org-keyword">setq</span> tec/tex-last-delim-char ?\()
(<span class="org-keyword">setq</span> tec/tex-delim-dot-second nil)
(tec/tex-delim-yas-expand)
</pre>
</div>
    </details>

<p>
Enumerate
</p>
<details id='latex-mode,code--14' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--14'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: enumerate</span>
<span class="org-comment"># key: en          </span>
<span class="org-comment"># --</span>
\begin{enumerate<span class="org-keyword">}</span>
`(<span class="org-keyword">if</span> % % <span class="org-string">"  \\item "</span>)`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{enumerate<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
Example
</p>
<details id='latex-mode,code--15' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--15'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: example</span>
<span class="org-comment"># key: eg</span>
<span class="org-comment"># group: theorems</span>
<span class="org-comment"># --</span>
\begin{example<span class="org-keyword">}</span>${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:name<span class="org-keyword">}</span>]<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{example<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
Frac short
</p>
<details id='latex-mode,code--16' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--16'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># key: /</span>
<span class="org-comment"># name: frac-short</span>
<span class="org-comment"># group: math</span>
<span class="org-comment"># condition: (texmathp)      </span>
<span class="org-comment"># --</span>
\frac{${<span class="org-warning">1</span>:`(<span class="org-keyword">or</span> % <span class="org-string">""</span>)`<span class="org-keyword">}}</span>{<span class="org-keyword">$</span><span class="org-string">2</span><span class="org-keyword">}$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Int ^
</p>
<details id='latex-mode,code--17' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--17'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># key: int</span>
<span class="org-comment"># name: int_^</span>
<span class="org-comment"># --</span>
\int${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"_"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"{"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">1</span>:left<span class="org-keyword">}</span>${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"}"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"^"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"{"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:right<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"}"</span>)<span class="org-keyword">}</span> <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Itemize
</p>
<details id='latex-mode,code--18' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--18'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: itemize</span>
<span class="org-comment"># key: it</span>
<span class="org-comment"># uuid: it              </span>
<span class="org-comment"># --</span>
\begin{itemize<span class="org-keyword">}</span>
`(<span class="org-keyword">if</span> % % <span class="org-string">"  \\item "</span>)`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{itemize<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
Lemma
</p>
<details id='latex-mode,code--19' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--19'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: lemma</span>
<span class="org-comment"># key: lmm</span>
<span class="org-comment"># group: theorems</span>
<span class="org-comment"># --</span>
\begin{lemma<span class="org-keyword">}</span>${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:name<span class="org-keyword">}</span>]<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{lemma<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
Lim
</p>
<details id='latex-mode,code--20' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--20'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: lim</span>
<span class="org-comment"># key: lim</span>
<span class="org-comment"># --</span>
\lim_{${<span class="org-warning">1</span>:n<span class="org-keyword">}</span> \to ${<span class="org-warning">2</span>:\infty<span class="org-keyword">}}</span> <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Mathclap
</p>
<details id='latex-mode,code--21' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--21'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># key: mc</span>
<span class="org-comment"># name: mathclap</span>
<span class="org-comment"># group: math</span>
<span class="org-comment"># condition: (texmathp)</span>
<span class="org-comment"># --</span>
\mathclap{`%`<span class="org-keyword">$</span><span class="org-string">1</span><span class="org-keyword">}$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Prod ^
</p>
<details id='latex-mode,code--22' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--22'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># key: prod</span>
<span class="org-comment"># name: prod_^</span>
<span class="org-comment"># --</span>
\prod${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"_"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"{"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">1</span>:i=1<span class="org-keyword">}</span>${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"}"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"^"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"{"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:n<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"}"</span>)<span class="org-keyword">}</span> <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Proof
</p>
<details id='latex-mode,code--23' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--23'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: proof</span>
<span class="org-comment"># key: prf</span>
<span class="org-comment"># group: theorems</span>
<span class="org-comment"># --</span>
\begin{proof<span class="org-keyword">}</span>${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:name<span class="org-keyword">}</span>]<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{proof<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
Remark
</p>
<details id='latex-mode,code--24' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--24'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: remark</span>
<span class="org-comment"># key: rmk</span>
<span class="org-comment"># group: theorems</span>
<span class="org-comment"># --</span>
\begin{remark<span class="org-keyword">}</span>${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:name<span class="org-keyword">}</span>]<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{remark<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
Sum ^
</p>
<details id='latex-mode,code--25' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--25'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># key: sum</span>
<span class="org-comment"># name: sum_^</span>
<span class="org-comment"># --</span>
\sum${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"_"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"{"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">1</span>:i=1<span class="org-keyword">}</span>${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"}"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"^"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"{"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:n<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"}"</span>)<span class="org-keyword">}</span> <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Theorem
</p>
<details id='latex-mode,code--26' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--26'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: theorem</span>
<span class="org-comment"># key: thm</span>
<span class="org-comment"># group: theorems</span>
<span class="org-comment"># --</span>
\begin{theorem<span class="org-keyword">}</span>${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:name<span class="org-keyword">}</span>]<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{theorem<span class="org-keyword">}</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-markdown-mode" class="outline-4">
<h4 id="markdown-mode"><span class="section-number-4">6.12.2</span> Markdown mode<a aria-hidden="true" href="#markdown-mode">#</a> </h4>
<div class="outline-text-4" id="text-6-12-2">
<p>
File template
</p>
<details id='markdown-mode,code--1' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#markdown-mode,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Org template</span>
<span class="org-comment"># --</span>
# ${<span class="org-warning">1</span>:`(s-titleized-words (file-name-base (<span class="org-keyword">or</span> buffer-file-name <span class="org-string">"new buffer"</span>)))`<span class="org-keyword">}</span>

<span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-snippets-org-mode" class="outline-4">
<h4 id="snippets-org-mode"><span class="section-number-4">6.12.3</span> Org mode<a aria-hidden="true" href="#snippets-org-mode">#</a> </h4>
<div class="outline-text-4" id="text-6-12-3">
<p>
File template
</p>
<details id='org-mode,code--2' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Org template</span>
<span class="org-comment"># --</span>
#+title: ${<span class="org-warning">1</span>:`(s-titleized-words (replace-regexp-in-string <span class="org-string">"^[0-9]\\{4\\}-[0-9][0-9]-[0-9][0-9]-"</span> <span class="org-string">""</span> (file-name-base (<span class="org-keyword">or</span> buffer-file-name <span class="org-string">"new buffer"</span>))))`<span class="org-keyword">}</span>
#+author: ${<span class="org-warning">2</span>:`(user-full-name)`<span class="org-keyword">}</span>
#+date: ${<span class="org-warning">3</span>:`(format-time-string <span class="org-string">"%Y-%m-%d"</span>)`<span class="org-keyword">}</span>

<span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Display maths
</p>
<details id='org-mode,code--3' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: display math</span>
<span class="org-comment"># key: M</span>
<span class="org-comment"># condition: t</span>
# expand-env: ((yas-after-exit-snippet-hook (<span class="org-keyword">lambda</span> () (org-edit-latex-fragment) (evil-insert-state) (insert <span class="org-string">"\n  \n"</span>) (left-char))))
<span class="org-comment"># --</span>
\\[`%`<span class="org-keyword">$</span><span class="org-string">0</span>\\]
</pre>
</div>
    </details>

<p>
Elisp source
</p>
<details id='org-mode,code--4' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: elisp src</span>
<span class="org-comment"># uuid: src_elisp</span>
<span class="org-comment"># key: &lt;el</span>
<span class="org-comment"># condition: t</span>
<span class="org-comment"># expand-env: ((yas-after-exit-snippet-hook #'org-edit-src-code))</span>
<span class="org-comment"># --</span>
<span class="org-comment">#+begin_src emacs-lisp</span>
`%`<span class="org-keyword">$</span><span class="org-string">0</span>
<span class="org-comment">#+end_src</span>
</pre>
</div>
    </details>

<p>
Global property
</p>
<details id='org-mode,code--5' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Global property</span>
<span class="org-comment"># key: #+p</span>
# condition: (&gt; <span class="org-highlight-numbers-number">20</span> (line-number-at-pos))
<span class="org-comment"># --</span>
<span class="org-comment">#+property: $</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Header argument dir
</p>
<details id='org-mode,code--6' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - dir</span>
<span class="org-comment"># key: d</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
:dir `(file-relative-name (read-directory-name <span class="org-string">"Working directory: "</span>))` <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Header argument eval
</p>
<details id='org-mode,code--7' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--7'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - eval</span>
<span class="org-comment"># key: v</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
`(<span class="org-keyword">let</span> ((out (+yas/org-prompt-header-arg :eval <span class="org-string">"Evaluate: "</span> '(<span class="org-string">"no"</span> <span class="org-string">"query"</span> <span class="org-string">"no-export"</span> <span class="org-string">"query-export"</span>)))) (<span class="org-keyword">if</span> out (concat <span class="org-string">":eval "</span> out <span class="org-string">" "</span>) <span class="org-string">""</span>))`
</pre>
</div>
    </details>

<p>
Header argument export
</p>
<details id='org-mode,code--8' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--8'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - export</span>
<span class="org-comment"># key: e</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
`(<span class="org-keyword">let</span> ((out (+yas/org-prompt-header-arg :exports <span class="org-string">"Exports: "</span> '(<span class="org-string">"code"</span> <span class="org-string">"results"</span> <span class="org-string">"both"</span> <span class="org-string">"none"</span>)))) (<span class="org-keyword">if</span> out (concat <span class="org-string">":exports "</span> out <span class="org-string">" "</span>) <span class="org-string">""</span>))`
</pre>
</div>
    </details>

<p>
Header argument file
</p>
<details id='org-mode,code--9' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--9'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - file</span>
<span class="org-comment"># key: f</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
:file <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Header argument graphics
</p>
<details id='org-mode,code--10' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--10'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - graphics</span>
<span class="org-comment"># key: g</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
:results file graphics <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Header argument height
</p>
<details id='org-mode,code--11' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--11'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - height</span>
<span class="org-comment"># key: H</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
:height <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Header argument noweb
</p>
<details id='org-mode,code--12' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--12'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - noweb</span>
<span class="org-comment"># key: n</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
`(<span class="org-keyword">let</span> ((out (+yas/org-prompt-header-arg :noweb <span class="org-string">"NoWeb: "</span> '(<span class="org-string">"no"</span> <span class="org-string">"yes"</span> <span class="org-string">"tangle"</span> <span class="org-string">"no-export"</span> <span class="org-string">"strip-export"</span> <span class="org-string">"eval"</span>)))) (<span class="org-keyword">if</span> out (concat <span class="org-string">":noweb "</span> out <span class="org-string">" "</span>) <span class="org-string">""</span>))`
</pre>
</div>
    </details>

<p>
Header argument output
</p>
<details id='org-mode,code--13' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--13'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - output</span>
<span class="org-comment"># key: o</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
:results output <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Header argument results
</p>
<details id='org-mode,code--14' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--14'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - results</span>
<span class="org-comment"># key: r</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
`(<span class="org-keyword">let</span> ((out
(string-trim-right
 (concat
  (+yas/org-prompt-header-arg :results <span class="org-string">"Result collection: "</span> '(<span class="org-string">"value "</span> <span class="org-string">"output "</span>))
  (+yas/org-prompt-header-arg :results <span class="org-string">"Results type: "</span> '(<span class="org-string">"table "</span> <span class="org-string">"vector "</span> <span class="org-string">"list "</span> <span class="org-string">"verbatim "</span> <span class="org-string">"file "</span>))
  (+yas/org-prompt-header-arg :results <span class="org-string">"Results format: "</span> '(<span class="org-string">"code "</span> <span class="org-string">"drawer "</span> <span class="org-string">"html "</span> <span class="org-string">"latex "</span> <span class="org-string">"link "</span> <span class="org-string">"graphics "</span> <span class="org-string">"org "</span> <span class="org-string">"pp "</span> <span class="org-string">"raw "</span>))
  (+yas/org-prompt-header-arg :results <span class="org-string">"Result output: "</span> '(<span class="org-string">"silent "</span> <span class="org-string">"replace "</span> <span class="org-string">"append "</span> <span class="org-string">"prepend "</span>))))))
  (<span class="org-keyword">if</span> (string= out <span class="org-string">""</span>) <span class="org-string">""</span>
  (concat <span class="org-string">":results "</span> out <span class="org-string">" "</span>)))
`
</pre>
</div>
    </details>

<p>
Header argument session
</p>
<details id='org-mode,code--15' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--15'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - session</span>
<span class="org-comment"># key: S</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
:session <span class="org-string">"${</span><span class="org-warning">1</span><span class="org-string">:`(file-name-base (or (buffer-file-name) "</span>unnnamed<span class="org-string">"))`-session}"</span> <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Header argument silent
</p>
<details id='org-mode,code--16' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--16'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - silent</span>
<span class="org-comment"># key: s</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
:results silent <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Header argument tangle
</p>
<details id='org-mode,code--17' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--17'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - tangle</span>
<span class="org-comment"># key: t</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
:tangle <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Header argument width
</p>
<details id='org-mode,code--18' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--18'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - width</span>
<span class="org-comment"># key: W</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
:width <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Header argument wrap
</p>
<details id='org-mode,code--19' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--19'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - wrap</span>
<span class="org-comment"># key: w</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
`(<span class="org-keyword">let</span> ((out (+yas/org-prompt-header-arg :noweb <span class="org-string">"Wrap: "</span> '(<span class="org-string">"example"</span> <span class="org-string">"export"</span> <span class="org-string">"comment"</span> <span class="org-string">"src"</span>)))) (<span class="org-keyword">if</span> out (concat <span class="org-string">":wrap "</span> out <span class="org-string">" "</span>) <span class="org-string">""</span>))`
</pre>
</div>
    </details>

<p>
Inline math
</p>
<details id='org-mode,code--20' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--20'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: inline math</span>
<span class="org-comment"># key: m</span>
<span class="org-comment"># condition: t</span>
# expand-env: ((yas-after-exit-snippet-hook (<span class="org-keyword">lambda</span> () (org-edit-latex-fragment) (evil-insert-state) (goto-char <span class="org-highlight-numbers-number">3</span>))))
<span class="org-comment"># --</span>
\\(`%`<span class="org-keyword">$</span><span class="org-string">0</span>\\)
</pre>
</div>
    </details>

<p>
Property header arguments
</p>
<details id='org-mode,code--21' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--21'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Property - header arg</span>
<span class="org-comment"># key: h</span>
# condition: (<span class="org-keyword">or</span> (looking-back <span class="org-string">"^#\\+PROPERTY:.*"</span> (line-beginning-position)) (looking-back <span class="org-string">"^#\\+property:.*"</span> (line-beginning-position)))
<span class="org-comment"># --</span>
header-args:${<span class="org-warning">1</span>:`(<span class="org-keyword">or</span> (+yas/org-most-common-no-property-lang) <span class="org-string">"?"</span>)`<span class="org-keyword">}</span> <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
Python source
</p>
<details id='org-mode,code--22' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--22'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: python src</span>
<span class="org-comment"># uuid: src_python</span>
<span class="org-comment"># key: &lt;py</span>
<span class="org-comment"># condition: t</span>
<span class="org-comment"># expand-env: ((yas-after-exit-snippet-hook #'org-edit-src-code))</span>
<span class="org-comment"># --</span>
<span class="org-comment">#+begin_src python</span>
`%`<span class="org-keyword">$</span><span class="org-string">0</span>
<span class="org-comment">#+end_src</span>
</pre>
</div>
    </details>

<p>
Source
</p>
<details id='org-mode,code--23' class='code' open><summary><span class="lang">snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--23'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: #+begin_src</span>
<span class="org-comment"># uuid: src</span>
<span class="org-comment"># key: src</span>
<span class="org-comment"># --</span>
#+begin_src ${<span class="org-warning">1</span>:`(<span class="org-keyword">or</span> (+yas/org-last-src-lang) <span class="org-string">"?"</span>)`<span class="org-keyword">}</span>
`%`<span class="org-keyword">$</span><span class="org-string">0</span>
<span class="org-comment">#+end_src</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: <!--<a href="https://github.com/tecosaur/emacs-config/commit/402879a" style="text-decoration: none"><code style="padding: 0; color: var(--text-light); font-size: inherit; opacity: 0.7">402879a</code></a>--> 2021-07-08 18:40 <span class='acr'>UTC</span>, <a href="https://github.com/tecosaur/emacs-config/commit/402879a" style="text-decoration: none"><code style="padding: 0; color: var(--text-light); font-size: inherit; opacity: 0.7">402879a</code></a></p>
<p class="author">Author: tecosaur</p>
<p class="date">Created: 2021-07-08 Thu 18:42</p>
</div>
</div>
</body>
</html>
